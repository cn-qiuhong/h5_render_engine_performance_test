var Laya=window.Laya=function(l,t){var u={__internals:[],__packages:{},__classmap:{Object:Object,Function:Function,Array:Array,String:String},__sysClass:{object:"Object",array:"Array",string:"String",dictionary:"Dictionary"},__propun:{writable:true,enumerable:false,configurable:true},__presubstr:String.prototype.substr,__substr:function(t,e){return arguments.length==1?u.__presubstr.call(this,t):u.__presubstr.call(this,t,e>0?e:this.length+e)},__init:function(t){t.forEach(function(t){t.__init$&&t.__init$()})},__isClass:function(t){return t&&(t.__isclass||t==Object||t==String||t==Array)},__newvec:function(t,e){var i=[];i.length=t;for(var r=0;r<t;r++)i[r]=e;return i},__extend:function(t,e){for(var i in e){if(!e.hasOwnProperty(i))continue;var r=Object.getOwnPropertyDescriptor(e,i);var n=r.get,s=r.set;if(n||s){if(n&&s)Object.defineProperty(t,i,r);else{n&&Object.defineProperty(t,i,n);s&&Object.defineProperty(t,i,s)}}else t[i]=e[i]}function a(){u.un(this,"constructor",t)}a.prototype=e.prototype;t.prototype=new a;u.un(t.prototype,"__imps",u.__copy({},e.prototype.__imps))},__copy:function(t,e){if(!e)return null;t=t||{};for(var i in e)t[i]=e[i];return t},__package:function(t,e){if(u.__packages[t])return;u.__packages[t]=true;var i=l,r=t.split(".");if(r.length>1){for(var n=0,s=r.length-1;n<s;n++){var a=i[r[n]];i=a?a:i[r[n]]={}}}i[r[r.length-1]]||(i[r[r.length-1]]=e||{})},__hasOwnProperty:function(t,e){e=e||this;function r(t,e){if(Object.hasOwnProperty.call(e.prototype,t))return true;var i=e.prototype.__super;return i==null?null:r(t,i)}return Object.hasOwnProperty.call(e,t)||r(t,e.__class)},__typeof:function(t,e){if(!t||!e)return false;if(e===String)return typeof t==="string";if(e===Number)return typeof t==="number";if(e.__interface__)e=e.__interface__;else if(typeof e!="string")return t instanceof e;return t.__imps&&t.__imps[e]||t.__class==e},__as:function(t,e){return this.__typeof(t,e)?t:null},__int:function(t){return t?parseInt(t):0},interface:function(t,e){u.__package(t,{});var i=u.__internals;var r=i[t]=i[t]||{self:t};if(e){var n=e.split(",");r.extend=[];for(var s=0;s<n.length;s++){var a=n[s];i[a]=i[a]||{self:a};r.extend.push(i[a])}}var o=l,h=t.split(".");for(var s=0;s<h.length-1;s++)o=o[h[s]];o[h[h.length-1]]={__interface__:t}},class:function(t,e,i,r){i&&u.__extend(t,i);if(e){u.__package(e,t);u.__classmap[e]=t;if(e.indexOf(".")>0){if(e.indexOf("laya.")==0){var n=e.split(".");r=r||n[n.length-1];if(u[r])console.log("Warning!,this class["+r+"] already exist:",u[r]);u[r]=t}}else{if(e=="Main")l.Main=t;else{if(u[e]){console.log("Error!,this class["+e+"] already exist:",u[e])}u[e]=t}}}var s=u.un,a=t.prototype;s(a,"hasOwnProperty",u.__hasOwnProperty);s(a,"__class",t);s(a,"__super",i);s(a,"__className",e);s(t,"__super",i);s(t,"__className",e);s(t,"__isclass",true);s(t,"super",function(t){this.__super.call(t)})},imps:function(t,e){if(!e)return null;var n=t.__imps||u.un(t,"__imps",{});function s(t){var e,i;if(!(e=u.__internals[t]))return;n[t]=true;if(!(i=e.extend))return;for(var r=0;r<i.length;r++){s(i[r].self)}}for(var i in e)s(i)},superSet:function(t,e,i,r){var n=t.prototype["_$set_"+i];n&&n.call(e,r)},superGet:function(t,e,i){var r=t.prototype["_$get_"+i];return r?r.call(e):null},getset:function(t,e,i,r,n){if(!t){r&&u.un(e,"_$get_"+i,r);n&&u.un(e,"_$set_"+i,n)}else{r&&(e["_$GET_"+i]=r);n&&(e["_$SET_"+i]=n)}if(r&&n)Object.defineProperty(e,i,{get:r,set:n,enumerable:false,configurable:true});else{r&&Object.defineProperty(e,i,{get:r,enumerable:false,configurable:true});n&&Object.defineProperty(e,i,{set:n,enumerable:false,configurable:true})}},static:function(i,r){for(var n=0,t=r.length;n<t;n+=2){if(r[n]=="length")i.length=r[n+1].call(i);else{function e(){var e=r[n];var t=r[n+1];Object.defineProperty(i,e,{get:function(){delete this[e];return this[e]=t.call(this)},set:function(t){delete this[e];this[e]=t},enumerable:true,configurable:true})}e()}}},un:function(t,e,i){i||(i=t[e]);u.__propun.value=i;Object.defineProperty(t,e,u.__propun);return i},uns:function(e,t){t.forEach(function(t){u.un(e,t)})}};l.console=l.console||{log:function(){}};l.trace=l.console.log;Error.prototype.throwError=function(){throw arguments};Object.defineProperty(Array.prototype,"fixed",{enumerable:false});return u}(window,document);(function(t,e,i){var r=i.un,n=i.uns,s=i.static,a=i.class,o=i.getset,h=i.__newvec})(window,document,Laya);(function(g,s,y){var t=y.un,e=y.uns,a=y.static,v=y.class,d=y.getset,i=y.__newvec;y.interface("laya.filters.IFilter");y.interface("laya.resource.IDispose");y.interface("laya.resource.IDestroy");y.interface("laya.webgl.submit.ISubmit");y.interface("laya.resource.ICreateResource");y.interface("laya.webgl.canvas.save.ISaveData");y.interface("laya.resource.ISingletonElement");var r=function(){d(1,y,"alertGlobalError",null,function(t){var s=0;if(t){Yt.window.onerror=function(t,e,i,r,n){if(s++<5&&n)alert("出错啦，请把此信息截图给研发商\n"+t+"\n"+n.stack)}}else{Yt.window.onerror=null}});y.init=function(t,e,i){var r=[];for(var n=2,s=arguments.length;n<s;n++)r.push(arguments[n]);if(y._isinit)return;y._isinit=true;ArrayBuffer.prototype.slice||(ArrayBuffer.prototype.slice=y._arrayBufferSlice);Yt.__init__();y.systemTimer=new ht(false);y.startTimer=new ht(false);y.physicsTimer=new ht(false);y.updateTimer=new ht(false);y.lateTimer=new ht(false);y.timer=new ht(false);y.loader=new ci;Ft.__init__();Bt.inner_enable();for(var n=0,a=r.length;n<a;n++){if(r[n]&&r[n].enable){r[n].enable()}}if(Wt.isConchApp){Pe.enableNative()}st.beginCheck();y._currentStage=y.stage=new Oi;nt.rootPath=nt._basePath=y._getUrlPath();y.render=new Wt(0,0);y.stage.size(t,e);g.stage=y.stage;F.__init__();Mt.__init__();D.instance.__init__(y.stage,Wt.canvas);Ui.__init__();We.autoStopMusic=true;return Wt.canvas};y._getUrlPath=function(){var t=Yt.window.location;var e=t.pathname;e=e.charAt(2)==":"?e.substring(1):e;return nt.getPath(t.protocol=="file:"?e:t.protocol+"//"+t.host+t.pathname)};y._arrayBufferSlice=function(t,e){var i=this;var r=new Uint8Array(i,t,e-t);var n=new Uint8Array(r.length);n.set(r);return n.buffer};y._runScript=function(t){return Yt.window[y._evcode](t)};y.enableDebugPanel=function(t){t===void 0&&(t="libs/laya.debugtool.js");if(!y["DebugPanel"]){var e=Yt.createElement("script");e.onload=function(){y["DebugPanel"].enable()};e.src=t;Yt.document.body.appendChild(e)}else{y["DebugPanel"].enable()}};y.stage=null;y.systemTimer=null;y.startTimer=null;y.physicsTimer=null;y.updateTimer=null;y.lateTimer=null;y.timer=null;y.loader=null;y.version="2.1.0beta";y.render=null;y._currentStage=null;y._isinit=false;y.isWXOpenDataContext=false;y.isWXPosMsg=false;a(y,["_evcode",function(){return this._evcode="eva"+"l"}]);return y}();var n=function(){function m(){}v(m,"laya.renders.LayaGLQuickRunner");m.__init__=function(){m.map[1|2|512]=m.alpha_transform_drawLayaGL;m.map[1|512]=m.alpha_drawLayaGL;m.map[2|512]=m.transform_drawLayaGL;m.map[2|8192]=m.transform_drawNodes;m.map[1|2|256]=m.alpha_transform_drawTexture;m.map[1|256]=m.alpha_drawTexture;m.map[2|256]=m.transform_drawTexture;m.map[512|8192]=m.drawLayaGL_drawNodes};m.transform_drawTexture=function(t,e,i,r){var n=t._style;var s=t.texture;e.saveTransform(m.curMat);e.transformByMatrix(t.transform,i,r);e.drawTexture(s,-t.pivotX,-t.pivotY,t._width||s.width,t._height||s.height);e.restoreTransform(m.curMat)};m.alpha_drawTexture=function(t,e,i,r){var n=t._style;var s=NaN;var a=t.texture;if((s=n.alpha)>.01||t._needRepaint()){var o=e.globalAlpha;e.globalAlpha*=s;e.drawTexture(a,i-n.pivotX+a.offsetX,r-n.pivotY+a.offsetY,t._width||a.width,t._height||a.height);e.globalAlpha=o}};m.alpha_transform_drawTexture=function(t,e,i,r){var n=t._style;var s=NaN;var a=t.texture;if((s=n.alpha)>.01||t._needRepaint()){var o=e.globalAlpha;e.globalAlpha*=s;e.saveTransform(m.curMat);e.transformByMatrix(t.transform,i,r);e.drawTexture(a,-n.pivotX+a.offsetX,-n.pivotY+a.offsetY,t._width||a.width,t._height||a.height);e.restoreTransform(m.curMat);e.globalAlpha=o}};m.alpha_transform_drawLayaGL=function(t,e,i,r){var n=t._style;var s=NaN;if((s=n.alpha)>.01||t._needRepaint()){var a=e.globalAlpha;e.globalAlpha*=s;e.saveTransform(m.curMat);e.transformByMatrix(t.transform,i,r);t._graphics&&t._graphics._render(t,e,-n.pivotX,-n.pivotY);e.restoreTransform(m.curMat);e.globalAlpha=a}};m.alpha_drawLayaGL=function(t,e,i,r){var n=t._style;var s=NaN;if((s=n.alpha)>.01||t._needRepaint()){var a=e.globalAlpha;e.globalAlpha*=s;t._graphics&&t._graphics._render(t,e,i-n.pivotX,r-n.pivotY);e.globalAlpha=a}};m.transform_drawLayaGL=function(t,e,i,r){var n=t._style;e.saveTransform(m.curMat);e.transformByMatrix(t.transform,i,r);t._graphics&&t._graphics._render(t,e,-n.pivotX,-n.pivotY);e.restoreTransform(m.curMat)};m.transform_drawNodes=function(t,e,i,r){var n=t._getBit(256)&&e.drawCallOptimize(true);var s=t._style;e.saveTransform(m.curMat);e.transformByMatrix(t.transform,i,r);i=-s.pivotX;r=-s.pivotY;var a=t._children,o=a.length,h;if(s.viewport){var l=s.viewport;var u=l.x;var c=l.y;var f=l.right;var _=l.bottom;var d=NaN,p=NaN;for(v=0;v<o;++v){if((h=a[v])._visible&&((d=h._x)<f&&d+h.width>u&&(p=h._y)<_&&p+h.height>c)){h.render(e,i,r)}}}else{for(var v=0;v<o;++v)(h=a[v])._visible&&h.render(e,i,r)}e.restoreTransform(m.curMat);n&&e.drawCallOptimize(false)};m.drawLayaGL_drawNodes=function(t,e,i,r){var n=t._getBit(256)&&e.drawCallOptimize(true);var s=t._style;i=i-s.pivotX;r=r-s.pivotY;t._graphics&&t._graphics._render(t,e,i,r);var a=t._children,o=a.length,h;if(s.viewport){var l=s.viewport;var u=l.x;var c=l.y;var f=l.right;var _=l.bottom;var d=NaN,p=NaN;for(v=0;v<o;++v){if((h=a[v])._visible&&((d=h._x)<f&&d+h.width>u&&(p=h._y)<_&&p+h.height>c)){h.render(e,i,r)}}}else{for(var v=0;v<o;++v)(h=a[v])._visible&&h.render(e,i,r)}n&&e.drawCallOptimize(false)};m.map={};a(m,["curMat",function(){return this.curMat=new pt}]);return m}();var x=function(){function h(t){this.arrColor=[];if(t==null){this.strColor="#00000000";this.numColor=0;this.arrColor=[0,0,0,0];return}var e=0,i=0;var r=0;if(typeof t=="string"){if(t.indexOf("rgba(")>=0||t.indexOf("rgb(")>=0){var n=t;var s=0,a=0;s=n.indexOf("(");a=n.indexOf(")");n=n.substring(s+1,a);this.arrColor=n.split(",");i=this.arrColor.length;for(e=0;e<i;e++){this.arrColor[e]=parseFloat(this.arrColor[e]);if(e<3){this.arrColor[e]=Math.round(this.arrColor[e])}}if(this.arrColor.length==4){r=((this.arrColor[0]*256+this.arrColor[1])*256+this.arrColor[2])*256+Math.round(this.arrColor[3]*255)}else{r=(this.arrColor[0]*256+this.arrColor[1])*256+this.arrColor[2]}this.strColor=t}else{this.strColor=t;t.charAt(0)==="#"&&(t=t.substr(1));i=t.length;if(i===3||i===4){var o="";for(e=0;e<i;e++){o+=t[e]+t[e]}t=o}r=parseInt(t,16)}}else{r=t;this.strColor=xe.toHexColor(r)}if(this.strColor.indexOf("rgba")>=0||this.strColor.length===9){this.arrColor=[((4278190080&r)>>>24)/255,((16711680&r)>>16)/255,((65280&r)>>8)/255,(255&r)/255];this.numColor=(4278190080&r)>>>24|(r&16711680)>>8|(r&65280)<<8|(r&255)<<24}else{this.arrColor=[((16711680&r)>>16)/255,((65280&r)>>8)/255,(255&r)/255,1];this.numColor=4278190080|(r&16711680)>>16|r&65280|(r&255)<<16}this.arrColor.__id=++h._COLODID}v(h,"laya.utils.ColorUtils");h._initDefault=function(){h._DEFAULT={};for(var t in h._COLOR_MAP)h._SAVE[t]=h._DEFAULT[t]=new h(h._COLOR_MAP[t]);return h._DEFAULT};h._initSaveMap=function(){h._SAVE_SIZE=0;h._SAVE={};for(var t in h._DEFAULT)h._SAVE[t]=h._DEFAULT[t]};h.create=function(t){var e=t+"";var i=h._SAVE[e];if(i!=null)return i;if(h._SAVE_SIZE<1e3)h._initSaveMap();return h._SAVE[e]=new h(t)};h._SAVE={};h._SAVE_SIZE=0;h._COLOR_MAP={purple:"#800080",orange:"#ffa500",white:"#FFFFFF",red:"#FF0000",green:"#00FF00",blue:"#0000FF",black:"#000000",yellow:"#FFFF00",gray:"#808080"};h._DEFAULT=h._initDefault();h._COLODID=1;return h}();var o=function(){function o(){}v(o,"laya.webgl.canvas.save.SaveBase");var t=o.prototype;y.imps(t,{"laya.webgl.canvas.save.ISaveData":true});t.isSaveMark=function(){return false};t.restore=function(t){this._dataObj[this._valueName]=this._value;o.POOL[o.POOL._length++]=this;this._newSubmit&&(t._curSubmit=T.RENDERBASE)};o._createArray=function(){var t=[];t._length=0;return t};o._init=function(){var t=o._namemap={};t[1]="ALPHA";t[2]="fillStyle";t[8]="font";t[256]="lineWidth";t[512]="strokeStyle";t[8192]="_mergeID";t[1024]=t[2048]=t[4096]=[];t[16384]="textBaseline";t[32768]="textAlign";t[65536]="_nBlendType";t[1048576]="shader";t[2097152]="filters";t[8388608]="_colorFiler";return t};o.save=function(t,e,i,r){if((t._saveMark._saveuse&e)!==e){t._saveMark._saveuse|=e;var n=o.POOL;var s=n._length>0?n[--n._length]:new o;s._value=i[s._valueName=o._namemap[e]];s._dataObj=i;s._newSubmit=r;var a=t._save;a[a._length++]=s}};o.POOL=laya.webgl.canvas.save.SaveBase._createArray();o._namemap=o._init();return o}();var T=function(){function a(t){this.clipInfoID=-1;this._mesh=null;this._blendFn=null;this._id=0;this._renderType=0;this._parent=null;this._startIdx=0;this._numEle=0;this._ref=1;this.shaderValue=null;this._key=new Y;t===void 0&&(t=1e4);this._renderType=t;this._id=++a.ID}v(a,"laya.webgl.submit.Submit");var t=a.prototype;y.imps(t,{"laya.webgl.submit.ISubmit":true});t.getID=function(){return this._id};t.releaseRender=function(){if(a.RENDERBASE==this)return;if(--this._ref<1){a.POOL[a._poolSize++]=this;this.shaderValue.release();this.shaderValue=null;this._mesh=null;this._parent&&(this._parent.releaseRender(),this._parent=null)}};t.getRenderType=function(){return this._renderType};t.renderSubmit=function(){if(this._numEle===0||!this._mesh||this._numEle==0)return 1;var t=this.shaderValue.textureHost;if(t){var e=t._getSource();if(!e)return 1;this.shaderValue.texture=e}var i=Bt.mainContext;this._mesh.useMesh(i);this.shaderValue.upload();if(Le.activeBlendFunction!==this._blendFn){ft.setBlend(i,true);this._blendFn(i);Le.activeBlendFunction=this._blendFn}i.drawElements(4,this._numEle,5123,this._startIdx);I.renderBatches++;I.trianglesFaces+=this._numEle/3;return 1};t._cloneInit=function(t,e,i,r){t._ref=1;t._mesh=i;t._id=this._id;t._key.copyFrom(this._key);t._parent=this;t._blendFn=this._blendFn;t._renderType=this._renderType;t._startIdx=r*bt.BYTES_PIDX;t._numEle=this._numEle;t.shaderValue=this.shaderValue;this.shaderValue.ref++;this._ref++};t.clone=function(t,e,i){return null};t.reUse=function(t,e){return 0};t.toString=function(){return"ibindex:"+this._startIdx+" num:"+this._numEle+" key="+this._key};a.__init__=function(){var t=a.RENDERBASE=new a(-1);t.shaderValue=new Q(0,0);t.shaderValue.ALPHA=1;t._ref=4294967295};a.create=function(t,e,i){var r=a._poolSize?a.POOL[--a._poolSize]:new a;r._ref=1;r._mesh=e;r._key.clear();r._startIdx=e.indexNum*bt.BYTES_PIDX;r._numEle=0;var n=t._nBlendType;r._blendFn=t._targets?Le.targetFns[n]:Le.fns[n];r.shaderValue=i;r.shaderValue.setValue(t._shader2D);var s=t._shader2D.filters;s&&r.shaderValue.setFilters(s);return r};a.createShape=function(t,e,i,r){var n=a._poolSize?a.POOL[--a._poolSize]:new a;n._mesh=e;n._numEle=i;n._startIdx=e.indexNum*2;n._ref=1;n.shaderValue=r;n.shaderValue.setValue(t._shader2D);var s=t._nBlendType;n._key.blendShader=s;n._blendFn=t._targets?Le.targetFns[s]:Le.fns[s];return n};a.TYPE_2D=1e4;a.TYPE_CANVAS=10003;a.TYPE_CMDSETRT=10004;a.TYPE_CUSTOM=10005;a.TYPE_BLURRT=10006;a.TYPE_CMDDESTORYPRERT=10007;a.TYPE_DISABLESTENCIL=10008;a.TYPE_OTHERIBVB=10009;a.TYPE_PRIMITIVE=10010;a.TYPE_RT=10011;a.TYPE_BLUR_RT=10012;a.TYPE_TARGET=10013;a.TYPE_CHANGE_VALUE=10014;a.TYPE_SHAPE=10015;a.TYPE_TEXTURE=10016;a.TYPE_FILLTEXTURE=10017;a.KEY_ONCE=-1;a.KEY_FILLRECT=1;a.KEY_DRAWTEXTURE=2;a.KEY_VG=3;a.KEY_TRIANGLES=4;a.RENDERBASE=null;a.ID=1;a.preRender=null;a._poolSize=0;a.POOL=[];return a}();var h=function(){function l(){}v(l,"laya.display.cmd.FillTextureCmd");var t=l.prototype;t.recover=function(){this.texture=null;this.offset=null;this.other=null;z.recover("FillTextureCmd",this)};t.run=function(t,e,i){t.fillTexture(this.texture,this.x+e,this.y+i,this.width,this.height,this.type,this.offset,this.other)};d(0,t,"cmdID",function(){return"FillTexture"});l.create=function(t,e,i,r,n,s,a,o){var h=z.getItemByClass("FillTextureCmd",l);h.texture=t;h.x=e;h.y=i;h.width=r;h.height=n;h.type=s;h.offset=a;h.other=o;return h};l.ID="FillTexture";return l}();var l=function(){function t(){this._glRender=null}v(t,"laya.filters.Filter");var e=t.prototype;y.imps(e,{"laya.filters.IFilter":true});d(0,e,"type",function(){return-1});t.BLUR=16;t.COLOR=32;t.GLOW=8;t._filter=function(t,e,i,r){var n=e;var s=this._next;if(s){var a=t.filters,o=a.length;if(o==1&&a[0].type==32){e.save();e.setColorFilter(a[0]);s._fun.call(s,t,e,i,r);e.restore();return}var h=Q.create(1,0);var l;var u=ie.TEMP;var c=n._curMat;var f=pt.create();c.copyTo(f);var _=0;var d=0;var p=false;var v=null;var m=t._cacheStyle.filterCache||null;if(!m||t.getRepaint()!=0){p=t._isHaveGlowFilter();if(p){_=50;d=25}l=new St;l.copyFrom(t.getSelfBounds());l.x+=t.x;l.y+=t.y;l.x-=t.pivotX+4;l.y-=t.pivotY+4;var g=l.x;var y=l.y;l.width+=_+8;l.height+=_+8;u.x=l.x*f.a+l.y*f.c;u.y=l.y*f.d+l.x*f.b;l.x=u.x;l.y=u.y;u.x=l.width*f.a+l.height*f.c;u.y=l.height*f.d+l.width*f.b;l.width=u.x;l.height=u.y;if(l.width<=0||l.height<=0){return}m&&ye.releaseRT(m);v=ye.getRT(l.width,l.height);var x=m=ye.getRT(l.width,l.height);t._getCacheStyle().filterCache=m;n.pushRT();n.useRT(v);var T=t.x-g+d;var b=t.y-y+d;s._fun.call(s,t,e,T,b);n.useRT(x);for(var w=0;w<o;w++){if(w!=0){n.useRT(v);n.drawTarget(x,0,0,l.width,l.height,pt.TEMP.identity(),h,null,Le.TOINT.overlay);n.useRT(x)}var C=a[w];switch(C.type){case 16:C._glRender&&C._glRender.render(v,e,l.width,l.height,C);break;case 8:C._glRender&&C._glRender.render(v,e,l.width,l.height,C);break;case 32:n.setColorFilter(C);n.drawTarget(v,0,0,l.width,l.height,pt.EMPTY.identity(),Q.create(1,0));n.setColorFilter(null);break}}n.popRT()}else{p=t._cacheStyle.hasGlowFilter||false;if(p){_=50;d=25}l=t.getBounds();if(l.width<=0||l.height<=0){return}l.width+=_;l.height+=_;u.x=l.x*f.a+l.y*f.c;u.y=l.y*f.d+l.x*f.b;l.x=u.x;l.y=u.y;u.x=l.width*f.a+l.height*f.c;u.y=l.height*f.d+l.width*f.b;l.width=u.x;l.height=u.y}i=i-d-t.x;r=r-d-t.y;u.setTo(i,r);f.transformPoint(u);i=u.x+l.x;r=u.y+l.y;n._drawRenderTexture(m,i,r,l.width,l.height,pt.TEMP.identity(),1,Yi.defuv);if(v){var A=rt.create([v],function(t){t.destroy()},this);v=null;e.addRenderObject(A)}f.destroy()}};return t}();var u=function(){function e(){}v(e,"laya.utils.Log");e.enable=function(){if(!e._logdiv){e._logdiv=Yt.createElement("div");e._logdiv.style.cssText="border:white;padding:4px;overflow-y:auto;z-index:1000000;background:rgba(100,100,100,0.6);color:white;position: absolute;left:0px;top:0px;width:50%;height:50%;";Yt.document.body.appendChild(e._logdiv);e._btn=Yt.createElement("button");e._btn.innerText="Hide";e._btn.style.cssText="z-index:1000001;position: absolute;left:10px;top:10px;";e._btn.onclick=e.toggle;Yt.document.body.appendChild(e._btn)}};e.toggle=function(){var t=e._logdiv.style;if(t.display===""){e._btn.innerText="Show";t.display="none"}else{e._btn.innerText="Hide";t.display=""}};e.print=function(t){if(e._logdiv){if(e._count>=e.maxCount)e.clear();e._count++;e._logdiv.innerText+=t+"\n";if(e.autoScrollToBottom){if(e._logdiv.scrollHeight-e._logdiv.scrollTop-e._logdiv.clientHeight<50){e._logdiv.scrollTop=e._logdiv.scrollHeight}}}};e.clear=function(){e._logdiv.innerText="";e._count=0};e._logdiv=null;e._btn=null;e._count=0;e.maxCount=50;e.autoScrollToBottom=true;return e}();var c=function(){function p(){this.preOvers=[];this.preDowns=[];this.preRightDowns=[];this.enable=true;this._lastClickTime=0;this._event=new M}v(p,"laya.events.TouchManager");var t=p.prototype;t._clearTempArrs=function(){p._oldArr.length=0;p._newArr.length=0;p._tEleArr.length=0};t.getTouchFromArr=function(t,e){var i=0,r=0;r=e.length;var n;for(i=0;i<r;i++){n=e[i];if(n.id==t){return n}}return null};t.removeTouchFromArr=function(t,e){var i=0;for(i=e.length-1;i>=0;i--){if(e[i].id==t){e.splice(i,1)}}};t.createTouchO=function(t,e){var i;i=z.getItem("TouchData")||{};i.id=e;i.tar=t;return i};t.onMouseDown=function(t,e,i){i===void 0&&(i=false);if(!this.enable)return;var r;var n;var s;r=this.getTouchFromArr(e,this.preOvers);s=this.getEles(t,null,p._tEleArr);if(!r){n=this.createTouchO(t,e);this.preOvers.push(n)}else{r.tar=t}if(Yt.onMobile)this.sendEvents(s,"mouseover");var a;a=i?this.preDowns:this.preRightDowns;r=this.getTouchFromArr(e,a);if(!r){n=this.createTouchO(t,e);a.push(n)}else{r.tar=t}this.sendEvents(s,i?"mousedown":"rightmousedown");this._clearTempArrs()};t.sendEvents=function(t,e){var i=0,r=0;r=t.length;this._event._stoped=false;var n;n=t[0];var s;for(i=0;i<r;i++){s=t[i];if(s.destroyed)return;s.event(e,this._event.setTo(e,s,n));if(this._event._stoped)break}};t.getEles=function(t,e,i){if(!i){i=[]}else{i.length=0}while(t&&t!=e){i.push(t);t=t.parent}return i};t.checkMouseOutAndOverOfMove=function(t,e,i){i===void 0&&(i=0);if(e==t)return;var r;var n;var s=0,a=0;if(e.contains(t)){n=this.getEles(t,e,p._tEleArr);this.sendEvents(n,"mouseover")}else if(t.contains(e)){n=this.getEles(e,t,p._tEleArr);this.sendEvents(n,"mouseout")}else{n=p._tEleArr;n.length=0;var o;o=this.getEles(e,null,p._oldArr);var h;h=this.getEles(t,null,p._newArr);a=o.length;var l=0;for(s=0;s<a;s++){r=o[s];l=h.indexOf(r);if(l>=0){h.splice(l,h.length-l);break}else{n.push(r)}}if(n.length>0){this.sendEvents(n,"mouseout")}if(h.length>0){this.sendEvents(h,"mouseover")}}};t.onMouseMove=function(t,e){if(!this.enable)return;var i;i=this.getTouchFromArr(e,this.preOvers);var r;var n;if(!i){r=this.getEles(t,null,p._tEleArr);this.sendEvents(r,"mouseover");this.preOvers.push(this.createTouchO(t,e))}else{this.checkMouseOutAndOverOfMove(t,i.tar);i.tar=t;r=this.getEles(t,null,p._tEleArr)}this.sendEvents(r,"mousemove");this._clearTempArrs()};t.getLastOvers=function(){p._tEleArr.length=0;if(this.preOvers.length>0&&this.preOvers[0].tar){return this.getEles(this.preOvers[0].tar,null,p._tEleArr)}p._tEleArr.push(y.stage);return p._tEleArr};t.stageMouseOut=function(){var t;t=this.getLastOvers();this.preOvers.length=0;this.sendEvents(t,"mouseout")};t.onMouseUp=function(t,e,i){i===void 0&&(i=false);if(!this.enable)return;var r;var n;var s;var a;var o=0,h=0;var l;var u;var c=Yt.onMobile;s=this.getEles(t,null,p._tEleArr);this.sendEvents(s,i?"mouseup":"rightmouseup");var f;f=i?this.preDowns:this.preRightDowns;r=this.getTouchFromArr(e,f);if(!r){}else{var _=false;var d=Yt.now();_=d-this._lastClickTime<300;this._lastClickTime=d;if(t==r.tar){u=s}else{a=this.getEles(r.tar,null,p._oldArr);u=p._newArr;u.length=0;h=a.length;for(o=0;o<h;o++){l=a[o];if(s.indexOf(l)>=0){u.push(l)}}}if(u.length>0){this.sendEvents(u,i?"click":"rightclick")}if(i&&_){this.sendEvents(u,"doubleclick")}this.removeTouchFromArr(e,f);r.tar=null;z.recover("TouchData",r)}r=this.getTouchFromArr(e,this.preOvers);if(!r){}else{if(c){u=this.getEles(r.tar,null,u);if(u&&u.length>0){this.sendEvents(u,"mouseout")}this.removeTouchFromArr(e,this.preOvers);r.tar=null;z.recover("TouchData",r)}}this._clearTempArrs()};p._oldArr=[];p._newArr=[];p._tEleArr=[];a(p,["I",function(){return this.I=new p}]);return p}();var f=function(){function a(){this._mesh=null;this._startIdx=0;this._numEle=0;this.shaderValue=null;this.blendType=0;this._ref=1;this.srcRT=null;this._key=new Y}v(a,"laya.webgl.submit.SubmitTarget");var t=a.prototype;y.imps(t,{"laya.webgl.submit.ISubmit":true});t.renderSubmit=function(){var t=Bt.mainContext;this._mesh.useMesh(t);var e=this.srcRT;if(e){this.shaderValue.texture=e._getSource();this.shaderValue.upload();this.blend();I.renderBatches++;I.trianglesFaces+=this._numEle/3;Bt.mainContext.drawElements(4,this._numEle,5123,this._startIdx)}return 1};t.blend=function(){if(Le.activeBlendFunction!==Le.fns[this.blendType]){var t=Bt.mainContext;t.enable(3042);Le.fns[this.blendType](t);Le.activeBlendFunction=Le.fns[this.blendType]}};t.getRenderType=function(){return 0};t.releaseRender=function(){if(--this._ref<1){var t=a.POOL;t[t._length++]=this}};t.reUse=function(t,e){this._startIdx=e;this._ref++;return e};a.create=function(t,e,i,r){var n=a.POOL._length?a.POOL[--a.POOL._length]:new a;n._mesh=e;n.srcRT=r;n._startIdx=e.indexNum*bt.BYTES_PIDX;n._ref=1;n._key.clear();n._numEle=0;n.blendType=t._nBlendType;n._key.blendShader=n.blendType;n.shaderValue=i;n.shaderValue.setValue(t._shader2D);if(t._colorFiler){var s=t._colorFiler;i.defines.add(s.type);i.colorMat=s._mat;i.colorAlpha=s._alpha}return n};a.POOL=[];a.__init$=function(){{a.POOL._length=0}};return a}();var _=function(){function a(){}v(a,"laya.display.cmd.DrawImageCmd");var t=a.prototype;t.recover=function(){this.texture._removeReference();this.texture=null;z.recover("DrawImageCmd",this)};t.run=function(t,e,i){t.drawTexture(this.texture,this.x+e,this.y+i,this.width,this.height)};d(0,t,"cmdID",function(){return"DrawImage"});a.create=function(t,e,i,r,n){var s=z.getItemByClass("DrawImageCmd",a);s.texture=t;t._addReference();s.x=e;s.y=i;s.width=r;s.height=n;return s};a.ID="DrawImage";return a}();var p=function(){function t(){this._id=xe.getGID();this._resetComp()}v(t,"laya.components.Component");var e=t.prototype;y.imps(e,{"laya.resource.ISingletonElement":true,"laya.resource.IDestroy":true});e._isScript=function(){return false};e._resetComp=function(){this._indexInList=-1;this._enabled=true;this._awaked=false;this.owner=null};e._getIndexInList=function(){return this._indexInList};e._setIndexInList=function(t){this._indexInList=t};e._onAdded=function(){};e._onAwake=function(){};e._onEnable=function(){};e._onDisable=function(){};e._onEnableInScene=function(){};e._onDisableInScene=function(){};e._onDestroy=function(){};e.onReset=function(){};e._parse=function(t){};e._cloneTo=function(t){};e._setActive=function(t){if(t){if(!this._awaked){this._awaked=true;this._onAwake()}this._enabled&&this._onEnable()}else{this._enabled&&this._onDisable()}};e._setActiveInScene=function(t){if(t)this._onEnableInScene();else this._onDisableInScene()};e.destroy=function(){if(this.owner)this.owner._destroyComponent(this)};e._destroy=function(){if(this.owner.activeInHierarchy&&this._enabled){this._setActive(false);this._isScript()&&this.onDisable()}this.owner._scene&&this._setActiveInScene(false);this._onDestroy();this._destroyed=true;if(this.onReset!==laya.components.Component.prototype.onReset){this.onReset();this._resetComp();z.recoverByClass(this)}else{this._resetComp()}};d(0,e,"id",function(){return this._id});d(0,e,"enabled",function(){return this._enabled},function(t){this._enabled=t;if(this.owner){if(t)this.owner.activeInHierarchy&&this._onEnable();else this.owner.activeInHierarchy&&this._onDisable()}});d(0,e,"isSingleton",function(){return true});d(0,e,"destroyed",function(){return this._destroyed});return t}();var m=function(){var h;function e(){this._$0__events=null}v(e,"laya.events.EventDispatcher");var t=e.prototype;t.hasListener=function(t){var e=this._$0__events&&this._$0__events[t];return!!e};t.event=function(t,e){if(!this._$0__events||!this._$0__events[t])return false;var i=this._$0__events[t];if(i.run){if(i.once)delete this._$0__events[t];e!=null?i.runWith(e):i.run()}else{for(var r=0,n=i.length;r<n;r++){var s=i[r];if(s){e!=null?s.runWith(e):s.run()}if(!s||s.once){i.splice(r,1);r--;n--}}if(i.length===0&&this._$0__events)delete this._$0__events[t]}return true};t.on=function(t,e,i,r){return this._createListener(t,e,i,r,false)};t.once=function(t,e,i,r){return this._createListener(t,e,i,r,true)};t._createListener=function(t,e,i,r,n,s){s===void 0&&(s=true);s&&this.off(t,e,i,n);var a=h.create(e||this,i,r,n);this._$0__events||(this._$0__events={});var o=this._$0__events;if(!o[t])o[t]=a;else{if(!o[t].run)o[t].push(a);else o[t]=[o[t],a]}return this};t.off=function(t,e,i,r){r===void 0&&(r=false);if(!this._$0__events||!this._$0__events[t])return this;var n=this._$0__events[t];if(n!=null){if(n.run){if((!e||n.caller===e)&&(i==null||n.method===i)&&(!r||n.once)){delete this._$0__events[t];n.recover()}}else{var s=0;for(var a=0,o=n.length;a<o;a++){var h=n[a];if(!h){s++;continue}if(h&&(!e||h.caller===e)&&(i==null||h.method===i)&&(!r||h.once)){s++;n[a]=null;h.recover()}}if(s===o)delete this._$0__events[t]}}return this};t.offAll=function(t){var e=this._$0__events;if(!e)return this;if(t){this._recoverHandlers(e[t]);delete e[t]}else{for(var i in e){this._recoverHandlers(e[i])}this._$0__events=null}return this};t.offAllCaller=function(t){if(t&&this._$0__events){for(var e in this._$0__events){this.off(e,t,null)}}return this};t._recoverHandlers=function(t){if(!t)return;if(t.run){t.recover()}else{for(var e=t.length-1;e>-1;e--){if(t[e]){t[e].recover();t[e]=null}}}};t.isMouseEvent=function(t){return e.MOUSE_EVENTS[t]||false};e.MOUSE_EVENTS={rightmousedown:true,rightmouseup:true,rightclick:true,mousedown:true,mouseup:true,mousemove:true,mouseover:true,mouseout:true,click:true,doubleclick:true};e.__init$=function(){Object.defineProperty(laya.events.EventDispatcher.prototype,"_events",{enumerable:false,writable:true});h=function(t){function n(t,e,i,r){n.__super.call(this,t,e,i,r)}v(n,"",t);var e=n.prototype;e.recover=function(){if(this._id>0){this._id=0;n._pool.push(this.clear())}};n.create=function(t,e,i,r){r===void 0&&(r=true);if(n._pool.length)return n._pool.pop().setTo(t,e,i,r);return new n(t,e,i,r)};n._pool=[];return n}(b)};return e}();var b=function(){function n(t,e,i,r){this.once=false;this._id=0;r===void 0&&(r=false);this.setTo(t,e,i,r)}v(n,"laya.utils.Handler");var t=n.prototype;t.setTo=function(t,e,i,r){this._id=n._gid++;this.caller=t;this.method=e;this.args=i;this.once=r;return this};t.run=function(){if(this.method==null)return null;var t=this._id;var e=this.method.apply(this.caller,this.args);this._id===t&&this.once&&this.recover();return e};t.runWith=function(t){if(this.method==null)return null;var e=this._id;if(t==null)var i=this.method.apply(this.caller,this.args);else if(!this.args&&!t.unshift)i=this.method.call(this.caller,t);else if(this.args)i=this.method.apply(this.caller,this.args.concat(t));else i=this.method.apply(this.caller,t);this._id===e&&this.once&&this.recover();return i};t.clear=function(){this.caller=null;this.method=null;this.args=null;return this};t.recover=function(){if(this._id>0){this._id=0;n._pool.push(this.clear())}};n.create=function(t,e,i,r){r===void 0&&(r=true);if(n._pool.length)return n._pool.pop().setTo(t,e,i,r);return new n(t,e,i,r)};n._pool=[];n._gid=1;return n}();var w=function(){function t(){this.ib=null;this.vb=null;var t=Bt.mainContext;this.ib=Ai.create(35048);this.vb=Mi.create(8)}v(t,"laya.webgl.shader.d2.skinAnishader.SkinMeshBuffer");var e=t.prototype;e.addSkinMesh=function(t){t.getData2(this.vb,this.ib,this.vb._byteLength/32)};e.reset=function(){this.vb.clear();this.ib.clear()};t.getInstance=function(){return t.instance=t.instance||new t};t.instance=null;return t}();var C=function(){function f(){}v(f,"laya.display.cmd.DrawTrianglesCmd");var t=f.prototype;t.recover=function(){this.texture=null;this.vertices=null;this.uvs=null;this.indices=null;this.matrix=null;z.recover("DrawTrianglesCmd",this)};t.run=function(t,e,i){t.drawTriangles(this.texture,this.x+e,this.y+i,this.vertices,this.uvs,this.indices,this.matrix,this.alpha,this.color,this.blendMode)};d(0,t,"cmdID",function(){return"DrawTriangles"});f.create=function(t,e,i,r,n,s,a,o,h,l){var u=z.getItemByClass("DrawTrianglesCmd",f);u.texture=t;u.x=e;u.y=i;u.vertices=r;u.uvs=n;u.indices=s;u.matrix=a;u.alpha=o;if(h){u.color=new Ge;var c=x.create(h).arrColor;u.color.color(c[0]*255,c[1]*255,c[2]*255,c[3]*255)}u.blendMode=l;return u};f.ID="DrawTriangles";return f}();var A=function(){function u(){}v(u,"laya.display.cmd.DrawPieCmd");var t=u.prototype;t.recover=function(){this.fillColor=null;this.lineColor=null;z.recover("DrawPieCmd",this)};t.run=function(t,e,i){t._drawPie(this.x+e,this.y+i,this.radius,this._startAngle,this._endAngle,this.fillColor,this.lineColor,this.lineWidth,this.vid)};d(0,t,"startAngle",function(){return this._startAngle*180/Math.PI},function(t){this._startAngle=t*Math.PI/180});d(0,t,"cmdID",function(){return"DrawPie"});d(0,t,"endAngle",function(){return this._endAngle*180/Math.PI},function(t){this._endAngle=t*Math.PI/180});u.create=function(t,e,i,r,n,s,a,o,h){var l=z.getItemByClass("DrawPieCmd",u);l.x=t;l.y=e;l.radius=i;l._startAngle=r;l._endAngle=n;l.fillColor=s;l.lineColor=a;l.lineWidth=o;l.vid=h;return l};u.ID="DrawPie";return u}();var S=function(){function t(){this.id=NaN;this.save=[];this.toUpperCase=null;this.changed=false;this._text=null;this.width=-1;this.pageChars=[];this.startID=0;this.startIDStroke=0;this.lastGCCnt=0;this.splitRender=false}v(t,"laya.utils.WordText");var e=t.prototype;e.setText=function(t){this.changed=true;this._text=t;this.width=-1;this.cleanCache()};e.toString=function(){return this._text};e.charCodeAt=function(t){return this._text?this._text.charCodeAt(t):NaN};e.charAt=function(t){return this._text?this._text.charAt(t):null};e.cleanCache=function(){this.pageChars.forEach(function(t){var e=t.tex;var i=t.words;if(t.words.length==1&&e&&e.ri){e.destroy()}});this.pageChars=[];this.startID=0};d(0,e,"length",function(){return this._text?this._text.length:0});return t}();var E=function(){function e(t,e,i){this._stride=0;this.vertNum=0;this.indexNum=0;this._applied=false;this._vb=null;this._ib=null;this._vao=null;this._attribInfo=null;this._quadNum=0;this.canReuse=false;this._stride=t;this._vb=new Mi(t,35048);if(e){this._vb._resizeBuffer(e,false)}else{Ce.webGL2D_MeshAllocMaxMem&&this._vb._resizeBuffer(64*1024*t,false)}this._ib=new Ai;if(i){this._ib._resizeBuffer(i,false)}}v(e,"laya.webgl.utils.Mesh2D");var t=e.prototype;t.cloneWithNewVB=function(){var t=new e(this._stride,0,0);t._ib=this._ib;t._quadNum=this._quadNum;t._attribInfo=this._attribInfo;return t};t.cloneWithNewVBIB=function(){var t=new e(this._stride,0,0);t._attribInfo=this._attribInfo;return t};t.getVBW=function(){this._vb.setNeedUpload();return this._vb};t.getVBR=function(){return this._vb};t.getIBR=function(){return this._ib};t.getIBW=function(){this._ib.setNeedUpload();return this._ib};t.createQuadIB=function(t){this._quadNum=t;this._ib._resizeBuffer(t*6*2,false);this._ib.byteLength=this._ib.bufferLength;var e=this._ib.getUint16Array();var i=0;var r=0;for(var n=0;n<t;n++){e[i++]=r;e[i++]=r+2;e[i++]=r+1;e[i++]=r;e[i++]=r+3;e[i++]=r+2;r+=4}this._ib.setNeedUpload()};t.setAttributes=function(t){this._attribInfo=t;if(this._attribInfo.length%3!=0){throw"Mesh2D setAttributes error!"}};t.configVAO=function(t){if(this._applied)return;this._applied=true;if(!this._vao){this._vao=new vi}this._vao.bind();this._vb._bindForVAO();this._ib.setNeedUpload();this._ib._bind_uploadForVAO();var e=this._attribInfo.length/3;var i=0;for(var r=0;r<e;r++){var n=this._attribInfo[i+1];var s=this._attribInfo[i];var a=this._attribInfo[i+2];t.enableVertexAttribArray(r);t.vertexAttribPointer(r,n,s,false,this._stride,a);i+=3}this._vao.unBind()};t.useMesh=function(t){this._applied||this.configVAO(t);this._vao.bind();this._vb.bind();this._ib._bind_upload()||this._ib.bind();this._vb._bind_upload()||this._vb.bind()};t.getEleNum=function(){return this._ib.getBuffer().byteLength/2};t.releaseMesh=function(){};t.destroy=function(){};t.clearVB=function(){this._vb.clear()};e._gvaoid=0;return e}();var M=function(){function t(){}v(t,"laya.events.Event");var e=t.prototype;e.setTo=function(t,e,i){this.type=t;this.currentTarget=e;this.target=i;return this};e.stopPropagation=function(){this._stoped=true};d(0,e,"stageY",function(){return y.stage.mouseY});d(0,e,"charCode",function(){return this.nativeEvent.charCode});d(0,e,"touches",function(){if(!this.nativeEvent)return null;var t=this.nativeEvent.touches;if(t){var e=y.stage;for(var i=0,r=t.length;i<r;i++){var n=t[i];var s=ie.TEMP;s.setTo(n.clientX,n.clientY);e._canvasTransform.invertTransformPoint(s);e.transform.invertTransformPoint(s);n.stageX=s.x;n.stageY=s.y}}return t});d(0,e,"keyLocation",function(){return this.nativeEvent.location||this.nativeEvent.keyLocation});d(0,e,"ctrlKey",function(){return this.nativeEvent.ctrlKey});d(0,e,"altKey",function(){return this.nativeEvent.altKey});d(0,e,"shiftKey",function(){return this.nativeEvent.shiftKey});d(0,e,"stageX",function(){return y.stage.mouseX});t.EMPTY=new t;t.MOUSE_DOWN="mousedown";t.MOUSE_UP="mouseup";t.CLICK="click";t.RIGHT_MOUSE_DOWN="rightmousedown";t.RIGHT_MOUSE_UP="rightmouseup";t.RIGHT_CLICK="rightclick";t.MOUSE_MOVE="mousemove";t.MOUSE_OVER="mouseover";t.MOUSE_OUT="mouseout";t.MOUSE_WHEEL="mousewheel";t.ROLL_OVER="mouseover";t.ROLL_OUT="mouseout";t.DOUBLE_CLICK="doubleclick";t.CHANGE="change";t.CHANGED="changed";t.RESIZE="resize";t.ADDED="added";t.REMOVED="removed";t.DISPLAY="display";t.UNDISPLAY="undisplay";t.ERROR="error";t.COMPLETE="complete";t.LOADED="loaded";t.READY="ready";t.PROGRESS="progress";t.INPUT="input";t.RENDER="render";t.OPEN="open";t.MESSAGE="message";t.CLOSE="close";t.KEY_DOWN="keydown";t.KEY_PRESS="keypress";t.KEY_UP="keyup";t.FRAME="enterframe";t.DRAG_START="dragstart";t.DRAG_MOVE="dragmove";t.DRAG_END="dragend";t.ENTER="enter";t.SELECT="select";t.BLUR="blur";t.FOCUS="focus";t.VISIBILITY_CHANGE="visibilitychange";t.FOCUS_CHANGE="focuschange";t.PLAYED="played";t.PAUSED="paused";t.STOPPED="stopped";t.START="start";t.END="end";t.COMPONENT_ADDED="componentadded";t.COMPONENT_REMOVED="componentremoved";t.RELEASED="released";t.LINK="link";t.LABEL="label";t.FULL_SCREEN_CHANGE="fullscreenchange";t.DEVICE_LOST="devicelost";t.TRANSFORM_CHANGED="transformchanged";t.ANIMATION_CHANGED="animationchanged";t.TRAIL_FILTER_CHANGE="trailfilterchange";t.TRIGGER_ENTER="triggerenter";t.TRIGGER_STAY="triggerstay";t.TRIGGER_EXIT="triggerexit";return t}();var R=function(){function R(){this.fontSizeInfo={};this.charRender=null;this.mapFont={};this.fontID=0;this.mapColor=[];this.colorID=0;this.fontScaleX=1;this.fontScaleY=1;this._curStrPos=0;this.bmpData32=null;this.lastFont=null;this.fontSizeW=0;this.fontSizeH=0;this.fontSizeOffX=0;this.fontSizeOffY=0;this.renderPerChar=true;this.textureMem=0;this.fontStr=null;this.textAtlases=[];this.isoTextures=[];this.tmpAtlasPos=new ie;var t=false;var e=y["MiniAdpter"];if(e&&e.systemInfo&&e.systemInfo.system){t=e.systemInfo.system.toLowerCase()==="ios 10.1.1"}if(Yt.onMiniGame&&!t)R.isWan1Wan=true;if(Yt.onLimixiu)R.isWan1Wan=true;this.charRender=Wt.isConchApp?new xi:new yi(R.atlasWidth,R.atlasWidth,R.scaleFontWithCtx,!R.isWan1Wan,false);R.textRenderInst=this;y["textRender"]=this;R.atlasWidth2=R.atlasWidth*R.atlasWidth}v(R,"laya.webgl.text.TextRender");var t=R.prototype;t.setFont=function(t){if(this.lastFont==t)return;this.lastFont=t;var e=this.getFontSizeInfo(t._family);var i=e>>24;var r=e>>16&255;var n=e>>8&255;var s=e&255;var a=t._size/R.standardFontSize;this.fontSizeOffX=Math.ceil(i*a);this.fontSizeOffY=Math.ceil(r*a);this.fontSizeW=Math.ceil(n*a);this.fontSizeH=Math.ceil(s*a);if(t._font.indexOf("italic")>=0){this.fontStr=t._font.replace("italic","")}else{this.fontStr=t._font}};t.getNextChar=function(t){var e=t.length;var i=this._curStrPos;if(i>=e)return null;var r=false;var n=i;var s=0;for(;n<e;n++){var a=t.charCodeAt(n);if(a>>>11==27){if(s==1)break;s=1;n++}else if(a===65038||a===65039){}else if(a==8205){s=2}else{if(s==0)s=1;else if(s==1)break;else if(s==2){}}}this._curStrPos=n;return t.substring(i,n)};t.filltext=function(t,e,i,r,n,s,a,o,h,l){l===void 0&&(l=0);if(e.length<=0)return;var u=Fe.Parse(n);var c=0;switch(h){case"center":c=xt.ENUM_TEXTALIGN_CENTER;break;case"right":c=xt.ENUM_TEXTALIGN_RIGHT;break}this._fast_filltext(t,e,null,i,r,u,s,a,o,c,l)};t.fillWords=function(t,e,i,r,n,s,a,o){if(!e)return;if(e.length<=0)return;var h=Fe.Parse(n);this._fast_filltext(t,null,e,i,r,h,s,a,o,0,0)};t._fast_filltext=function(t,e,i,r,n,s,a,o,h,l,u){u===void 0&&(u=0);if(e&&e.length<1)return;if(i&&i.length<1)return;if(h<0)h=0;this.setFont(s);this.fontScaleX=this.fontScaleY=1;if(!Wt.isConchApp&&R.scaleFontWithCtx){var c=1;var f=1;if(Wt.isConchApp){c=t._curMat.getScaleX();f=t._curMat.getScaleY()}else{c=t.getMatScaleX();f=t.getMatScaleY()}if(c<1e-4||f<.1)return;if(c>1)this.fontScaleX=c;if(f>1)this.fontScaleY=f}s._italic&&(t._italicDeg=13);var _=e;var d=!i&&e instanceof laya.utils.WordText;var p=e;var v=!!i;var m=d?_.pageChars:[];var g=0;if(d){p=_._text;g=_.width;if(g<0){g=_.width=this.charRender.getWidth(this.fontStr,p)}}else{g=p?this.charRender.getWidth(this.fontStr,p):0}switch(l){case xt.ENUM_TEXTALIGN_CENTER:r-=g/2;break;case xt.ENUM_TEXTALIGN_RIGHT:r-=g;break}if(_&&m){if(this.hasFreedText(m)){m=_.pageChars=[]}}var y=null;var x=d||R.forceWholeRender;var T=this.renderPerChar=!d||R.forceSplitRender||v||d&&_.splitRender;if(!m||m.length<1){if(T){var b=0;var w=0;this._curStrPos=0;var C;while(true){if(v){var A=i[this._curStrPos++];if(A){C=A.char;b=A.x;w=A.y}else{C=null}}else{C=this.getNextChar(p)}if(!C)break;y=this.getCharRenderInfo(C,s,a,o,h,false);if(!y){break}if(y.isSpace){}else{var E=m[y.tex.id];if(!E){var S={texgen:y.tex.genID,tex:y.tex,words:[]};m[y.tex.id]=S;E=S.words}else{E=E.words}if(Wt.isConchApp){E.push({ri:y,x:b,y:w,w:y.bmpWidth/this.fontScaleX,h:y.bmpHeight/this.fontScaleY})}else{E.push({ri:y,x:b+1/this.fontScaleX,y:w,w:(y.bmpWidth-2)/this.fontScaleX,h:(y.bmpHeight-1)/this.fontScaleY})}b+=y.width}}}else{var M=R.noAtlas||g*this.fontScaleX>R.atlasWidth;y=this.getCharRenderInfo(p,s,a,o,h,M);if(Wt.isConchApp){m[0]={texgen:y.tex.genID,tex:y.tex,words:[{ri:y,x:0,y:0,w:y.bmpWidth/this.fontScaleX,h:y.bmpHeight/this.fontScaleY}]}}else{m[0]={texgen:y.tex.genID,tex:y.tex,words:[{ri:y,x:1/this.fontScaleX,y:0/this.fontScaleY,w:(y.bmpWidth-2)/this.fontScaleX,h:(y.bmpHeight-1)/this.fontScaleY}]}}}}this._drawResortedWords(t,r,n,m);t._italicDeg=0};t._drawResortedWords=function(t,e,i,r){var n=t._charSubmitCache&&t._charSubmitCache._enbale;var s=t._curMat;var a=r.length;for(var o=0;o<a;o++){var h=r[o];if(!h)continue;var l=h.words;var u=l.length;if(u<=0)continue;var c=r[o].tex;for(var f=0;f<u;f++){var _=l[f];var d=_.ri;if(d.isSpace)continue;d.touch();t.drawTexAlign=true;if(Wt.isConchApp){t._drawTextureM(c.texture,e+_.x-d.orix,i+_.y-d.oriy,_.w,_.h,null,1,d.uv)}else t._inner_drawTexture(c.texture,c.texture.bitmap.id,e+_.x-d.orix,i+_.y-d.oriy,_.w,_.h,s,d.uv,1,n);if(t.touches){t.touches.push(d)}}}};t.hasFreedText=function(t){var e=t.length;for(var i=0;i<e;i++){var r=t[i];if(!r)continue;var n=r.tex;if(n.__destroyed||n.genID!=r.texgen){return true}}return false};t.getCharRenderInfo=function(t,e,i,r,n,s){s===void 0&&(s=false);var a=this.mapFont[e._family];if(a==undefined){this.mapFont[e._family]=a=this.fontID++}var o=t+"_"+a+"_"+e._size+"_"+i;if(n>0)o+="_"+r+n;if(e._bold)o+="P";if(this.fontScaleX!=1||this.fontScaleY!=1){o+=(this.fontScaleX*20|0)+"_"+(this.fontScaleY*20|0)}var h=0;var l=this.textAtlases.length;var u=null;var c=null;if(!s){for(h=0;h<l;h++){c=this.textAtlases[h];u=c.charMaps[o];if(u){u.touch();return u}}}u=new wt;this.charRender.scale(this.fontScaleX,this.fontScaleY);u.char=t;u.height=e._size;var f=e._size/3|0;var _=null;var d=Math.ceil(this.charRender.getWidth(this.fontStr,t)*this.fontScaleX);if(d>this.charRender.canvasWidth){this.charRender.canvasWidth=Math.min(2048,d+f*2)}if(s){_=this.charRender.getCharBmp(t,this.fontStr,n,i,r,u,f,f,f,f,null);var p=Ci.getTextTexture(_.width,_.height);p.addChar(_,0,0,u.uv);u.tex=p;u.orix=f;u.oriy=f;p.ri=u;this.isoTextures.push(p)}else{var v=t.length;if(v>1){}var m=n*1;var g=Math.ceil((this.fontSizeW+m*2)*this.fontScaleX);var y=Math.ceil((this.fontSizeH+m*2)*this.fontScaleY);R.imgdtRect[0]=(f-this.fontSizeOffX-m)*this.fontScaleX|0;R.imgdtRect[1]=(f-this.fontSizeOffY-m)*this.fontScaleY|0;if(this.renderPerChar||v==1){R.imgdtRect[2]=Math.max(d,g);R.imgdtRect[3]=Math.max(d,y)}else{R.imgdtRect[2]=-1;R.imgdtRect[3]=y}_=this.charRender.getCharBmp(t,this.fontStr,n,i,r,u,f,f,f,f,R.imgdtRect);c=this.addBmpData(_,u);if(R.isWan1Wan){u.orix=f;u.oriy=f}else{u.orix=this.fontSizeOffX+m;u.oriy=this.fontSizeOffY+m}c.charMaps[o]=u}return u};t.addBmpData=function(t,e){var i=t.width;var r=t.height;var n=this.textAtlases.length;var s=null;var a=false;for(var o=0;o<n;o++){s=this.textAtlases[o];a=s.getAEmpty(i,r,this.tmpAtlasPos);if(a){break}}if(!a){s=new qt;this.textAtlases.push(s);a=s.getAEmpty(i,r,this.tmpAtlasPos);if(!a){throw"err1"}this.cleanAtlases()}if(a){s.texture.addChar(t,this.tmpAtlasPos.x,this.tmpAtlasPos.y,e.uv);e.tex=s.texture}return s};t.GC=function(){var t=0;var e=this.textAtlases.length;var i=0;var r=R.destroyAtlasDt;var n=0;var s=0;var a=I.loopCount;var o=-1;var h=0;var l=null;var u=null;for(;t<e;t++){u=this.textAtlases[t];l=u.texture;if(l){n+=l.curUsedCovRate;s+=l.curUsedCovRateAtlas;var c=u.usedRate-l.curUsedCovRateAtlas;if(h<c){h=c;o=t}}i=a-u.texture.lastTouchTm;if(i>r){R.showLog&&console.log("TextRender GC delete atlas "+l?u.texture.id:"unk");u.destroy();this.textAtlases[t]=this.textAtlases[e-1];e--;t--;o=-1}}this.textAtlases.length=e;e=this.isoTextures.length;for(t=0;t<e;t++){l=this.isoTextures[t];i=a-l.lastTouchTm;if(i>R.destroyUnusedTextureDt){l.ri.deleted=true;l.ri.tex=null;l.destroy();this.isoTextures[t]=this.isoTextures[e-1];e--;t--}}this.isoTextures.length=e;var f=this.textAtlases.length>1&&this.textAtlases.length-s>=2;if(R.atlasWidth*R.atlasWidth*4*this.textAtlases.length>R.cleanMem||f||R.simClean){R.simClean=false;R.showLog&&console.log("清理使用率低的贴图。总使用率:",s,":",this.textAtlases.length,"最差贴图:"+o);if(o>=0){u=this.textAtlases[o];u.destroy();this.textAtlases[o]=this.textAtlases[this.textAtlases.length-1];this.textAtlases.length=this.textAtlases.length-1}}Ci.clean()};t.cleanAtlases=function(){};t.getCharBmp=function(t){};t.checkBmpLine=function(t,e,i,r){if(this.bmpData32.buffer!=t.data.buffer){this.bmpData32=new Uint32Array(t.data.buffer)}var n=t.width*e+i;for(var s=i;s<r;s++){if(this.bmpData32[n++]!=0)return true}return false};t.updateBbx=function(t,e,i){i===void 0&&(i=false);var r=t.width;var n=t.height;var s=0;var a=e[1];var o=0;var h=a;if(this.checkBmpLine(t,a,0,r)){while(true){h=(a+o)/2|0;if(h+1>=a){e[1]=h;break}if(this.checkBmpLine(t,h,0,r)){a=h}else{o=h}}}if(e[3]>n)e[3]=n;else{h=a=e[3];o=n;if(this.checkBmpLine(t,a,0,r)){while(true){h=(a+o)/2|0;if(h-1<=a){e[3]=h;break}if(this.checkBmpLine(t,h,0,r)){a=h}else{o=h}}}}if(i)return;var l=e[0];var u=r*e[1];for(h=e[1];h<e[3];h++){for(s=0;s<l;s++){if(this.bmpData32[u+s]!=0){l=s;break}}u+=r}e[0]=l;var c=e[2];u=r*e[1];for(h=e[1];h<e[3];h++){for(s=c;s<r;s++){if(this.bmpData32[u+s]!=0){c=s;break}}u+=r}e[2]=c};t.getFontSizeInfo=function(t){var e=this.fontSizeInfo[t];if(e!=undefined)return e;var i="bold "+R.standardFontSize+"px "+t;if(R.isWan1Wan){this.fontSizeW=this.charRender.getWidth(i,"有")*1.5;this.fontSizeH=R.standardFontSize*1.5;var r=this.fontSizeW<<8|this.fontSizeH;this.fontSizeInfo[t]=r;return r}R.pixelBBX[0]=R.standardFontSize/2;R.pixelBBX[1]=R.standardFontSize/2;R.pixelBBX[2]=R.standardFontSize;R.pixelBBX[3]=R.standardFontSize;var n=16;var s=16;var a=16;var o=16;this.charRender.scale(1,1);R.tmpRI.height=R.standardFontSize;var h=this.charRender.getCharBmp("g",i,0,"red",null,R.tmpRI,n,s,a,o);if(Wt.isConchApp){h.data=new Uint8ClampedArray(h.data)}this.bmpData32=new Uint32Array(h.data.buffer);this.updateBbx(h,R.pixelBBX,false);h=this.charRender.getCharBmp("有",i,0,"red",null,R.tmpRI,s,s,a,o);if(Wt.isConchApp){h.data=new Uint8ClampedArray(h.data)}this.bmpData32=new Uint32Array(h.data.buffer);if(R.pixelBBX[2]<n+R.tmpRI.width)R.pixelBBX[2]=n+R.tmpRI.width;this.updateBbx(h,R.pixelBBX,false);if(Wt.isConchApp){n=0;s=0}var l=Math.max(n-R.pixelBBX[0],0);var u=Math.max(s-R.pixelBBX[1],0);var c=R.pixelBBX[2]-R.pixelBBX[0];var f=R.pixelBBX[3]-R.pixelBBX[1]+1;var _=l<<24|u<<16|c<<8|f;this.fontSizeInfo[t]=_;return _};t.printDbgInfo=function(){console.log("图集个数:"+this.textAtlases.length+",每个图集大小:"+R.atlasWidth+"x"+R.atlasWidth," 用canvas:",R.isWan1Wan);console.log("图集占用空间:"+R.atlasWidth*R.atlasWidth*4/1024/1024*this.textAtlases.length+"M");console.log("缓存用到的字体:");for(var t in this.mapFont){var e=this.getFontSizeInfo(t);var i=e>>24;var r=e>>16&255;var n=e>>8&255;var s=e&255;console.log("    "+t," off:",i,r," size:",n,s)}var a=0;console.log("缓存数据:");var o=0;var h=0;this.textAtlases.forEach(function(t){var e=t.texture.id;var i=I.loopCount-t.texture.lastTouchTm;var r=i>0?""+i+"帧以前":"当前帧";o+=t.texture.curUsedCovRate;h+=t.texture.curUsedCovRateAtlas;console.log("--图集(id:"+e+",当前使用率:"+(t.texture.curUsedCovRate*1e3|0)+"‰","当前图集使用率:",(t.texture.curUsedCovRateAtlas*100|0)+"%","图集使用率:",t.usedRate*100|0,"%, 使用于:"+r+")--:");for(var n in t.charMaps){var s=t.charMaps[n];console.log("     off:",s.orix,s.oriy," bmp宽高:",s.bmpWidth,s.bmpHeight,"无效:",s.deleted,"touchdt:",I.loopCount-s.touchTick,"位置:",s.uv[0]*R.atlasWidth|0,s.uv[1]*R.atlasWidth|0,"字符:",s.char,"key:",n);a++}});console.log("独立贴图文字("+this.isoTextures.length+"个):");this.isoTextures.forEach(function(t){console.log("    size:",t._texW,t._texH,"touch间隔:",I.loopCount-t.lastTouchTm,"char:",t.ri.char)});console.log("总缓存:",a,"总使用率:",o,"总当前图集使用率:",h)};t.showAtlas=function(t,i,e,r,n,s){if(!this.textAtlases[t]){console.log("没有这个图集");return null}var a=new Ti;var o=this.textAtlases[t].texture;var h={width:R.atlasWidth,height:R.atlasWidth,sourceWidth:R.atlasWidth,sourceHeight:R.atlasWidth,offsetX:0,offsetY:0,getIsReady:function(){return true},_addReference:function(){},_removeReference:function(){},_getSource:function(){return o._getSource()},bitmap:{id:o.id},_uv:ti.DEF_UV};a.size=function(t,e){this.width=t;this.height=e;a.graphics.clear();a.graphics.drawRect(0,0,a.width,a.height,i);a.graphics.drawTexture(h,0,0,a.width,a.height);return this};a.graphics.drawRect(0,0,n,s,i);a.graphics.drawTexture(h,0,0,n,s);a.pos(e,r);y.stage.addChild(a);return a};t.filltext_native=function(t,e,i,r,n,s,a,o,h,l,u){u===void 0&&(u=0);if(e&&e.length<=0)return;if(i&&i.length<1)return;var c=Fe.Parse(s);var f=0;switch(l){case"center":f=xt.ENUM_TEXTALIGN_CENTER;break;case"right":f=xt.ENUM_TEXTALIGN_RIGHT;break}return this._fast_filltext(t,e,i,r,n,c,a,o,h,f,u)};R.useOldCharBook=false;R.atlasWidth=2048;R.noAtlas=false;R.forceSplitRender=false;R.forceWholeRender=false;R.scaleFontWithCtx=true;R.standardFontSize=32;R.destroyAtlasDt=10;R.checkCleanTextureDt=2e3;R.destroyUnusedTextureDt=3e3;R.cleanMem=100*1024*1024;R.isWan1Wan=false;R.showLog=false;R.debugUV=false;R.atlasWidth2=2048*2048;R.textRenderInst=null;R.simClean=false;a(R,["tmpRI",function(){return this.tmpRI=new wt},"pixelBBX",function(){return this.pixelBBX=[0,0,0,0]},"imgdtRect",function(){return this.imgdtRect=[0,0,0,0]}]);return R}();var I=function(){function l(){}v(l,"laya.utils.Stat");d(1,l,"onclick",null,function(t){if(l._sp){l._sp.on("click",l._sp,t)}if(l._canvas){l._canvas.source.onclick=t;l._canvas.source.style.pointerEvents=""}});l.show=function(t,e){t===void 0&&(t=0);e===void 0&&(e=0);if(!Yt.onMiniGame&&!Yt.onLimixiu&&!Wt.isConchApp&&!Yt.onBDMiniGame&&!Yt.onKGMiniGame&&!Yt.onQGMiniGame)l._useCanvas=true;l._show=true;l._fpsData.length=60;l._view[0]={title:"FPS(Canvas)",value:"_fpsStr",color:"yellow",units:"int"};l._view[1]={title:"Sprite",value:"_spriteStr",color:"white",units:"int"};l._view[2]={title:"RenderBatches",value:"renderBatches",color:"white",units:"int"};l._view[3]={title:"SavedRenderBatches",value:"savedRenderBatches",color:"white",units:"int"};l._view[4]={title:"CPUMemory",value:"cpuMemory",color:"yellow",units:"M"};l._view[5]={title:"GPUMemory",value:"gpuMemory",color:"yellow",units:"M"};l._view[6]={title:"Shader",value:"shaderCall",color:"white",units:"int"};if(!Wt.is3DMode){l._view[0].title="FPS(WebGL)";l._view[7]={title:"Canvas",value:"_canvasStr",color:"white",units:"int"}}else{l._view[0].title="FPS(3D)";l._view[7]={title:"TriFaces",value:"trianglesFaces",color:"white",units:"int"};l._view[8]={title:"FrustumCulling",value:"frustumCulling",color:"white",units:"int"};l._view[9]={title:"OctreeNodeCulling",value:"octreeNodeCulling",color:"white",units:"int"}}if(l._useCanvas){l.createUIPre(t,e)}else l.createUI(t,e);l.enable()};l.createUIPre=function(t,e){var i=Yt.pixelRatio;l._width=i*180;l._vx=i*120;l._height=i*(l._view.length*12+3*i)+4;l._fontSize=12*i;for(var r=0;r<l._view.length;r++){l._view[r].x=4;l._view[r].y=r*l._fontSize+2*i}if(!l._canvas){l._canvas=new Bi(true);l._canvas.size(l._width,l._height);l._ctx=l._canvas.getContext("2d");l._ctx.textBaseline="top";l._ctx.font=l._fontSize+"px Arial";l._canvas.source.style.cssText="pointer-events:none;background:rgba(150,150,150,0.8);z-index:100000;position: absolute;direction:ltr;left:"+t+"px;top:"+e+"px;width:"+l._width/i+"px;height:"+l._height/i+"px;"}if(!Yt.onKGMiniGame){Yt.container.appendChild(l._canvas.source)}l._first=true;l.loop();l._first=false};l.createUI=function(t,e){var i=l._sp;var r=Yt.pixelRatio;if(!i){i=new Ti;l._leftText=new Ri;l._leftText.pos(5,5);l._leftText.color="#ffffff";i.addChild(l._leftText);l._txt=new Ri;l._txt.pos(80*r,5);l._txt.color="#ffffff";i.addChild(l._txt);l._sp=i}i.pos(t,e);var n="";for(var s=0;s<l._view.length;s++){var a=l._view[s];n+=a.title+"\n"}l._leftText.text=n;var o=r*138;var h=r*(l._view.length*12+3*r)+4;l._txt.fontSize=l._fontSize*r;l._leftText.fontSize=l._fontSize*r;i.size(o,h);i.graphics.clear();i.graphics.alpha(.5);i.graphics.drawRect(0,0,o,h,"#999999");i.graphics.alpha(2);l.loop()};l.enable=function(){y.systemTimer.frameLoop(1,l,l.loop)};l.hide=function(){l._show=false;y.systemTimer.clear(l,l.loop);if(l._canvas){Yt.removeElement(l._canvas.source)}};l.clear=function(){l.trianglesFaces=l.renderBatches=l.savedRenderBatches=l.shaderCall=l.spriteRenderUseCacheCount=l.frustumCulling=l.octreeNodeCulling=l.canvasNormal=l.canvasBitmap=l.canvasReCache=0};l.loop=function(){l._count++;var t=Yt.now();if(t-l._timer<1e3)return;var e=l._count;l.FPS=Math.round(e*1e3/(t-l._timer));if(l._show){l.trianglesFaces=Math.round(l.trianglesFaces/e);if(!l._useCanvas){l.renderBatches=Math.round(l.renderBatches/e)-1}else{l.renderBatches=Math.round(l.renderBatches/e)}l.savedRenderBatches=Math.round(l.savedRenderBatches/e);l.shaderCall=Math.round(l.shaderCall/e);l.spriteRenderUseCacheCount=Math.round(l.spriteRenderUseCacheCount/e);l.canvasNormal=Math.round(l.canvasNormal/e);l.canvasBitmap=Math.round(l.canvasBitmap/e);l.canvasReCache=Math.ceil(l.canvasReCache/e);l.frustumCulling=Math.round(l.frustumCulling/e);l.octreeNodeCulling=Math.round(l.octreeNodeCulling/e);var i=l.FPS>0?Math.floor(1e3/l.FPS).toString():" ";l._fpsStr=l.FPS+(l.renderSlow?" slow":"")+" "+i;if(l._useCanvas)l._spriteStr=l.spriteCount-1+(l.spriteRenderUseCacheCount?"/"+l.spriteRenderUseCacheCount:"");else l._spriteStr=l.spriteCount-4+(l.spriteRenderUseCacheCount?"/"+l.spriteRenderUseCacheCount:"");l._canvasStr=l.canvasReCache+"/"+l.canvasNormal+"/"+l.canvasBitmap;l.cpuMemory=qe.cpuMemory;l.gpuMemory=qe.gpuMemory;if(l._useCanvas){l.renderInfoPre()}else l.renderInfo();l.clear()}l._count=0;l._timer=t};l.renderInfoPre=function(){var t=0;var e;var i;if(l._canvas){var r=l._ctx;r.clearRect(l._first?0:l._vx,0,l._width,l._height);for(t=0;t<l._view.length;t++){e=l._view[t];if(l._first){r.fillStyle="white";r.fillText(e.title,e.x,e.y)}r.fillStyle=e.color;i=l[e.value];e.units=="M"&&(i=Math.floor(i/(1024*1024)*100)/100+" M");r.fillText(i+"",e.x+l._vx,e.y)}}};l.renderInfo=function(){var t="";for(var e=0;e<l._view.length;e++){var i=l._view[e];var r=l[i.value];i.units=="M"&&(r=Math.floor(r/(1024*1024)*100)/100+" M");i.units=="K"&&(r=Math.floor(r/1024*100)/100+" K");t+=r+"\n"}l._txt.text=t};l.FPS=0;l.loopCount=0;l.shaderCall=0;l.renderBatches=0;l.savedRenderBatches=0;l.trianglesFaces=0;l.spriteCount=0;l.spriteRenderUseCacheCount=0;l.frustumCulling=0;l.octreeNodeCulling=0;l.canvasNormal=0;l.canvasBitmap=0;l.canvasReCache=0;l.renderSlow=false;l.gpuMemory=0;l.cpuMemory=0;l._fpsStr=null;l._canvasStr=null;l._spriteStr=null;l._fpsData=[];l._timer=0;l._count=0;l._view=[];l._fontSize=12;l._txt=null;l._leftText=null;l._sp=null;l._titleSp=null;l._bgSp=null;l._show=false;l._useCanvas=false;l._canvas=null;l._ctx=null;l._first=false;l._vx=NaN;l._width=0;l._height=100;return l}();var P=function(){var r;function t(){this._lastOriX=0;this._lastOriY=0;this.paths=[];this._curPath=null}v(t,"laya.webgl.canvas.Path");var e=t.prototype;e.beginPath=function(t){this.paths.length=1;this._curPath=this.paths[0]=new r;this._curPath.convex=t};e.closePath=function(){this._curPath.loop=true};e.newPath=function(){this._curPath=new r;this.paths.push(this._curPath)};e.addPoint=function(t,e){this._curPath.path.push(t,e)};e.push=function(t,e){if(!this._curPath){this._curPath=new r;this.paths.push(this._curPath)}else if(this._curPath.path.length>0){this._curPath=new r;this.paths.push(this._curPath)}var i=this._curPath;i.path=t.slice();i.convex=e};e.reset=function(){this.paths.length=0};t.__init$=function(){r=function(){function t(){this.path=[];this.loop=false;this.convex=false}v(t,"");return t}()};return t}();var D=function(){function l(){this.mouseX=0;this.mouseY=0;this.disableMouseEvent=false;this.mouseDownTime=0;this.mouseMoveAccuracy=2;this._stage=null;this._captureSp=null;this._captureExlusiveMode=false;this._hitCaputreSp=false;this._target=null;this._lastMoveTimer=0;this._isLeftMouse=false;this._touchIDs={};this._id=1;this._tTouchID=0;this._event=new M;this._captureChain=[];this._matrix=new pt;this._point=new ie;this._rect=new St;this._prePoint=new ie;this._curTouchID=NaN}v(l,"laya.events.MouseManager");var t=l.prototype;t.__init__=function(t,e){var i=this;this._stage=t;var r=this;e.oncontextmenu=function(t){if(l.enabled)return false};e.addEventListener("mousedown",function(t){if(l.enabled){if(!Yt.onIE)t.preventDefault();r.mouseDownTime=Yt.now();i.runEvent(t)}});e.addEventListener("mouseup",function(t){if(l.enabled){t.preventDefault();r.mouseDownTime=-Yt.now();i.runEvent(t)}},true);e.addEventListener("mousemove",function(t){if(l.enabled){t.preventDefault();var e=Yt.now();if(e-r._lastMoveTimer<10)return;r._lastMoveTimer=e;i.runEvent(t)}},true);e.addEventListener("mouseout",function(t){if(l.enabled)i.runEvent(t)});e.addEventListener("mouseover",function(t){if(l.enabled)i.runEvent(t)});e.addEventListener("touchstart",function(t){if(l.enabled){if(!l._isFirstTouch&&!Ui.isInputting)t.preventDefault();r.mouseDownTime=Yt.now();i.runEvent(t)}});e.addEventListener("touchend",function(t){if(l.enabled){if(!l._isFirstTouch&&!Ui.isInputting)t.preventDefault();l._isFirstTouch=false;r.mouseDownTime=-Yt.now();i.runEvent(t)}else{i._curTouchID=NaN}},true);e.addEventListener("touchmove",function(t){if(l.enabled){t.preventDefault();i.runEvent(t)}},true);e.addEventListener("touchcancel",function(t){if(l.enabled){t.preventDefault();i.runEvent(t)}else{i._curTouchID=NaN}},true);e.addEventListener("mousewheel",function(t){if(l.enabled)i.runEvent(t)});e.addEventListener("DOMMouseScroll",function(t){if(l.enabled)i.runEvent(t)})};t.initEvent=function(t,e){var i=this;i._event._stoped=false;i._event.nativeEvent=e||t;i._target=null;this._point.setTo(t.pageX||t.clientX,t.pageY||t.clientY);if(this._stage._canvasTransform){this._stage._canvasTransform.invertTransformPoint(this._point);i.mouseX=this._point.x;i.mouseY=this._point.y}i._event.touchId=t.identifier||0;this._tTouchID=i._event.touchId;var r;r=c.I._event;r._stoped=false;r.nativeEvent=i._event.nativeEvent;r.touchId=i._event.touchId};t.checkMouseWheel=function(t){this._event.delta=t.wheelDelta?t.wheelDelta*.025:-t.detail;var e=c.I.getLastOvers();for(var i=0,r=e.length;i<r;i++){var n=e[i];n.event("mousewheel",this._event.setTo("mousewheel",n,this._target))}};t.onMouseMove=function(t){c.I.onMouseMove(t,this._tTouchID)};t.onMouseDown=function(t){if(Ui.isInputting&&y.stage.focus&&y.stage.focus["focus"]&&!y.stage.focus.contains(this._target)){var e=y.stage.focus["_tf"]||y.stage.focus;var i=t["_tf"]||t;if(i instanceof laya.display.Input&&i.multiline==e.multiline)e["_focusOut"]();else e.focus=false}c.I.onMouseDown(t,this._tTouchID,this._isLeftMouse)};t.onMouseUp=function(t){c.I.onMouseUp(t,this._tTouchID,this._isLeftMouse)};t.check=function(t,e,i,r){this._point.setTo(e,i);t.fromParentPoint(this._point);e=this._point.x;i=this._point.y;var n=t._style.scrollRect;if(n){this._rect.setTo(n.x,n.y,n.width,n.height);if(!this._rect.contains(e,i))return false}if(!this.disableMouseEvent){if(t.hitTestPrior&&!t.mouseThrough&&!this.hitTest(t,e,i)){return false}for(var s=t._children.length-1;s>-1;s--){var a=t._children[s];if(!a.destroyed&&a._mouseState>1&&a._visible){if(this.check(a,e,i,r))return true}}for(s=t._extUIChild.length-1;s>=0;s--){var o=t._extUIChild[s];if(!o.destroyed&&o._mouseState>1&&o._visible){if(this.check(o,e,i,r))return true}}}var h=t.hitTestPrior&&!t.mouseThrough&&!this.disableMouseEvent?true:this.hitTest(t,e,i);if(h){this._target=t;r.call(this,t);if(this._target==this._hitCaputreSp){this._hitCaputreSp=true}}else if(r===this.onMouseUp&&t===this._stage){this._target=this._stage;r.call(this,this._target)}return h};t.hitTest=function(t,e,i){var r=false;if(t.scrollRect){e-=t._style.scrollRect.x;i-=t._style.scrollRect.y}var n=t._style.hitArea;if(n&&n._hit){return n.contains(e,i)}if(t.width>0&&t.height>0||t.mouseThrough||n){if(!t.mouseThrough){r=(n?n:this._rect.setTo(0,0,t.width,t.height)).contains(e,i)}else{r=t.getGraphicBounds().contains(e,i)}}return r};t._checkAllBaseUI=function(t,e,i){var r=this.handleExclusiveCapture(this.mouseX,this.mouseY,i);if(r)return true;r=this.check(this._stage,this.mouseX,this.mouseY,i);return this.handleCapture(this.mouseX,this.mouseY,i)||r};t.check3DUI=function(t,e,i){var r=this._stage._3dUI;var n=0;var s=false;for(;n<r.length;n++){var a=r[n];this._stage._curUIBase=a;if(!a.destroyed&&a._mouseState>1&&a._visible){s=s||this.check(a,this.mouseX,this.mouseY,i)}}this._stage._curUIBase=this._stage;return s};t.handleExclusiveCapture=function(t,e,i){if(this._captureExlusiveMode&&this._captureSp&&this._captureChain.length>0){var r;this._point.setTo(t,e);for(var n=0;n<this._captureChain.length;n++){r=this._captureChain[n];r.fromParentPoint(this._point)}this._target=r;i.call(this,r);return true}return false};t.handleCapture=function(t,e,i){if(!this._hitCaputreSp&&this._captureSp&&this._captureChain.length>0){var r;this._point.setTo(t,e);for(var n=0;n<this._captureChain.length;n++){r=this._captureChain[n];r.fromParentPoint(this._point)}this._target=r;i.call(this,r);return true}return false};t.runEvent=function(t){var e=this;var i=0,r=0,n;if(t.type!=="mousemove")this._prePoint.x=this._prePoint.y=-1e6;switch(t.type){case"mousedown":this._touchIDs[0]=this._id++;if(!l._isTouchRespond){this._isLeftMouse=t.button===0;this.initEvent(t);this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown)}else l._isTouchRespond=false;break;case"mouseup":this._isLeftMouse=t.button===0;this.initEvent(t);this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp);break;case"mousemove":if(Math.abs(this._prePoint.x-t.clientX)+Math.abs(this._prePoint.y-t.clientY)>=this.mouseMoveAccuracy){this._prePoint.x=t.clientX;this._prePoint.y=t.clientY;this.initEvent(t);this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove)}break;case"touchstart":l._isTouchRespond=true;this._isLeftMouse=true;var s=t.changedTouches;for(i=0,r=s.length;i<r;i++){n=s[i];if(l.multiTouchEnabled||isNaN(this._curTouchID)){this._curTouchID=n.identifier;if(this._id%200===0)this._touchIDs={};this._touchIDs[n.identifier]=this._id++;this.initEvent(n,t);this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseDown)}}break;case"touchend":case"touchcancel":l._isTouchRespond=true;this._isLeftMouse=true;var a=t.changedTouches;for(i=0,r=a.length;i<r;i++){n=a[i];if(l.multiTouchEnabled||n.identifier==this._curTouchID){this._curTouchID=NaN;this.initEvent(n,t);var o=false;o=this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseUp);if(!o){this.onMouseUp(null)}}}break;case"touchmove":;var h=t.changedTouches;for(i=0,r=h.length;i<r;i++){n=h[i];if(l.multiTouchEnabled||n.identifier==this._curTouchID){this.initEvent(n,t);this._checkAllBaseUI(this.mouseX,this.mouseY,this.onMouseMove)}}break;case"wheel":case"mousewheel":case"DOMMouseScroll":this.checkMouseWheel(t);break;case"mouseout":c.I.stageMouseOut();break;case"mouseover":this._stage.event("mouseover",this._event.setTo("mouseover",this._stage,this._stage));break}};t.setCapture=function(t,e){e===void 0&&(e=false);this._captureSp=t;this._captureExlusiveMode=e;this._captureChain.length=0;this._captureChain.push(t);var i=t;while(true){if(i==y.stage)break;if(i==y.stage._curUIBase)break;i=i.parent;if(!i)break;this._captureChain.splice(0,0,i)}};t.releaseCapture=function(){console.log("release capture");this._captureSp=null};l.enabled=true;l.multiTouchEnabled=true;l._isTouchRespond=false;l._isFirstTouch=true;a(l,["instance",function(){return this.instance=new l}]);return l}();var L=function(){function t(){this.useDic={};this.shapeDic={};this.shapeLineDic={};this._id=0;this._checkKey=false;this._freeIdArray=[];st.regCacheByFunction(xe.bind(this.startDispose,this),xe.bind(this.getCacheList,this))}v(t,"laya.utils.VectorGraphManager");var e=t.prototype;e.getId=function(){return this._id++};e.addShape=function(t,e){this.shapeDic[t]=e;if(!this.useDic[t]){this.useDic[t]=true}};e.addLine=function(t,e){this.shapeLineDic[t]=e;if(!this.shapeLineDic[t]){this.shapeLineDic[t]=true}};e.getShape=function(t){if(this._checkKey){if(this.useDic[t]!=null){this.useDic[t]=true}}};e.deleteShape=function(t){if(this.shapeDic[t]){this.shapeDic[t]=null;delete this.shapeDic[t]}if(this.shapeLineDic[t]){this.shapeLineDic[t]=null;delete this.shapeLineDic[t]}if(this.useDic[t]!=null){delete this.useDic[t]}};e.getCacheList=function(){var t;var e=[];for(t in this.shapeDic){e.push(this.shapeDic[t])}for(t in this.shapeLineDic){e.push(this.shapeLineDic[t])}return e};e.startDispose=function(t){var e;for(e in this.useDic){this.useDic[e]=false}this._checkKey=true};e.endDispose=function(){if(this._checkKey){var t;for(t in this.useDic){if(!this.useDic[t]){this.deleteShape(t)}}this._checkKey=false}};t.getInstance=function(){return t.instance=t.instance||new t};t.instance=null;return t}();var B=function(){function n(){}v(n,"laya.maths.MathUtil");n.subtractVector3=function(t,e,i){i[0]=t[0]-e[0];i[1]=t[1]-e[1];i[2]=t[2]-e[2]};n.lerp=function(t,e,i){return t*(1-i)+e*i};n.scaleVector3=function(t,e,i){i[0]=t[0]*e;i[1]=t[1]*e;i[2]=t[2]*e};n.lerpVector3=function(t,e,i,r){var n=t[0],s=t[1],a=t[2];r[0]=n+i*(e[0]-n);r[1]=s+i*(e[1]-s);r[2]=a+i*(e[2]-a)};n.lerpVector4=function(t,e,i,r){var n=t[0],s=t[1],a=t[2],o=t[3];r[0]=n+i*(e[0]-n);r[1]=s+i*(e[1]-s);r[2]=a+i*(e[2]-a);r[3]=o+i*(e[3]-o)};n.slerpQuaternionArray=function(t,e,i,r,n,s,a){var o=t[e+0],h=t[e+1],l=t[e+2],u=t[e+3],c=i[r+0],f=i[r+1],_=i[r+2],d=i[r+3];var p,v,m,g,y;v=o*c+h*f+l*_+u*d;if(v<0){v=-v;c=-c;f=-f;_=-_;d=-d}if(1-v>1e-6){p=Math.acos(v);m=Math.sin(p);g=Math.sin((1-n)*p)/m;y=Math.sin(n*p)/m}else{g=1-n;y=n}s[a+0]=g*o+y*c;s[a+1]=g*h+y*f;s[a+2]=g*l+y*_;s[a+3]=g*u+y*d;return s};n.getRotation=function(t,e,i,r){return Math.atan2(r-e,i-t)/Math.PI*180};n.sortBigFirst=function(t,e){if(t==e)return 0;return e>t?1:-1};n.sortSmallFirst=function(t,e){if(t==e)return 0;return e>t?-1:1};n.sortNumBigFirst=function(t,e){return parseFloat(e)-parseFloat(t)};n.sortNumSmallFirst=function(t,e){return parseFloat(t)-parseFloat(e)};n.sortByKey=function(i,t,e){t===void 0&&(t=false);e===void 0&&(e=true);var r;if(t){r=e?n.sortNumBigFirst:n.sortBigFirst}else{r=e?n.sortNumSmallFirst:n.sortSmallFirst}return function(t,e){return r(t[i],e[i])}};return n}();var F=function(){function p(t,e){if(n.map[t]){this._fun=n.map[t];this._next=p.NORENDER;return}this._next=e||p.NORENDER;switch(t){case 0:this._fun=this._no;return;case 1:this._fun=this._alpha;return;case 2:this._fun=this._transform;return;case 4:this._fun=this._blend;return;case 8:this._fun=this._canvas;return;case 32:this._fun=this._mask;return;case 64:this._fun=this._clip;return;case 128:this._fun=this._style;return;case 512:this._fun=this._graphics;return;case 8192:this._fun=this._children;return;case 2048:this._fun=this._custom;return;case 256:this._fun=this._texture;return;case 16:this._fun=l._filter;return;case 69905:this._fun=p._initRenderFun;return}this.onCreate(t)}v(p,"laya.renders.RenderSprite");var t=p.prototype;t.onCreate=function(t){};t._style=function(t,e,i,r){var n=t._style;if(n.render!=null)n.render(t,e,i,r);var s=this._next;s._fun.call(s,t,e,i,r)};t._no=function(t,e,i,r){};t._custom=function(t,e,i,r){t.customRender(e,i,r);this._next._fun.call(this._next,t,e,i-t.pivotX,r-t.pivotY)};t._clip=function(t,e,i,r){var n=this._next;if(n==p.NORENDER)return;var s=t._style.scrollRect;e.save();e.clipRect(i,r,s.width,s.height);n._fun.call(n,t,e,i-s.x,r-s.y);e.restore()};t._texture=function(t,e,i,r){var n=t.texture;if(n._getSource())e.drawTexture(n,i-t.pivotX+n.offsetX,r-t.pivotY+n.offsetY,t._width||n.width,t._height||n.height);var s=this._next;if(s!=p.NORENDER)s._fun.call(s,t,e,i,r)};t._graphics=function(t,e,i,r){var n=t._style;var s=t._graphics;s&&s._render(t,e,i-n.pivotX,r-n.pivotY);var a=this._next;if(a!=p.NORENDER)a._fun.call(a,t,e,i,r)};t._image=function(t,e,i,r){var n=t._style;e.drawTexture2(i,r,n.pivotX,n.pivotY,t.transform,t._graphics._one)};t._image2=function(t,e,i,r){var n=t._style;e.drawTexture2(i,r,n.pivotX,n.pivotY,t.transform,t._graphics._one)};t._alpha=function(t,e,i,r){var n=t._style;var s;if((s=n.alpha)>.01||t._needRepaint()){var a=e.globalAlpha;e.globalAlpha*=s;var o=this._next;o._fun.call(o,t,e,i,r);e.globalAlpha=a}};t._transform=function(t,e,i,r){var n=t.transform,s=this._next;var a=t._style;if(n&&s!=p.NORENDER){e.save();e.transform(n.a,n.b,n.c,n.d,n.tx+i,n.ty+r);s._fun.call(s,t,e,0,0);e.restore()}else{if(s!=p.NORENDER)s._fun.call(s,t,e,i,r)}};t._children=function(t,e,i,r){var n=t._style;var s=t._children,a=s.length,o;i=i-t.pivotX;r=r-t.pivotY;var h=t._getBit(256)&&e.drawCallOptimize(true);if(n.viewport){var l=n.viewport;var u=l.x;var c=l.y;var f=l.right;var _=l.bottom;var d=NaN,p=NaN;for(v=0;v<a;++v){if((o=s[v])._visible&&((d=o._x)<f&&d+o.width>u&&(p=o._y)<_&&p+o.height>c)){o.render(e,i,r)}}}else{for(var v=0;v<a;++v)(o=s[v])._visible&&o.render(e,i,r)}h&&e.drawCallOptimize(false)};t._canvas=function(t,e,i,r){var n=t._cacheStyle;var s=this._next;if(!n.enableCanvasRender){s._fun.call(s,t,e,i,r);return}n.cacheAs==="bitmap"?I.canvasBitmap++:I.canvasNormal++;var a=false;var o=false;if(n.canvas){var h=n.canvas;var l=h.context;var u=h.touches;if(u){for(var c=0;c<u.length;c++){if(u[c].deleted){o=true;break}}}a=h.isCacheValid&&!h.isCacheValid()}if(t._needRepaint()||!n.canvas||o||a||y.stage.isGlobalRepaint()){if(n.cacheAs==="normal"){if(e._targets){s._fun.call(s,t,e,i,r);return}else{this._canvas_webgl_normal_repaint(t,e)}}else{this._canvas_repaint(t,e,i,r)}}var f=n.cacheRect;e.drawCanvas(n.canvas,i+f.x,r+f.y,f.width,f.height)};t._canvas_repaint=function(t,e,i,r){var n=t._cacheStyle;var s=this._next;var a;var o=n.canvas;var h;var l;var u;var c=n.cacheAs;var f,_;var d,p;var v;v=n._calculateCacheRect(t,c,i,r);d=v.x;p=v.y;u=n.cacheRect;f=u.width*d;_=u.height*p;h=u.x;l=u.y;if(c==="bitmap"&&(f>2048||_>2048)){console.warn("cache bitmap size larger than 2048,cache ignored");n.releaseContext();s._fun.call(s,t,e,i,r);return}if(!o){n.createContext();o=n.canvas}a=o.context;a.sprite=t;(o.width!=f||o.height!=_)&&o.size(f,_);if(c==="bitmap")a.asBitmap=true;else if(c==="normal")a.asBitmap=false;a.clear();if(d!=1||p!=1){var m=a;m.save();m.scale(d,p);s._fun.call(s,t,a,-h,-l);m.restore();t._applyFilters()}else{m=a;s._fun.call(s,t,a,-h,-l);t._applyFilters()}if(n.staticCache)n.reCache=false;I.canvasReCache++};t._canvas_webgl_normal_repaint=function(t,e){var i=t._cacheStyle;var r=this._next;var n=i.canvas;var s=i.cacheAs;var a=i._calculateCacheRect(t,s,0,0);if(!n){n=i.canvas=new y.WebGLCacheAsNormalCanvas(e,t)}var o=n.context;n["startRec"]();r._fun.call(r,t,o,t.pivotX,t.pivotY);t._applyFilters();I.canvasReCache++;n["endRec"]()};t._blend=function(t,e,i,r){var n=t._style;var s=this._next;if(n.blendMode){e.save();e.globalCompositeOperation=n.blendMode;s._fun.call(s,t,e,i,r);e.restore()}else{s._fun.call(s,t,e,i,r)}};t._mask=function(t,e,i,r){var n=this._next;var s=t.mask;var a;var o=e;if(s){o.save();var h=o.globalCompositeOperation;var l=new St;l.copyFrom(s.getBounds());l.width=Math.round(l.width);l.height=Math.round(l.height);l.x=Math.round(l.x);l.y=Math.round(l.y);if(l.width>0&&l.height>0){var u=l.width;var c=l.height;var f=ye.getRT(u,c);o.breakNextMerge();o.pushRT();o.addRenderObject(rt.create([o,f,u,c],p.tmpTarget,this));s.render(o,-l.x,-l.y);o.breakNextMerge();o.popRT();o.save();o.clipRect(i+l.x-t.getStyle().pivotX,r+l.y-t.getStyle().pivotY,u,c);n._fun.call(n,t,o,i,r);o.restore();h=o.globalCompositeOperation;o.addRenderObject(rt.create(["mask"],p.setBlendMode,this));var _=Q.create(1,0);var d=ti.INV_UV;o.drawTarget(f,i+l.x-t.getStyle().pivotX,r+l.y-t.getStyle().pivotY,u,c,pt.TEMP.identity(),_,d,6);o.addRenderObject(rt.create([f],p.recycleTarget,this));o.addRenderObject(rt.create([h],p.setBlendMode,this))}o.restore()}else{n._fun.call(n,t,e,i,r)}};p.__init__=function(){n.__init__();var t=0,e=0;var i;i=new p(69905,null);e=p.renders.length=8192*2;for(t=0;t<e;t++)p.renders[t]=i;p.renders[0]=new p(0,null);function r(t,e){var i=0;for(var r=0;r<t.length;r++){i|=t[r];p.renders[i]=e}}};p._initRenderFun=function(t,e,i,r){var n=t._renderType;var s=p.renders[n]=p._getTypeRender(n);s._fun(t,e,i,r)};p._getTypeRender=function(t){if(n.map[t])return new p(t,null);var e=null;var i=8192;while(i>0){if(i&t)e=new p(i,e);i=i>>1}return e};p.tmpTarget=function(t,e,i,r){e.start();e.clear(0,0,0,0)};p.recycleTarget=function(t){ye.releaseRT(t)};p.setBlendMode=function(t){var e=Bt.mainContext;Le.targetFns[Le.TOINT[t]](e)};p.INIT=69905;p.renders=[];p.NORENDER=new p(0,null);a(p,["tempUV",function(){return this.tempUV=new Array(8)}]);return p}();var O=function(){function t(){}v(t,"laya.events.Keyboard");t.NUMBER_0=48;t.NUMBER_1=49;t.NUMBER_2=50;t.NUMBER_3=51;t.NUMBER_4=52;t.NUMBER_5=53;t.NUMBER_6=54;t.NUMBER_7=55;t.NUMBER_8=56;t.NUMBER_9=57;t.A=65;t.B=66;t.C=67;t.D=68;t.E=69;t.F=70;t.G=71;t.H=72;t.I=73;t.J=74;t.K=75;t.L=76;t.M=77;t.N=78;t.O=79;t.P=80;t.Q=81;t.R=82;t.S=83;t.T=84;t.U=85;t.V=86;t.W=87;t.X=88;t.Y=89;t.Z=90;t.F1=112;t.F2=113;t.F3=114;t.F4=115;t.F5=116;t.F6=117;t.F7=118;t.F8=119;t.F9=120;t.F10=121;t.F11=122;t.F12=123;t.F13=124;t.F14=125;t.F15=126;t.NUMPAD=21;t.NUMPAD_0=96;t.NUMPAD_1=97;t.NUMPAD_2=98;t.NUMPAD_3=99;t.NUMPAD_4=100;t.NUMPAD_5=101;t.NUMPAD_6=102;t.NUMPAD_7=103;t.NUMPAD_8=104;t.NUMPAD_9=105;t.NUMPAD_ADD=107;t.NUMPAD_DECIMAL=110;t.NUMPAD_DIVIDE=111;t.NUMPAD_ENTER=108;t.NUMPAD_MULTIPLY=106;t.NUMPAD_SUBTRACT=109;t.SEMICOLON=186;t.EQUAL=187;t.COMMA=188;t.MINUS=189;t.PERIOD=190;t.SLASH=191;t.BACKQUOTE=192;t.LEFTBRACKET=219;t.BACKSLASH=220;t.RIGHTBRACKET=221;t.QUOTE=222;t.ALTERNATE=18;t.BACKSPACE=8;t.CAPS_LOCK=20;t.COMMAND=15;t.CONTROL=17;t.DELETE=46;t.ENTER=13;t.ESCAPE=27;t.PAGE_UP=33;t.PAGE_DOWN=34;t.END=35;t.HOME=36;t.LEFT=37;t.UP=38;t.RIGHT=39;t.DOWN=40;t.SHIFT=16;t.SPACE=32;t.TAB=9;t.INSERT=45;return t}();var N=function(){function e(){}v(e,"laya.display.cmd.RestoreCmd");var t=e.prototype;t.recover=function(){z.recover("RestoreCmd",this)};t.run=function(t,e,i){t.restore()};d(0,t,"cmdID",function(){return"Restore"});e.create=function(){var t=z.getItemByClass("RestoreCmd",e);return t};e.ID="Restore";return e}();var k=function(){function e(t,e,i){this._value=0;this._name2int=t;this._int2name=e;this._int2nameMap=i}v(e,"laya.webgl.shader.ShaderDefinesBase");var t=e.prototype;t.add=function(t){if(typeof t=="string")t=this._name2int[t];this._value|=t;return this._value};t.addInt=function(t){this._value|=t;return this._value};t.remove=function(t){if(typeof t=="string")t=this._name2int[t];this._value&=~t;return this._value};t.isDefine=function(t){return(this._value&t)===t};t.getValue=function(){return this._value};t.setValue=function(t){this._value=t};t.toNameDic=function(){var t=this._int2nameMap[this._value];return t?t:e._toText(this._value,this._int2name,this._int2nameMap)};e._reg=function(t,e,i,r){i[t]=e;r[e]=t};e._toText=function(t,e,i){var r=i[t];if(r)return r;var n={};var s=1;for(var a=0;a<32;a++){s=1<<a;if(s>t)break;if(t&s){var o=e[s];o&&(n[o]="")}}i[t]=n;return n};e._toInt=function(t,e){var i=t.split(".");var r=0;for(var n=0,s=i.length;n<s;n++){var a=e[i[n]];if(!a)throw new Error("Defines to int err:"+t+"/"+i[n]);r|=a}return r};return e}();var U=function(){function t(){this._texture=null;this._fontCharDic={};this._fontWidthMap={};this._complete=null;this._path=null;this._maxWidth=0;this._spaceWidth=10;this._padding=null;this.fontSize=12;this.autoScaleSize=false;this.letterSpacing=0}v(t,"laya.display.BitmapFont");var e=t.prototype;e.loadFont=function(t,e){this._path=t;this._complete=e;if(!t||t.indexOf(".fnt")===-1){console.error('Bitmap font configuration information must be a ".fnt" file');return}y.loader.load([{url:t,type:"xml"},{url:t.replace(".fnt",".png"),type:"image"}],b.create(this,this._onLoaded))};e._onLoaded=function(){this.parseFont(ii.getRes(this._path),ii.getRes(this._path.replace(".fnt",".png")));this._complete&&this._complete.run()};e.parseFont=function(t,e){if(t==null||e==null)return;this._texture=e;var i=0;var r=1;var n=t.getElementsByTagName("info");if(!n[0].getAttributeNode){return this.parseFont2(t,e)}this.fontSize=parseInt(n[0].getAttributeNode("size").nodeValue);var s=n[0].getAttributeNode("padding").nodeValue;var a=s.split(",");this._padding=[parseInt(a[0]),parseInt(a[1]),parseInt(a[2]),parseInt(a[3])];var o;o=t.getElementsByTagName("char");var h=0;for(h=0;h<o.length;h++){var l=o[h];var u=parseInt(l.getAttributeNode("id").nodeValue);var c=parseInt(l.getAttributeNode("xoffset").nodeValue)/r;var f=parseInt(l.getAttributeNode("yoffset").nodeValue)/r;var _=parseInt(l.getAttributeNode("xadvance").nodeValue)/r;var d=new St;d.x=parseInt(l.getAttributeNode("x").nodeValue);d.y=parseInt(l.getAttributeNode("y").nodeValue);d.width=parseInt(l.getAttributeNode("width").nodeValue);d.height=parseInt(l.getAttributeNode("height").nodeValue);var p=ti.create(e,d.x,d.y,d.width,d.height,c,f);this._maxWidth=Math.max(this._maxWidth,_+this.letterSpacing);this._fontCharDic[u]=p;this._fontWidthMap[u]=_}};e.parseFont2=function(t,e){if(t==null||e==null)return;this._texture=e;var i=0;var r=1;var n=t.getElementsByTagName("info");this.fontSize=parseInt(n[0].attributes["size"].nodeValue);var s=n[0].attributes["padding"].nodeValue;var a=s.split(",");this._padding=[parseInt(a[0]),parseInt(a[1]),parseInt(a[2]),parseInt(a[3])];var o=t.getElementsByTagName("char");var h=0;for(h=0;h<o.length;h++){var l=o[h].attributes;var u=parseInt(l["id"].nodeValue);var c=parseInt(l["xoffset"].nodeValue)/r;var f=parseInt(l["yoffset"].nodeValue)/r;var _=parseInt(l["xadvance"].nodeValue)/r;var d=new St;d.x=parseInt(l["x"].nodeValue);d.y=parseInt(l["y"].nodeValue);d.width=parseInt(l["width"].nodeValue);d.height=parseInt(l["height"].nodeValue);var p=ti.create(e,d.x,d.y,d.width,d.height,c,f);this._maxWidth=Math.max(this._maxWidth,_+this.letterSpacing);this._fontCharDic[u]=p;this._fontWidthMap[u]=_}};e.getCharTexture=function(t){return this._fontCharDic[t.charCodeAt(0)]};e.destroy=function(){if(this._texture){for(var t in this._fontCharDic){var e=this._fontCharDic[t];if(e)e.destroy()}this._texture.destroy();this._fontCharDic=null;this._fontWidthMap=null;this._texture=null;this._complete=null;this._padding=null}};e.setSpaceWidth=function(t){this._spaceWidth=t};e.getCharWidth=function(t){var e=t.charCodeAt(0);if(this._fontWidthMap[e])return this._fontWidthMap[e]+this.letterSpacing;if(t===" ")return this._spaceWidth+this.letterSpacing;return 0};e.getTextWidth=function(t){var e=0;for(var i=0,r=t.length;i<r;i++){e+=this.getCharWidth(t.charAt(i))}return e};e.getMaxWidth=function(){return this._maxWidth};e.getMaxHeight=function(){return this.fontSize};e._drawText=function(t,e,i,r,n,s){var a=this.getTextWidth(t);var o;var h=0;n==="center"&&(h=(s-a)/2);n==="right"&&(h=s-a);var l=0;for(var u=0,c=t.length;u<c;u++){o=this.getCharTexture(t.charAt(u));if(o){e.graphics.drawImage(o,i+l+h,r);l+=this.getCharWidth(t.charAt(u))}}};return t}();var W=function(){function s(){}v(s,"laya.display.cmd.ClipRectCmd");var t=s.prototype;t.recover=function(){z.recover("ClipRectCmd",this)};t.run=function(t,e,i){t.clipRect(this.x+e,this.y+i,this.width,this.height)};d(0,t,"cmdID",function(){return"ClipRect"});s.create=function(t,e,i,r){var n=z.getItemByClass("ClipRectCmd",s);n.x=t;n.y=e;n.width=i;n.height=r;return n};s.ID="ClipRect";return s}();var V=function(){function t(){this.ALPHA=1;this.shaderType=0;this.defines=new Je;this.fillStyle=Nt.DEFAULT;this.strokeStyle=Nt.DEFAULT}v(t,"laya.webgl.shader.d2.Shader2D");var e=t.prototype;e.destroy=function(){this.defines=null;this.filters=null};t.__init__=function(){var t,e;t="/*\n\ttexture和fillrect使用的。\n*/\nattribute vec4 posuv;\nattribute vec4 attribColor;\nattribute vec4 attribFlags;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\t\t// 这个是全局的，不用再应用矩阵了。\nvarying vec2 cliped;\nuniform vec2 size;\nuniform vec2 clipOff;\t\t\t// 使用要把clip偏移。cacheas normal用. 只用了[0]\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\n#ifdef MVP3D\n\tuniform mat4 u_MvpMatrix;\n#endif\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\n\nvoid main() {\n\n\tvec4 pos = vec4(posuv.xy,0.,1.);\n#ifdef WORLDMAT\n\tpos=mmat*pos;\n#endif\n\tvec4 pos1  =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,0.,1.0);\n#ifdef MVP3D\n\tgl_Position=u_MvpMatrix*pos1;\n#else\n\tgl_Position=pos1;\n#endif\n\tv_texcoordAlpha.xy = posuv.zw;\n\t//v_texcoordAlpha.z = attribColor.a/255.0;\n\tv_color = attribColor/255.0;\n\tv_color.xyz*=v_color.w;//反正后面也要预乘\n\t\n\tv_useTex = attribFlags.r/255.0;\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\t\n\tvec2 clpos = clipMatPos.xy;\n\t#ifdef WORLDMAT\n\t\t// 如果有mmat，需要修改clipMatPos,因为 这是cacheas normal （如果不是就错了）， clipMatPos被去掉了偏移\n\t\tif(clipOff[0]>0.0){\n\t\t\tclpos.x+=mmat[3].x;\t//tx\t最简单处理\n\t\t\tclpos.y+=mmat[3].y;\t//ty\n\t\t}\n\t#endif\n\tvec2 clippos = pos.xy - clpos;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//转成0到1之间。/clipw/clipw 表示clippos与normalize之后的clip朝向点积之后，再除以clipw\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n\n}";e="/*\n\ttexture和fillrect使用的。\n*/\n#ifdef FSHIGHPRECISION\nprecision highp float;\n#else\nprecision mediump float;\n#endif\n\nvarying vec4 v_texcoordAlpha;\nvarying vec4 v_color;\nvarying float v_useTex;\nuniform sampler2D texture;\nvarying vec2 cliped;\n\n#ifdef BLUR_FILTER\nuniform vec4 strength_sig2_2sig2_gauss1;\nuniform vec2 blurInfo;\n\n#define PI 3.141593\n\nfloat getGaussian(float x, float y){\n    return strength_sig2_2sig2_gauss1.w*exp(-(x*x+y*y)/strength_sig2_2sig2_gauss1.z);\n}\n\nvec4 blur(){\n    const float blurw = 9.0;\n    vec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n    vec2 halfsz=vec2(blurw,blurw)/2.0/blurInfo;    \n    vec2 startpos=v_texcoordAlpha.xy-halfsz;\n    vec2 ctexcoord = startpos;\n    vec2 step = 1.0/blurInfo;  //每个像素      \n    \n    for(float y = 0.0;y<=blurw; ++y){\n        ctexcoord.x=startpos.x;\n        for(float x = 0.0;x<=blurw; ++x){\n            //TODO 纹理坐标的固定偏移应该在vs中处理\n            vec4Color += texture2D(texture, ctexcoord)*getGaussian(x-blurw/2.0,y-blurw/2.0);\n            ctexcoord.x+=step.x;\n        }\n        ctexcoord.y+=step.y;\n    }\n    return vec4Color;\n}\n#endif\n\n#ifdef COLOR_FILTER\nuniform vec4 colorAlpha;\nuniform mat4 colorMat;\n#endif\n\n#ifdef GLOW_FILTER\nuniform vec4 u_color;\nuniform vec4 u_blurInfo1;\nuniform vec4 u_blurInfo2;\n#endif\n\n#ifdef COLOR_ADD\nuniform vec4 colorAdd;\n#endif\n\n#ifdef FILLTEXTURE\t\nuniform vec4 u_TexRange;//startu,startv,urange, vrange\n#endif\nvoid main() {\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n\t\n#ifdef FILLTEXTURE\t\n   vec4 color= texture2D(texture, fract(v_texcoordAlpha.xy)*u_TexRange.zw + u_TexRange.xy);\n#else\n   vec4 color= texture2D(texture, v_texcoordAlpha.xy);\n#endif\n\n   if(v_useTex<=0.)color = vec4(1.,1.,1.,1.);\n   color.a*=v_color.w;\n   //color.rgb*=v_color.w;\n   color.rgb*=v_color.rgb;\n   gl_FragColor=color;\n   \n   #ifdef COLOR_ADD\n\tgl_FragColor = vec4(colorAdd.rgb,colorAdd.a*gl_FragColor.a);\n\tgl_FragColor.xyz *= colorAdd.a;\n   #endif\n   \n   #ifdef BLUR_FILTER\n\tgl_FragColor =   blur();\n\tgl_FragColor.w*=v_color.w;   \n   #endif\n   \n   #ifdef COLOR_FILTER\n\tmat4 alphaMat =colorMat;\n\n\talphaMat[0][3] *= gl_FragColor.a;\n\talphaMat[1][3] *= gl_FragColor.a;\n\talphaMat[2][3] *= gl_FragColor.a;\n\n\tgl_FragColor = gl_FragColor * alphaMat;\n\tgl_FragColor += colorAlpha/255.0*gl_FragColor.a;\n   #endif\n   \n   #ifdef GLOW_FILTER\n\tconst float c_IterationTime = 10.0;\n\tfloat floatIterationTotalTime = c_IterationTime * c_IterationTime;\n\tvec4 vec4Color = vec4(0.0,0.0,0.0,0.0);\n\tvec2 vec2FilterDir = vec2(-(u_blurInfo1.z)/u_blurInfo2.x,-(u_blurInfo1.w)/u_blurInfo2.y);\n\tvec2 vec2FilterOff = vec2(u_blurInfo1.x/u_blurInfo2.x/c_IterationTime * 2.0,u_blurInfo1.y/u_blurInfo2.y/c_IterationTime * 2.0);\n\tfloat maxNum = u_blurInfo1.x * u_blurInfo1.y;\n\tvec2 vec2Off = vec2(0.0,0.0);\n\tfloat floatOff = c_IterationTime/2.0;\n\tfor(float i = 0.0;i<=c_IterationTime; ++i){\n\t\tfor(float j = 0.0;j<=c_IterationTime; ++j){\n\t\t\tvec2Off = vec2(vec2FilterOff.x * (i - floatOff),vec2FilterOff.y * (j - floatOff));\n\t\t\tvec4Color += texture2D(texture, v_texcoordAlpha.xy + vec2FilterDir + vec2Off)/floatIterationTotalTime;\n\t\t}\n\t}\n\tgl_FragColor = vec4(u_color.rgb,vec4Color.a * u_blurInfo2.z);\n\tgl_FragColor.rgb *= gl_FragColor.a;   \n   #endif\n   \n}";Pi.preCompile2D(0,1,t,e,null);t="attribute vec4 position;\nattribute vec4 attribColor;\n//attribute vec4 clipDir;\n//attribute vec2 clipRect;\nuniform vec4 clipMatDir;\nuniform vec2 clipMatPos;\n#ifdef WORLDMAT\n\tuniform mat4 mmat;\n#endif\nuniform mat4 u_mmat2;\n//uniform vec2 u_pos;\nuniform vec2 size;\nvarying vec4 color;\n//vec4 dirxy=vec4(0.9,0.1, -0.1,0.9);\n//vec4 clip=vec4(100.,30.,300.,600.);\nvarying vec2 cliped;\nvoid main(){\n\t\n#ifdef WORLDMAT\n\tvec4 pos=mmat*vec4(position.xy,0.,1.);\n\tgl_Position =vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n#else\n\tgl_Position =vec4((position.x/size.x-0.5)*2.0,(0.5-position.y/size.y)*2.0,position.z,1.0);\n#endif\t\n\tfloat clipw = length(clipMatDir.xy);\n\tfloat cliph = length(clipMatDir.zw);\n\tvec2 clippos = position.xy - clipMatPos.xy;\t//pos已经应用矩阵了，为了减的有意义，clip的位置也要缩放\n\tif(clipw>20000. && cliph>20000.)\n\t\tcliped = vec2(0.5,0.5);\n\telse {\n\t\t//clipdir是带缩放的方向，由于上面clippos是在缩放后的空间计算的，所以需要把方向先normalize一下\n\t\tcliped=vec2( dot(clippos,clipMatDir.xy)/clipw/clipw, dot(clippos,clipMatDir.zw)/cliph/cliph);\n\t}\n  //pos2d.x = dot(clippos,dirx);\n  color=attribColor/255.;\n}";e="precision mediump float;\n//precision mediump float;\nvarying vec4 color;\n//uniform float alpha;\nvarying vec2 cliped;\nvoid main(){\n\t//vec4 a=vec4(color.r, color.g, color.b, 1);\n\t//a.a*=alpha;\n    gl_FragColor= color;// vec4(color.r, color.g, color.b, alpha);\n\tgl_FragColor.rgb*=color.a;\n\tif(cliped.x<0.) discard;\n\tif(cliped.x>1.) discard;\n\tif(cliped.y<0.) discard;\n\tif(cliped.y>1.) discard;\n}";Pi.preCompile2D(0,4,t,e,null);t="attribute vec2 position;\nattribute vec2 texcoord;\nattribute vec4 color;\nuniform vec2 size;\nuniform float offsetX;\nuniform float offsetY;\nuniform mat4 mmat;\nuniform mat4 u_mmat2;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nvoid main() {\n  vec4 pos=mmat*u_mmat2*vec4(offsetX+position.x,offsetY+position.y,0,1 );\n  gl_Position = vec4((pos.x/size.x-0.5)*2.0,(0.5-pos.y/size.y)*2.0,pos.z,1.0);\n  v_color = color;\n  v_color.rgb *= v_color.a;\n  v_texcoord = texcoord;  \n}";e="precision mediump float;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\nuniform sampler2D texture;\nuniform float alpha;\nvoid main() {\n\tvec4 t_color = texture2D(texture, v_texcoord);\n\tgl_FragColor = t_color.rgba * v_color;\n\tgl_FragColor *= alpha;\n}";Pi.preCompile2D(0,512,t,e,null)};return t}();var G=function(){function l(){}v(l,"laya.display.cmd.DrawPolyCmd");var t=l.prototype;t.recover=function(){this.points=null;this.fillColor=null;this.lineColor=null;z.recover("DrawPolyCmd",this)};t.run=function(t,e,i){t._drawPoly(this.x+e,this.y+i,this.points,this.fillColor,this.lineColor,this.lineWidth,this.isConvexPolygon,this.vid)};d(0,t,"cmdID",function(){return"DrawPoly"});l.create=function(t,e,i,r,n,s,a,o){var h=z.getItemByClass("DrawPolyCmd",l);h.x=t;h.y=e;h.points=i;h.fillColor=r;h.lineColor=n;h.lineWidth=s;h.isConvexPolygon=a;h.vid=o;return h};l.ID="DrawPoly";return l}();var X=function(){function t(){this.fontName=null;this.complete=null;this.err=null;this._fontTxt=null;this._url=null;this._div=null;this._txtWidth=NaN;this._http=null}v(t,"laya.net.TTFLoader");var e=t.prototype;e.load=function(t){this._url=t;var e=t.split(".ttf")[0].split("/");this.fontName=e[e.length-1];if(Wt.isConchApp){this._loadConch()}else if(Yt.window.FontFace){this._loadWithFontFace()}else{this._loadWithCSS()}};e._loadConch=function(){this._http=new ei;this._http.on("error",this,this._onErr);this._http.on("complete",this,this._onHttpLoaded);this._http.send(this._url,null,"get","arraybuffer")};e._onHttpLoaded=function(t){Yt.window["conchTextCanvas"].setFontFaceFromBuffer(this.fontName,t);this._clearHttp();this._complete()};e._clearHttp=function(){if(this._http){this._http.off("error",this,this._onErr);this._http.off("complete",this,this._onHttpLoaded);this._http=null}};e._onErr=function(){this._clearHttp();if(this.err){this.err.runWith("fail:"+this._url);this.err=null}};e._complete=function(){y.systemTimer.clear(this,this._complete);y.systemTimer.clear(this,this._checkComplete);if(this._div&&this._div.parentNode){this._div.parentNode.removeChild(this._div);this._div=null}if(this.complete){this.complete.runWith(this);this.complete=null}};e._checkComplete=function(){if(Pe.measureText("LayaTTFFont",this._fontTxt).width!=this._txtWidth){this._complete()}};e._loadWithFontFace=function(){var t=new Yt.window.FontFace(this.fontName,"url('"+this._url+"')");Yt.window.document.fonts.add(t);var e=this;t.loaded.then(function(){e._complete()});t.load()};e._createDiv=function(){this._div=Yt.createElement("div");this._div.innerHTML="laya";var t=this._div.style;t.fontFamily=this.fontName;t.position="absolute";t.left="-100px";t.top="-100px";Yt.document.body.appendChild(this._div)};e._loadWithCSS=function(){var t=this;var e=Yt.createElement("style");e.type="text/css";Yt.document.body.appendChild(e);e.textContent="@font-face { font-family:'"+this.fontName+"'; src:url('"+this._url+"');}";this._fontTxt="40px "+this.fontName;this._txtWidth=Pe.measureText("LayaTTFFont",this._fontTxt).width;var i=this;e.onload=function(){y.systemTimer.once(1e4,i,t._complete)};y.systemTimer.loop(20,this,this._checkComplete);this._createDiv()};t._testString="LayaTTFFont";return t}();var Y=function(){function t(){this.blendShader=0;this.submitType=0;this.other=0;this.clear()}v(t,"laya.webgl.submit.SubmitKey");var e=t.prototype;e.clear=function(){this.submitType=-1;this.blendShader=this.other=0};e.copyFrom=function(t){this.other=t.other;this.blendShader=t.blendShader;this.submitType=t.submitType};e.copyFrom2=function(t,e,i){this.other=i;this.submitType=e};e.equal3_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader};e.equal4_2=function(t,e,i){return this.submitType===e&&this.other===i&&this.blendShader===t.blendShader};e.equal_3=function(t){return this.submitType===t.submitType&&this.blendShader===t.blendShader};e.equal=function(t){return this.other===t.other&&this.submitType===t.submitType&&this.blendShader===t.blendShader};return t}();var H=function(){function t(){this._graphicsCmdEncoder=null;this._index=0;this._paramData=null;this.texture=null;this.x=NaN;this.y=NaN;this.width=NaN;this.height=NaN}v(t,"laya.display.cmd.DrawCanvasCmd");var e=t.prototype;e.recover=function(){this._graphicsCmdEncoder=null;z.recover("DrawCanvasCmd",this)};d(0,e,"cmdID",function(){return"DrawCanvasCmd"});t.create=function(t,e,i,r,n){return null};t.ID="DrawCanvasCmd";t._DRAW_IMAGE_CMD_ENCODER_=null;t._PARAM_TEXTURE_POS_=2;t._PARAM_VB_POS_=5;return t}();var z=function(){function s(){}v(s,"laya.utils.Pool");s.getPoolBySign=function(t){return s._poolDic[t]||(s._poolDic[t]=[])};s.clearBySign=function(t){if(s._poolDic[t])s._poolDic[t].length=0};s.recover=function(t,e){if(e["__InPool"])return;e["__InPool"]=true;s.getPoolBySign(t).push(e)};s.recoverByClass=function(t){if(t){var e=t["__className"]||t.constructor._$gid;if(e)s.recover(e,t)}};s._getClassSign=function(t){var e=t["__className"]||t["_$gid"];if(!e){t["_$gid"]=e=xe.getGID()+""}return e};s.createByClass=function(t){return s.getItemByClass(s._getClassSign(t),t)};s.getItemByClass=function(t,e){if(!s._poolDic[t])return new e;var i=s.getPoolBySign(t);if(i.length){var r=i.pop();r["__InPool"]=false}else{r=new e}return r};s.getItemByCreateFun=function(t,e,i){var r=s.getPoolBySign(t);var n=r.length?r.pop():e.call(i);n["__InPool"]=false;return n};s.getItem=function(t){var e=s.getPoolBySign(t);var i=e.length?e.pop():null;if(i){i["__InPool"]=false}return i};s.POOLSIGN="__InPool";s._poolDic={};return s}();var j=function(){function t(t){this.script=null;this.codes={};this.funs={};this.curUseID=-1;this.funnames="";this.script=t;var e=0,i=0,r=0;while(true){e=t.indexOf("#begin",e);if(e<0)break;r=e+5;while(true){r=t.indexOf("#end",r);if(r<0)break;if(t.charAt(r+4)==="i")r+=5;else break}if(r<0){throw"add include err,no #end:"+t}i=t.indexOf("\n",e);var n=Oe.splitToWords(t.substr(e,i-e),null);if(n[1]=="code"){this.codes[n[2]]=t.substr(i+1,r-i-1)}else if(n[1]=="function"){i=t.indexOf("function",e);i+="function".length;this.funs[n[3]]=t.substr(i+1,r-i-1);this.funnames+=n[3]+";"}e=r+1}}v(t,"laya.webgl.utils.InlcudeFile");var e=t.prototype;e.getWith=function(t){var e=t?this.codes[t]:this.script;if(!e){throw"get with error:"+t}return e};e.getFunsScript=function(t){var e="";for(var i in this.funs){if(t.indexOf(i+";")>=0){e+=this.funs[i]}}return e};return t}();var K=function(){function t(){}v(t,"laya.display.SpriteConst");t.ALPHA=1;t.TRANSFORM=2;t.BLEND=4;t.CANVAS=8;t.FILTERS=16;t.MASK=32;t.CLIP=64;t.STYLE=128;t.TEXTURE=256;t.GRAPHICS=512;t.LAYAGL3D=1024;t.CUSTOM=2048;t.ONECHILD=4096;t.CHILDS=8192;t.REPAINT_NONE=0;t.REPAINT_NODE=1;t.REPAINT_CACHE=2;t.REPAINT_ALL=3;return t}();var $=function(){function t(){this._glBuffer=null;this._buffer=null;this._bufferType=0;this._bufferUsage=0;this._byteLength=0;this._glBuffer=Xt.instance.createBuffer()}v(t,"laya.webgl.utils.Buffer");var e=t.prototype;e._bindForVAO=function(){};e.bind=function(){return false};e.destroy=function(){if(this._glBuffer){Xt.instance.deleteBuffer(this._glBuffer);this._glBuffer=null}};d(0,e,"bufferUsage",function(){return this._bufferUsage});t._bindedVertexBuffer=null;t._bindedIndexBuffer=null;return t}();var q=function(){function u(){this.colorFlt=null}v(u,"laya.display.cmd.DrawTextureCmd");var t=u.prototype;t.recover=function(){this.texture._removeReference();this.texture=null;this.matrix=null;z.recover("DrawTextureCmd",this)};t.run=function(t,e,i){t.drawTextureWithTransform(this.texture,this.x,this.y,this.width,this.height,this.matrix,e,i,this.alpha,this.blendMode,this.colorFlt)};d(0,t,"cmdID",function(){return"DrawTexture"});u.create=function(t,e,i,r,n,s,a,o,h){var l=z.getItemByClass("DrawTextureCmd",u);l.texture=t;t._addReference();l.x=e;l.y=i;l.width=r;l.height=n;l.matrix=s;l.alpha=a;l.color=o;l.blendMode=h;if(o){l.colorFlt=new Ge;l.colorFlt.setColor(o)}return l};u.ID="DrawTexture";return u}();var Q=function(){function r(t,e){this.size=[0,0];this.alpha=1;this.ALPHA=1;this.subID=0;this.ref=1;this._cacheID=0;this.clipMatDir=[99999999,0,0,99999999];this.clipMatPos=[0,0];this.clipOff=[0,0];this.defines=new Je;this.mainID=t;this.subID=e;this.textureHost=null;this.texture=null;this.color=null;this.colorAdd=null;this.u_mmat2=null;this._cacheID=t|e;this._inClassCache=r._cache[this._cacheID];if(t>0&&!this._inClassCache){this._inClassCache=r._cache[this._cacheID]=[];this._inClassCache._length=0}this.clear()}v(r,"laya.webgl.shader.d2.value.Value2D");var t=r.prototype;t.setValue=function(t){};t._ShaderWithCompile=function(){var t=Pi.withCompile2D(0,this.mainID,this.defines.toNameDic(),this.mainID|this.defines._value,Vi.create,this._attribLocation);return t};t.upload=function(){var t=At;At.worldMatrix4===At.TEMPMAT4_ARRAY||this.defines.addInt(128);this.mmat=t.worldMatrix4;if(At.matWVP){this.defines.addInt(2048);this.u_MvpMatrix=At.matWVP.elements}var e=Pi.sharders[this.mainID|this.defines._value]||this._ShaderWithCompile();if(e._shaderValueWidth!==t.width||e._shaderValueHeight!==t.height){this.size[0]=t.width;this.size[1]=t.height;e._shaderValueWidth=t.width;e._shaderValueHeight=t.height;e.upload(this,null)}else{e.upload(this,e._params2dQuick2||e._make2dQuick2())}};t.setFilters=function(t){this.filters=t;if(!t)return;var e=t.length,i;for(var r=0;r<e;r++){i=t[r];if(i){this.defines.add(i.type);i.action.setValue(this)}}};t.clear=function(){this.defines._value=this.subID+(Bt.shaderHighPrecision?1024:0);this.clipOff[0]=0};t.release=function(){if(--this.ref<1){this._inClassCache&&(this._inClassCache[this._inClassCache._length++]=this);this.clear();this.filters=null;this.ref=1;this.clipOff[0]=0}};r._initone=function(t,e){r._typeClass[t]=e;r._cache[t]=[];r._cache[t]._length=0};r.__init__=function(){r._initone(4,mi);r._initone(512,gi);r._initone(1,li);r._initone(1|8,li)};r.create=function(t,e){var i=r._cache[t|e];if(i._length)return i[--i._length];else return new r._typeClass[t|e](e)};r._cache=[];r._typeClass=[];r.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return r}();var Z=function(){function u(){}v(u,"laya.maths.GrahamScan");u.multiply=function(t,e,i){return(t.x-i.x)*(e.y-i.y)-(e.x-i.x)*(t.y-i.y)};u.dis=function(t,e){return(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y)};u._getPoints=function(t,e,i){e===void 0&&(e=false);if(!u._mPointList)u._mPointList=[];while(u._mPointList.length<t)u._mPointList.push(new ie);if(!i)i=[];i.length=0;if(e){u.getFrom(i,u._mPointList,t)}else{u.getFromR(i,u._mPointList,t)}return i};u.getFrom=function(t,e,i){var r=0;for(r=0;r<i;r++){t.push(e[r])}return t};u.getFromR=function(t,e,i){var r=0;for(r=0;r<i;r++){t.push(e.pop())}return t};u.pListToPointList=function(t,e){e===void 0&&(e=false);var i=0,r=t.length/2,n=u._getPoints(r,e,u._tempPointList);for(i=0;i<r;i++){n[i].setTo(t[i+i],t[i+i+1])}return n};u.pointListToPlist=function(t){var e=0,i=t.length,r=u._temPList,n;r.length=0;for(e=0;e<i;e++){n=t[e];r.push(n.x,n.y)}return r};u.scanPList=function(t){return xe.copyArray(t,u.pointListToPlist(u.scan(u.pListToPointList(t,true))))};u.scan=function(t){var e=0,i=0,r=0,n=2,s,a=t.length,o;var h={};var l;o=u._temArr;o.length=0;a=t.length;for(e=a-1;e>=0;e--){s=t[e];l=s.x+"_"+s.y;if(!h.hasOwnProperty(l)){h[l]=true;o.push(s)}}a=o.length;xe.copyArray(t,o);for(e=1;e<a;e++)if(t[e].y<t[r].y||t[e].y==t[r].y&&t[e].x<t[r].x)r=e;s=t[0];t[0]=t[r];t[r]=s;for(e=1;e<a-1;e++){r=e;for(i=e+1;i<a;i++)if(u.multiply(t[i],t[r],t[0])>0||u.multiply(t[i],t[r],t[0])==0&&u.dis(t[0],t[i])<u.dis(t[0],t[r]))r=i;s=t[e];t[e]=t[r];t[r]=s}o=u._temArr;o.length=0;if(t.length<3){return xe.copyArray(o,t)}o.push(t[0],t[1],t[2]);for(e=3;e<a;e++){while(o.length>=2&&u.multiply(t[e],o[o.length-1],o[o.length-2])>=0)o.pop();t[e]&&o.push(t[e])}return o};u._mPointList=null;u._tempPointList=[];u._temPList=[];u._temArr=[];return u}();var J=function(){function r(){this._saveuse=0}v(r,"laya.webgl.canvas.save.SaveMark");var t=r.prototype;y.imps(t,{"laya.webgl.canvas.save.ISaveData":true});t.isSaveMark=function(){return true};t.restore=function(t){t._saveMark=this._preSaveMark;r.POOL[r.POOL._length++]=this};r.Create=function(t){var e=r.POOL;var i=e._length>0?e[--e._length]:new r;i._saveuse=0;i._preSaveMark=t._saveMark;t._saveMark=i;return i};r.POOL=o._createArray();return r}();var tt=function(){function c(){this.gid=0;this.repeat=1;this._count=0}v(c,"laya.utils.Tween");var t=c.prototype;t.to=function(t,e,i,r,n,s,a){s===void 0&&(s=0);a===void 0&&(a=false);return this._create(t,e,i,r,n,s,a,true,false,true)};t.from=function(t,e,i,r,n,s,a){s===void 0&&(s=0);a===void 0&&(a=false);return this._create(t,e,i,r,n,s,a,false,false,true)};t._create=function(t,e,i,r,n,s,a,o,h,l){if(!t)throw new Error("Tween:target is null");this._target=t;this._duration=i;this._ease=r||e.ease||c.easeNone;this._complete=n||e.complete;this._delay=s;this._props=[];this._usedTimer=0;this._startTimer=Yt.now();this._usedPool=h;this._delayParam=null;this.update=e.update;var u=t.$_GID||(t.$_GID=xe.getGID());if(!c.tweenMap[u]){c.tweenMap[u]=[this]}else{if(a)c.clearTween(t);c.tweenMap[u].push(this)}if(l){if(s<=0)this.firstStart(t,e,o);else{this._delayParam=[t,e,o];y.timer.once(s,this,this.firstStart,this._delayParam)}}else{this._initProps(t,e,o)}return this};t.firstStart=function(t,e,i){this._delayParam=null;if(t.destroyed){this.clear();return}this._initProps(t,e,i);this._beginLoop()};t._initProps=function(t,e,i){for(var r in e){if(typeof t[r]=="number"){var n=i?t[r]:e[r];var s=i?e[r]:t[r];this._props.push([r,n,s-n]);if(!i)t[r]=n}}};t._beginLoop=function(){y.timer.frameLoop(1,this,this._doEase)};t._doEase=function(){this._updateEase(Yt.now())};t._updateEase=function(t){var e=this._target;if(!e)return;if(e.destroyed)return c.clearTween(e);var i=this._usedTimer=t-this._startTimer-this._delay;if(i<0)return;if(i>=this._duration)return this.complete();var r=i>0?this._ease(i,0,1,this._duration):0;var n=this._props;for(var s=0,a=n.length;s<a;s++){var o=n[s];e[o[0]]=o[1]+r*o[2]}if(this.update)this.update.run()};t.complete=function(){if(!this._target)return;y.timer.runTimer(this,this.firstStart);var t=this._target;var e=this._props;var i=this._complete;for(var r=0,n=e.length;r<n;r++){var s=e[r];t[s[0]]=s[1]+s[2]}if(this.update)this.update.run();this._count++;if(this.repeat!=0&&this._count>=this.repeat){this.clear();i&&i.run()}else{this.restart()}};t.pause=function(){y.timer.clear(this,this._beginLoop);y.timer.clear(this,this._doEase);y.timer.clear(this,this.firstStart);var t=Yt.now();var e=NaN;e=t-this._startTimer-this._delay;if(e<0){this._usedTimer=e}};t.setStartTime=function(t){this._startTimer=t};t.clear=function(){if(this._target){this._remove();this._clear()}};t._clear=function(){this.pause();y.timer.clear(this,this.firstStart);this._complete=null;this._target=null;this._ease=null;this._props=null;this._delayParam=null;if(this._usedPool){this.update=null;z.recover("tween",this)}};t.recover=function(){this._usedPool=true;this._clear()};t._remove=function(){var t=c.tweenMap[this._target.$_GID];if(t){for(var e=0,i=t.length;e<i;e++){if(t[e]===this){t.splice(e,1);break}}}};t.restart=function(){this.pause();this._usedTimer=0;this._startTimer=Yt.now();if(this._delayParam){y.timer.once(this._delay,this,this.firstStart,this._delayParam);return}var t=this._props;for(var e=0,i=t.length;e<i;e++){var r=t[e];this._target[r[0]]=r[1]}y.timer.once(this._delay,this,this._beginLoop)};t.resume=function(){if(this._usedTimer>=this._duration)return;this._startTimer=Yt.now()-this._usedTimer-this._delay;if(this._delayParam){if(this._usedTimer<0){y.timer.once(-this._usedTimer,this,this.firstStart,this._delayParam)}else{this.firstStart.apply(this,this._delayParam)}}else{this._beginLoop()}};d(0,t,"progress",null,function(t){var e=t*this._duration;this._startTimer=Yt.now()-this._delay-e});c.to=function(t,e,i,r,n,s,a,o){s===void 0&&(s=0);a===void 0&&(a=false);o===void 0&&(o=true);return z.getItemByClass("tween",c)._create(t,e,i,r,n,s,a,true,o,true)};c.from=function(t,e,i,r,n,s,a,o){s===void 0&&(s=0);a===void 0&&(a=false);o===void 0&&(o=true);return z.getItemByClass("tween",c)._create(t,e,i,r,n,s,a,false,o,true)};c.clearAll=function(t){if(!t||!t.$_GID)return;var e=c.tweenMap[t.$_GID];if(e){for(var i=0,r=e.length;i<r;i++){e[i]._clear()}e.length=0}};c.clear=function(t){t.clear()};c.clearTween=function(t){c.clearAll(t)};c.easeNone=function(t,e,i,r){return i*t/r+e};c.tweenMap=[];return c}();var et=function(){function h(){}v(h,"laya.display.cmd.DrawRectCmd");var t=h.prototype;t.recover=function(){this.fillColor=null;this.lineColor=null;z.recover("DrawRectCmd",this)};t.run=function(t,e,i){t.drawRect(this.x+e,this.y+i,this.width,this.height,this.fillColor,this.lineColor,this.lineWidth)};d(0,t,"cmdID",function(){return"DrawRect"});h.create=function(t,e,i,r,n,s,a){var o=z.getItemByClass("DrawRectCmd",h);o.x=t;o.y=e;o.width=i;o.height=r;o.fillColor=n;o.lineColor=s;o.lineWidth=a;return o};h.ID="DrawRect";return h}();var it=function(){function t(t,e,i){this.i=null;this.x=null;this.y=null;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=null;this.i=t;this.x=e;this.y=i;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=false}v(t,"laya.webgl.shapes.EarcutNode");return t}();var rt=function(){function n(){this.fun=null;this._this=null;this.args=null;this._ref=1;this._key=new Y}v(n,"laya.webgl.submit.SubmitCMD");var t=n.prototype;y.imps(t,{"laya.webgl.submit.ISubmit":true});t.renderSubmit=function(){this.fun.apply(this._this,this.args);return 1};t.getRenderType=function(){return 0};t.reUse=function(t,e){this._ref++;return e};t.releaseRender=function(){if(--this._ref<1){var t=n.POOL;t[t._length++]=this}};t.clone=function(t,e,i){return null};n.create=function(t,e,i){var r=n.POOL._length?n.POOL[--n.POOL._length]:new n;r.fun=e;r.args=t;r._this=i;r._ref=1;r._key.clear();return r};n.POOL=[];n.__init$=function(){{n.POOL._length=0}};return n}();var nt=function(){function n(t){this._url=null;this._path=null;this._url=n.formatURL(t);this._path=n.getPath(t)}v(n,"laya.net.URL");var t=n.prototype;d(0,t,"path",function(){return this._path});d(0,t,"url",function(){return this._url});d(1,n,"basePath",function(){return n._basePath},function(t){n._basePath=y._getUrlPath();n._basePath=n.formatURL(t)});n.formatURL=function(t){if(!t)return"null path";if(t.indexOf(":")>0)return t;if(n.customFormat!=null)t=n.customFormat(t);if(t.indexOf(":")>0)return t;var e=t.charAt(0);if(e==="."){return n._formatRelativePath(n._basePath+t)}else if(e==="~"){return n.rootPath+t.substring(1)}else if(e==="d"){if(t.indexOf("data:image")===0)return t}else if(e==="/"){return t}return n._basePath+t};n._formatRelativePath=function(t){var e=t.split("/");for(var i=0,r=e.length;i<r;i++){if(e[i]==".."){e.splice(i-1,2);i-=2}}return e.join("/")};n.getPath=function(t){var e=t.lastIndexOf("/");return e>0?t.substr(0,e+1):""};n.getFileName=function(t){var e=t.lastIndexOf("/");return e>0?t.substr(e+1):t};n.getAdptedFilePath=function(t){if(!n.exportSceneToJson||!t)return t;var e=0,i=0;i=n._adpteTypeList.length;var r;for(e=0;e<i;e++){r=n._adpteTypeList[e];t=t.replace(r[0],r[1])}return t};n.version={};n.exportSceneToJson=false;n._basePath="";n.rootPath="";n.customFormat=function(t){var e=n.version[t];if(!Wt.isConchApp&&e)t+="?v="+e;return t};a(n,["_adpteTypeList",function(){return this._adpteTypeList=[[".scene3d",".json"],[".scene",".json"],[".taa",".json"],[".prefab",".json"]]}]);return n}();var st=function(){function n(){}v(n,"laya.utils.CacheManger");n.regCacheByFunction=function(t,e){n.unRegCacheByFunction(t,e);var i;i={tryDispose:t,getCacheList:e};n._cacheList.push(i)};n.unRegCacheByFunction=function(t,e){var i=0,r=0;r=n._cacheList.length;for(i=0;i<r;i++){if(n._cacheList[i].tryDispose==t&&n._cacheList[i].getCacheList==e){n._cacheList.splice(i,1);return}}};n.forceDispose=function(){var t=0,e=n._cacheList.length;for(t=0;t<e;t++){n._cacheList[t].tryDispose(true)}};n.beginCheck=function(t){t===void 0&&(t=15e3);y.systemTimer.loop(t,null,n._checkLoop)};n.stopCheck=function(){y.systemTimer.clear(null,n._checkLoop)};n._checkLoop=function(){var t=n._cacheList;if(t.length<1)return;var e=Yt.now();var i=0;var r=0;r=i=t.length;while(i>0){n._index++;n._index=n._index%r;t[n._index].tryDispose(false);if(Yt.now()-e>n.loopTimeLimit)break;i--}};n.loopTimeLimit=2;n._cacheList=[];n._index=0;return n}();var at=function(){function t(){this.reset()}v(t,"laya.display.css.SpriteStyle");var e=t.prototype;e.reset=function(){this.scaleX=this.scaleY=1;this.skewX=this.skewY=0;this.pivotX=this.pivotY=this.rotation=0;this.alpha=1;if(this.scrollRect)this.scrollRect.recover();this.scrollRect=null;if(this.viewport)this.viewport.recover();this.viewport=null;this.hitArea=null;this.dragging=null;this.blendMode=null;return this};e.recover=function(){if(this===t.EMPTY)return;z.recover("SpriteStyle",this.reset())};t.create=function(){return z.getItemByClass("SpriteStyle",t)};t.EMPTY=new t;return t}();var ot=function(){function t(t,e){this.submitStartPos=0;this.submitEndPos=0;this.context=null;this.touches=[];this.submits=[];this.sprite=null;this._mesh=null;this._pathMesh=null;this._triangleMesh=null;this.meshlist=[];this._oldMesh=null;this._oldPathMesh=null;this._oldTriMesh=null;this._oldMeshList=null;this.oldTx=0;this.oldTy=0;this.cachedClipInfo=new pt;this.invMat=new pt;this.context=t;this.sprite=e;t._globalClipMatrix.copyTo(this.cachedClipInfo)}v(t,"laya.webgl.canvas.WebGLCacheAsNormalCanvas");var e=t.prototype;e.startRec=function(){if(this.context._charSubmitCache._enbale){this.context._charSubmitCache.enable(false,this.context);this.context._charSubmitCache.enable(true,this.context)}this.context._incache=true;this.touches.length=0;this.context.touches=this.touches;this.context._globalClipMatrix.copyTo(this.cachedClipInfo);this.submits.length=0;this.submitStartPos=this.context._submits._length;for(var t=0,e=this.meshlist.length;t<e;t++){var i=this.meshlist[t];i.canReuse?i.releaseMesh():i.destroy()}this.meshlist.length=0;this._mesh=ai.getAMesh(false);this._pathMesh=Qe.getAMesh(false);this._triangleMesh=fi.getAMesh(false);this.meshlist.push(this._mesh);this.meshlist.push(this._pathMesh);this.meshlist.push(this._triangleMesh);this.context._curSubmit=T.RENDERBASE;this._oldMesh=this.context._mesh;this._oldPathMesh=this.context._pathMesh;this._oldTriMesh=this.context._triangleMesh;this._oldMeshList=this.context.meshlist;this.context._mesh=this._mesh;this.context._pathMesh=this._pathMesh;this.context._triangleMesh=this._triangleMesh;this.context.meshlist=this.meshlist;this.oldTx=this.context._curMat.tx;this.oldTy=this.context._curMat.ty;this.context._curMat.tx=0;this.context._curMat.ty=0;this.context._curMat.copyTo(this.invMat);this.invMat.invert()};e.endRec=function(){if(this.context._charSubmitCache._enbale){this.context._charSubmitCache.enable(false,this.context);this.context._charSubmitCache.enable(true,this.context)}var t=this.context._submits;this.submitEndPos=t._length;var e=this.submitEndPos-this.submitStartPos;for(var i=0;i<e;i++){this.submits.push(t[this.submitStartPos+i])}t._length-=e;this.context._mesh=this._oldMesh;this.context._pathMesh=this._oldPathMesh;this.context._triangleMesh=this._oldTriMesh;this.context.meshlist=this._oldMeshList;this.context._curSubmit=T.RENDERBASE;this.context._curMat.tx=this.oldTx;this.context._curMat.ty=this.oldTy;this.context.touches=null;this.context._incache=false};e.isCacheValid=function(){var t=this.context._globalClipMatrix;if(t.a!=this.cachedClipInfo.a||t.b!=this.cachedClipInfo.b||t.c!=this.cachedClipInfo.c||t.d!=this.cachedClipInfo.d||t.tx!=this.cachedClipInfo.tx||t.ty!=this.cachedClipInfo.ty)return false;return true};e.flushsubmit=function(){var e=T.RENDERBASE;this.submits.forEach(function(t){if(t==T.RENDERBASE)return;T.preRender=e;e=t;t.renderSubmit()})};e.releaseMem=function(){};a(t,["matI",function(){return this.matI=new pt}]);return t}();var ht=function(){var h;function l(t){this.scale=1;this.currFrame=0;this._delta=0;this._map=[];this._handlers=[];this._temp=[];this._count=0;this.currTimer=Yt.now();this._lastTimer=Yt.now();t===void 0&&(t=true);t&&y.systemTimer&&y.systemTimer.frameLoop(1,this,this._update)}v(l,"laya.utils.Timer");var t=l.prototype;t._update=function(){if(this.scale<=0){this._lastTimer=Yt.now();return}var t=this.currFrame=this.currFrame+this.scale;var e=Yt.now();this._delta=(e-this._lastTimer)*this.scale;var i=this.currTimer=this.currTimer+this._delta;this._lastTimer=e;var r=this._handlers;this._count=0;for(var n=0,s=r.length;n<s;n++){var a=r[n];if(a.method!==null){var o=a.userFrame?t:i;if(o>=a.exeTime){if(a.repeat){if(!a.jumpFrame){a.exeTime+=a.delay;a.run(false);if(o>a.exeTime){a.exeTime+=Math.ceil((o-a.exeTime)/a.delay)*a.delay}}else{while(o>=a.exeTime){a.exeTime+=a.delay;a.run(false)}}}else{a.run(true)}}}else{this._count++}}if(this._count>30||t%200===0)this._clearHandlers()};t._clearHandlers=function(){var t=this._handlers;for(var e=0,i=t.length;e<i;e++){var r=t[e];if(r.method!==null)this._temp.push(r);else this._recoverHandler(r)}this._handlers=this._temp;t.length=0;this._temp=t};t._recoverHandler=function(t){if(this._map[t.key]==t)this._map[t.key]=null;t.clear();l._pool.push(t)};t._create=function(t,e,i,r,n,s,a){if(!i){n.apply(r,s);return null}if(a){var o=this._getHandler(r,n);if(o){o.repeat=e;o.userFrame=t;o.delay=i;o.caller=r;o.method=n;o.args=s;o.exeTime=i+(t?this.currFrame:this.currTimer+Yt.now()-this._lastTimer);return o}}o=l._pool.length>0?l._pool.pop():new h;o.repeat=e;o.userFrame=t;o.delay=i;o.caller=r;o.method=n;o.args=s;o.exeTime=i+(t?this.currFrame:this.currTimer+Yt.now()-this._lastTimer);this._indexHandler(o);this._handlers.push(o);return o};t._indexHandler=function(t){var e=t.caller;var i=t.method;var r=e?e.$_GID||(e.$_GID=xe.getGID()):0;var n=i.$_TID||(i.$_TID=l._mid++*1e5);t.key=r+n;this._map[t.key]=t};t.once=function(t,e,i,r,n){n===void 0&&(n=true);this._create(false,false,t,e,i,r,n)};t.loop=function(t,e,i,r,n,s){n===void 0&&(n=true);s===void 0&&(s=false);var a=this._create(false,true,t,e,i,r,n);if(a)a.jumpFrame=s};t.frameOnce=function(t,e,i,r,n){n===void 0&&(n=true);this._create(true,false,t,e,i,r,n)};t.frameLoop=function(t,e,i,r,n){n===void 0&&(n=true);this._create(true,true,t,e,i,r,n)};t.toString=function(){return" handlers:"+this._handlers.length+" pool:"+l._pool.length};t.clear=function(t,e){var i=this._getHandler(t,e);if(i){this._map[i.key]=null;i.key=0;i.clear()}};t.clearAll=function(t){if(!t)return;for(var e=0,i=this._handlers.length;e<i;e++){var r=this._handlers[e];if(r.caller===t){this._map[r.key]=null;r.key=0;r.clear()}}};t._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=xe.getGID()):0;var r=e.$_TID||(e.$_TID=l._mid++*1e5);return this._map[i+r]};t.callLater=function(t,e,i){he.I.callLater(t,e,i)};t.runCallLater=function(t,e){he.I.runCallLater(t,e)};t.runTimer=function(t,e){var i=this._getHandler(t,e);if(i&&i.method!=null){this._map[i.key]=null;i.run(true)}};t.pause=function(){this.scale=0};t.resume=function(){this.scale=1};d(0,t,"delta",function(){return this._delta});l._pool=[];l._mid=1;l.__init$=function(){h=function(){function t(){this.key=0;this.repeat=false;this.delay=0;this.userFrame=false;this.exeTime=0;this.caller=null;this.method=null;this.args=null;this.jumpFrame=false}v(t,"");var e=t.prototype;e.clear=function(){this.caller=null;this.method=null;this.args=null};e.run=function(t){var e=this.caller;if(e&&e.destroyed)return this.clear();var i=this.method;var r=this.args;t&&this.clear();if(i==null)return;r?i.apply(e,r):i.call(e)};return t}()};return l}();var lt=function(){function o(){this.reset()}v(o,"laya.display.css.CacheStyle");var t=o.prototype;t.needBitmapCache=function(){return this.cacheForFilters||!!this.mask};t.needEnableCanvasRender=function(){return this.userSetCache!="none"||this.cacheForFilters||!!this.mask};t.releaseContext=function(){if(this.canvas&&this.canvas.size){z.recover("CacheCanvas",this.canvas);this.canvas.size(0,0);this.canvas.width=0;this.canvas.height=0}this.canvas=null};t.createContext=function(){if(!this.canvas){this.canvas=z.getItem("CacheCanvas")||new Bi(false);var t=this.canvas.context;if(!t){t=this.canvas.getContext("2d")}}};t.releaseFilterCache=function(){var t=this.filterCache;if(t){t.destroy();t.recycle();this.filterCache=null}};t.recover=function(){if(this===o.EMPTY)return;z.recover("SpriteCache",this.reset())};t.reset=function(){this.releaseContext();this.releaseFilterCache();this.cacheAs="none";this.enableCanvasRender=false;this.userSetCache="none";this.cacheForFilters=false;this.staticCache=false;this.reCache=true;this.mask=null;this.maskParent=null;this.filterCache=null;this.filters=null;this.hasGlowFilter=false;if(this.cacheRect)this.cacheRect.recover();this.cacheRect=null;return this};t._calculateCacheRect=function(t,e,i,r){var n=t._cacheStyle;if(!n.cacheRect)n.cacheRect=St.create();var s;if(e==="bitmap"){s=t.getSelfBounds();s.width=s.width+16*2;s.height=s.height+16*2;s.x=s.x-t.pivotX;s.y=s.y-t.pivotY;s.x=s.x-16;s.y=s.y-16;s.x=Math.floor(s.x+i)-i;s.y=Math.floor(s.y+r)-r;s.width=Math.floor(s.width);s.height=Math.floor(s.height);n.cacheRect.copyFrom(s)}else{n.cacheRect.setTo(-t._style.pivotX,-t._style.pivotY,1,1)}s=n.cacheRect;if(t._style.scrollRect){var a=t._style.scrollRect;s.x-=a.x;s.y-=a.y}o._scaleInfo.setTo(1,1);return o._scaleInfo};o.create=function(){return z.getItemByClass("SpriteCache",o)};o.EMPTY=new o;o.CANVAS_EXTEND_EDGE=16;a(o,["_scaleInfo",function(){return this._scaleInfo=new ie}]);return o}();var ut=function(){function n(){this._mat=new pt}v(n,"laya.webgl.canvas.save.SaveTranslate");var t=n.prototype;y.imps(t,{"laya.webgl.canvas.save.ISaveData":true});t.isSaveMark=function(){return false};t.restore=function(t){this._mat.copyTo(t._curMat);n.POOL[n.POOL._length++]=this};n.save=function(t){var e=n.POOL;var i=e._length>0?e[--e._length]:new n;t._curMat.copyTo(i._mat);var r=t._save;r[r._length++]=i};n.POOL=o._createArray();return n}();var ct=function(){function h(){}v(h,"laya.display.cmd.DrawLineCmd");var t=h.prototype;t.recover=function(){z.recover("DrawLineCmd",this)};t.run=function(t,e,i){t._drawLine(e,i,this.fromX,this.fromY,this.toX,this.toY,this.lineColor,this.lineWidth,this.vid)};d(0,t,"cmdID",function(){return"DrawLine"});h.create=function(t,e,i,r,n,s,a){var o=z.getItemByClass("DrawLineCmd",h);o.fromX=t;o.fromY=e;o.toX=i;o.toY=r;o.lineColor=n;o.lineWidth=s;o.vid=a;return o};h.ID="DrawLine";return h}();var ft=function(){function s(){}v(s,"laya.webgl.WebGLContext");var t=s.prototype;t.getContextAttributes=function(){return null};t.isContextLost=function(){};t.getSupportedExtensions=function(){return null};t.getExtension=function(t){return null};t.activeTexture=function(t){};t.attachShader=function(t,e){};t.bindAttribLocation=function(t,e,i){};t.bindBuffer=function(t,e){};t.bindFramebuffer=function(t,e){};t.bindRenderbuffer=function(t,e){};t.bindTexture=function(t,e){};t.useTexture=function(t){};t.blendColor=function(t,e,i,r){};t.blendEquation=function(t){};t.blendEquationSeparate=function(t,e){};t.blendFunc=function(t,e){};t.blendFuncSeparate=function(t,e,i,r){};t.bufferData=function(t,e,i){};t.bufferSubData=function(t,e,i){};t.checkFramebufferStatus=function(t){return null};t.clear=function(t){};t.clearColor=function(t,e,i,r){};t.clearDepth=function(t){};t.clearStencil=function(t){};t.colorMask=function(t,e,i,r){};t.compileShader=function(t){};t.copyTexImage2D=function(t,e,i,r,n,s,a,o){};t.copyTexSubImage2D=function(t,e,i,r,n,s,a,o){};t.createBuffer=function(){};t.createFramebuffer=function(){};t.createProgram=function(){};t.createRenderbuffer=function(){};t.createShader=function(t){};t.createTexture=function(){return null};t.cullFace=function(t){};t.deleteBuffer=function(t){};t.deleteFramebuffer=function(t){};t.deleteProgram=function(t){};t.deleteRenderbuffer=function(t){};t.deleteShader=function(t){};t.deleteTexture=function(t){};t.depthFunc=function(t){};t.depthMask=function(t){};t.depthRange=function(t,e){};t.detachShader=function(t,e){};t.disable=function(t){};t.disableVertexAttribArray=function(t){};t.drawArrays=function(t,e,i){};t.drawElements=function(t,e,i,r){};t.enable=function(t){};t.enableVertexAttribArray=function(t){};t.finish=function(){};t.flush=function(){};t.framebufferRenderbuffer=function(t,e,i,r){};t.framebufferTexture2D=function(t,e,i,r,n){};t.frontFace=function(t){return null};t.generateMipmap=function(t){return null};t.getActiveAttrib=function(t,e){return null};t.getActiveUniform=function(t,e){return null};t.getAttribLocation=function(t,e){return 0};t.getParameter=function(t){return null};t.getBufferParameter=function(t,e){return null};t.getError=function(){return null};t.getFramebufferAttachmentParameter=function(t,e,i){};t.getProgramParameter=function(t,e){return 0};t.getProgramInfoLog=function(t){return null};t.getRenderbufferParameter=function(t,e){return null};t.getShaderPrecisionFormat=function(t){var e=arguments;return null};t.getShaderParameter=function(t,e){};t.getShaderInfoLog=function(t){return null};t.getShaderSource=function(t){return null};t.getTexParameter=function(t,e){};t.getUniform=function(t,e){};t.getUniformLocation=function(t,e){return null};t.getVertexAttrib=function(t,e){return null};t.getVertexAttribOffset=function(t,e){return null};t.hint=function(t,e){};t.isBuffer=function(t){};t.isEnabled=function(t){};t.isFramebuffer=function(t){};t.isProgram=function(t){};t.isRenderbuffer=function(t){};t.isShader=function(t){};t.isTexture=function(t){};t.lineWidth=function(t){};t.linkProgram=function(t){};t.pixelStorei=function(t,e){};t.polygonOffset=function(t,e){};t.readPixels=function(t,e,i,r,n,s,a){};t.renderbufferStorage=function(t,e,i,r){};t.sampleCoverage=function(t,e){};t.scissor=function(t,e,i,r){};t.shaderSource=function(t,e){};t.stencilFunc=function(t,e,i){};t.stencilFuncSeparate=function(t,e,i,r){};t.stencilMask=function(t){};t.stencilMaskSeparate=function(t,e){};t.stencilOp=function(t,e,i){};t.stencilOpSeparate=function(t,e,i,r){};t.texImage2D=function(t){};t.texParameterf=function(t,e,i){};t.texParameteri=function(t,e,i){};t.texSubImage2D=function(t){};t.uniform1f=function(t,e){};t.uniform1fv=function(t,e){};t.uniform1i=function(t,e){};t.uniform1iv=function(t,e){};t.uniform2f=function(t,e,i){};t.uniform2fv=function(t,e){};t.uniform2i=function(t,e,i){};t.uniform2iv=function(t,e){};t.uniform3f=function(t,e,i,r){};t.uniform3fv=function(t,e){};t.uniform3i=function(t,e,i,r){};t.uniform3iv=function(t,e){};t.uniform4f=function(t,e,i,r,n){};t.uniform4fv=function(t,e){};t.uniform4i=function(t,e,i,r,n){};t.uniform4iv=function(t,e){};t.uniformMatrix2fv=function(t,e,i){};t.uniformMatrix3fv=function(t,e,i){};t.uniformMatrix4fv=function(t,e,i){};t.useProgram=function(t){};t.validateProgram=function(t){};t.vertexAttrib1f=function(t,e){};t.vertexAttrib1fv=function(t,e){};t.vertexAttrib2f=function(t,e,i){};t.vertexAttrib2fv=function(t,e){};t.vertexAttrib3f=function(t,e,i,r){};t.vertexAttrib3fv=function(t,e){};t.vertexAttrib4f=function(t,e,i,r,n){};t.vertexAttrib4fv=function(t,e){};t.vertexAttribPointer=function(t,e,i,r,n,s){};t.viewport=function(t,e,i,r){};t.configureBackBuffer=function(t,e,i,r,n){r===void 0&&(r=true);n===void 0&&(n=false)};t.compressedTexImage2D=function(t){};t.createVertexArray=function(){throw"not implemented"};t.bindVertexArray=function(t){throw"not implemented"};t.deleteVertexArray=function(t){throw"not implemented"};t.isVertexArray=function(t){throw"not implemented"};s._forceSupportVAOPlatform=function(){return Yt.onMiniGame&&Yt.onIOS||Yt.onBDMiniGame||Yt.onQGMiniGame};s.__init__=function(t){laya.webgl.WebGLContext._checkExtensions(t);if(!Bt._isWebGL2&&!Wt.isConchApp){ge;if(g._setupVertexArrayObject){if(s._forceSupportVAOPlatform())g._forceSetupVertexArrayObject(t);else g._setupVertexArrayObject(t)}var e=(t.rawgl||t).getExtension("OES_vertex_array_object");if(e){var i=t;i.createVertexArray=function(){return e.createVertexArrayOES()};i.bindVertexArray=function(t){e.bindVertexArrayOES(t)};i.deleteVertexArray=function(t){e.deleteVertexArrayOES(t)};i.isVertexArray=function(t){e.isVertexArrayOES(t)}}}};s._getExtension=function(t,e){var i=s._extentionVendorPrefixes;for(var r in i){var n=t.getExtension(i[r]+e);if(n)return n}return null};s._checkExtensions=function(t){s._extTextureFilterAnisotropic=s._getExtension(t,"EXT_texture_filter_anisotropic");s._compressedTextureS3tc=s._getExtension(t,"WEBGL_compressed_texture_s3tc");s._compressedTexturePvrtc=s._getExtension(t,"WEBGL_compressed_texture_pvrtc");s._compressedTextureEtc1=s._getExtension(t,"WEBGL_compressed_texture_etc1");if(!s._forceSupportVAOPlatform())s._angleInstancedArrays=s._getExtension(t,"ANGLE_instanced_arrays")};s.__init_native=function(){if(!Wt.supportWebGLPlusRendering)return;var t=s;t.activeTexture=t.activeTextureForNative;t.bindTexture=t.bindTextureForNative};s.useProgram=function(t,e){if(s._useProgram===e)return false;t.useProgram(e);s._useProgram=e;return true};s.setDepthTest=function(t,e){e!==s._depthTest&&(s._depthTest=e,e?t.enable(2929):t.disable(2929))};s.setDepthMask=function(t,e){e!==s._depthMask&&(s._depthMask=e,t.depthMask(e))};s.setDepthFunc=function(t,e){e!==s._depthFunc&&(s._depthFunc=e,t.depthFunc(e))};s.setBlend=function(t,e){e!==s._blend&&(s._blend=e,e?t.enable(3042):t.disable(3042))};s.setBlendFunc=function(t,e,i){(e!==s._sFactor||i!==s._dFactor)&&(s._sFactor=s._srcAlpha=e,s._dFactor=s._dstAlpha=i,t.blendFunc(e,i))};s.setBlendFuncSeperate=function(t,e,i,r,n){if(e!==s._sFactor||i!==s._dFactor||r!==s._srcAlpha||n!==s._dstAlpha){s._sFactor=e;s._dFactor=i;s._srcAlpha=r;s._dstAlpha=n;t.blendFuncSeparate(e,i,r,n)}};s.setCullFace=function(t,e){e!==s._cullFace&&(s._cullFace=e,e?t.enable(2884):t.disable(2884))};s.setFrontFace=function(t,e){e!==s._frontFace&&(s._frontFace=e,t.frontFace(e))};s.activeTexture=function(t,e){if(s._activedTextureID!==e){t.activeTexture(e);s._activedTextureID=e}};s.bindTexture=function(t,e,i){if(s._activeTextures[s._activedTextureID-33984]!==i){t.bindTexture(e,i);s._activeTextures[s._activedTextureID-33984]=i}};s.useProgramForNative=function(t,e){t.useProgram(e);return true};s.setDepthTestForNative=function(t,e){if(e)t.enable(2929);else t.disable(2929)};s.setDepthMaskForNative=function(t,e){t.depthMask(e)};s.setDepthFuncForNative=function(t,e){t.depthFunc(e)};s.setBlendForNative=function(t,e){if(e)t.enable(3042);else t.disable(3042)};s.setBlendFuncForNative=function(t,e,i){t.blendFunc(e,i)};s.setCullFaceForNative=function(t,e){if(e)t.enable(2884);else t.disable(2884)};s.setFrontFaceForNative=function(t,e){t.frontFace(e)};s.activeTextureForNative=function(t,e){t.activeTexture(e)};s.bindTextureForNative=function(t,e,i){t.bindTexture(e,i)};s.bindVertexArrayForNative=function(t,e){t.bindVertexArray(e)};s.DEPTH_BUFFER_BIT=256;s.STENCIL_BUFFER_BIT=1024;s.COLOR_BUFFER_BIT=16384;s.POINTS=0;s.LINES=1;s.LINE_LOOP=2;s.LINE_STRIP=3;s.TRIANGLES=4;s.TRIANGLE_STRIP=5;s.TRIANGLE_FAN=6;s.ZERO=0;s.ONE=1;s.SRC_COLOR=768;s.ONE_MINUS_SRC_COLOR=769;s.SRC_ALPHA=770;s.ONE_MINUS_SRC_ALPHA=771;s.DST_ALPHA=772;s.ONE_MINUS_DST_ALPHA=773;s.DST_COLOR=774;s.ONE_MINUS_DST_COLOR=775;s.SRC_ALPHA_SATURATE=776;s.FUNC_ADD=32774;s.BLEND_EQUATION=32777;s.BLEND_EQUATION_RGB=32777;s.BLEND_EQUATION_ALPHA=34877;s.FUNC_SUBTRACT=32778;s.FUNC_REVERSE_SUBTRACT=32779;s.BLEND_DST_RGB=32968;s.BLEND_SRC_RGB=32969;s.BLEND_DST_ALPHA=32970;s.BLEND_SRC_ALPHA=32971;s.CONSTANT_COLOR=32769;s.ONE_MINUS_CONSTANT_COLOR=32770;s.CONSTANT_ALPHA=32771;s.ONE_MINUS_CONSTANT_ALPHA=32772;s.BLEND_COLOR=32773;s.ARRAY_BUFFER=34962;s.ELEMENT_ARRAY_BUFFER=34963;s.ARRAY_BUFFER_BINDING=34964;s.ELEMENT_ARRAY_BUFFER_BINDING=34965;s.STREAM_DRAW=35040;s.STATIC_DRAW=35044;s.DYNAMIC_DRAW=35048;s.BUFFER_SIZE=34660;s.BUFFER_USAGE=34661;s.CURRENT_VERTEX_ATTRIB=34342;s.FRONT=1028;s.BACK=1029;s.CULL_FACE=2884;s.FRONT_AND_BACK=1032;s.BLEND=3042;s.DITHER=3024;s.STENCIL_TEST=2960;s.DEPTH_TEST=2929;s.SCISSOR_TEST=3089;s.POLYGON_OFFSET_FILL=32823;s.SAMPLE_ALPHA_TO_COVERAGE=32926;s.SAMPLE_COVERAGE=32928;s.NO_ERROR=0;s.INVALID_ENUM=1280;s.INVALID_VALUE=1281;s.INVALID_OPERATION=1282;s.OUT_OF_MEMORY=1285;s.CW=2304;s.CCW=2305;s.LINE_WIDTH=2849;s.ALIASED_POINT_SIZE_RANGE=33901;s.ALIASED_LINE_WIDTH_RANGE=33902;s.CULL_FACE_MODE=2885;s.FRONT_FACE=2886;s.DEPTH_RANGE=2928;s.DEPTH_WRITEMASK=2930;s.DEPTH_CLEAR_VALUE=2931;s.DEPTH_FUNC=2932;s.STENCIL_CLEAR_VALUE=2961;s.STENCIL_FUNC=2962;s.STENCIL_FAIL=2964;s.STENCIL_PASS_DEPTH_FAIL=2965;s.STENCIL_PASS_DEPTH_PASS=2966;s.STENCIL_REF=2967;s.STENCIL_VALUE_MASK=2963;s.STENCIL_WRITEMASK=2968;s.STENCIL_BACK_FUNC=34816;s.STENCIL_BACK_FAIL=34817;s.STENCIL_BACK_PASS_DEPTH_FAIL=34818;s.STENCIL_BACK_PASS_DEPTH_PASS=34819;s.STENCIL_BACK_REF=36003;s.STENCIL_BACK_VALUE_MASK=36004;s.STENCIL_BACK_WRITEMASK=36005;s.VIEWPORT=2978;s.SCISSOR_BOX=3088;s.COLOR_CLEAR_VALUE=3106;s.COLOR_WRITEMASK=3107;s.UNPACK_ALIGNMENT=3317;s.PACK_ALIGNMENT=3333;s.MAX_TEXTURE_SIZE=3379;s.MAX_VIEWPORT_DIMS=3386;s.SUBPIXEL_BITS=3408;s.RED_BITS=3410;s.GREEN_BITS=3411;s.BLUE_BITS=3412;s.ALPHA_BITS=3413;s.DEPTH_BITS=3414;s.STENCIL_BITS=3415;s.POLYGON_OFFSET_UNITS=10752;s.POLYGON_OFFSET_FACTOR=32824;s.TEXTURE_BINDING_2D=32873;s.SAMPLE_BUFFERS=32936;s.SAMPLES=32937;s.SAMPLE_COVERAGE_VALUE=32938;s.SAMPLE_COVERAGE_INVERT=32939;s.NUM_COMPRESSED_TEXTURE_FORMATS=34466;s.COMPRESSED_TEXTURE_FORMATS=34467;s.DONT_CARE=4352;s.FASTEST=4353;s.NICEST=4354;s.GENERATE_MIPMAP_HINT=33170;s.BYTE=5120;s.UNSIGNED_BYTE=5121;s.SHORT=5122;s.UNSIGNED_SHORT=5123;s.INT=5124;s.UNSIGNED_INT=5125;s.FLOAT=5126;s.DEPTH_COMPONENT=6402;s.ALPHA=6406;s.RGB=6407;s.RGBA=6408;s.LUMINANCE=6409;s.LUMINANCE_ALPHA=6410;s.UNSIGNED_SHORT_4_4_4_4=32819;s.UNSIGNED_SHORT_5_5_5_1=32820;s.UNSIGNED_SHORT_5_6_5=33635;s.FRAGMENT_SHADER=35632;s.VERTEX_SHADER=35633;s.MAX_VERTEX_ATTRIBS=34921;s.MAX_VERTEX_UNIFORM_VECTORS=36347;s.MAX_VARYING_VECTORS=36348;s.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661;s.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660;s.MAX_TEXTURE_IMAGE_UNITS=34930;s.MAX_FRAGMENT_UNIFORM_VECTORS=36349;s.SHADER_TYPE=35663;s.DELETE_STATUS=35712;s.LINK_STATUS=35714;s.VALIDATE_STATUS=35715;s.ATTACHED_SHADERS=35717;s.ACTIVE_UNIFORMS=35718;s.ACTIVE_ATTRIBUTES=35721;s.SHADING_LANGUAGE_VERSION=35724;s.CURRENT_PROGRAM=35725;s.NEVER=512;s.LESS=513;s.EQUAL=514;s.LEQUAL=515;s.GREATER=516;s.NOTEQUAL=517;s.GEQUAL=518;s.ALWAYS=519;s.KEEP=7680;s.REPLACE=7681;s.INCR=7682;s.DECR=7683;s.INVERT=5386;s.INCR_WRAP=34055;s.DECR_WRAP=34056;s.VENDOR=7936;s.RENDERER=7937;s.VERSION=7938;s.NEAREST=9728;s.LINEAR=9729;s.NEAREST_MIPMAP_NEAREST=9984;s.LINEAR_MIPMAP_NEAREST=9985;s.NEAREST_MIPMAP_LINEAR=9986;s.LINEAR_MIPMAP_LINEAR=9987;s.TEXTURE_MAG_FILTER=10240;s.TEXTURE_MIN_FILTER=10241;s.TEXTURE_WRAP_S=10242;s.TEXTURE_WRAP_T=10243;s.TEXTURE_2D=3553;s.TEXTURE_3D=32879;s.TEXTURE=5890;s.TEXTURE_CUBE_MAP=34067;s.TEXTURE_BINDING_CUBE_MAP=34068;s.TEXTURE_CUBE_MAP_POSITIVE_X=34069;s.TEXTURE_CUBE_MAP_NEGATIVE_X=34070;s.TEXTURE_CUBE_MAP_POSITIVE_Y=34071;s.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072;s.TEXTURE_CUBE_MAP_POSITIVE_Z=34073;s.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074;s.MAX_CUBE_MAP_TEXTURE_SIZE=34076;s.TEXTURE0=33984;s.TEXTURE1=33985;s.TEXTURE2=33986;s.TEXTURE3=33987;s.TEXTURE4=33988;s.TEXTURE5=33989;s.TEXTURE6=33990;s.TEXTURE7=33991;s.TEXTURE8=33992;s.TEXTURE9=33993;s.TEXTURE10=33994;s.TEXTURE11=33995;s.TEXTURE12=33996;s.TEXTURE13=33997;s.TEXTURE14=33998;s.TEXTURE15=33999;s.TEXTURE16=34e3;s.TEXTURE17=34001;s.TEXTURE18=34002;s.TEXTURE19=34003;s.TEXTURE20=34004;s.TEXTURE21=34005;s.TEXTURE22=34006;s.TEXTURE23=34007;s.TEXTURE24=34008;s.TEXTURE25=34009;s.TEXTURE26=34010;s.TEXTURE27=34011;s.TEXTURE28=34012;s.TEXTURE29=34013;s.TEXTURE30=34014;s.TEXTURE31=34015;s.ACTIVE_TEXTURE=34016;s.REPEAT=10497;s.CLAMP_TO_EDGE=33071;s.MIRRORED_REPEAT=33648;s.FLOAT_VEC2=35664;s.FLOAT_VEC3=35665;s.FLOAT_VEC4=35666;s.INT_VEC2=35667;s.INT_VEC3=35668;s.INT_VEC4=35669;s.BOOL=35670;s.BOOL_VEC2=35671;s.BOOL_VEC3=35672;s.BOOL_VEC4=35673;s.FLOAT_MAT2=35674;s.FLOAT_MAT3=35675;s.FLOAT_MAT4=35676;s.SAMPLER_2D=35678;s.SAMPLER_CUBE=35680;s.VERTEX_ATTRIB_ARRAY_ENABLED=34338;s.VERTEX_ATTRIB_ARRAY_SIZE=34339;s.VERTEX_ATTRIB_ARRAY_STRIDE=34340;s.VERTEX_ATTRIB_ARRAY_TYPE=34341;s.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922;s.VERTEX_ATTRIB_ARRAY_POINTER=34373;s.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975;s.COMPILE_STATUS=35713;s.LOW_FLOAT=36336;s.MEDIUM_FLOAT=36337;s.HIGH_FLOAT=36338;s.LOW_INT=36339;s.MEDIUM_INT=36340;s.HIGH_INT=36341;s.FRAMEBUFFER=36160;s.RENDERBUFFER=36161;s.RGBA4=32854;s.RGB5_A1=32855;s.RGB565=36194;s.DEPTH_COMPONENT16=33189;s.STENCIL_INDEX=6401;s.STENCIL_INDEX8=36168;s.DEPTH_STENCIL=34041;s.RENDERBUFFER_WIDTH=36162;s.RENDERBUFFER_HEIGHT=36163;s.RENDERBUFFER_INTERNAL_FORMAT=36164;s.RENDERBUFFER_RED_SIZE=36176;s.RENDERBUFFER_GREEN_SIZE=36177;s.RENDERBUFFER_BLUE_SIZE=36178;s.RENDERBUFFER_ALPHA_SIZE=36179;s.RENDERBUFFER_DEPTH_SIZE=36180;s.RENDERBUFFER_STENCIL_SIZE=36181;s.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048;s.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049;s.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050;s.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051;s.COLOR_ATTACHMENT0=36064;s.DEPTH_ATTACHMENT=36096;s.STENCIL_ATTACHMENT=36128;s.DEPTH_STENCIL_ATTACHMENT=33306;s.NONE=0;s.FRAMEBUFFER_COMPLETE=36053;s.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054;s.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055;s.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057;s.FRAMEBUFFER_UNSUPPORTED=36061;s.FRAMEBUFFER_BINDING=36006;s.RENDERBUFFER_BINDING=36007;s.MAX_RENDERBUFFER_SIZE=34024;s.INVALID_FRAMEBUFFER_OPERATION=1286;s.UNPACK_FLIP_Y_WEBGL=37440;s.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441;s.CONTEXT_LOST_WEBGL=37442;s.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443;s.BROWSER_DEFAULT_WEBGL=37444;s._extTextureFilterAnisotropic=null;s._compressedTextureS3tc=null;s._compressedTexturePvrtc=null;s._compressedTextureEtc1=null;s._angleInstancedArrays=null;s._glTextureIDs=[33984,33985,33986,33987,33988,33989,33990,33991];s._useProgram=null;s._depthTest=true;s._depthMask=true;s._blend=false;s._cullFace=false;s._activedTextureID=33984;a(s,["_extentionVendorPrefixes",function(){return this._extentionVendorPrefixes=["","WEBKIT_","MOZ_"]},"_activeTextures",function(){return this._activeTextures=new Array(8)},"_depthFunc",function(){return this._depthFunc=513},"_sFactor",function(){return this._sFactor=1},"_dFactor",function(){return this._dFactor=0},"_srcAlpha",function(){return this._srcAlpha=1},"_dstAlpha",function(){return this._dstAlpha=0},"_frontFace",function(){return this._frontFace=2305}]);return s}();var _t=function(){function r(){}v(r,"laya.net.ResourceVersion");r.enable=function(t,e,i){i===void 0&&(i=2);laya.net.ResourceVersion.type=i;y.loader.load(t,b.create(null,r.onManifestLoaded,[e]),null,"json");nt.customFormat=r.addVersionPrefix};r.onManifestLoaded=function(t,e){r.manifest=e;t.run();if(!e){console.warn("资源版本清单文件不存在，不使用资源版本管理。忽略ERR_FILE_NOT_FOUND错误。")}};r.addVersionPrefix=function(t){t=nt.getAdptedFilePath(t);if(r.manifest&&r.manifest[t]){if(r.type==2)return r.manifest[t];return r.manifest[t]+"/"+t}return t};r.FOLDER_VERSION=1;r.FILENAME_VERSION=2;r.manifest=null;r.type=1;return r}();var dt=function(){function a(){}v(a,"laya.display.cmd.FillWordsCmd");var t=a.prototype;t.recover=function(){this.words=null;z.recover("FillWordsCmd",this)};t.run=function(t,e,i){t.fillWords(this.words,this.x+e,this.y+i,this.font,this.color)};d(0,t,"cmdID",function(){return"FillWords"});a.create=function(t,e,i,r,n){var s=z.getItemByClass("FillWordsCmd",a);s.words=t;s.x=e;s.y=i;s.font=r;s.color=n;return s};a.ID="FillWords";return a}();var pt=function(){function o(t,e,i,r,n,s,a){this._bTransform=false;t===void 0&&(t=1);e===void 0&&(e=0);i===void 0&&(i=0);r===void 0&&(r=1);n===void 0&&(n=0);s===void 0&&(s=0);a===void 0&&(a=0);if(o._createFun!=null){return o._createFun(t,e,i,r,n,s,a)}this.a=t;this.b=e;this.c=i;this.d=r;this.tx=n;this.ty=s;this._checkTransform()}v(o,"laya.maths.Matrix");var t=o.prototype;t.identity=function(){this.a=this.d=1;this.b=this.tx=this.ty=this.c=0;this._bTransform=false;return this};t._checkTransform=function(){return this._bTransform=this.a!==1||this.b!==0||this.c!==0||this.d!==1};t.setTranslate=function(t,e){this.tx=t;this.ty=e;return this};t.translate=function(t,e){this.tx+=t;this.ty+=e;return this};t.scale=function(t,e){this.a*=t;this.d*=e;this.c*=t;this.b*=e;this.tx*=t;this.ty*=e;this._bTransform=true;return this};t.rotate=function(t){var e=Math.cos(t);var i=Math.sin(t);var r=this.a;var n=this.c;var s=this.tx;this.a=r*e-this.b*i;this.b=r*i+this.b*e;this.c=n*e-this.d*i;this.d=n*i+this.d*e;this.tx=s*e-this.ty*i;this.ty=s*i+this.ty*e;this._bTransform=true;return this};t.skew=function(t,e){var i=Math.tan(t);var r=Math.tan(e);var n=this.a;var s=this.b;this.a+=r*this.c;this.b+=r*this.d;this.c+=i*n;this.d+=i*s;return this};t.invertTransformPoint=function(t){var e=this.a;var i=this.b;var r=this.c;var n=this.d;var s=this.tx;var a=e*n-i*r;var o=n/a;var h=-i/a;var l=-r/a;var u=e/a;var c=(r*this.ty-n*s)/a;var f=-(e*this.ty-i*s)/a;return t.setTo(o*t.x+l*t.y+c,h*t.x+u*t.y+f)};t.transformPoint=function(t){return t.setTo(this.a*t.x+this.c*t.y+this.tx,this.b*t.x+this.d*t.y+this.ty)};t.transformPointN=function(t){return t.setTo(this.a*t.x+this.c*t.y,this.b*t.x+this.d*t.y)};t.getScaleX=function(){return this.b===0?this.a:Math.sqrt(this.a*this.a+this.b*this.b)};t.getScaleY=function(){return this.c===0?this.d:Math.sqrt(this.c*this.c+this.d*this.d)};t.invert=function(){var t=this.a;var e=this.b;var i=this.c;var r=this.d;var n=this.tx;var s=t*r-e*i;this.a=r/s;this.b=-e/s;this.c=-i/s;this.d=t/s;this.tx=(i*this.ty-r*n)/s;this.ty=-(t*this.ty-e*n)/s;return this};t.setTo=function(t,e,i,r,n,s){this.a=t,this.b=e,this.c=i,this.d=r,this.tx=n,this.ty=s;return this};t.concat=function(t){var e=this.a;var i=this.c;var r=this.tx;this.a=e*t.a+this.b*t.c;this.b=e*t.b+this.b*t.d;this.c=i*t.a+this.d*t.c;this.d=i*t.b+this.d*t.d;this.tx=r*t.a+this.ty*t.c+t.tx;this.ty=r*t.b+this.ty*t.d+t.ty;return this};t.scaleEx=function(t,e){var i=this.a,r=this.b,n=this.c,s=this.d;if(r!==0||n!==0){this.a=t*i;this.b=t*r;this.c=e*n;this.d=e*s}else{this.a=t*i;this.b=0*s;this.c=0*i;this.d=e*s}this._bTransform=true};t.rotateEx=function(t){var e=Math.cos(t);var i=Math.sin(t);var r=this.a,n=this.b,s=this.c,a=this.d;if(n!==0||s!==0){this.a=e*r+i*s;this.b=e*n+i*a;this.c=-i*r+e*s;this.d=-i*n+e*a}else{this.a=e*r;this.b=i*a;this.c=-i*r;this.d=e*a}this._bTransform=true};t.clone=function(){var t=o.create();t.a=this.a;t.b=this.b;t.c=this.c;t.d=this.d;t.tx=this.tx;t.ty=this.ty;t._bTransform=this._bTransform;return t};t.copyTo=function(t){t.a=this.a;t.b=this.b;t.c=this.c;t.d=this.d;t.tx=this.tx;t.ty=this.ty;t._bTransform=this._bTransform;return t};t.toString=function(){return this.a+","+this.b+","+this.c+","+this.d+","+this.tx+","+this.ty};t.destroy=function(){this.recover()};t.recover=function(){z.recover("Matrix",this.identity())};o.mul=function(t,e,i){var r=t.a,n=t.b,s=t.c,a=t.d,o=t.tx,h=t.ty;var l=e.a,u=e.b,c=e.c,f=e.d,_=e.tx,d=e.ty;if(u!==0||c!==0){i.a=r*l+n*c;i.b=r*u+n*f;i.c=s*l+a*c;i.d=s*u+a*f;i.tx=l*o+c*h+_;i.ty=u*o+f*h+d}else{i.a=r*l;i.b=n*f;i.c=s*l;i.d=a*f;i.tx=l*o+_;i.ty=f*h+d}return i};o.mul16=function(t,e,i){var r=t.a,n=t.b,s=t.c,a=t.d,o=t.tx,h=t.ty;var l=e.a,u=e.b,c=e.c,f=e.d,_=e.tx,d=e.ty;if(u!==0||c!==0){i[0]=r*l+n*c;i[1]=r*u+n*f;i[4]=s*l+a*c;i[5]=s*u+a*f;i[12]=l*o+c*h+_;i[13]=u*o+f*h+d}else{i[0]=r*l;i[1]=n*f;i[4]=s*l;i[5]=a*f;i[12]=l*o+_;i[13]=f*h+d}return i};o.create=function(){return z.getItemByClass("Matrix",o)};o.EMPTY=new o;o.TEMP=new o;o._createFun=null;return o}();var vt=function(){function t(t,e,i,r){this.id=0;this.name=null;this.color=0;this.scale=1;this.datapos=0;this.datas=new Array(Ni.DATANUM);this.id=t;this.color=e;this.name=i;this.scale=r}v(t,"laya.utils.PerfData");var e=t.prototype;e.addData=function(t){this.datas[this.datapos]=t;this.datapos++;this.datapos%=Ni.DATANUM};return t}();var mt=function(){function n(){}v(n,"laya.display.cmd.TransformCmd");var t=n.prototype;t.recover=function(){this.matrix=null;z.recover("TransformCmd",this)};t.run=function(t,e,i){t._transform(this.matrix,this.pivotX+e,this.pivotY+i)};d(0,t,"cmdID",function(){return"Transform"});n.create=function(t,e,i){var r=z.getItemByClass("TransformCmd",n);r.matrix=t;r.pivotX=e;r.pivotY=i;return r};n.ID="Transform";return n}();var gt=function(){function r(){}v(r,"laya.display.cmd.DrawTexturesCmd");var t=r.prototype;t.recover=function(){this.texture._removeReference();this.texture=null;this.pos=null;z.recover("DrawTexturesCmd",this)};t.run=function(t,e,i){t.drawTextures(this.texture,this.pos,e,i)};d(0,t,"cmdID",function(){return"DrawTextures"});r.create=function(t,e){var i=z.getItemByClass("DrawTexturesCmd",r);i.texture=t;t._addReference();i.pos=e;return i};r.ID="DrawTextures";return r}();var yt=function(){function h(){}v(h,"laya.display.cmd.DrawCircleCmd");var t=h.prototype;t.recover=function(){this.fillColor=null;this.lineColor=null;z.recover("DrawCircleCmd",this)};t.run=function(t,e,i){t._drawCircle(this.x+e,this.y+i,this.radius,this.fillColor,this.lineColor,this.lineWidth,this.vid)};d(0,t,"cmdID",function(){return"DrawCircle"});h.create=function(t,e,i,r,n,s,a){var o=z.getItemByClass("DrawCircleCmd",h);o.x=t;o.y=e;o.radius=i;o.fillColor=r;o.lineColor=n;o.lineWidth=s;o.vid=a;return o};h.ID="DrawCircle";return h}();var xt=function(){var i;function K(){this._drawTriUseAbsMatrix=false;this._id=++K._COUNT;this._other=null;this._renderNextSubmitIndex=0;this._path=null;this._drawCount=1;this._renderCount=0;this._isConvexCmd=true;this._submits=null;this._curSubmit=null;this._mesh=null;this._pathMesh=null;this._triangleMesh=null;this.meshlist=[];this._clipInCache=false;this._clipInfoID=0;this._curMat=null;this._lastMatScaleX=1;this._lastMatScaleY=1;this._lastMat_a=1;this._lastMat_b=0;this._lastMat_c=0;this._lastMat_d=1;this._nBlendType=0;this._save=null;this._targets=null;this._charSubmitCache=null;this._saveMark=null;this.sprite=null;this._italicDeg=0;this._lastTex=null;this._fillColor=0;this._flushCnt=0;this.defTexture=null;this._colorFiler=null;this.drawTexAlign=false;this._incache=false;this.isMain=false;this._tmpMatrix=new pt;this._drawTexToDrawTri_Vert=new Float32Array(8);this._drawTexToDrawTri_Index=new Uint16Array([0,1,2,0,2,3]);this._tempUV=new Float32Array(8);this._width=99999999;this._height=99999999;this._submitKey=new Y;this._transedPoints=new Array(8);this._temp4Points=new Array(8);this._clipRect=K.MAXCLIPRECT;this._globalClipMatrix=new pt(99999999,0,0,99999999,0,0);this._shader2D=new V;K._contextcount++;if(!this.defTexture){var t=new Xi(2,2);t.setPixels(new Uint8Array(16));t.lock=true;this.defTexture=new ti(t)}this._lastTex=this.defTexture;this.clear()}v(K,"laya.resource.Context");var t=K.prototype;t.drawImage=function(t){};t.getImageData=function(t){};t.measureText=function(t){return null};t.setTransform=function(t){};t.$transform=function(t,e,i,r,n,s){};t.clearRect=function(t,e,i,r){};t._drawRect=function(t,e,i,r,n){I.renderBatches++;n&&(this.fillStyle=n);this.fillRect(t,e,i,r)};t.drawTexture2=function(t,e,i,r,n,s){};t.transformByMatrix=function(t,e,i){this.transform(t.a,t.b,t.c,t.d,t.tx+e,t.ty+i)};t.saveTransform=function(t){this.save()};t.restoreTransform=function(t){this.restore()};t.drawRect=function(t,e,i,r,n,s,a){var o=this;if(n!=null){o.fillStyle=n;o.fillRect(t,e,i,r)}if(s!=null){o.strokeStyle=s;o.lineWidth=a;o.strokeRect(t,e,i,r)}};t.alpha=function(t){this.globalAlpha*=t};t._transform=function(t,e,i){this.translate(e,i);this.transform(t.a,t.b,t.c,t.d,t.tx,t.ty);this.translate(-e,-i)};t._rotate=function(t,e,i){this.translate(e,i);this.rotate(t);this.translate(-e,-i)};t._scale=function(t,e,i,r){this.translate(i,r);this.scale(t,e);this.translate(-i,-r)};t._drawLine=function(t,e,i,r,n,s,a,o,h){this.beginPath();this.strokeStyle=a;this.lineWidth=o;this.moveTo(t+i,e+r);this.lineTo(t+n,e+s);this.stroke()};t._drawLines=function(t,e,i,r,n,s){this.beginPath();this.strokeStyle=r;this.lineWidth=n;var a=2,o=i.length;this.addPath(i.slice(),false,false,t,e);this.stroke()};t.drawCurves=function(t,e,i,r,n){this.beginPath();this.strokeStyle=r;this.lineWidth=n;this.moveTo(t+i[0],e+i[1]);var s=2,a=i.length;while(s<a){this.quadraticCurveTo(t+i[s++],e+i[s++],t+i[s++],e+i[s++])}this.stroke()};t._fillAndStroke=function(t,e,i,r){r===void 0&&(r=false);if(t!=null){this.fillStyle=t;this.fill()}if(e!=null&&i>0){this.strokeStyle=e;this.lineWidth=i;this.stroke()}};t._drawCircle=function(t,e,i,r,n,s,a){I.renderBatches++;this.beginPath(true);this.arc(t,e,i,0,K.PI2);this.closePath();this._fillAndStroke(r,n,s)};t._drawPie=function(t,e,i,r,n,s,a,o,h){this.beginPath();this.moveTo(t,e);this.arc(t,e,i,r,n);this.closePath();this._fillAndStroke(s,a,o)};t._drawPoly=function(t,e,i,r,n,s,a,o){var h=2,l=i.length;this.beginPath();this.addPath(i.slice(),true,a,t,e);this.closePath();this._fillAndStroke(r,n,s,a)};t._drawPath=function(t,e,i,r,n){this.beginPath();for(var s=0,a=i.length;s<a;s++){var o=i[s];switch(o[0]){case"moveTo":this.moveTo(t+o[1],e+o[2]);break;case"lineTo":this.lineTo(t+o[1],e+o[2]);break;case"arcTo":this.arcTo(t+o[1],e+o[2],t+o[3],e+o[4],o[5]);break;case"closePath":this.closePath();break}}if(r!=null){this.fillStyle=r.fillStyle;this.fill()}if(n!=null){this.strokeStyle=n.strokeStyle;this.lineWidth=n.lineWidth||1;this.lineJoin=n.lineJoin;this.lineCap=n.lineCap;this.miterLimit=n.miterLimit;this.stroke()}};t.clearBG=function(t,e,i,r){var n=Bt.mainContext;n.clearColor(t,e,i,r);n.clear(16384)};t._getSubmits=function(){return this._submits};t._releaseMem=function(t){t===void 0&&(t=false);if(!this._submits)return;this._curMat.destroy();this._curMat=null;this._shader2D.destroy();this._shader2D=null;this._charSubmitCache.clear();for(var e=0,i=this._submits._length;e<i;e++){this._submits[e].releaseRender()}this._submits.length=0;this._submits._length=0;this._submits=null;this._curSubmit=null;this._path=null;this._save=null;var r=0;for(e=0,r=this.meshlist.length;e<r;e++){var n=this.meshlist[e];n.destroy()}this.meshlist.length=0;this.sprite=null;if(!t){this._targets&&this._targets.destroy();this._targets=null}};t.destroy=function(t){t===void 0&&(t=false);--K._contextcount;this.sprite=null;this._releaseMem(t);this._charSubmitCache.destroy();this._mesh.destroy();if(!t){this._targets&&this._targets.destroy();this._targets=null}};t.clear=function(){if(!this._submits){this._other=i.DEFAULT;this._curMat=pt.create();this._charSubmitCache=new we;this._mesh=ai.getAMesh(this.isMain);this.meshlist.push(this._mesh);this._pathMesh=Qe.getAMesh(this.isMain);this.meshlist.push(this._pathMesh);this._triangleMesh=fi.getAMesh(this.isMain);this.meshlist.push(this._triangleMesh);this._submits=[];this._save=[J.Create(this)];this._save.length=10;this._shader2D=new V}this._submitKey.clear();this._mesh.clearVB();this._renderCount++;this._drawCount=1;this._other=i.DEFAULT;this._other.lineWidth=this._shader2D.ALPHA=1;this._nBlendType=0;this._clipRect=K.MAXCLIPRECT;this._curSubmit=T.RENDERBASE;T.RENDERBASE._ref=16777215;T.RENDERBASE._numEle=0;this._shader2D.fillStyle=this._shader2D.strokeStyle=Nt.DEFAULT;for(var t=0,e=this._submits._length;t<e;t++)this._submits[t].releaseRender();this._submits._length=0;this._curMat.identity();this._other.clear();this._saveMark=this._save[0];this._save._length=1};t.size=function(t,e){if(this._width!=t||this._height!=e){this._width=t;this._height=e;if(this._targets){this._targets.destroy();this._targets=new Yi(t,e,1,-1)}if(Wt._context==this){Bt.mainContext.viewport(0,0,t,e);At.width=t;At.height=e}}if(t===0&&e===0)this._releaseMem()};t.getMatScaleX=function(){if(this._lastMat_a==this._curMat.a&&this._lastMat_b==this._curMat.b)return this._lastMatScaleX;this._lastMatScaleX=this._curMat.getScaleX();this._lastMat_a=this._curMat.a;this._lastMat_b=this._curMat.b;return this._lastMatScaleX};t.getMatScaleY=function(){if(this._lastMat_c==this._curMat.c&&this._lastMat_d==this._curMat.d)return this._lastMatScaleY;this._lastMatScaleY=this._curMat.getScaleY();this._lastMat_c=this._curMat.c;this._lastMat_d=this._curMat.d;return this._lastMatScaleY};t.setFillColor=function(t){this._fillColor=t};t.getFillColor=function(){return this._fillColor};t.translate=function(t,e){if(t!==0||e!==0){ut.save(this);if(this._curMat._bTransform){Ht.save(this);this._curMat.tx+=t*this._curMat.a+e*this._curMat.c;this._curMat.ty+=t*this._curMat.b+e*this._curMat.d}else{this._curMat.tx=t;this._curMat.ty=e}}};t.save=function(){this._save[this._save._length++]=J.Create(this)};t.restore=function(){var t=this._save._length;var e=this._nBlendType;if(t<1)return;for(var i=t-1;i>=0;i--){var r=this._save[i];r.restore(this);if(r.isSaveMark()){this._save._length=i;return}}if(e!=this._nBlendType){this._curSubmit=T.RENDERBASE}};t.fillText=function(t,e,i,r,n,s){this._fillText(t,null,e,i,r,n,null,0,null)};t._fillText=function(t,e,i,r,n,s,a,o,h,l){l===void 0&&(l=0);if(t)K._textRender.filltext(this,t,i,r,n,s,a,o,h,l);else if(e)K._textRender.fillWords(this,e,i,r,n,s,a,o)};t._fast_filltext=function(t,e,i,r,n,s,a,o,h){h===void 0&&(h=0);K._textRender._fast_filltext(this,t,null,e,i,r,n,s,a,o,h)};t.fillWords=function(t,e,i,r,n){this._fillText(null,t,e,i,r,n,null,-1,null,0)};t.fillBorderWords=function(t,e,i,r,n,s,a){this._fillBorderText(null,t,e,i,r,n,s,a,null)};t.drawText=function(t,e,i,r,n,s){this._fillText(t,null,e,i,r,x.create(n).strColor,null,-1,s)};t.strokeWord=function(t,e,i,r,n,s,a){this._fillText(t,null,e,i,r,null,x.create(n).strColor,s||1,a)};t.fillBorderText=function(t,e,i,r,n,s,a,o){this._fillBorderText(t,null,e,i,r,x.create(n).strColor,x.create(s).strColor,a,o)};t._fillBorderText=function(t,e,i,r,n,s,a,o,h){this._fillText(t,e,i,r,n,s,a,o||1,h)};t._fillRect=function(t,e,i,r,n){var s=this._curSubmit;var a=s&&(s._key.submitType===2&&s._key.blendShader===this._nBlendType);if(this._mesh.vertNum+4>65535){this._mesh=ai.getAMesh(this.isMain);this.meshlist.push(this._mesh);a=false}a&&(a=a&&this.isSameClipInfo(s));this.transformQuad(t,e,i,r,0,this._curMat,this._transedPoints);if(!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,ti.NO_UV,n,false);if(!a){s=this._curSubmit=Ve.create(this,this._mesh,Q.create(1,0));this._submits[this._submits._length++]=s;this._copyClipInfo(s,this._globalClipMatrix);s.shaderValue.textureHost=this._lastTex;s._key.other=this._lastTex&&this._lastTex.bitmap?this._lastTex.bitmap.id:-1;s._renderType=10016}this._curSubmit._numEle+=6;this._mesh.indexNum+=6;this._mesh.vertNum+=4}};t.fillRect=function(t,e,i,r,n){var s=n?Nt.create(n):this._shader2D.fillStyle;var a=this.mixRGBandAlpha(s.toInt());this._fillRect(t,e,i,r,a)};t.fillTexture=function(t,e,i,r,n,s,a,o){if(!t._getSource()){this.sprite&&y.systemTimer.callLater(this,this._repaintSprite);return}this._fillTexture(t,t.width,t.height,t.uvrect,e,i,r,n,s,a.x,a.y)};t._fillTexture=function(t,e,i,r,n,s,a,o,h,l,u){var c=this._curSubmit;var f=false;if(this._mesh.vertNum+4>65535){this._mesh=ai.getAMesh(this.isMain);this.meshlist.push(this._mesh);f=false}var _=true;var d=true;switch(h){case"repeat":break;case"repeat-x":d=false;break;case"repeat-y":_=false;break;case"no-repeat":_=d=false;break;default:break}var p=this._temp4Points;var v=0;var m=0;var g=0,y=0,x=0,T=0;if(l<0){g=n;v=-l%e/e}else{g=n+l}if(u<0){y=s;m=-u%i/i}else{y=s+u}x=n+a;T=s+o;!_&&(x=Math.min(x,n+l+e));!d&&(T=Math.min(T,s+u+i));if(x<n||T<s)return;if(g>x||y>T)return;var b=(x-n-l)/e;var w=(T-s-u)/i;this.transformQuad(g,y,x-g,T-y,0,this._curMat,this._transedPoints);p[0]=v;p[1]=m;p[2]=b;p[3]=m;p[4]=b;p[5]=w;p[6]=v;p[7]=w;if(!this.clipedOff(this._transedPoints)){var C=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA);this._mesh.addQuad(this._transedPoints,p,C,true);var A=Q.create(1,0);A.defines.add(256);A.u_TexRange=r;c=this._curSubmit=Ve.create(this,this._mesh,A);this._submits[this._submits._length++]=c;this._copyClipInfo(c,this._globalClipMatrix);c.shaderValue.textureHost=t;c._renderType=10016;this._curSubmit._numEle+=6;this._mesh.indexNum+=6;this._mesh.vertNum+=4}this.breakNextMerge()};t.setColorFilter=function(t){o.save(this,8388608,this,true);this._colorFiler=t;this._curSubmit=T.RENDERBASE};t.drawTexture=function(t,e,i,r,n){this._drawTextureM(t,e,i,r,n,null,1,null)};t.drawTextures=function(t,e,i,r){if(!t._getSource()){this.sprite&&y.systemTimer.callLater(this,this._repaintSprite);return}var n=e.length/2;var s=0;var a=t.bitmap.id;for(var o=0;o<n;o++){this._inner_drawTexture(t,a,e[s++]+i,e[s++]+r,0,0,null,null,1,false)}};t._drawTextureAddSubmit=function(t,e){var i=null;i=Ve.create(this,this._mesh,Q.create(1,0));this._submits[this._submits._length++]=i;i.shaderValue.textureHost=e;i._key.other=t;i._renderType=10016;this._curSubmit=i};t._drawTextureM=function(t,e,i,r,n,s,a,o){var h=this.sprite;if(!t._getSource(function(){if(h){h.repaint()}})){return false}return this._inner_drawTexture(t,t.bitmap.id,e,i,r,n,s,o,a,false)};t._drawRenderTexture=function(t,e,i,r,n,s,a,o){return this._inner_drawTexture(t,-1,e,i,r,n,s,o,1,false)};t.submitDebugger=function(){this._submits[this._submits._length++]=rt.create([],function(){debugger},this)};t._copyClipInfo=function(t,e){var i=t.shaderValue.clipMatDir;i[0]=e.a;i[1]=e.b;i[2]=e.c;i[3]=e.d;var r=t.shaderValue.clipMatPos;r[0]=e.tx;r[1]=e.ty;t.clipInfoID=this._clipInfoID;if(this._clipInCache){t.shaderValue.clipOff[0]=1}};t.isSameClipInfo=function(t){return t.clipInfoID===this._clipInfoID};t._useNewTex2DSubmit=function(t,e){if(this._mesh.vertNum+e>65535){this._mesh=ai.getAMesh(this.isMain);this.meshlist.push(this._mesh)}var i=Ve.create(this,this._mesh,Q.create(1,0));this._submits[this._submits._length++]=this._curSubmit=i;i.shaderValue.textureHost=t;this._copyClipInfo(i,this._globalClipMatrix)};t._drawTexRect=function(t,e,i,r,n){this.transformQuad(t,e,i,r,this._italicDeg,this._curMat,this._transedPoints);var s=this._transedPoints;s[0]=s[0]+.5|0;s[1]=s[1]+.5|0;s[2]=s[2]+.5|0;s[3]=s[3]+.5|0;s[4]=s[4]+.5|0;s[5]=s[5]+.5|0;s[6]=s[6]+.5|0;s[7]=s[7]+.5|0;if(!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,n,this._fillColor,true);this._curSubmit._numEle+=6;this._mesh.indexNum+=6;this._mesh.vertNum+=4}};t.drawCallOptimize=function(t){this._charSubmitCache.enable(t,this);return t};t._inner_drawTexture=function(t,e,i,r,n,s,a,o,h,l){var u=this._curSubmit._key;o=o||t._uv;if(u.submitType===4&&u.other===e){var c=this._drawTexToDrawTri_Vert;c[0]=i;c[1]=r;c[2]=i+n,c[3]=r,c[4]=i+n,c[5]=r+s,c[6]=i,c[7]=r+s;this._drawTriUseAbsMatrix=true;var f=this._tempUV;f[0]=o[0];f[1]=o[1];f[2]=o[2];f[3]=o[3];f[4]=o[4];f[5]=o[5];f[6]=o[6];f[7]=o[7];this.drawTriangles(t,0,0,c,f,this._drawTexToDrawTri_Index,a,h,null,null);this._drawTriUseAbsMatrix=false;return true}var _=this._mesh;var d=this._curSubmit;var p=l?this._charSubmitCache.getPos():this._transedPoints;this.transformQuad(i,r,n||t.width,s||t.height,this._italicDeg,a||this._curMat,p);if(this.drawTexAlign){var v=Math.round;p[0]=v(p[0]);p[1]=v(p[1]);p[2]=v(p[2]);p[3]=v(p[3]);p[4]=v(p[4]);p[5]=v(p[5]);p[6]=v(p[6]);p[7]=v(p[7]);this.drawTexAlign=false}var m=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*h);if(l){this._charSubmitCache.add(this,t,e,p,o,m);return true}this._drawCount++;var g=e>=0&&u.submitType===2&&u.other===e;g&&(g=g&&this.isSameClipInfo(d));this._lastTex=t;if(_.vertNum+4>65535){_=this._mesh=ai.getAMesh(this.isMain);this.meshlist.push(_);g=false}{_.addQuad(p,o,m,true);if(!g){this._submits[this._submits._length++]=this._curSubmit=d=Ve.create(this,_,Q.create(1,0));d.shaderValue.textureHost=t;d._key.other=e;this._copyClipInfo(d,this._globalClipMatrix)}d._numEle+=6;_.indexNum+=6;_.vertNum+=4;return true}return false};t.transform4Points=function(t,e,i){var r=e.tx;var n=e.ty;var s=e.a;var a=e.b;var o=e.c;var h=e.d;var l=t[0];var u=t[1];var c=t[2];var f=t[3];var _=t[4];var d=t[5];var p=t[6];var v=t[7];if(e._bTransform){i[0]=l*s+u*o+r;i[1]=l*a+u*h+n;i[2]=c*s+f*o+r;i[3]=c*a+f*h+n;i[4]=_*s+d*o+r;i[5]=_*a+d*h+n;i[6]=p*s+v*o+r;i[7]=p*a+v*h+n}else{i[0]=l+r;i[1]=u+n;i[2]=c+r;i[3]=f+n;i[4]=_+r;i[5]=d+n;i[6]=p+r;i[7]=v+n}};t.clipedOff=function(t){if(this._clipRect.width<=0||this._clipRect.height<=0)return true;return false};t.transformQuad=function(t,e,i,r,n,s,a){var o=0;if(n!=0){o=Math.tan(n*Math.PI/180)*r}var h=t+i;var l=e+r;var u=s.tx;var c=s.ty;var f=s.a;var _=s.b;var d=s.c;var p=s.d;var v=t+o;var m=e;var g=h+o;var y=e;var x=h;var T=l;var b=t;var w=l;if(s._bTransform){a[0]=v*f+m*d+u;a[1]=v*_+m*p+c;a[2]=g*f+y*d+u;a[3]=g*_+y*p+c;a[4]=x*f+T*d+u;a[5]=x*_+T*p+c;a[6]=b*f+w*d+u;a[7]=b*_+w*p+c}else{a[0]=v+u;a[1]=m+c;a[2]=g+u;a[3]=y+c;a[4]=x+u;a[5]=T+c;a[6]=b+u;a[7]=w+c}};t.pushRT=function(){this.addRenderObject(rt.create(null,Yi.pushRT,this))};t.popRT=function(){this.addRenderObject(rt.create(null,Yi.popRT,this));this.breakNextMerge()};t.useRT=function(t){function e(t){if(!t){throw"error useRT"}else{t.start();t.clear(0,0,0,0)}}this.addRenderObject(rt.create([t],e,this));this.breakNextMerge()};t.RTRestore=function(t){function e(t){t.restore()}this.addRenderObject(rt.create([t],e,this));this.breakNextMerge()};t.breakNextMerge=function(){this._curSubmit=T.RENDERBASE};t._repaintSprite=function(){this.sprite&&this.sprite.repaint()};t.drawTextureWithTransform=function(t,e,i,r,n,s,a,o,h,l,u){var c=null;var f=this._curMat;if(l){c=this.globalCompositeOperation;this.globalCompositeOperation=l}var _=this._colorFiler;if(u){this.setColorFilter(u)}if(!s){this._drawTextureM(t,e+a,i+o,r,n,f,h,null);if(l){this.globalCompositeOperation=c}if(u){this.setColorFilter(_)}return}var d=this._tmpMatrix;d.a=s.a;d.b=s.b;d.c=s.c;d.d=s.d;d.tx=s.tx+a;d.ty=s.ty+o;d._bTransform=s._bTransform;if(s&&f._bTransform){pt.mul(d,f,d);s=d;s._bTransform=true}else{d.tx+=f.tx;d.ty+=f.ty;s=d}this._drawTextureM(t,e,i,r,n,s,h,null);if(l){this.globalCompositeOperation=c}if(u){this.setColorFilter(_)}};t._flushToTarget=function(t,e){At.worldScissorTest=false;Bt.mainContext.disable(3089);var i=At.worldAlpha;var r=At.worldMatrix4;var n=At.worldMatrix;var s=At.worldShaderDefines;At.worldMatrix=pt.EMPTY;At.restoreTempArray();At.worldMatrix4=At.TEMPMAT4_ARRAY;At.worldAlpha=1;bi.activeShader=null;e.start();if(t._submits._length>0)e.clear(0,0,0,0);t._curSubmit=T.RENDERBASE;t.flush();t.clear();e.restore();t._curSubmit=T.RENDERBASE;bi.activeShader=null;At.worldAlpha=i;At.worldMatrix4=r;At.worldMatrix=n};t.drawCanvas=function(t,e,i,r,n){if(!t)return;var s=t.context;var a;if(s._targets){if(s._submits._length>0){a=rt.create([s,s._targets],this._flushToTarget,this);this._submits[this._submits._length++]=a}this._drawRenderTexture(s._targets,e,i,r,n,null,1,Yi.flipyuv);this._curSubmit=T.RENDERBASE}else{var o=t;if(o.touches){o.touches.forEach(function(t){t.touch()})}a=Xe.create(t,this._shader2D.ALPHA,this._shader2D.filters);this._submits[this._submits._length++]=a;a._key.clear();var h=a._matrix;this._curMat.copyTo(h);var l=h.tx,u=h.ty;h.tx=h.ty=0;h.transformPoint(ie.TEMP.setTo(e,i));h.translate(ie.TEMP.x+l,ie.TEMP.y+u);pt.mul(o.invMat,h,h);this._curSubmit=T.RENDERBASE}};t.drawTarget=function(t,e,i,r,n,s,a,o,h){h===void 0&&(h=-1);this._drawCount++;var l=4294967295;if(this._mesh.vertNum+4>65535){this._mesh=ai.getAMesh(this.isMain);this.meshlist.push(this._mesh)}this.transformQuad(e,i,r,n,0,s||this._curMat,this._transedPoints);if(!this.clipedOff(this._transedPoints)){this._mesh.addQuad(this._transedPoints,o||ti.DEF_UV,4294967295,true);var u=this._curSubmit=f.create(this,this._mesh,a,t);u.blendType=h==-1?this._nBlendType:h;this._copyClipInfo(u,this._globalClipMatrix);u._numEle=6;this._mesh.indexNum+=6;this._mesh.vertNum+=4;this._submits[this._submits._length++]=u;this._curSubmit=T.RENDERBASE;return true}this._curSubmit=T.RENDERBASE;return false};t.drawTriangles=function(t,e,i,r,n,s,a,o,h,l){if(!t._getSource()){if(this.sprite){y.systemTimer.callLater(this,this._repaintSprite)}return}this._drawCount++;var u=this._tmpMatrix;var c=this._triangleMesh;var f=null;var _=false;if(h){f=this._colorFiler;this._colorFiler=h;this._curSubmit=T.RENDERBASE;_=f!=h}var d=t.bitmap;var p=this._curSubmit._key;var v=p.submitType===4&&p.other===d.id&&p.blendShader==this._nBlendType;if(c.vertNum+r.length/2>65535){c=this._triangleMesh=fi.getAMesh(this.isMain);this.meshlist.push(c);v=false}if(!v){var m=this._curSubmit=Ve.create(this,c,Q.create(1,0));m.shaderValue.textureHost=t;m._renderType=10016;m._key.submitType=4;m._key.other=d.id;this._copyClipInfo(m,this._globalClipMatrix);this._submits[this._submits._length++]=m}var g=this._mixRGBandAlpha(4294967295,this._shader2D.ALPHA*o);if(!this._drawTriUseAbsMatrix){if(!a){u.a=1;u.b=0;u.c=0;u.d=1;u.tx=e;u.ty=i}else{u.a=a.a;u.b=a.b;u.c=a.c;u.d=a.d;u.tx=a.tx+e;u.ty=a.ty+i}pt.mul(u,this._curMat,u);c.addData(r,n,s,u,g)}else{c.addData(r,n,s,a,g)}this._curSubmit._numEle+=s.length;if(_){this._colorFiler=f;this._curSubmit=T.RENDERBASE}};t.transform=function(t,e,i,r,n,s){Ht.save(this);pt.mul(pt.TEMP.setTo(t,e,i,r,n,s),this._curMat,this._curMat);this._curMat._checkTransform()};t._transformByMatrix=function(t,e,i){t.setTranslate(e,i);pt.mul(t,this._curMat,this._curMat);t.setTranslate(0,0);this._curMat._bTransform=true};t.setTransformByMatrix=function(t){t.copyTo(this._curMat)};t.rotate=function(t){Ht.save(this);this._curMat.rotateEx(t)};t.scale=function(t,e){Ht.save(this);this._curMat.scaleEx(t,e)};t.clipRect=function(t,e,i,r){Re.save(this);if(this._clipRect==K.MAXCLIPRECT){this._clipRect=new St(t,e,i,r)}else{this._clipRect.width=i;this._clipRect.height=r;this._clipRect.x=t;this._clipRect.y=e}K._clipID_Gen++;K._clipID_Gen%=1e4;this._clipInfoID=K._clipID_Gen;var n=this._globalClipMatrix;var s=n.tx;var a=n.ty;var o=s+n.a;var h=a+n.d;if(this._clipRect.width>=99999999){n.a=n.d=99999999;n.b=n.c=n.tx=n.ty=0}else{if(this._curMat._bTransform){n.tx=this._clipRect.x*this._curMat.a+this._clipRect.y*this._curMat.c+this._curMat.tx;n.ty=this._clipRect.x*this._curMat.b+this._clipRect.y*this._curMat.d+this._curMat.ty;n.a=this._clipRect.width*this._curMat.a;n.b=this._clipRect.width*this._curMat.b;n.c=this._clipRect.height*this._curMat.c;n.d=this._clipRect.height*this._curMat.d}else{n.tx=this._clipRect.x+this._curMat.tx;n.ty=this._clipRect.y+this._curMat.ty;n.a=this._clipRect.width;n.b=n.c=0;n.d=this._clipRect.height}if(this._incache){this._clipInCache=true}}if(n.a>0&&n.d>0){var l=n.tx+n.a;var u=n.ty+n.d;if(l<=s||u<=a||n.tx>=o||n.ty>=h){n.a=-.1;n.d=-.1}else{if(n.tx<s){n.a-=s-n.tx;n.tx=s}if(l>o){n.a-=l-o}if(n.ty<a){n.d-=a-n.ty;n.ty=a}if(u>h){n.d-=u-h}if(n.a<=0)n.a=-.1;if(n.d<=0)n.d=-.1}}};t.drawMesh=function(t,e,i,r,n,s,a,o,h){h===void 0&&(h=0)};t.addRenderObject=function(t){this._submits[this._submits._length++]=t};t.submitElement=function(t,e){var i=Wt._context===this;var r=this._submits;var n=r._length;e<0&&(e=r._length);var s=T.RENDERBASE;while(t<e){this._renderNextSubmitIndex=t+1;if(r[t]===T.RENDERBASE){t++;continue}T.preRender=s;s=r[t];t+=s.renderSubmit()}return n};t.flush=function(){var t=this.submitElement(0,this._submits._length);this._path&&this._path.reset();w.instance&&w.getInstance().reset();this._curSubmit=T.RENDERBASE;for(var e=0,i=this.meshlist.length;e<i;e++){var r=this.meshlist[e];r.canReuse?r.releaseMesh():r.destroy()}this.meshlist.length=0;this._mesh=ai.getAMesh(this.isMain);this._pathMesh=Qe.getAMesh(this.isMain);this._triangleMesh=fi.getAMesh(this.isMain);this.meshlist.push(this._mesh,this._pathMesh,this._triangleMesh);this._flushCnt++;if(this._flushCnt%60==0&&Wt._context==this){if(R.textRenderInst){R.textRenderInst.GC()}}return t};t.beginPath=function(t){t===void 0&&(t=false);var e=this._getPath();e.beginPath(t)};t.closePath=function(){this._path.closePath()};t.addPath=function(t,e,i,r,n){var s=0;for(var a=0,o=t.length/2;a<o;a++){var h=t[s]+r,l=t[s+1]+n;t[s]=h;t[s+1]=l;s+=2}this._getPath().push(t,i)};t.fill=function(){var t=this._curMat;var e=this._getPath();var i=this._curSubmit;var r=i._key.submitType===3&&i._key.blendShader===this._nBlendType;r&&(r=r&&this.isSameClipInfo(i));if(!r){this._curSubmit=this.addVGSubmit(this._pathMesh)}var n=this.mixRGBandAlpha(this.fillStyle.toInt());var s=0;var a;for(var o=0,h=e.paths.length;o<h;o++){var l=e.paths[o];var u=l.path.length/2;if(u<3||u==3&&!l.convex)continue;var c=l.path.concat();var f=0;var _=0,d=0;var p=NaN,v=NaN;if(t._bTransform){for(f=0;f<u;f++){_=f<<1;d=_+1;p=c[_];v=c[d];c[_]=t.a*p+t.c*v+t.tx;c[d]=t.b*p+t.d*v+t.ty}}else{for(f=0;f<u;f++){_=f<<1;d=_+1;p=c[_];v=c[d];c[_]=p+t.tx;c[d]=v+t.ty}}if(this._pathMesh.vertNum+u>65535){this._curSubmit._numEle+=s;s=0;this._pathMesh=Qe.getAMesh(this.isMain);this._curSubmit=this.addVGSubmit(this._pathMesh)}var m=this._pathMesh.vertNum;if(l.convex){var g=u-2;a=new Array(g*3);var y=0;for(var x=0;x<g;x++){a[y++]=m;a[y++]=x+1+m;a[y++]=x+2+m}}else{a=Jt.earcut(c,null,2);if(m>0){for(var T=0;T<a.length;T++){a[T]+=m}}}this._pathMesh.addVertAndIBToMesh(this,c,n,a);s+=a.length}this._curSubmit._numEle+=s};t.addVGSubmit=function(t){var e=T.createShape(this,t,0,Q.create(4,0));e._key.submitType=3;this._submits[this._submits._length++]=e;this._copyClipInfo(e,this._globalClipMatrix);return e};t.stroke=function(){if(this.lineWidth>0){var t=this.mixRGBandAlpha(this.strokeStyle._color.numColor);var e=this._getPath();var i=this._curSubmit;var r=i._key.submitType===3&&i._key.blendShader===this._nBlendType;r&&(r=r&&this.isSameClipInfo(i));if(!r){this._curSubmit=this.addVGSubmit(this._pathMesh)}var n=0;for(var s=0,a=e.paths.length;s<a;s++){var o=e.paths[s];if(o.path.length<=0)continue;var h=[];var l=[];var u=o.path.length*2;if(u<2)continue;if(this._pathMesh.vertNum+u>65535){this._curSubmit._numEle+=n;n=0;this._pathMesh=Qe.getAMesh(this.isMain);this.meshlist.push(this._pathMesh);this._curSubmit=this.addVGSubmit(this._pathMesh)}ne.createLine2(o.path,h,this.lineWidth,this._pathMesh.vertNum,l,o.loop);var c=l.length/2;var f=this._curMat;var _=0;var d=0,p=0;var v=NaN,m=NaN;if(f._bTransform){for(_=0;_<c;_++){d=_<<1;p=d+1;v=l[d];m=l[p];l[d]=f.a*v+f.c*m+f.tx;l[p]=f.b*v+f.d*m+f.ty}}else{for(_=0;_<c;_++){d=_<<1;p=d+1;v=l[d];m=l[p];l[d]=v+f.tx;l[p]=m+f.ty}}this._pathMesh.addVertAndIBToMesh(this,l,t,h);n+=h.length}this._curSubmit._numEle+=n}};t.moveTo=function(t,e){var i=this._getPath();i.newPath();i._lastOriX=t;i._lastOriY=e;i.addPoint(t,e)};t.lineTo=function(t,e){var i=this._getPath();if(Math.abs(t-i._lastOriX)<.001&&Math.abs(e-i._lastOriY)<.001)return;i._lastOriX=t;i._lastOriY=e;i.addPoint(t,e)};t.arcTo=function(t,e,i,r,n){var s=0;var a=0,o=0;var h=this._path._lastOriX-t;var l=this._path._lastOriY-e;var u=Math.sqrt(h*h+l*l);if(u<=1e-6){return}var c=h/u;var f=l/u;var _=i-t;var d=r-e;var p=_*_+d*d;var v=Math.sqrt(p);if(v<=1e-6){return}var m=_/v;var g=d/v;var y=c+m;var x=f+g;var T=Math.sqrt(y*y+x*x);if(T<=1e-6){return}var b=y/T;var w=x/T;var C=Math.acos(b*c+w*f);var A=Math.PI/2-C;u=n/Math.tan(A);var E=u*c+t;var S=u*f+e;var M=Math.sqrt(u*u+n*n);var R=t+b*M;var I=e+w*M;var P=u*m+t;var D=u*g+e;var L=c*g-f*m;var B=0;var F=0;var O=0;if(L>=0){B=A*2;var N=B/K.SEGNUM;F=Math.sin(N);O=Math.cos(N)}else{B=-A*2;N=B/K.SEGNUM;F=Math.sin(N);O=Math.cos(N)}var k=this._path._lastOriX,U=this._path._lastOriY;var W=E,V=S;if(Math.abs(W-this._path._lastOriX)>.1||Math.abs(V-this._path._lastOriY)>.1){a=W;o=V;k=W;U=V;this._path.addPoint(a,o)}var G=E-R;var X=S-I;var Y=0;var H=0;for(s=0;s<K.SEGNUM;s++){var z=G*O+X*F;var j=-G*F+X*O;a=z+R;o=j+I;if(Math.abs(k-a)>.1||Math.abs(U-o)>.1){this._path.addPoint(a,o);k=a;U=o}G=z;X=j}};t.arc=function(t,e,i,r,n,s,a){s===void 0&&(s=false);a===void 0&&(a=true);var o=0,h=0,l=0,u=0;var c=0,f=0,_=0,d=0,p=0,v=0;var m=0,g=0,y=0,x=0;var T=0,b=0,w=0;h=n-r;if(!s){if(Math.abs(h)>=Math.PI*2){h=Math.PI*2}else{while(h<0){h+=Math.PI*2}}}else{if(Math.abs(h)>=Math.PI*2){h=-Math.PI*2}else{while(h>0){h-=Math.PI*2}}}var C=this.getMatScaleX();var A=this.getMatScaleY();var E=i*(C>A?C:A);var S=2*Math.PI*E;b=Math.max(S/10,10)|0;l=h/b/2;u=Math.abs(4/3*(1-Math.cos(l))/Math.sin(l));if(s)u=-u;w=0;var M=this._getPath();var R=NaN,I=NaN;for(T=0;T<=b;T++){o=r+h*(T/b);c=Math.cos(o);f=Math.sin(o);_=t+c*i;d=e+f*i;if(_!=this._path._lastOriX||d!=this._path._lastOriY){M.addPoint(_,d)}}c=Math.cos(n);f=Math.sin(n);_=t+c*i;d=e+f*i;if(_!=this._path._lastOriX||d!=this._path._lastOriY){M.addPoint(_,d)}};t.quadraticCurveTo=function(t,e,i,r){var n=Kt.I;var s=[];var a=n.getBezierPoints([this._path._lastOriX,this._path._lastOriY,t,e,i,r],30,2);for(var o=0,h=a.length/2;o<h;o++){this.lineTo(a[o*2],a[o*2+1])}this.lineTo(i,r)};t.mixRGBandAlpha=function(t){return this._mixRGBandAlpha(t,this._shader2D.ALPHA)};t._mixRGBandAlpha=function(t,e){if(e>=1){return t}var i=(t&4278190080)>>>24;if(i!=0){i*=e}else{i=e*255}return t&16777215|i<<24};t.strokeRect=function(t,e,i,r,n){var s=n*.5;if(this.lineWidth>0){var a=this.mixRGBandAlpha(this.strokeStyle._color.numColor);var o=this.lineWidth/2;this._fillRect(t-o,e-o,i+this.lineWidth,this.lineWidth,a);this._fillRect(t-o,e-o+r,i+this.lineWidth,this.lineWidth,a);this._fillRect(t-o,e+o,this.lineWidth,r-this.lineWidth,a);this._fillRect(t-o+i,e+o,this.lineWidth,r-this.lineWidth,a)}};t.clip=function(){};t.drawParticle=function(t,e,i){i.x=t;i.y=e;this._submits[this._submits._length++]=i};t._getPath=function(){return this._path||(this._path=new P)};t._fillTexture_h=function(t,e,i,r,n,s,a,o){var h=s;var l=Math.floor(o/r);var u=o%r;for(var c=0;c<l;c++){this._inner_drawTexture(t,e,h,a,r,n,this._curMat,i,1,false);h+=r}if(u>0){var f=i[2]-i[0];var _=i[0]+f*(u/r);var d=K.tmpuv1;d[0]=i[0];d[1]=i[1];d[2]=_;d[3]=i[3];d[4]=_;d[5]=i[5];d[6]=i[6];d[7]=i[7];this._inner_drawTexture(t,e,h,a,u,n,this._curMat,d,1,false)}};t._fillTexture_v=function(t,e,i,r,n,s,a,o){var h=a;var l=Math.floor(o/n);var u=o%n;for(var c=0;c<l;c++){this._inner_drawTexture(t,e,s,h,r,n,this._curMat,i,1,false);h+=n}if(u>0){var f=i[7]-i[1];var _=i[1]+f*(u/n);var d=K.tmpuv1;d[0]=i[0];d[1]=i[1];d[2]=i[2];d[3]=i[3];d[4]=i[4];d[5]=_;d[6]=i[6];d[7]=_;this._inner_drawTexture(t,e,s,h,r,u,this._curMat,d,1,false)}};t.drawTextureWithSizeGrid=function(t,e,i,r,n,s,a,o){if(!t._getSource())return;e+=a;i+=o;var h=t.uv,l=t.bitmap.width,u=t.bitmap.height;var c=s[0];var f=s[3];var _=c/u;var d=f/l;var p=s[1];var v=s[2];var m=p/l;var g=v/u;var y=s[4];var x=false;if(r==l){f=p=0}if(n==u){c=v=0}if(f+p>r){var T=r;x=true;r=f+p;this.save();this.clipRect(0+e,0+i,T,n)}var b=t.bitmap.id;var w=this._curMat;var C=this._tempUV;var A=h[0];var E=h[1];var S=h[4];var M=h[5];var R=A;var I=E;var P=S;var D=M;if(f&&c){P=A+d;D=E+_;C[0]=A,C[1]=E,C[2]=P,C[3]=E,C[4]=P,C[5]=D,C[6]=A,C[7]=D;this._inner_drawTexture(t,b,e,i,f,c,w,C,1,false)}if(p&&c){R=S-m;I=E;P=S;D=E+_;C[0]=R,C[1]=I,C[2]=P,C[3]=I,C[4]=P,C[5]=D,C[6]=R,C[7]=D;this._inner_drawTexture(t,b,r-p+e,0+i,p,c,w,C,1,false)}if(f&&v){R=A;I=M-g;P=A+d;D=M;C[0]=R,C[1]=I,C[2]=P,C[3]=I,C[4]=P,C[5]=D,C[6]=R,C[7]=D;this._inner_drawTexture(t,b,0+e,n-v+i,f,v,w,C,1,false)}if(p&&v){R=S-m;I=M-g;P=S;D=M;C[0]=R,C[1]=I,C[2]=P,C[3]=I,C[4]=P,C[5]=D,C[6]=R,C[7]=D;this._inner_drawTexture(t,b,r-p+e,n-v+i,p,v,w,C,1,false)}if(c){R=A+d;I=E;P=S-m;D=E+_;C[0]=R,C[1]=I,C[2]=P,C[3]=I,C[4]=P,C[5]=D,C[6]=R,C[7]=D;if(y){this._fillTexture_h(t,b,C,t.width-f-p,c,f+e,i,r-f-p)}else{this._inner_drawTexture(t,b,f+e,i,r-f-p,c,w,C,1,false)}}if(v){R=A+d;I=M-g;P=S-m;D=M;C[0]=R,C[1]=I,C[2]=P,C[3]=I,C[4]=P,C[5]=D,C[6]=R,C[7]=D;if(y){this._fillTexture_h(t,b,C,t.width-f-p,v,f+e,n-v+i,r-f-p)}else{this._inner_drawTexture(t,b,f+e,n-v+i,r-f-p,v,w,C,1,false)}}if(f){R=A;I=E+_;P=A+d;D=M-g;C[0]=R,C[1]=I,C[2]=P,C[3]=I,C[4]=P,C[5]=D,C[6]=R,C[7]=D;if(y){this._fillTexture_v(t,b,C,f,t.height-c-v,e,c+i,n-c-v)}else{this._inner_drawTexture(t,b,e,c+i,f,n-c-v,w,C,1,false)}}if(p){R=S-m;I=E+_;P=S;D=M-g;C[0]=R,C[1]=I,C[2]=P,C[3]=I,C[4]=P,C[5]=D,C[6]=R,C[7]=D;if(y){this._fillTexture_v(t,b,C,p,t.height-c-v,r-p+e,c+i,n-c-v)}else{this._inner_drawTexture(t,b,r-p+e,c+i,p,n-c-v,w,C,1,false)}}R=A+d;I=E+_;P=S-m;D=M-g;C[0]=R,C[1]=I,C[2]=P,C[3]=I,C[4]=P,C[5]=D,C[6]=R,C[7]=D;if(y){var L=K.tmpUVRect;L[0]=R;L[1]=I;L[2]=P-R;L[3]=D-I;this._fillTexture(t,t.width-f-p,t.height-c-v,L,f+e,c+i,r-f-p,n-c-v,"repeat",0,0)}else{this._inner_drawTexture(t,b,f+e,c+i,r-f-p,n-c-v,w,C,1,false)}if(x)this.restore()};d(0,t,"textAlign",function(){return this._other.textAlign},function(t){this._other.textAlign===t||(this._other=this._other.make(),o.save(this,32768,this._other,false),this._other.textAlign=t)});d(0,t,"lineJoin",function(){return null},function(t){});d(0,t,"fillStyle",function(){return this._shader2D.fillStyle},function(t){if(!this._shader2D.fillStyle.equal(t)){o.save(this,2,this._shader2D,false);this._shader2D.fillStyle=Nt.create(t);this._submitKey.other=-this._shader2D.fillStyle.toInt()}});d(0,t,"lineCap",function(){return null},function(t){});d(0,t,"miterLimit",function(){return null},function(t){});d(0,t,"strokeStyle",function(){return this._shader2D.strokeStyle},function(t){this._shader2D.strokeStyle.equal(t)||(o.save(this,512,this._shader2D,false),this._shader2D.strokeStyle=Nt.create(t),this._submitKey.other=-this._shader2D.strokeStyle.toInt())});d(0,t,"globalCompositeOperation",function(){return Le.NAMES[this._nBlendType]},function(t){var e=Le.TOINT[t];e==null||this._nBlendType===e||(o.save(this,65536,this,true),this._curSubmit=T.RENDERBASE,this._nBlendType=e)});d(0,t,"globalAlpha",function(){return this._shader2D.ALPHA},function(t){t=Math.floor(t*1e3)/1e3;if(t!=this._shader2D.ALPHA){o.save(this,1,this._shader2D,false);this._shader2D.ALPHA=t}});d(0,t,"asBitmap",null,function(t){if(t){this._targets||(this._targets=new Yi(this._width,this._height,1,-1));if(!this._width||!this._height)throw Error("asBitmap no size!")}else{this._targets&&this._targets.destroy();this._targets=null}});d(0,t,"textBaseline",function(){return this._other.textBaseline},function(t){this._other.textBaseline===t||(this._other=this._other.make(),o.save(this,16384,this._other,false),this._other.textBaseline=t)});d(0,t,"lineWidth",function(){return this._other.lineWidth},function(t){this._other.lineWidth===t||(this._other=this._other.make(),o.save(this,256,this._other,false),this._other.lineWidth=t)});d(0,t,"font",null,function(t){this._other=this._other.make();o.save(this,8,this._other,false)});d(0,t,"canvas",function(){return this._canvas});K.__init__=function(){K.MAXCLIPRECT=new St(0,0,99999999,99999999);i.DEFAULT=new i;ot};K.set2DRenderConfig=function(){var t=Xt.instance;ft.setBlend(t,true);ft.setBlendFunc(t,1,771);ft.setDepthTest(t,false);ft.setCullFace(t,false);ft.setDepthMask(t,true);ft.setFrontFace(t,2305);t.viewport(0,0,At.width,At.height)};K.ENUM_TEXTALIGN_DEFAULT=0;K.ENUM_TEXTALIGN_CENTER=1;K.ENUM_TEXTALIGN_RIGHT=2;K._SUBMITVBSIZE=32e3;K._MAXSIZE=99999999;K._MAXVERTNUM=65535;K.MAXCLIPRECT=null;K._COUNT=0;K.SEGNUM=32;K._contextcount=0;K.PI2=2*Math.PI;K._clipID_Gen=0;a(K,["_textRender",function(){return this._textRender=new R},"tmpuv1",function(){return this.tmpuv1=[0,0,0,0,0,0,0,0]},"tmpUV",function(){return this.tmpUV=[0,0,0,0,0,0,0,0]},"tmpUVRect",function(){return this.tmpUVRect=[0,0,0,0]}]);K.__init$=function(){i=function(){function t(){this.lineWidth=1;this.textAlign=null;this.textBaseline=null}v(t,"");var e=t.prototype;e.clear=function(){this.lineWidth=1;this.textAlign=this.textBaseline=null};e.make=function(){return this===t.DEFAULT?new t:this};t.DEFAULT=null;return t}()};return K}();var Tt=function(){function o(){}v(o,"laya.filters.BlurFilterGLRender");var t=o.prototype;t.render=function(t,e,i,r,n){var s=Q.create(1,0);this.setShaderInfo(s,n,t.width,t.height);e.drawTarget(t,0,0,i,r,pt.EMPTY.identity(),s)};t.setShaderInfo=function(t,e,i,r){t.defines.add(16);var n=t;o.blurinfo[0]=i;o.blurinfo[1]=r;n.blurInfo=o.blurinfo;var s=e.strength/3;var a=s*s;e.strength_sig2_2sig2_gauss1[0]=e.strength;e.strength_sig2_2sig2_gauss1[1]=a;e.strength_sig2_2sig2_gauss1[2]=2*a;e.strength_sig2_2sig2_gauss1[3]=1/(2*Math.PI*a);n.strength_sig2_2sig2_gauss1=e.strength_sig2_2sig2_gauss1};a(o,["blurinfo",function(){return this.blurinfo=new Array(2)}]);return o}();var bt=function(){function t(){}v(t,"laya.webgl.utils.CONST3D2D");t.BYTES_PE=4;t.BYTES_PIDX=2;t.defaultMatrix4=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];t.defaultMinusYMatrix4=[1,0,0,0,0,-1,0,0,0,0,1,0,0,0,0,1];t.uniformMatrix3=[1,0,0,0,0,1,0,0,0,0,1,0];t._TMPARRAY=[];t._OFFSETX=0;t._OFFSETY=0;return t}();var wt=function(){function t(){this.char="";this.tex=null;this.deleted=false;this.pos=0;this.width=0;this.height=0;this.bmpWidth=0;this.bmpHeight=0;this.orix=0;this.oriy=0;this.touchTick=0;this.isSpace=false;this.uv=new Array(8)}v(t,"laya.webgl.text.CharRenderInfo");var e=t.prototype;e.touch=function(){var t=I.loopCount;if(this.touchTick!=t){this.tex.touchRect(this,t)}this.touchTick=t};return t}();var Ct=function(){function n(){this._renderType=0;this._repaint=0;this._x=NaN;this._y=NaN}v(n,"laya.layagl.QuickTestTool");var t=n.prototype;t.render=function(t,e,i){n._addType(this._renderType);n.showRenderTypeInfo(this._renderType);F.renders[this._renderType]._fun(this,t,e+this._x,i+this._y);this._repaint=0};t._stageRender=function(t,e,i){n._countStart();n._PreStageRender.call(y.stage,t,e,i);n._countEnd()};n.getMCDName=function(t){return n._typeToNameDic[t]};n.showRenderTypeInfo=function(t,e){e===void 0&&(e=false);if(!e&&n.showedDic[t])return;n.showedDic[t]=true;if(!n._rendertypeToStrDic[t]){var i=[];var r=0;r=1;while(r<=t){if(r&t){i.push(n.getMCDName(r&t))}r=r<<1}n._rendertypeToStrDic[t]=i.join(",")}console.log("cmd:",n._rendertypeToStrDic[t])};n.__init__=function(){n._typeToNameDic[1]="ALPHA";n._typeToNameDic[2]="TRANSFORM";n._typeToNameDic[256]="TEXTURE";n._typeToNameDic[512]="GRAPHICS";n._typeToNameDic[4096]="ONECHILD";n._typeToNameDic[8192]="CHILDS";n._typeToNameDic[2|1]="TRANSFORM|ALPHA";n._typeToNameDic[8]="CANVAS";n._typeToNameDic[4]="BLEND";n._typeToNameDic[16]="FILTERS";n._typeToNameDic[32]="MASK";n._typeToNameDic[64]="CLIP";n._typeToNameDic[1024]="LAYAGL3D"};n._countStart=function(){var t;for(t in n._countDic){n._countDic[t]=0}};n._countEnd=function(){n._i++;if(n._i>60){n.showCountInfo();n._i=0}};n._addType=function(t){if(!n._countDic[t]){n._countDic[t]=1}else{n._countDic[t]+=1}};n.showCountInfo=function(){console.log("===================");var t;for(t in n._countDic){console.log("count:"+n._countDic[t]);n.showRenderTypeInfo(t,true)}};n.enableQuickTest=function(){n.__init__();Ti["prototype"]["render"]=n["prototype"]["render"];n._PreStageRender=Oi["prototype"]["render"];Oi["prototype"]["render"]=n["prototype"]["_stageRender"]};n.showedDic={};n._rendertypeToStrDic={};n._typeToNameDic={};n._PreStageRender=null;n._countDic={};n._i=0;return n}();var At=function(){function n(){}v(n,"laya.webgl.utils.RenderState2D");n.mat2MatArray=function(t,e){var i=t;var r=e;r[0]=i.a;r[1]=i.b;r[2]=n.EMPTYMAT4_ARRAY[2];r[3]=n.EMPTYMAT4_ARRAY[3];r[4]=i.c;r[5]=i.d;r[6]=n.EMPTYMAT4_ARRAY[6];r[7]=n.EMPTYMAT4_ARRAY[7];r[8]=n.EMPTYMAT4_ARRAY[8];r[9]=n.EMPTYMAT4_ARRAY[9];r[10]=n.EMPTYMAT4_ARRAY[10];r[11]=n.EMPTYMAT4_ARRAY[11];r[12]=i.tx;r[13]=i.ty;r[14]=n.EMPTYMAT4_ARRAY[14];r[15]=n.EMPTYMAT4_ARRAY[15];return e};n.restoreTempArray=function(){n.TEMPMAT4_ARRAY[0]=1;n.TEMPMAT4_ARRAY[1]=0;n.TEMPMAT4_ARRAY[4]=0;n.TEMPMAT4_ARRAY[5]=1;n.TEMPMAT4_ARRAY[12]=0;n.TEMPMAT4_ARRAY[13]=0};n.clear=function(){n.worldScissorTest=false;n.worldAlpha=1};n._MAXSIZE=99999999;n.EMPTYMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];n.TEMPMAT4_ARRAY=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];n.worldMatrix4=n.TEMPMAT4_ARRAY;n.matWVP=null;n.worldAlpha=1;n.worldScissorTest=false;n.worldShaderDefines=null;n.worldFilters=null;n.width=0;n.height=0;a(n,["worldMatrix",function(){return this.worldMatrix=new pt}]);return n}();var Et=function(){var f,l;function m(){}v(m,"laya.utils.SceneUtils");m.getBindFun=function(t){var e=m._funMap.get(t);if(e==null){var i='"'+t+'"';i=i.replace(/^"\${|}"$/g,"").replace(/\${/g,'"+').replace(/}/g,'+"');var r="(function(data){if(data==null)return;with(data){try{\nreturn "+i+"\n}catch(e){}}})";e=y._runScript(r);m._funMap.set(t,e)}return e};m.createByData=function(t,e){var i=l.create();t=m.createComp(e,t,t,null,i);t._setBit(8,true);if(t.hasOwnProperty("_idMap")){t["_idMap"]=i._idMap}if(e.animations){var r=[];var n=e.animations;var s=0,a=n.length;var o;var h;for(s=0;s<a;s++){o=new Gi;h=n[s];o._setUp(i._idMap,h);t[h.name]=o;o._setControlNode(t);switch(h.action){case 1:o.play(0,false);break;case 2:o.play(0,true);break}r.push(o)}t._aniList=r}if(t._$componentType==="Scene"&&t._width>0&&e.props.hitTestPrior==null&&!t.mouseThrough)t.hitTestPrior=true;i.beginLoad(t);return t};m.createInitTool=function(){return l.create()};m.createComp=function(t,e,i,r,n){if(t.type=="Scene3D"||t.type=="Sprite3D"){var s=[];var a=y["Utils3D"]._createSceneByJsonForMaker(t,s,n);if(t.type=="Sprite3D")y["StaticBatchManager"].combine(a,s);else y["StaticBatchManager"].combine(null,s);return a}e=e||m.getCompInstance(t);if(!e){if(t.props&&t.props.runtime)console.warn("runtime not found:"+t.props.runtime);else console.warn("can not create:"+t.type);return null}var o=t.child;if(o){var h=e["_$componentType"]=="List";for(var l=0,u=o.length;l<u;l++){var c=o[l];if(e.hasOwnProperty("itemRender")&&(c.props.name=="render"||c.props.renderType==="render")){e["itemRender"]=c}else if(c.type=="Graphic"){Vt._addGraphicsToSprite(c,e)}else if(Vt._isDrawType(c.type)){Vt._addGraphicToSprite(c,e,true)}else{if(h){var f=[];var _=m.createComp(c,null,i,f,n);if(f.length)_["_$bindData"]=f}else{_=m.createComp(c,null,i,r,n)}if(c.type=="Script"){if(_ instanceof laya.components.Component){e._addComponentInstance(_)}else{if("owner"in _){_["owner"]=e}else if("target"in _){_["target"]=e}}}else if(c.props.renderType=="mask"||c.props.name=="mask"){e.mask=_}else{_ instanceof laya.display.Node&&e.addChild(_)}}}}var d=t.props;for(var p in d){var v=d[p];if(typeof v=="string"&&(v.indexOf("@node:")>=0||v.indexOf("@Prefab:")>=0)){if(n){n.addNodeRef(e,p,v)}}else m.setCompValue(e,p,v,i,r)}if(e._afterInited){e._afterInited()}if(t.compId&&n&&n._idMap){n._idMap[t.compId]=e}return e};m.setCompValue=function(t,e,i,r,n){if(typeof i=="string"&&i.indexOf("${")>-1){m._sheet||(m._sheet=Vt.getClass("laya.data.Table"));if(!m._sheet){console.warn("Can not find class Sheet");return}if(n){n.push(t,e,i)}else if(r){if(i.indexOf("].")==-1){i=i.replace(".","[0].")}var s=new f(t,e,i);s.exe(r);var a,o;var h=i.replace(/\[.*?\]\./g,".");while((a=m._parseWatchData.exec(h))!=null){var l=a[1];while((o=m._parseKeyWord.exec(l))!=null){var u=o[0];var c=r._watchMap[u]||(r._watchMap[u]=[]);c.push(s);m._sheet.I.notifer.on(u,r,r.changeData,[u])}c=r._watchMap[l]||(r._watchMap[l]=[]);c.push(s);m._sheet.I.notifer.on(l,r,r.changeData,[l])}}return}if(e==="var"&&r){r[i]=t}else{t[e]=i==="true"?true:i==="false"?false:i}};m.getCompInstance=function(t){if(t.type=="UIView"){if(t.props&&t.props.pageData){return m.createByData(null,t.props.pageData)}}var e=t.props&&t.props.runtime||t.type;var i=Vt.getClass(e);if(!i)throw"Can not find class "+e;if(t.type==="Script"&&i.prototype._doAwake){var r=z.createByClass(i);r._destroyed=false;return r}if(t.props&&t.props.hasOwnProperty("renderType")&&t.props["renderType"]=="instance"){if(!i["instance"])i["instance"]=new i;return i["instance"]}return new i};m._sheet=null;a(m,["_funMap",function(){return this._funMap=new Ft},"_parseWatchData",function(){return this._parseWatchData=/\${(.*?)}/g},"_parseKeyWord",function(){return this._parseKeyWord=/[a-zA-Z_][a-zA-Z0-9_]*(?:(?:\.[a-zA-Z_][a-zA-Z0-9_]*)+)/g}]);m.__init$=function(){f=function(){function t(t,e,i){this.comp=null;this.prop=null;this.value=null;this.comp=t;this.prop=e;this.value=i}v(t,"");var e=t.prototype;e.exe=function(t){var e=m.getBindFun(this.value);this.comp[this.prop]=e.call(this,t)};return t}();l=function(){function e(){this._nodeRefList=null;this._initList=null;this._loadList=null;this._idMap=null;this._scene=null}v(e,"");var t=e.prototype;t.reset=function(){this._nodeRefList=null;this._initList=null;this._idMap=null;this._loadList=null;this._scene=null};t.recover=function(){this.reset();z.recover("InitTool",this)};t.addLoadRes=function(t,e){if(!this._loadList)this._loadList=[];if(!e){this._loadList.push(t)}else{this._loadList.push({url:t,type:e})}};t.addNodeRef=function(t,e,i){if(!this._nodeRefList)this._nodeRefList=[];this._nodeRefList.push([t,e,i]);if(i.indexOf("@Prefab:")>=0){this.addLoadRes(i.replace("@Prefab:",""),"prefab")}};t.setNodeRef=function(){if(!this._nodeRefList)return;if(!this._idMap){this._nodeRefList=null;return}var t=0,e=0;e=this._nodeRefList.length;var i;for(t=0;t<e;t++){i=this._nodeRefList[t];i[0][i[1]]=this.getReferData(i[2])}this._nodeRefList=null};t.getReferData=function(t){if(t.indexOf("@Prefab:")>=0){var e;e=ii.getRes(t.replace("@Prefab:",""));return e}else if(t.indexOf("@arr:")>=0){t=t.replace("@arr:","");var i;i=t.split(",");var r=0,n=0;var s;n=i.length;for(r=0;r<n;r++){s=i[r];if(s){i[r]=this._idMap[s.replace("@node:","")]}else{i[r]=null}}return i}else{return this._idMap[t.replace("@node:","")]}};t.addInitItem=function(t){if(!this._initList)this._initList=[];this._initList.push(t)};t.doInits=function(){if(!this._initList)return;this._initList=null};t.finish=function(){this.setNodeRef();this.doInits();this._scene._setBit(8,false);if(this._scene.parent&&this._scene.parent.activeInHierarchy&&this._scene.active)this._scene._processActive();this._scene.event("onViewCreated");this.recover()};t.beginLoad=function(t){this._scene=t;if(!this._loadList||this._loadList.length<1){this.finish()}else{y.loader.load(this._loadList,b.create(this,this.finish))}};e.create=function(){var t=z.getItemByClass("InitTool",e);t._idMap=[];return t};return e}()};return m}();var St=function(){function l(t,e,i,r){t===void 0&&(t=0);e===void 0&&(e=0);i===void 0&&(i=0);r===void 0&&(r=0);this.x=t;this.y=e;this.width=i;this.height=r}v(l,"laya.maths.Rectangle");var t=l.prototype;t.setTo=function(t,e,i,r){this.x=t;this.y=e;this.width=i;this.height=r;return this};t.reset=function(){this.x=this.y=this.width=this.height=0;return this};t.recover=function(){if(this==l.TEMP||this==l.EMPTY){console.log("recover Temp or Empty:",this);return}z.recover("Rectangle",this.reset())};t.copyFrom=function(t){this.x=t.x;this.y=t.y;this.width=t.width;this.height=t.height;return this};t.contains=function(t,e){if(this.width<=0||this.height<=0)return false;if(t>=this.x&&t<this.right){if(e>=this.y&&e<this.bottom){return true}}return false};t.intersects=function(t){return!(t.x>this.x+this.width||t.x+t.width<this.x||t.y>this.y+this.height||t.y+t.height<this.y)};t.intersection=function(t,e){if(!this.intersects(t))return null;e||(e=new l);e.x=Math.max(this.x,t.x);e.y=Math.max(this.y,t.y);e.width=Math.min(this.right,t.right)-e.x;e.height=Math.min(this.bottom,t.bottom)-e.y;return e};t.union=function(t,e){e||(e=new l);this.clone(e);if(t.width<=0||t.height<=0)return e;e.addPoint(t.x,t.y);e.addPoint(t.right,t.bottom);return this};t.clone=function(t){t||(t=new l);t.x=this.x;t.y=this.y;t.width=this.width;t.height=this.height;return t};t.toString=function(){return this.x+","+this.y+","+this.width+","+this.height};t.equals=function(t){if(!t||t.x!==this.x||t.y!==this.y||t.width!==this.width||t.height!==this.height)return false;return true};t.addPoint=function(t,e){this.x>t&&(this.width+=this.x-t,this.x=t);this.y>e&&(this.height+=this.y-e,this.y=e);if(this.width<t-this.x)this.width=t-this.x;if(this.height<e-this.y)this.height=e-this.y;return this};t._getBoundPoints=function(){var t=l._temB;t.length=0;if(this.width==0||this.height==0)return t;t.push(this.x,this.y,this.x+this.width,this.y,this.x,this.y+this.height,this.x+this.width,this.y+this.height);return t};t.isEmpty=function(){if(this.width<=0||this.height<=0)return true;return false};d(0,t,"right",function(){return this.x+this.width});d(0,t,"bottom",function(){return this.y+this.height});l.create=function(){return z.getItemByClass("Rectangle",l)};l._getBoundPointS=function(t,e,i,r){var n=l._temA;n.length=0;if(i==0||r==0)return n;n.push(t,e,t+i,e,t,e+r,t+i,e+r);return n};l._getWrapRec=function(t,e){if(!t||t.length<1)return e?e.setTo(0,0,0,0):l.TEMP.setTo(0,0,0,0);e=e?e:laya.maths.Rectangle.create();var i,r=t.length,n,s,a,o,h=ie.TEMP;n=a=99999;s=o=-n;for(i=0;i<r;i+=2){h.x=t[i];h.y=t[i+1];n=n<h.x?n:h.x;a=a<h.y?a:h.y;s=s>h.x?s:h.x;o=o>h.y?o:h.y}return e.setTo(n,a,s-n,o-a)};l.EMPTY=new l;l.TEMP=new l;l._temB=[];l._temA=[];return l}();var Mt=function(){function n(){}v(n,"laya.events.KeyBoardManager");n.__init__=function(){n._addEvent("keydown");n._addEvent("keypress");n._addEvent("keyup")};n._addEvent=function(e){Yt.document.addEventListener(e,function(t){laya.events.KeyBoardManager._dispatch(t,e)},true)};n._dispatch=function(t,e){if(!n.enabled)return;n._event._stoped=false;n._event.nativeEvent=t;n._event.keyCode=t.keyCode||t.which||t.charCode;if(e==="keydown")n._pressKeys[n._event.keyCode]=true;else if(e==="keyup")n._pressKeys[n._event.keyCode]=null;var i=y.stage.focus&&y.stage.focus.event!=null&&y.stage.focus.displayedInStage?y.stage.focus:y.stage;var r=i;while(r){r.event(e,n._event.setTo(e,r,i));r=r.parent}};n.hasKeyDown=function(t){return n._pressKeys[t]};n._pressKeys={};n.enabled=true;a(n,["_event",function(){return this._event=new M}]);return n}();var Rt=function(){function t(){}v(t,"laya.layagl.LayaGLRunner");t.uploadShaderUniforms=function(t,e,i,r){var n=i._data;var s=e.getArrayData();var a=0;for(var o=0,h=s.length;o<h;o++){var l=s[o];if(r||l.textureID!==-1){var u=n[l.dataOffset];if(u!=null)a+=l.fun.call(l.caller,l,u)}}return a};t.uploadCustomUniform=function(t,e,i,r){var n=0;var s=e[i];if(s&&r!=null)n+=s.fun.call(s.caller,s,r);return n};t.uploadShaderUniformsForNative=function(t,e,i){var r=0;if(i._runtimeCopyValues.length>0){r=1}var n=i._data;return t.uploadShaderUniforms(e,n,r)};return t}();var It=function(){function a(){}v(a,"laya.display.cmd.DrawPathCmd");var t=a.prototype;t.recover=function(){this.paths=null;this.brush=null;this.pen=null;z.recover("DrawPathCmd",this)};t.run=function(t,e,i){t._drawPath(this.x+e,this.y+i,this.paths,this.brush,this.pen)};d(0,t,"cmdID",function(){return"DrawPath"});a.create=function(t,e,i,r,n){var s=z.getItemByClass("DrawPathCmd",a);s.x=t;s.y=e;s.paths=i;s.brush=r;s.pen=n;return s};a.ID="DrawPath";return a}();var Pt=function(){function t(){this._nativeVertexArrayObject=null;this._bindedIndexBuffer=null;this._nativeVertexArrayObject=Xt.instance.createVertexArray()}v(t,"laya.webgl.BufferStateBase");var e=t.prototype;e.bind=function(){if(t._curBindedBufferState!==this){Xt.instance.bindVertexArray(this._nativeVertexArrayObject);t._curBindedBufferState=this}};e.unBind=function(){if(t._curBindedBufferState===this){Xt.instance.bindVertexArray(null);t._curBindedBufferState=null}else{throw"BufferState: must call bind() function first."}};e.bindForNative=function(){Xt.instance.bindVertexArray(this._nativeVertexArrayObject);t._curBindedBufferState=this};e.unBindForNative=function(){Xt.instance.bindVertexArray(null);t._curBindedBufferState=null};e.destroy=function(){Xt.instance.deleteVertexArray(this._nativeVertexArrayObject)};t._curBindedBufferState=null;return t}();var Dt=function(){function e(){}v(e,"laya.display.cmd.SaveCmd");var t=e.prototype;t.recover=function(){z.recover("SaveCmd",this)};t.run=function(t,e,i){t.save()};d(0,t,"cmdID",function(){return"Save"});e.create=function(){var t=z.getItemByClass("SaveCmd",e);return t};e.ID="Save";return e}();var Lt=function(){var t;function i(){}v(i,"laya.net.LocalStorage");i.__init__=function(){if(!i._baseClass){i._baseClass=t;t.init()}i.items=i._baseClass.items;i.support=i._baseClass.support;return i.support};i.setItem=function(t,e){i._baseClass.setItem(t,e)};i.getItem=function(t){return i._baseClass.getItem(t)};i.setJSON=function(t,e){i._baseClass.setJSON(t,e)};i.getJSON=function(t){return i._baseClass.getJSON(t)};i.removeItem=function(t){i._baseClass.removeItem(t)};i.clear=function(){i._baseClass.clear()};i._baseClass=null;i.items=null;i.support=false;i.__init$=function(){t=function(){function i(){}v(i,"");i.init=function(){try{i.support=true;i.items=g.localStorage;i.setItem("laya","1");i.removeItem("laya")}catch(t){i.support=false}if(!i.support)console.log("LocalStorage is not supprot or browser is private mode.")};i.setItem=function(t,e){try{i.support&&i.items.setItem(t,e)}catch(t){console.warn("set localStorage failed",t)}};i.getItem=function(t){return i.support?i.items.getItem(t):null};i.setJSON=function(t,e){try{i.support&&i.items.setItem(t,JSON.stringify(e))}catch(t){console.warn("set localStorage failed",t)}};i.getJSON=function(t){return JSON.parse(i.support?i.items.getItem(t):null)};i.removeItem=function(t){i.support&&i.items.removeItem(t)};i.clear=function(){i.support&&i.items.clear()};i.items=null;i.support=false;return i}()};return i}();var Bt=function(){function i(){}v(i,"laya.webgl.WebGL");i._uint8ArraySlice=function(){var t=this;var e=t.length;var i=new Uint8Array(t.length);for(var r=0;r<e;r++)i[r]=t[r];return i};i._float32ArraySlice=function(){var t=this;var e=t.length;var i=new Float32Array(t.length);for(var r=0;r<e;r++)i[r]=t[r];return i};i._uint16ArraySlice=function(t){var e=arguments;var i=this;var r=0;var n;var s=0;if(e.length===0){r=i.length;n=new Uint16Array(r);for(s=0;s<r;s++)n[s]=i[s]}else if(e.length===2){var a=e[0];var o=e[1];if(o>a){r=o-a;n=new Uint16Array(r);for(s=a;s<o;s++)n[s-a]=i[s]}else{n=new Uint16Array(0)}}return n};i._nativeRender_enable=function(){if(i.isNativeRender_enable)return;i.isNativeRender_enable=true;ft.__init_native();Pi.prototype.uploadTexture2D=function(t){var e=ft;e.bindTexture(laya.webgl.WebGL.mainContext,e.TEXTURE_2D,t)};At.width=Yt.window.innerWidth;At.height=Yt.window.innerHeight;Pe.measureText=function(t,e){g["conchTextCanvas"].font=e;return g["conchTextCanvas"].measureText(t)};Pe.enableNative=function(){if(Wt.supportWebGLPlusRendering){Rt.uploadShaderUniforms=Rt.uploadShaderUniformsForNative;zt=g.GLCommandEncoder;Xt=g.LayaGLContext}var t=Oi;t.prototype.render=t.prototype.renderToNative};Pe.clear=function(t){xt.set2DRenderConfig();var e=x.create(t).arrColor;var i=Xt.instance;if(e)i.clearColor(e[0],e[1],e[2],e[3]);i.clear(16384|256|1024);At.clear()};Pe.drawToCanvas=Pe.drawToTexture=function(t,e,i,r,n,s){n-=t.x;s-=t.y;n|=0;s|=0;i|=0;r|=0;var a=new Bi(false);var o=a.getContext("2d");a.size(i,r);o.asBitmap=true;o._targets.start();F.renders[e]._fun(t,o,n,s);o.flush();o._targets.end();o._targets.restore();return a};Yi.prototype._uv=Yi.flipyuv;Object["defineProperty"](Yi.prototype,"uv",{get:function(){return this._uv},set:function(t){this._uv=t}});Bi.prototype.getTexture=function(){if(!this._texture){this._texture=this.context._targets;this._texture.uv=Yi.flipyuv;this._texture.bitmap=this._texture}return this._texture}};i.enable=function(){return true};i.inner_enable=function(){Float32Array.prototype.slice||(Float32Array.prototype.slice=i._float32ArraySlice);Uint16Array.prototype.slice||(Uint16Array.prototype.slice=i._uint16ArraySlice);Uint8Array.prototype.slice||(Uint8Array.prototype.slice=i._uint8ArraySlice);if(Wt.isConchApp){i._nativeRender_enable()}return true};i.onStageResize=function(t,e){if(i.mainContext==null)return;i.mainContext.viewport(0,0,t,e);At.width=t;At.height=e};i.mainContext=null;i.shaderHighPrecision=false;i._isWebGL2=false;i.isNativeRender_enable=false;return i}();var Ft=function(){function r(){this._obj=null;this._obj=r.supportWeakMap?new Yt.window.WeakMap:{};if(!r.supportWeakMap)r._maps.push(this)}v(r,"laya.utils.WeakObject");var t=r.prototype;t.set=function(t,e){if(t==null)return;if(r.supportWeakMap){var i=t;if(typeof t=="string"||typeof t=="number"){i=r._keys[t];if(!i)i=r._keys[t]={k:t}}this._obj.set(i,e)}else{if(typeof t=="string"||typeof t=="number"){this._obj[t]=e}else{t.$_GID||(t.$_GID=xe.getGID());this._obj[t.$_GID]=e}}};t.get=function(t){if(t==null)return null;if(r.supportWeakMap){var e=typeof t=="string"||typeof t=="number"?r._keys[t]:t;if(!e)return null;return this._obj.get(e)}else{if(typeof t=="string"||typeof t=="number")return this._obj[t];return this._obj[t.$_GID]}};t.del=function(t){if(t==null)return;if(r.supportWeakMap){var e=typeof t=="string"||typeof t=="number"?r._keys[t]:t;if(!e)return;this._obj.delete(e)}else{if(typeof t=="string"||typeof t=="number")delete this._obj[t];else delete this._obj[this._obj.$_GID]}};t.has=function(t){if(t==null)return false;if(r.supportWeakMap){var e=typeof t=="string"||typeof t=="number"?r._keys[t]:t;return this._obj.has(e)}else{if(typeof t=="string"||typeof t=="number")return this._obj[t]!=null;return this._obj[this._obj.$_GID]!=null}};r.__init__=function(){r.supportWeakMap=Yt.window.WeakMap!=null;if(!r.supportWeakMap)y.systemTimer.loop(r.delInterval,null,r.clearCache)};r.clearCache=function(){for(var t=0,e=r._maps.length;t<e;t++){var i=r._maps[t];i._obj={}}};r.supportWeakMap=false;r.delInterval=10*60*1e3;r._keys={};r._maps=[];a(r,["I",function(){return this.I=new r}]);return r}();var Ot=function(){function t(){}v(t,"laya.display.css.BoundsStyle");var e=t.prototype;e.reset=function(){if(this.bounds)this.bounds.recover();if(this.userBounds)this.userBounds.recover();this.bounds=null;this.userBounds=null;this.temBM=null;return this};e.recover=function(){z.recover("BoundsStyle",this.reset())};t.create=function(){return z.getItemByClass("BoundsStyle",t)};return t}();var Nt=function(){function i(t){this._color=null;this.setValue(t)}v(i,"laya.webgl.canvas.DrawStyle");var t=i.prototype;t.setValue=function(t){if(t){this._color=t instanceof laya.utils.ColorUtils?t:x.create(t)}else this._color=x.create("#000000")};t.reset=function(){this._color=x.create("#000000")};t.toInt=function(){return this._color.numColor};t.equal=function(t){if(typeof t=="string")return this._color.strColor===t;if(t instanceof laya.utils.ColorUtils)return this._color.numColor===t.numColor;return false};t.toColorStr=function(){return this._color.strColor};i.create=function(t){if(t){var e=t instanceof laya.utils.ColorUtils?t:x.create(t);return e._drawStyle||(e._drawStyle=new i(t))}return i.DEFAULT};a(i,["DEFAULT",function(){return this.DEFAULT=new i("#000000")}]);return i}();var kt=function(){function t(){}v(t,"laya.system.System");t.changeDefinition=function(t,e){y[t]=e;var i=t+"=classObj";y._runScript(i)};t.__init__=function(){};return t}();var Ut=function(){function i(){}v(i,"laya.display.cmd.DrawParticleCmd");var t=i.prototype;t.recover=function(){this._templ=null;z.recover("DrawParticleCmd",this)};t.run=function(t,e,i){t.drawParticle(e,i,this._templ)};d(0,t,"cmdID",function(){return"DrawParticleCmd"});i.create=function(t){var e=z.getItemByClass("DrawParticleCmd",i);e._templ=t;return e};i.ID="DrawParticleCmd";return i}();var Wt=function(){function r(t,e){this._timeId=0;r._mainCanvas.source.id="layaCanvas";r._mainCanvas.source.width=t;r._mainCanvas.source.height=e;if(laya.renders.Render.isConchApp){Yt.document.body.appendChild(r._mainCanvas.source)}else{if(!Yt.onKGMiniGame){Yt.container.appendChild(r._mainCanvas.source)}}this.initRender(r._mainCanvas,t,e);Yt.window.requestAnimationFrame(i);function i(t){y.stage._loop();Yt.window.requestAnimationFrame(i)}y.stage.on("visibilitychange",this,this._onVisibilitychange)}v(r,"laya.renders.Render");var t=r.prototype;t._onVisibilitychange=function(){if(!y.stage.isVisibility){this._timeId=Yt.window.setInterval(this._enterFrame,1e3)}else if(this._timeId!=0){Yt.window.clearInterval(this._timeId)}};t.initRender=function(t,e,i){function r(t){var e;var i=["webgl2","webgl","experimental-webgl","webkit-3d","moz-webgl"];if(!Ce.useWebGL2){i.shift()}for(var r=0;r<i.length;r++){try{e=t.getContext(i[r],{stencil:Ce.isStencil,alpha:Ce.isAlpha,antialias:Ce.isAntialias,premultipliedAlpha:Ce.premultipliedAlpha,preserveDrawingBuffer:Ce.preserveDrawingBuffer})}catch(t){}if(e){i[r]==="webgl2"&&(Bt._isWebGL2=true);new Xt;return e}}return null}var n=Xt.instance=Bt.mainContext=r(laya.renders.Render._mainCanvas.source);if(!n)return false;t.size(e,i);ft.__init__(n);xt.__init__();T.__init__();var s=new xt;s.isMain=true;laya.renders.Render._context=s;t._setContext(s);Bt.shaderHighPrecision=false;try{var a=n.getShaderPrecisionFormat(35632,36338);a.precision?Bt.shaderHighPrecision=true:Bt.shaderHighPrecision=false}catch(t){}Xt.instance=n;kt.__init__();Je.__init__();Q.__init__();V.__init__();ni.__int__(n);Le._init_(n);return true};t._enterFrame=function(t){y.stage._loop()};d(1,r,"context",function(){return r._context});d(1,r,"canvas",function(){return r._mainCanvas.source});r._context=null;r._mainCanvas=null;r.supportWebGLPlusCulling=false;r.supportWebGLPlusAnimation=false;r.supportWebGLPlusRendering=false;r.isConchApp=false;r.is3DMode=false;r.__init$=function(){{r.isConchApp=g.conch!=null;if(r.isConchApp){r.supportWebGLPlusCulling=true;r.supportWebGLPlusAnimation=true;r.supportWebGLPlusRendering=true}}};return r}();var Vt=function(){function _(){}v(_,"laya.utils.ClassUtils");_.regClass=function(t,e){_._classMap[t]=e};_.regShortClassName=function(t){for(var e=0;e<t.length;e++){var i=t[e];var r=i.name;_._classMap[r]=i}};_.getRegClass=function(t){return _._classMap[t]};_.getClass=function(t){var e=_._classMap[t]||t;if(typeof e=="string")return y["__classmap"][e]||y[t];return e};_.getInstance=function(t){var e=_.getClass(t);if(e)return new e;else console.warn("[error] Undefined class:",t);return null};_.createByJson=function(t,e,i,r,n){if(typeof t=="string")t=JSON.parse(t);var s=t.props;if(!e){e=n?n.runWith(t):_.getInstance(s.runtime||t.type);if(!e)return null}var a=t.child;if(a){for(var o=0,h=a.length;o<h;o++){var l=a[o];if((l.props.name==="render"||l.props.renderType==="render")&&e["_$set_itemRender"])e.itemRender=l;else{if(l.type=="Graphic"){_._addGraphicsToSprite(l,e)}else if(_._isDrawType(l.type)){_._addGraphicToSprite(l,e,true)}else{var u=_.createByJson(l,null,i,r,n);if(l.type==="Script"){if(u.hasOwnProperty("owner")){u["owner"]=e}else if(u.hasOwnProperty("target")){u["target"]=e}}else if(l.props.renderType=="mask"){e.mask=u}else{e.addChild(u)}}}}}if(s){for(var c in s){var f=s[c];if(c==="var"&&i){i[f]=e}else if(f instanceof Array&&typeof e[c]=="function"){e[c].apply(e,f)}else{e[c]=f}}}if(r&&t.customProps){r.runWith([e,t])}if(e["created"])e.created();return e};_._addGraphicsToSprite=function(t,e){var i=t.child;if(!i||i.length<1)return;var r=_._getGraphicsFromSprite(t,e);var n=0;var s=0;if(t.props){n=_._getObjVar(t.props,"x",0);s=_._getObjVar(t.props,"y",0)}if(n!=0&&s!=0){r.translate(n,s)}var a=0,o=0;o=i.length;for(a=0;a<o;a++){_._addGraphicToGraphics(i[a],r)}if(n!=0&&s!=0){r.translate(-n,-s)}};_._addGraphicToSprite=function(t,e,i){i===void 0&&(i=false);var r=i?_._getGraphicsFromSprite(t,e):e.graphics;_._addGraphicToGraphics(t,r)};_._getGraphicsFromSprite=function(t,e){if(!t||!t.props)return e.graphics;var i=t.props.renderType;if(i==="hit"||i==="unHit"){var r=e._style.hitArea||(e.hitArea=new Ue);if(!r[i]){r[i]=new le}var n=r[i]}if(!n)n=e.graphics;return n};_._getTransformData=function(t){var e;if(t.hasOwnProperty("pivotX")||t.hasOwnProperty("pivotY")){e=e||new pt;e.translate(-_._getObjVar(t,"pivotX",0),-_._getObjVar(t,"pivotY",0))}var i=_._getObjVar(t,"scaleX",1),r=_._getObjVar(t,"scaleY",1);var n=_._getObjVar(t,"rotation",0);var s=_._getObjVar(t,"skewX",0);var a=_._getObjVar(t,"skewY",0);if(i!=1||r!=1||n!=0){e=e||new pt;e.scale(i,r);e.rotate(n*.0174532922222222)}return e};_._addGraphicToGraphics=function(t,e){var i;i=t.props;if(!i)return;var r;r=_.DrawTypeDic[t.type];if(!r)return;var n=e;var s=_._getParams(i,r[1],r[2],r[3]);var a=_._tM;if(a||_._alpha!=1){n.save();if(a)n.transform(a);if(_._alpha!=1)n.alpha(_._alpha)}n[r[0]].apply(n,s);if(a||_._alpha!=1){n.restore()}};_._adptLineData=function(t){t[2]=parseFloat(t[0])+parseFloat(t[2]);t[3]=parseFloat(t[1])+parseFloat(t[3]);return t};_._adptTextureData=function(t){t[0]=ii.getRes(t[0]);return t};_._adptLinesData=function(t){t[2]=_._getPointListByStr(t[2]);return t};_._isDrawType=function(t){if(t==="Image")return false;return _.DrawTypeDic.hasOwnProperty(t)};_._getParams=function(t,e,i,r){i===void 0&&(i=0);var n=_._temParam;n.length=e.length;var s=0,a=0;a=e.length;for(s=0;s<a;s++){n[s]=_._getObjVar(t,e[s][0],e[s][1])}_._alpha=_._getObjVar(t,"alpha",1);var o;o=_._getTransformData(t);if(o){if(!i)i=0;o.translate(n[i],n[i+1]);n[i]=n[i+1]=0;_._tM=o}else{_._tM=null}if(r&&_[r]){n=_[r](n)}return n};_._getPointListByStr=function(t){var e=t.split(",");var i=0,r=0;r=e.length;for(i=0;i<r;i++){e[i]=parseFloat(e[i])}return e};_._getObjVar=function(t,e,i){if(t.hasOwnProperty(e)){return t[e]}return i};_._temParam=[];_._classMap={Sprite:Ti,Scene:ki,Text:Ri,Animation:"laya.display.Animation",Skeleton:"laya.ani.bone.Skeleton",Particle2D:"laya.particle.Particle2D",div:"laya.html.dom.HTMLDivParser",p:"laya.html.dom.HTMLElement",img:"laya.html.dom.HTMLImageElement",span:"laya.html.dom.HTMLElement",br:"laya.html.dom.HTMLBrElement",style:"laya.html.dom.HTMLStyleElement",font:"laya.html.dom.HTMLElement",a:"laya.html.dom.HTMLElement","#text":"laya.html.dom.HTMLElement",link:"laya.html.dom.HTMLLinkElement"};_._tM=null;_._alpha=NaN;a(_,["DrawTypeDic",function(){return this.DrawTypeDic={Rect:["drawRect",[["x",0],["y",0],["width",0],["height",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Circle:["drawCircle",[["x",0],["y",0],["radius",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Pie:["drawPie",[["x",0],["y",0],["radius",0],["startAngle",0],["endAngle",0],["fillColor",null],["lineColor",null],["lineWidth",1]]],Image:["drawTexture",[["x",0],["y",0],["width",0],["height",0]]],Texture:["drawTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0]],1,"_adptTextureData"],FillTexture:["fillTexture",[["skin",null],["x",0],["y",0],["width",0],["height",0],["repeat",null]],1,"_adptTextureData"],FillText:["fillText",[["text",""],["x",0],["y",0],["font",null],["color",null],["textAlign",null]],1],Line:["drawLine",[["x",0],["y",0],["toX",0],["toY",0],["lineColor",null],["lineWidth",0]],0,"_adptLineData"],Lines:["drawLines",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Curves:["drawCurves",[["x",0],["y",0],["points",""],["lineColor",null],["lineWidth",0]],0,"_adptLinesData"],Poly:["drawPoly",[["x",0],["y",0],["points",""],["fillColor",null],["lineColor",null],["lineWidth",1]],0,"_adptLinesData"]}}]);return _}();var Gt=function(){function y(){this._cacheBoundsType=false}v(y,"laya.display.GraphicsBounds");var t=y.prototype;t.destroy=function(){this._graphics=null;this._cacheBoundsType=false;if(this._temp)this._temp.length=0;if(this._rstBoundPoints)this._rstBoundPoints.length=0;if(this._bounds)this._bounds.recover();this._bounds=null;z.recover("GraphicsBounds",this)};t.reset=function(){this._temp&&(this._temp.length=0)};t.getBounds=function(t){t===void 0&&(t=false);if(!this._bounds||!this._temp||this._temp.length<1||t!=this._cacheBoundsType){this._bounds=St._getWrapRec(this.getBoundPoints(t),this._bounds)}this._cacheBoundsType=t;return this._bounds};t.getBoundPoints=function(t){t===void 0&&(t=false);if(!this._temp||this._temp.length<1||t!=this._cacheBoundsType)this._temp=this._getCmdPoints(t);this._cacheBoundsType=t;return this._rstBoundPoints=xe.copyArray(this._rstBoundPoints,this._temp)};t._getCmdPoints=function(t){t===void 0&&(t=false);var e=Wt._context;var i=this._graphics.cmds;var r;r=this._temp||(this._temp=[]);r.length=0;if(!i&&this._graphics._one!=null){y._tempCmds.length=0;y._tempCmds.push(this._graphics._one);i=y._tempCmds}if(!i)return r;var n=y._tempMatrixArrays;n.length=0;var s=y._initMatrix;s.identity();var a=y._tempMatrix;var o;var h;for(var l=0,u=i.length;l<u;l++){o=i[l];switch(o.cmdID){case"Alpha":n.push(s);s=s.clone();break;case"Restore":s=n.pop();break;case"Scale":a.identity();a.translate(-o.pivotX,-o.pivotY);a.scale(o.scaleX,o.scaleY);a.translate(o.pivotX,o.pivotY);this._switchMatrix(s,a);break;case"Rotate":a.identity();a.translate(-o.pivotX,-o.pivotY);a.rotate(o.angle);a.translate(o.pivotX,o.pivotY);this._switchMatrix(s,a);break;case"Translate":a.identity();a.translate(o.tx,o.ty);this._switchMatrix(s,a);break;case"Transform":a.identity();a.translate(-o.pivotX,-o.pivotY);a.concat(o.matrix);a.translate(o.pivotX,o.pivotY);this._switchMatrix(s,a);break;case"DrawImage":case"FillTexture":y._addPointArrToRst(r,St._getBoundPointS(o.x,o.y,o.width,o.height),s);break;case"DrawTexture":s.copyTo(a);if(o.matrix)a.concat(o.matrix);y._addPointArrToRst(r,St._getBoundPointS(o.x,o.y,o.width,o.height),a);break;case"DrawImage":h=o.texture;if(t){if(o.width&&o.height){y._addPointArrToRst(r,St._getBoundPointS(o.x,o.y,o.width,o.height),s)}else{y._addPointArrToRst(r,St._getBoundPointS(o.x,o.y,h.width,h.height),s)}}else{var c=(o.width||h.sourceWidth)/h.width;var f=(o.height||h.sourceHeight)/h.height;var _=c*h.sourceWidth;var d=f*h.sourceHeight;var p=h.offsetX>0?h.offsetX:0;var v=h.offsetY>0?h.offsetY:0;p*=c;v*=f;y._addPointArrToRst(r,St._getBoundPointS(o.x-p,o.y-v,_,d),s)}break;case"FillTexture":if(o.width&&o.height){y._addPointArrToRst(r,St._getBoundPointS(o.x,o.y,o.width,o.height),s)}else{h=o.texture;y._addPointArrToRst(r,St._getBoundPointS(o.x,o.y,h.width,h.height),s)}break;case"DrawTexture":;var m;if(o.matrix){s.copyTo(a);a.concat(o.matrix);m=a}else{m=s}if(t){if(o.width&&o.height){y._addPointArrToRst(r,St._getBoundPointS(o.x,o.y,o.width,o.height),m)}else{h=o.texture;y._addPointArrToRst(r,St._getBoundPointS(o.x,o.y,h.width,h.height),m)}}else{h=o.texture;c=(o.width||h.sourceWidth)/h.width;f=(o.height||h.sourceHeight)/h.height;_=c*h.sourceWidth;d=f*h.sourceHeight;p=h.offsetX>0?h.offsetX:0;v=h.offsetY>0?h.offsetY:0;p*=c;v*=f;y._addPointArrToRst(r,St._getBoundPointS(o.x-p,o.y-v,_,d),m)}break;case"DrawRect":y._addPointArrToRst(r,St._getBoundPointS(o.x,o.y,o.width,o.height),s);break;case"DrawCircle":y._addPointArrToRst(r,St._getBoundPointS(o.x-o.radius,o.y-o.radius,o.radius+o.radius,o.radius+o.radius),s);break;case"DrawLine":y._tempPoints.length=0;var g=NaN;g=o.lineWidth*.5;if(o.fromX==o.toX){y._tempPoints.push(o.fromX+g,o.fromY,o.toX+g,o.toY,o.fromX-g,o.fromY,o.toX-g,o.toY)}else if(o.fromY==o.toY){y._tempPoints.push(o.fromX,o.fromY+g,o.toX,o.toY+g,o.fromX,o.fromY-g,o.toX,o.toY-g)}else{y._tempPoints.push(o.fromX,o.fromY,o.toX,o.toY)}y._addPointArrToRst(r,y._tempPoints,s);break;case"DrawCurves":y._addPointArrToRst(r,Kt.I.getBezierPoints(o.points),s,o.x,o.y);break;case"DrawLines":case"DrawPoly":y._addPointArrToRst(r,o.points,s,o.x,o.y);break;case"DrawPath":y._addPointArrToRst(r,this._getPathPoints(o.paths),s,o.x,o.y);break;case"DrawPie":y._addPointArrToRst(r,this._getPiePoints(o.x,o.y,o.radius,o.startAngle,o.endAngle),s);break}}if(r.length>200){r=xe.copyArray(r,St._getWrapRec(r)._getBoundPoints())}else if(r.length>8)r=Z.scanPList(r);return r};t._switchMatrix=function(t,e){e.concat(t);e.copyTo(t)};t._getPiePoints=function(t,e,i,r,n){var s=y._tempPoints;y._tempPoints.length=0;var a=Math.PI/180;var o=n-r;if(o>=360||o<=-360){s.push(t-i,e-i);s.push(t+i,e-i);s.push(t+i,e+i);s.push(t-i,e+i);return s}s.push(t,e);var h=o%360;if(h<0)h+=360;var l=r+h;var u=r*a;var c=l*a;s.push(t+i*Math.cos(u),e+i*Math.sin(u));s.push(t+i*Math.cos(c),e+i*Math.sin(c));var f=Math.ceil(r/90)*90;var _=Math.floor(l/90)*90;for(var d=f;d<=_;d+=90){var p=d*a;s.push(t+i*Math.cos(p),e+i*Math.sin(p))}return s};t._getPathPoints=function(t){var e=0,i=0;var r=y._tempPoints;r.length=0;i=t.length;var n;for(e=0;e<i;e++){n=t[e];if(n.length>1){r.push(n[1],n[2]);if(n.length>3){r.push(n[3],n[4])}}}return r};y.create=function(){return z.getItemByClass("GraphicsBounds",y)};y._addPointArrToRst=function(t,e,i,r,n){r===void 0&&(r=0);n===void 0&&(n=0);var s=0,a=0;a=e.length;for(s=0;s<a;s+=2){y._addPointToRst(t,e[s]+r,e[s+1]+n,i)}};y._addPointToRst=function(t,e,i,r){var n=ie.TEMP;n.setTo(e?e:0,i?i:0);r.transformPoint(n);t.push(n.x,n.y)};y._tempPoints=[];y._tempMatrixArrays=[];y._tempCmds=[];a(y,["_tempMatrix",function(){return this._tempMatrix=new pt},"_initMatrix",function(){return this._initMatrix=new pt}]);return y}();var Xt=function(){function t(){}v(t,"laya.layagl.LayaGL");var e=t.prototype;e.createCommandEncoder=function(t,e,i){t===void 0&&(t=128);e===void 0&&(e=64);i===void 0&&(i=false);return new zt(this,t,e,i)};e.beginCommandEncoding=function(t){};e.endCommandEncoding=function(){};e.matrix4x4Multiply=function(t,e,i){};e.evaluateClipDatasRealTime=function(t,e,i,r){};t.getFrameCount=function(){return 0};t.syncBufferToRenderThread=function(t,e){e===void 0&&(e=0)};t.createArrayBufferRef=function(t,e,i){};t.createArrayBufferRefs=function(t,e,i,r){};t.EXECUTE_JS_THREAD_BUFFER=0;t.EXECUTE_RENDER_THREAD_BUFFER=1;t.EXECUTE_COPY_TO_RENDER=2;t.EXECUTE_COPY_TO_RENDER3D=3;t.ARRAY_BUFFER_TYPE_DATA=0;t.ARRAY_BUFFER_TYPE_CMD=1;t.ARRAY_BUFFER_REF_REFERENCE=0;t.ARRAY_BUFFER_REF_COPY=1;t.UPLOAD_SHADER_UNIFORM_TYPE_ID=0;t.UPLOAD_SHADER_UNIFORM_TYPE_DATA=1;t.instance=null;return t}();var Yt=function(){function p(){}v(p,"laya.utils.Browser");d(1,p,"pixelRatio",function(){if(p._pixelRatio<0){p.__init__();if(p.userAgent.indexOf("Mozilla/6.0(Linux; Android 6.0; HUAWEI NXT-AL10 Build/HUAWEINXT-AL10)")>-1)p._pixelRatio=2;else{var t=p.context;var e=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1;p._pixelRatio=(p._window.devicePixelRatio||1)/e;if(p._pixelRatio<1)p._pixelRatio=1}}return p._pixelRatio});d(1,p,"height",function(){p.__init__();return(y.stage&&y.stage.canvasRotation?p.clientWidth:p.clientHeight)*p.pixelRatio});d(1,p,"clientWidth",function(){p.__init__();return p._window.innerWidth||p._document.body.clientWidth});d(1,p,"window",function(){return p._window||p.__init__()});d(1,p,"clientHeight",function(){p.__init__();return p._window.innerHeight||p._document.body.clientHeight||p._document.documentElement.clientHeight});d(1,p,"width",function(){p.__init__();return(y.stage&&y.stage.canvasRotation?p.clientHeight:p.clientWidth)*p.pixelRatio});d(1,p,"container",function(){if(!p._container){p.__init__();p._container=p.createElement("div");p._container.id="layaContainer";p._document.body.appendChild(p._container)}return p._container},function(t){p._container=t});d(1,p,"document",function(){p.__init__();return p._document});p.__init__=function(){if(p._window)return p._window;var e=p._window=g;var t=p._document=e.document;var i=p.userAgent=e.navigator.userAgent;var r=e._layalibs;if(r){r.sort(function(t,e){return t.i-e.i});for(var n=0;n<r.length;n++){r[n].f(e,t,y)}}if(i.indexOf("MiniGame")>-1&&p.window.hasOwnProperty("wx")){if(!y["MiniAdpter"]){console.error("请先添加小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")}else{y["MiniAdpter"].enable()}}if(i.indexOf("SwanGame")>-1){if(!y["BMiniAdapter"]){console.error("请先添加百度小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")}else{y["BMiniAdapter"].enable()}}if(typeof getApp=="function"){if(!y["KGMiniAdapter"]){console.error("请先添加小米小游戏适配库,详细教程：https://ldc2.layabox.com/doc/?nav=zh-ts-5-0-0")}else{y["KGMiniAdapter"].enable()}}if(i.indexOf("OPPO")>-1&&i.indexOf("MiniGame")>-1){if(!y["QGMiniAdapter"]){console.error("请先添加OPPO小游戏适配库")}else{y["QGMiniAdapter"].enable()}}e.trace=console.log;e.requestAnimationFrame=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(t){return e.setTimeout(t,1e3/60)};var s=t.body.style;s.margin=0;s.overflow="hidden";s["-webkit-user-select"]="none";s["-webkit-tap-highlight-color"]="rgba(200,200,200,0)";var a=t.getElementsByTagName("meta");var o=0,h=false,l="width=device-width,initial-scale=1.0,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no";while(o<a.length){var u=a[o];if(u.name=="viewport"){u.content=l;h=true;break}o++}if(!h){u=t.createElement("meta");u.name="viewport",u.content=l;t.getElementsByTagName("head")[0].appendChild(u)}p.onMobile=g.isConchApp?true:i.indexOf("Mobile")>-1;p.onIOS=!!i.match(/\(i[^;]+;(U;)? CPU.+Mac OS X/);p.onIPhone=i.indexOf("iPhone")>-1;p.onMac=i.indexOf("Mac OS X")>-1;p.onIPad=i.indexOf("iPad")>-1;p.onAndroid=i.indexOf("Android")>-1||i.indexOf("Adr")>-1;p.onWP=i.indexOf("Windows Phone")>-1;p.onQQBrowser=i.indexOf("QQBrowser")>-1;p.onMQQBrowser=i.indexOf("MQQBrowser")>-1||i.indexOf("Mobile")>-1&&i.indexOf("QQ")>-1;p.onIE=!!e.ActiveXObject||"ActiveXObject"in e;p.onWeiXin=i.indexOf("MicroMessenger")>-1;p.onSafari=i.indexOf("Safari")>-1;p.onPC=!p.onMobile;p.onMiniGame=i.indexOf("MiniGame")>-1;p.onBDMiniGame=i.indexOf("SwanGame")>-1;if(i.indexOf("OPPO")>-1&&i.indexOf("MiniGame")>-1){p.onQGMiniGame=true;p.onMiniGame=false}p.onLimixiu=i.indexOf("limixiu")>-1;p.onKGMiniGame=i.indexOf("QuickGame")>-1;p.supportLocalStorage=Lt.__init__();p.supportWebAudio=We.__init__();Wt._mainCanvas=new Bi(true);var c=Wt._mainCanvas.source.style;c.position="absolute";c.top=c.left="0px";c.background="#000000";p.canvas=new Bi(true);p.context=p.canvas.getContext("2d");var f=new Bi(true);if(laya.utils.Browser.onQGMiniGame)f=Wt._mainCanvas;var _=["webgl","experimental-webgl","webkit-3d","moz-webgl"];var d=null;for(o=0;o<_.length;o++){try{d=f.source.getContext(_[o])}catch(t){}if(d){p._supportWebGL=true;break}}return e};p.createElement=function(t){p.__init__();return p._document.createElement(t)};p.getElementById=function(t){p.__init__();return p._document.getElementById(t)};p.removeElement=function(t){if(t&&t.parentNode)t.parentNode.removeChild(t)};p.now=function(){return Date.now()};p.userAgent=null;p.onMobile=false;p.onIOS=false;p.onMac=false;p.onIPhone=false;p.onIPad=false;p.onAndroid=false;p.onWP=false;p.onQQBrowser=false;p.onMQQBrowser=false;p.onSafari=false;p.onIE=false;p.onWeiXin=false;p.onPC=false;p.onMiniGame=false;p.onBDMiniGame=false;p.onKGMiniGame=false;p.onQGMiniGame=false;p.onLimixiu=false;p.onFirefox=false;p.onEdge=false;p.supportWebAudio=false;p.supportLocalStorage=false;p.canvas=null;p.context=null;p._window=null;p._document=null;p._container=null;p._pixelRatio=-1;p._supportWebGL=false;return p}();var Ht=function(){function s(){this._matrix=new pt}v(s,"laya.webgl.canvas.save.SaveTransform");var t=s.prototype;y.imps(t,{"laya.webgl.canvas.save.ISaveData":true});t.isSaveMark=function(){return false};t.restore=function(t){t._curMat=this._savematrix;s.POOL[s.POOL._length++]=this};s.save=function(t){var e=t._saveMark;if((e._saveuse&2048)===2048)return;e._saveuse|=2048;var i=s.POOL;var r=i._length>0?i[--i._length]:new s;r._savematrix=t._curMat;t._curMat=t._curMat.copyTo(r._matrix);var n=t._save;n[n._length++]=r};s.POOL=o._createArray();return s}();var zt=function(){function t(t,e,i,r){this._idata=[]}v(t,"laya.layagl.CommandEncoder");var e=t.prototype;e.getArrayData=function(){return this._idata};e.getPtrID=function(){return 0};e.beginEncoding=function(){};e.endEncoding=function(){};e.clearEncoding=function(){this._idata.length=0};e.getCount=function(){return this._idata.length};e.add_ShaderValue=function(t){this._idata.push(t)};e.addShaderUniform=function(t){this.add_ShaderValue(t)};return t}();var jt=function(){function l(){}v(l,"laya.display.cmd.FillBorderTextCmd");var t=l.prototype;t.recover=function(){z.recover("FillBorderTextCmd",this)};t.run=function(t,e,i){t.fillBorderText(this.text,this.x+e,this.y+i,this.font,this.fillColor,this.borderColor,this.lineWidth,this.textAlign)};d(0,t,"cmdID",function(){return"FillBorderText"});l.create=function(t,e,i,r,n,s,a,o){var h=z.getItemByClass("FillBorderTextCmd",l);h.text=t;h.x=e;h.y=i;h.font=r;h.fillColor=n;h.borderColor=s;h.lineWidth=a;h.textAlign=o;return h};l.ID="FillBorderText";return l}();var Kt=function(){function t(){this._controlPoints=[new ie,new ie,new ie];this._calFun=this.getPoint2}v(t,"laya.maths.Bezier");var e=t.prototype;e._switchPoint=function(t,e){var i=this._controlPoints.shift();i.setTo(t,e);this._controlPoints.push(i)};e.getPoint2=function(t,e){var i=this._controlPoints[0];var r=this._controlPoints[1];var n=this._controlPoints[2];var s=Math.pow(1-t,2)*i.x+2*t*(1-t)*r.x+Math.pow(t,2)*n.x;var a=Math.pow(1-t,2)*i.y+2*t*(1-t)*r.y+Math.pow(t,2)*n.y;e.push(s,a)};e.getPoint3=function(t,e){var i=this._controlPoints[0];var r=this._controlPoints[1];var n=this._controlPoints[2];var s=this._controlPoints[3];var a=Math.pow(1-t,3)*i.x+3*r.x*t*(1-t)*(1-t)+3*n.x*t*t*(1-t)+s.x*Math.pow(t,3);var o=Math.pow(1-t,3)*i.y+3*r.y*t*(1-t)*(1-t)+3*n.y*t*t*(1-t)+s.y*Math.pow(t,3);e.push(a,o)};e.insertPoints=function(t,e){var i=NaN;t=t>0?t:5;var r=NaN;r=1/t;for(i=0;i<=1;i+=r){this._calFun(i,e)}};e.getBezierPoints=function(t,e,i){e===void 0&&(e=5);i===void 0&&(i=2);var r=0,n=0;n=t.length;if(n<(i+1)*2)return[];var s=[];switch(i){case 2:this._calFun=this.getPoint2;break;case 3:this._calFun=this.getPoint3;break;default:return[]}while(this._controlPoints.length<=i){this._controlPoints.push(ie.create())}for(r=0;r<i*2;r+=2){this._switchPoint(t[r],t[r+1])}for(r=i*2;r<n;r+=2){this._switchPoint(t[r],t[r+1]);if(r/2%i==0)this.insertPoints(e,s)}return s};a(t,["I",function(){return this.I=new t}]);return t}();var $t=function(){function o(){}v(o,"laya.display.cmd.Draw9GridTexture");var t=o.prototype;t.recover=function(){this.texture._removeReference();z.recover("Draw9GridTexture",this)};t.run=function(t,e,i){t.drawTextureWithSizeGrid(this.texture,this.x,this.y,this.width,this.height,this.sizeGrid,e,i)};d(0,t,"cmdID",function(){return"Draw9GridTexture"});o.create=function(t,e,i,r,n,s){var a=z.getItemByClass("Draw9GridTexture",o);a.texture=t;t._addReference();a.x=e;a.y=i;a.width=r;a.height=n;a.sizeGrid=s;return a};o.ID="Draw9GridTexture";return o}();var qt=function(){function n(){this.texWidth=1024;this.texHeight=1024;this.atlasgrid=null;this.protectDist=1;this.texture=null;this.charMaps={};this.texHeight=this.texWidth=R.atlasWidth;this.texture=Ci.getTextTexture(this.texWidth,this.texHeight);if(this.texWidth/n.atlasGridW>256){n.atlasGridW=Math.ceil(this.texWidth/256)}this.atlasgrid=new ce(this.texWidth/n.atlasGridW,this.texHeight/n.atlasGridW,this.texture.id)}v(n,"laya.webgl.text.TextAtlas");var t=n.prototype;t.setProtecteDist=function(t){this.protectDist=t};t.getAEmpty=function(t,e,i){var r=this.atlasgrid.addRect(1,Math.ceil(t/n.atlasGridW),Math.ceil(e/n.atlasGridW),i);if(r){i.x*=n.atlasGridW;i.y*=n.atlasGridW}return r};t.destroy=function(){for(var t in this.charMaps){var e=this.charMaps[t];e.deleted=true}this.texture.discard()};t.printDebugInfo=function(){};d(0,t,"usedRate",function(){return this.atlasgrid._used});n.atlasGridW=16;return n}();var Qt=function(){function t(){this._strsToID={};this._idToStrs=[];this._length=0}v(t,"laya.utils.StringKey");var e=t.prototype;e.add=function(t){var e=this._strsToID[t];if(e!=null)return e;this._idToStrs[this._length]=t;return this._strsToID[t]=this._length++};e.getID=function(t){var e=this._strsToID[t];return e==null?-1:e};e.getName=function(t){var e=this._idToStrs[t];return e==null?undefined:e};return t}();var Zt=function(){function t(){this.ratio=.92;this.maxOffset=60;this._dragging=false;this._clickOnly=true}v(t,"laya.utils.Dragging");var e=t.prototype;e.start=function(t,e,i,r,n,s,a,o){o===void 0&&(o=.92);this.clearTimer();this.target=t;this.area=e;this.hasInertia=i;this.elasticDistance=e?r:0;this.elasticBackTime=n;this.data=s;this._disableMouseEvent=a;this.ratio=o;this._parent=t.parent;this._clickOnly=true;this._dragging=true;this._elasticRateX=this._elasticRateY=1;this._lastX=this._parent.mouseX;this._lastY=this._parent.mouseY;y.stage.on("mouseup",this,this.onStageMouseUp);y.stage.on("mouseout",this,this.onStageMouseUp);y.systemTimer.frameLoop(1,this,this.loop)};e.clearTimer=function(){y.systemTimer.clear(this,this.loop);y.systemTimer.clear(this,this.tweenMove);if(this._tween){this._tween.recover();this._tween=null}};e.stop=function(){if(this._dragging){D.instance.disableMouseEvent=false;y.stage.off("mouseup",this,this.onStageMouseUp);y.stage.off("mouseout",this,this.onStageMouseUp);this._dragging=false;this.target&&this.area&&this.backToArea();this.clear()}};e.loop=function(){var t=this._parent.getMousePoint();var e=t.x;var i=t.y;var r=e-this._lastX;var n=i-this._lastY;if(this._clickOnly){if(Math.abs(r*y.stage._canvasTransform.getScaleX())>1||Math.abs(n*y.stage._canvasTransform.getScaleY())>1){this._clickOnly=false;this._offsets||(this._offsets=[]);this._offsets.length=0;this.target.event("dragstart",this.data);D.instance.disableMouseEvent=this._disableMouseEvent}else return}else{this._offsets.push(r,n)}if(r===0&&n===0)return;this._lastX=e;this._lastY=i;this.target.x+=r*this._elasticRateX;this.target.y+=n*this._elasticRateY;this.area&&this.checkArea();this.target.event("dragmove",this.data)};e.checkArea=function(){if(this.elasticDistance<=0){this.backToArea()}else{if(this.target._x<this.area.x){var t=this.area.x-this.target._x}else if(this.target._x>this.area.x+this.area.width){t=this.target._x-this.area.x-this.area.width}else{t=0}this._elasticRateX=Math.max(0,1-t/this.elasticDistance);if(this.target._y<this.area.y){var e=this.area.y-this.target.y}else if(this.target._y>this.area.y+this.area.height){e=this.target._y-this.area.y-this.area.height}else{e=0}this._elasticRateY=Math.max(0,1-e/this.elasticDistance)}};e.backToArea=function(){this.target.x=Math.min(Math.max(this.target._x,this.area.x),this.area.x+this.area.width);this.target.y=Math.min(Math.max(this.target._y,this.area.y),this.area.y+this.area.height)};e.onStageMouseUp=function(t){D.instance.disableMouseEvent=false;y.stage.off("mouseup",this,this.onStageMouseUp);y.stage.off("mouseout",this,this.onStageMouseUp);y.systemTimer.clear(this,this.loop);if(this._clickOnly||!this.target)return;if(this.hasInertia){if(this._offsets.length<1){this._offsets.push(this._parent.mouseX-this._lastX,this._parent.mouseY-this._lastY)}this._offsetX=this._offsetY=0;var e=this._offsets.length;var i=Math.min(e,6);var r=this._offsets.length-i;for(var n=e-1;n>r;n--){this._offsetY+=this._offsets[n--];this._offsetX+=this._offsets[n]}this._offsetX=this._offsetX/i*2;this._offsetY=this._offsetY/i*2;if(Math.abs(this._offsetX)>this.maxOffset)this._offsetX=this._offsetX>0?this.maxOffset:-this.maxOffset;if(Math.abs(this._offsetY)>this.maxOffset)this._offsetY=this._offsetY>0?this.maxOffset:-this.maxOffset;y.systemTimer.frameLoop(1,this,this.tweenMove)}else if(this.elasticDistance>0){this.checkElastic()}else{this.clear()}};e.checkElastic=function(){var t=NaN;var e=NaN;if(this.target.x<this.area.x)t=this.area.x;else if(this.target._x>this.area.x+this.area.width)t=this.area.x+this.area.width;if(this.target.y<this.area.y)e=this.area.y;else if(this.target._y>this.area.y+this.area.height)e=this.area.y+this.area.height;if(!isNaN(t)||!isNaN(e)){var i={};if(!isNaN(t))i.x=t;if(!isNaN(e))i.y=e;this._tween=tt.to(this.target,i,this.elasticBackTime,de.sineOut,b.create(this,this.clear),0,false,false)}else{this.clear()}};e.tweenMove=function(){this._offsetX*=this.ratio*this._elasticRateX;this._offsetY*=this.ratio*this._elasticRateY;this.target.x+=this._offsetX;this.target.y+=this._offsetY;this.area&&this.checkArea();this.target.event("dragmove",this.data);if(Math.abs(this._offsetX)<1&&Math.abs(this._offsetY)<1||this._elasticRateX<.5||this._elasticRateY<.5){y.systemTimer.clear(this,this.tweenMove);if(this.elasticDistance>0)this.checkElastic();else this.clear()}};e.clear=function(){if(this.target){this.clearTimer();var t=this.target;this.target=null;this._parent=null;t.event("dragend",this.data)}};return t}();var Jt=function(){function p(){}v(p,"laya.webgl.shapes.Earcut");p.earcut=function(t,e,i){i=i||2;var r=e&&e.length,n=r?e[0]*i:t.length,s=p.linkedList(t,0,n,i,true),a=[];if(!s)return a;var o,h,l,u,c,f,_;if(r)s=p.eliminateHoles(t,e,s,i);if(t.length>80*i){o=l=t[0];h=u=t[1];for(var d=i;d<n;d+=i){c=t[d];f=t[d+1];if(c<o)o=c;if(f<h)h=f;if(c>l)l=c;if(f>u)u=f}_=Math.max(l-o,u-h);_=_!==0?1/_:0}p.earcutLinked(s,a,i,o,h,_);return a};p.linkedList=function(t,e,i,r,n){var s,a;if(n===p.signedArea(t,e,i,r)>0){for(s=e;s<i;s+=r)a=p.insertNode(s,t[s],t[s+1],a)}else{for(s=i-r;s>=e;s-=r)a=p.insertNode(s,t[s],t[s+1],a)}if(a&&p.equals(a,a.next)){p.removeNode(a);a=a.next}return a};p.filterPoints=function(t,e){if(!t)return t;if(!e)e=t;var i=t,r;do{r=false;if(!i.steiner&&(p.equals(i,i.next)||p.area(i.prev,i,i.next)===0)){p.removeNode(i);i=e=i.prev;if(i===i.next)break;r=true}else{i=i.next}}while(r||i!==e);return e};p.earcutLinked=function(t,e,i,r,n,s,a){if(!t)return;if(!a&&s)p.indexCurve(t,r,n,s);var o=t,h,l;while(t.prev!==t.next){h=t.prev;l=t.next;if(s?p.isEarHashed(t,r,n,s):p.isEar(t)){e.push(h.i/i);e.push(t.i/i);e.push(l.i/i);p.removeNode(t);t=l.next;o=l.next;continue}t=l;if(t===o){if(!a){p.earcutLinked(p.filterPoints(t,null),e,i,r,n,s,1)}else if(a===1){t=p.cureLocalIntersections(t,e,i);p.earcutLinked(t,e,i,r,n,s,2)}else if(a===2){p.splitEarcut(t,e,i,r,n,s)}break}}};p.isEar=function(t){var e=t.prev,i=t,r=t.next;if(p.area(e,i,r)>=0)return false;var n=t.next.next;while(n!==t.prev){if(p.pointInTriangle(e.x,e.y,i.x,i.y,r.x,r.y,n.x,n.y)&&p.area(n.prev,n,n.next)>=0)return false;n=n.next}return true};p.isEarHashed=function(t,e,i,r){var n=t.prev,s=t,a=t.next;if(p.area(n,s,a)>=0)return false;var o=n.x<s.x?n.x<a.x?n.x:a.x:s.x<a.x?s.x:a.x,h=n.y<s.y?n.y<a.y?n.y:a.y:s.y<a.y?s.y:a.y,l=n.x>s.x?n.x>a.x?n.x:a.x:s.x>a.x?s.x:a.x,u=n.y>s.y?n.y>a.y?n.y:a.y:s.y>a.y?s.y:a.y;var c=p.zOrder(o,h,e,i,r),f=p.zOrder(l,u,e,i,r);var _=t.nextZ;while(_&&_.z<=f){if(_!==t.prev&&_!==t.next&&p.pointInTriangle(n.x,n.y,s.x,s.y,a.x,a.y,_.x,_.y)&&p.area(_.prev,_,_.next)>=0)return false;_=_.nextZ}_=t.prevZ;while(_&&_.z>=c){if(_!==t.prev&&_!==t.next&&p.pointInTriangle(n.x,n.y,s.x,s.y,a.x,a.y,_.x,_.y)&&p.area(_.prev,_,_.next)>=0)return false;_=_.prevZ}return true};p.cureLocalIntersections=function(t,e,i){var r=t;do{var n=r.prev,s=r.next.next;if(!p.equals(n,s)&&p.intersects(n,r,r.next,s)&&p.locallyInside(n,s)&&p.locallyInside(s,n)){e.push(n.i/i);e.push(r.i/i);e.push(s.i/i);p.removeNode(r);p.removeNode(r.next);r=t=s}r=r.next}while(r!==t);return r};p.splitEarcut=function(t,e,i,r,n,s){var a=t;do{var o=a.next.next;while(o!==a.prev){if(a.i!==o.i&&p.isValidDiagonal(a,o)){var h=p.splitPolygon(a,o);a=p.filterPoints(a,a.next);h=p.filterPoints(h,h.next);p.earcutLinked(a,e,i,r,n,s);p.earcutLinked(h,e,i,r,n,s);return}o=o.next}a=a.next}while(a!==t)};p.eliminateHoles=function(t,e,i,r){var n=[],s,a,o,h,l;for(s=0,a=e.length;s<a;s++){o=e[s]*r;h=s<a-1?e[s+1]*r:t.length;l=p.linkedList(t,o,h,r,false);if(l===l.next)l.steiner=true;n.push(p.getLeftmost(l))}n.sort(p.compareX);for(s=0;s<n.length;s++){p.eliminateHole(n[s],i);i=p.filterPoints(i,i.next)}return i};p.compareX=function(t,e){return t.x-e.x};p.eliminateHole=function(t,e){e=p.findHoleBridge(t,e);if(e){var i=p.splitPolygon(e,t);p.filterPoints(i,i.next)}};p.findHoleBridge=function(t,e){var i=e,r=t.x,n=t.y,s=-Infinity,a;do{if(n<=i.y&&n>=i.next.y&&i.next.y!==i.y){var o=i.x+(n-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(o<=r&&o>s){s=o;if(o===r){if(n===i.y)return i;if(n===i.next.y)return i.next}a=i.x<i.next.x?i:i.next}}i=i.next}while(i!==e);if(!a)return null;if(r===s)return a.prev;var h=a,l=a.x,u=a.y,c=Infinity,f;i=a.next;while(i!==h){if(r>=i.x&&i.x>=l&&r!==i.x&&p.pointInTriangle(n<u?r:s,n,l,u,n<u?s:r,n,i.x,i.y)){f=Math.abs(n-i.y)/(r-i.x);if((f<c||f===c&&i.x>a.x)&&p.locallyInside(i,t)){a=i;c=f}}i=i.next}return a};p.indexCurve=function(t,e,i,r){var n=t;do{if(n.z===null)n.z=p.zOrder(n.x,n.y,e,i,r);n.prevZ=n.prev;n.nextZ=n.next;n=n.next}while(n!==t);n.prevZ.nextZ=null;n.prevZ=null;p.sortLinked(n)};p.sortLinked=function(t){var e,i,r,n,s,a,o,h,l=1;do{i=t;t=null;s=null;a=0;while(i){a++;r=i;o=0;for(e=0;e<l;e++){o++;r=r.nextZ;if(!r)break}h=l;while(o>0||h>0&&r){if(o!==0&&(h===0||!r||i.z<=r.z)){n=i;i=i.nextZ;o--}else{n=r;r=r.nextZ;h--}if(s)s.nextZ=n;else t=n;n.prevZ=s;s=n}i=r}s.nextZ=null;l*=2}while(a>1);return t};p.zOrder=function(t,e,i,r,n){t=32767*(t-i)*n;e=32767*(e-r)*n;t=(t|t<<8)&16711935;t=(t|t<<4)&252645135;t=(t|t<<2)&858993459;t=(t|t<<1)&1431655765;e=(e|e<<8)&16711935;e=(e|e<<4)&252645135;e=(e|e<<2)&858993459;e=(e|e<<1)&1431655765;return t|e<<1};p.getLeftmost=function(t){var e=t,i=t;do{if(e.x<i.x)i=e;e=e.next}while(e!==t);return i};p.pointInTriangle=function(t,e,i,r,n,s,a,o){return(n-a)*(e-o)-(t-a)*(s-o)>=0&&(t-a)*(r-o)-(i-a)*(e-o)>=0&&(i-a)*(s-o)-(n-a)*(r-o)>=0};p.isValidDiagonal=function(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!p.intersectsPolygon(t,e)&&p.locallyInside(t,e)&&p.locallyInside(e,t)&&p.middleInside(t,e)};p.area=function(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)};p.equals=function(t,e){return t.x===e.x&&t.y===e.y};p.intersects=function(t,e,i,r){if(p.equals(t,e)&&p.equals(i,r)||p.equals(t,r)&&p.equals(i,e))return true;return p.area(t,e,i)>0!==p.area(t,e,r)>0&&p.area(i,r,t)>0!==p.area(i,r,e)>0};p.intersectsPolygon=function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&p.intersects(i,i.next,t,e))return true;i=i.next}while(i!==t);return false};p.locallyInside=function(t,e){return p.area(t.prev,t,t.next)<0?p.area(t,e,t.next)>=0&&p.area(t,t.prev,e)>=0:p.area(t,e,t.prev)<0||p.area(t,t.next,e)<0};p.middleInside=function(t,e){var i=t,r=false,n=(t.x+e.x)/2,s=(t.y+e.y)/2;do{if(i.y>s!==i.next.y>s&&i.next.y!==i.y&&n<(i.next.x-i.x)*(s-i.y)/(i.next.y-i.y)+i.x)r=!r;i=i.next}while(i!==t);return r};p.splitPolygon=function(t,e){var i=new it(t.i,t.x,t.y),r=new it(e.i,e.x,e.y),n=t.next,s=e.prev;t.next=e;e.prev=t;i.next=n;n.prev=i;r.next=i;i.prev=r;s.next=r;r.prev=s;return r};p.insertNode=function(t,e,i,r){var n=new it(t,e,i);if(!r){n.prev=n;n.next=n}else{n.next=r.next;n.prev=r;r.next.prev=n;r.next=n}return n};p.removeNode=function(t){t.next.prev=t.prev;t.prev.next=t.next;if(t.prevZ)t.prevZ.nextZ=t.nextZ;if(t.nextZ)t.nextZ.prevZ=t.prevZ};p.signedArea=function(t,e,i,r){var n=0;for(var s=e,a=i-r;s<i;s+=r){n+=(t[a]-t[s])*(t[s+1]+t[a+1]);a=s}return n};return p}();var te=function(){function i(t){this.childs=[];this.text="";this.parent=null;this.name=null;this.noCompile=false;this.includefiles=null;this.condition=null;this.conditionType=0;this.useFuns="";this.z=0;this.src=null;this.includefiles=t}v(i,"laya.webgl.utils.ShaderNode");var t=i.prototype;t.setParent=function(t){t.childs.push(this);this.z=t.z+1;this.parent=t};t.setCondition=function(t,e){if(t){this.conditionType=e;t=t.replace(/(\s*$)/g,"");this.condition=function(){return this[t]};this.condition.__condition=t}};t.toscript=function(t,e){return this._toscript(t,e,++i.__id)};t._toscript=function(r,n,s){if(this.childs.length<1&&!this.text)return n;var t=n.length;if(this.condition){var e=!!this.condition.call(r);this.conditionType===2&&(e=!e);if(!e)return n}this.text&&n.push(this.text);this.childs.length>0&&this.childs.forEach(function(t,e,i){t._toscript(r,n,s)});if(this.includefiles.length>0&&this.useFuns.length>0){var i;for(var a=0,o=this.includefiles.length;a<o;a++){if(this.includefiles[a].curUseID==s){continue}i=this.includefiles[a].file.getFunsScript(this.useFuns);if(i.length>0){this.includefiles[a].curUseID=s;n[0]=i+n[0]}}}return n};i.__id=1;return i}();var ee=function(){function r(){}v(r,"laya.display.cmd.TranslateCmd");var t=r.prototype;t.recover=function(){z.recover("TranslateCmd",this)};t.run=function(t,e,i){t.translate(this.tx,this.ty)};d(0,t,"cmdID",function(){return"Translate"});r.create=function(t,e){var i=z.getItemByClass("TranslateCmd",r);i.tx=t;i.ty=e;return i};r.ID="Translate";return r}();var ie=function(){function t(t,e){t===void 0&&(t=0);e===void 0&&(e=0);this.x=t;this.y=e}v(t,"laya.maths.Point");var e=t.prototype;e.setTo=function(t,e){this.x=t;this.y=e;return this};e.reset=function(){this.x=this.y=0;return this};e.recover=function(){z.recover("Point",this.reset())};e.distance=function(t,e){return Math.sqrt((this.x-t)*(this.x-t)+(this.y-e)*(this.y-e))};e.toString=function(){return this.x+","+this.y};e.normalize=function(){var t=Math.sqrt(this.x*this.x+this.y*this.y);if(t>0){var e=1/t;this.x*=e;this.y*=e}};e.copy=function(t){return this.setTo(t.x,t.y)};t.create=function(){return z.getItemByClass("Point",t)};t.TEMP=new t;t.EMPTY=new t;return t}();var re=function(){function t(){}v(t,"laya.Const");t.NOT_ACTIVE=1;t.ACTIVE_INHIERARCHY=2;t.AWAKED=4;t.NOT_READY=8;t.DISPLAY=16;t.HAS_ZORDER=32;t.HAS_MOUSE=64;t.DISPLAYED_INSTAGE=128;t.DRAWCALL_OPTIMIZE=256;return t}();var ne=function(){function N(){}v(N,"laya.webgl.shapes.BasePoly");N.createLine2=function(t,e,i,r,n,s){if(t.length<4)return null;var a=N.tempData.length>t.length+2?N.tempData:new Array(t.length+2);a[0]=t[0];a[1]=t[1];var o=2;var h=0;var l=t.length;for(h=2;h<l;h+=2){if(Math.abs(t[h]-t[h-2])+Math.abs(t[h+1]-t[h-1])>.01){a[o++]=t[h];a[o++]=t[h+1]}}if(s&&Math.abs(t[0]-a[o-2])+Math.abs(t[1]-a[o-1])>.01){a[o++]=t[0];a[o++]=t[1]}var u=n;l=o/2;var c=i/2;var f,_,d,p,v,m,g,y;var x,T,b,w,C,A;var E,S,M,R,I,P;var D,L,B;d=a[0];p=a[1];v=a[2];m=a[3];x=-(p-m);T=d-v;B=Math.sqrt(x*x+T*T);x=x/B*c;T=T/B*c;var F=x,O=T;u.push(d-x,p-T,d+x,p+T);for(h=1;h<l-1;h++){d=a[(h-1)*2];p=a[(h-1)*2+1];v=a[h*2];m=a[h*2+1];g=a[(h+1)*2];y=a[(h+1)*2+1];x=-(p-m);T=d-v;B=Math.sqrt(x*x+T*T);x=x/B*c;T=T/B*c;b=-(m-y);w=v-g;B=Math.sqrt(b*b+w*w);b=b/B*c;w=w/B*c;E=-T+p-(-T+m);S=-x+v-(-x+d);M=(-x+d)*(-T+m)-(-x+v)*(-T+p);R=-w+y-(-w+m);I=-b+v-(-b+g);P=(-b+g)*(-w+m)-(-b+v)*(-w+y);D=E*I-R*S;if(Math.abs(D)<.1){D+=10.1;u.push(v-x,m-T,v+x,m+T);continue}f=(S*P-I*M)/D;_=(R*M-E*P)/D;L=(f-v)*(f-v)+(_-m)+(_-m);u.push(f,_,v-(f-v),m-(_-m))}d=a[o-4];p=a[o-3];v=a[o-2];m=a[o-1];x=-(p-m);T=d-v;B=Math.sqrt(x*x+T*T);x=x/B*c;T=T/B*c;u.push(v-x,m-T,v+x,m+T);for(h=1;h<l;h++){e.push(r+(h-1)*2,r+(h-1)*2+1,r+h*2+1,r+h*2+1,r+h*2,r+(h-1)*2)}return u};N.createLineTriangle=function(t,e,i,r,n,s,a){var o=t.slice();var h=o.length;var l=o[0],u=o[1];var c=o[2],f=o[2];var _=0;var d=0;var p=0,v=0;var m=h/2;if(m<=1)return;if(m==2){return}var g=new Array(m*4);var y=0;var x=0;for(var T=0;T<m-1;T++){l=o[x++],u=o[x++];c=o[x++],f=o[x++];p=c-l,v=f-u;if(p!=0&&v!=0){_=Math.sqrt(p*p+v*v);if(_>.001){d=y*4;g[d]=l;g[d+1]=u;g[d+2]=p/_;g[d+3]=v/_;y++}}}if(r){l=o[h-2],u=o[h-1];c=o[0],f=o[1];p=c-l,v=f-u;if(p!=0&&v!=0){_=Math.sqrt(p*p+v*v);if(_>.001){d=y*4;g[d]=l;g[d+1]=u;g[d+2]=p/_;g[d+3]=v/_;y++}}}else{d=y*4;g[d]=l;g[d+1]=u;g[d+2]=p/_;g[d+3]=v/_;y++}x=0;for(T=0;T<m;T++){l=o[x],u=o[x+1];c=o[x+2],f=o[x+3];var b=o[x+4],w=o[x+5]}if(r){}};a(N,["tempData",function(){return this.tempData=new Array(256)}]);return N}();var se=function(){function s(){}v(s,"laya.display.cmd.ScaleCmd");var t=s.prototype;t.recover=function(){z.recover("ScaleCmd",this)};t.run=function(t,e,i){t._scale(this.scaleX,this.scaleY,this.pivotX+e,this.pivotY+i)};d(0,t,"cmdID",function(){return"Scale"});s.create=function(t,e,i,r){var n=z.getItemByClass("ScaleCmd",s);n.scaleX=t;n.scaleY=e;n.pivotX=i;n.pivotY=r;return n};s.ID="Scale";return s}();var ae=function(){function i(){}v(i,"laya.display.cmd.AlphaCmd");var t=i.prototype;t.recover=function(){z.recover("AlphaCmd",this)};t.run=function(t,e,i){t.alpha(this.alpha)};d(0,t,"cmdID",function(){return"Alpha"});i.create=function(t){var e=z.getItemByClass("AlphaCmd",i);e.alpha=t;return e};i.ID="Alpha";return i}();var oe=function(){function e(t){this._xd_=true;this._allocated_=8;this._pos_=0;this._length=0;if(t){this._u8d_=new Uint8Array(t);this._d_=new DataView(this._u8d_.buffer);this._length=this._d_.byteLength}else{this._resizeBuffer(this._allocated_)}}v(e,"laya.utils.Byte");var t=e.prototype;t._resizeBuffer=function(e){try{var t=new Uint8Array(e);if(this._u8d_!=null){if(this._u8d_.length<=e)t.set(this._u8d_);else t.set(this._u8d_.subarray(0,e))}this._u8d_=t;this._d_=new DataView(t.buffer)}catch(t){throw"Invalid typed array length:"+e}};t.getString=function(){return this.readString()};t.readString=function(){return this._rUTF(this.getUint16())};t.getFloat32Array=function(t,e){return this.readFloat32Array(t,e)};t.readFloat32Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var r=new Float32Array(this._d_.buffer.slice(t,i));this._pos_=i;return r};t.getUint8Array=function(t,e){return this.readUint8Array(t,e)};t.readUint8Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var r=new Uint8Array(this._d_.buffer.slice(t,i));this._pos_=i;return r};t.getInt16Array=function(t,e){return this.readInt16Array(t,e)};t.readInt16Array=function(t,e){var i=t+e;i=i>this._length?this._length:i;var r=new Int16Array(this._d_.buffer.slice(t,i));this._pos_=i;return r};t.getFloat32=function(){return this.readFloat32()};t.readFloat32=function(){if(this._pos_+4>this._length)throw"getFloat32 error - Out of bounds";var t=this._d_.getFloat32(this._pos_,this._xd_);this._pos_+=4;return t};t.getFloat64=function(){return this.readFloat64()};t.readFloat64=function(){if(this._pos_+8>this._length)throw"getFloat64 error - Out of bounds";var t=this._d_.getFloat64(this._pos_,this._xd_);this._pos_+=8;return t};t.writeFloat32=function(t){this._ensureWrite(this._pos_+4);this._d_.setFloat32(this._pos_,t,this._xd_);this._pos_+=4};t.writeFloat64=function(t){this._ensureWrite(this._pos_+8);this._d_.setFloat64(this._pos_,t,this._xd_);this._pos_+=8};t.getInt32=function(){return this.readInt32()};t.readInt32=function(){if(this._pos_+4>this._length)throw"getInt32 error - Out of bounds";var t=this._d_.getInt32(this._pos_,this._xd_);this._pos_+=4;return t};t.getUint32=function(){return this.readUint32()};t.readUint32=function(){if(this._pos_+4>this._length)throw"getUint32 error - Out of bounds";var t=this._d_.getUint32(this._pos_,this._xd_);this._pos_+=4;return t};t.writeInt32=function(t){this._ensureWrite(this._pos_+4);this._d_.setInt32(this._pos_,t,this._xd_);this._pos_+=4};t.writeUint32=function(t){this._ensureWrite(this._pos_+4);this._d_.setUint32(this._pos_,t,this._xd_);this._pos_+=4};t.getInt16=function(){return this.readInt16()};t.readInt16=function(){if(this._pos_+2>this._length)throw"getInt16 error - Out of bounds";var t=this._d_.getInt16(this._pos_,this._xd_);this._pos_+=2;return t};t.getUint16=function(){return this.readUint16()};t.readUint16=function(){if(this._pos_+2>this._length)throw"getUint16 error - Out of bounds";var t=this._d_.getUint16(this._pos_,this._xd_);this._pos_+=2;return t};t.writeUint16=function(t){this._ensureWrite(this._pos_+2);this._d_.setUint16(this._pos_,t,this._xd_);this._pos_+=2};t.writeInt16=function(t){this._ensureWrite(this._pos_+2);this._d_.setInt16(this._pos_,t,this._xd_);this._pos_+=2};t.getUint8=function(){return this.readUint8()};t.readUint8=function(){if(this._pos_+1>this._length)throw"getUint8 error - Out of bounds";return this._u8d_[this._pos_++]};t.writeUint8=function(t){this._ensureWrite(this._pos_+1);this._d_.setUint8(this._pos_,t);this._pos_++};t._getUInt8=function(t){return this._readUInt8(t)};t._readUInt8=function(t){return this._d_.getUint8(t)};t._getUint16=function(t){return this._readUint16(t)};t._readUint16=function(t){return this._d_.getUint16(t,this._xd_)};t._getMatrix=function(){return this._readMatrix()};t._readMatrix=function(){var t=new pt(this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32(),this.getFloat32());return t};t._rUTF=function(t){var e="",i=this._pos_+t,r=0,n=0,s=0,a=String.fromCharCode;var o=this._u8d_,h=0;var l=[];var u=0;l.length=1e3;while(this._pos_<i){r=o[this._pos_++];if(r<128){if(r!=0)l[u++]=a(r)}else if(r<224){l[u++]=a((r&63)<<6|o[this._pos_++]&127)}else if(r<240){n=o[this._pos_++];l[u++]=a((r&31)<<12|(n&127)<<6|o[this._pos_++]&127)}else{n=o[this._pos_++];s=o[this._pos_++];l[u++]=a((r&15)<<18|(n&127)<<12|s<<6&127|o[this._pos_++]&127)}h++}l.length=u;return l.join("")};t.getCustomString=function(t){return this.readCustomString(t)};t.readCustomString=function(t){var e="",i=0,r=0,n=0,s=String.fromCharCode;var a=this._u8d_,o=0;while(t>0){r=a[this._pos_];if(r<128){e+=s(r);this._pos_++;t--}else{i=r-128;this._pos_++;t-=i;while(i>0){r=a[this._pos_++];n=a[this._pos_++];e+=s(n<<8|r);i--}}}return e};t.clear=function(){this._pos_=0;this.length=0};t.__getBuffer=function(){return this._d_.buffer};t.writeUTFBytes=function(t){t=t+"";for(var e=0,i=t.length;e<i;e++){var r=t.charCodeAt(e);if(r<=127){this.writeByte(r)}else if(r<=2047){this._ensureWrite(this._pos_+2);this._u8d_.set([192|r>>6,128|r&63],this._pos_);this._pos_+=2}else if(r<=65535){this._ensureWrite(this._pos_+3);this._u8d_.set([224|r>>12,128|r>>6&63,128|r&63],this._pos_);this._pos_+=3}else{this._ensureWrite(this._pos_+4);this._u8d_.set([240|r>>18,128|r>>12&63,128|r>>6&63,128|r&63],this._pos_);this._pos_+=4}}};t.writeUTFString=function(t){var e=this.pos;this.writeUint16(1);this.writeUTFBytes(t);var i=this.pos-e-2;this._d_.setUint16(e,i,this._xd_)};t.readUTFString=function(){return this.readUTFBytes(this.getUint16())};t.getUTFString=function(){return this.readUTFString()};t.readUTFBytes=function(t){t===void 0&&(t=-1);if(t===0)return"";var e=this.bytesAvailable;if(t>e)throw"readUTFBytes error - Out of bounds";t=t>0?t:e;return this._rUTF(t)};t.getUTFBytes=function(t){t===void 0&&(t=-1);return this.readUTFBytes(t)};t.writeByte=function(t){this._ensureWrite(this._pos_+1);this._d_.setInt8(this._pos_,t);this._pos_+=1};t.readByte=function(){if(this._pos_+1>this._length)throw"readByte error - Out of bounds";return this._d_.getInt8(this._pos_++)};t.getByte=function(){return this.readByte()};t._ensureWrite=function(t){if(this._length<t)this._length=t;if(this._allocated_<t)this.length=t};t.writeArrayBuffer=function(t,e,i){e===void 0&&(e=0);i===void 0&&(i=0);if(e<0||i<0)throw"writeArrayBuffer error - Out of bounds";if(i==0)i=t.byteLength-e;this._ensureWrite(this._pos_+i);var r=new Uint8Array(t);this._u8d_.set(r.subarray(e,e+i),this._pos_);this._pos_+=i};t.readArrayBuffer=function(t){var e;e=this._u8d_.buffer.slice(this._pos_,this._pos_+t);this._pos_=this._pos_+t;return e};d(0,t,"buffer",function(){var t=this._d_.buffer;if(t.byteLength===this._length)return t;return t.slice(0,this._length)});d(0,t,"endian",function(){return this._xd_?"littleEndian":"bigEndian"},function(t){this._xd_=t==="littleEndian"});d(0,t,"length",function(){return this._length},function(t){if(this._allocated_<t)this._resizeBuffer(this._allocated_=Math.floor(Math.max(t,this._allocated_*2)));else if(this._allocated_>t)this._resizeBuffer(this._allocated_=t);this._length=t});d(0,t,"pos",function(){return this._pos_},function(t){this._pos_=t});d(0,t,"bytesAvailable",function(){return this._length-this._pos_});e.getSystemEndian=function(){if(!e._sysEndian){var t=new ArrayBuffer(2);new DataView(t).setInt16(0,256,true);e._sysEndian=new Int16Array(t)[0]===256?"littleEndian":"bigEndian"}return e._sysEndian};e.BIG_ENDIAN="bigEndian";e.LITTLE_ENDIAN="littleEndian";e._sysEndian=null;return e}();var he=function(){var a;function t(){this._pool=[];this._map=[];this._laters=[]}v(t,"laya.utils.CallLater");var e=t.prototype;e._update=function(){var t=this._laters;var e=t.length;if(e>0){for(var i=0,r=e-1;i<=r;i++){var n=t[i];this._map[n.key]=null;if(n.method!==null){n.run();n.clear()}this._pool.push(n);i===r&&(r=t.length-1)}t.length=0}};e._getHandler=function(t,e){var i=t?t.$_GID||(t.$_GID=xe.getGID()):0;var r=e.$_TID||(e.$_TID=ht._mid++*1e5);return this._map[i+r]};e.callLater=function(t,e,i){if(this._getHandler(t,e)==null){if(this._pool.length)var r=this._pool.pop();else r=new a;r.caller=t;r.method=e;r.args=i;var n=t?t.$_GID:0;var s=e["$_TID"];r.key=n+s;this._map[r.key]=r;this._laters.push(r)}};e.runCallLater=function(t,e){var i=this._getHandler(t,e);if(i&&i.method!=null){this._map[i.key]=null;i.run();i.clear()}};t.I=new t;t.__init$=function(){a=function(){function t(){this.key=0;this.caller=null;this.method=null;this.args=null}v(t,"");var e=t.prototype;e.clear=function(){this.caller=null;this.method=null;this.args=null};e.run=function(){var t=this.caller;if(t&&t.destroyed)return this.clear();var e=this.method;var i=this.args;if(e==null)return;i?e.apply(t,i):e.call(t)};return t}()};return t}();var le=function(){function t(){this._sp=null;this._one=null;this._cmds=null;this._vectorgraphArray=null;this._graphicBounds=null;this.autoDestroy=false;this._render=this._renderEmpty;this._createData()}v(t,"laya.display.Graphics");var e=t.prototype;e._createData=function(){};e._clearData=function(){};e._destroyData=function(){};e.destroy=function(){this.clear(true);if(this._graphicBounds)this._graphicBounds.destroy();this._graphicBounds=null;this._vectorgraphArray=null;if(this._sp){this._sp._renderType=0;this._sp._setRenderType(0);this._sp=null}this._destroyData()};e.clear=function(t){t===void 0&&(t=true);if(t){var e=this._one;if(this._cmds){var i=0,r=this._cmds.length;for(i=0;i<r;i++){e=this._cmds[i];e.recover()}this._cmds.length=0}else if(e){e.recover()}}else{this._cmds=null}this._one=null;this._render=this._renderEmpty;this._clearData();if(this._sp){this._sp._renderType&=~512;this._sp._setRenderType(this._sp._renderType)}this._repaint();if(this._vectorgraphArray){for(i=0,r=this._vectorgraphArray.length;i<r;i++){L.getInstance().deleteShape(this._vectorgraphArray[i])}this._vectorgraphArray.length=0}};e._clearBoundsCache=function(){if(this._graphicBounds)this._graphicBounds.reset()};e._initGraphicBounds=function(){if(!this._graphicBounds){this._graphicBounds=Gt.create();this._graphicBounds._graphics=this}};e._repaint=function(){this._clearBoundsCache();this._sp&&this._sp.repaint()};e._isOnlyOne=function(){return!this._cmds||this._cmds.length===0};e.getBounds=function(t){t===void 0&&(t=false);this._initGraphicBounds();return this._graphicBounds.getBounds(t)};e.getBoundPoints=function(t){t===void 0&&(t=false);this._initGraphicBounds();return this._graphicBounds.getBoundPoints(t)};e.drawImage=function(t,e,i,r,n){e===void 0&&(e=0);i===void 0&&(i=0);r===void 0&&(r=0);n===void 0&&(n=0);if(!t)return null;if(!r)r=t.sourceWidth;if(!n)n=t.sourceHeight;if(t.getIsReady()){var s=r/t.sourceWidth;var a=n/t.sourceHeight;r=t.width*s;n=t.height*a;if(r<=0||n<=0)return null;e+=t.offsetX*s;i+=t.offsetY*a}if(this._sp){this._sp._renderType|=512;this._sp._setRenderType(this._sp._renderType)}var o=_.create.call(this,t,e,i,r,n);if(this._one==null){this._one=o;this._render=this._renderOneImg}else{this._saveToCmd(null,o)}this._repaint();return o};e.drawTexture=function(t,e,i,r,n,s,a,o,h){e===void 0&&(e=0);i===void 0&&(i=0);r===void 0&&(r=0);n===void 0&&(n=0);a===void 0&&(a=1);if(!t||a<.01)return null;if(!t.getIsReady())return null;if(!r)r=t.sourceWidth;if(!n)n=t.sourceHeight;if(t.getIsReady()){var l=r/t.sourceWidth;var u=n/t.sourceHeight;r=t.width*l;n=t.height*u;if(r<=0||n<=0)return null;e+=t.offsetX*l;i+=t.offsetY*u}if(this._sp){this._sp._renderType|=512;this._sp._setRenderType(this._sp._renderType)}var c=q.create.call(this,t,e,i,r,n,s,a,o,h);this._repaint();return this._saveToCmd(null,c)};e.drawTextures=function(t,e){if(!t)return null;return this._saveToCmd(Wt._context.drawTextures,gt.create.call(this,t,e))};e.drawTriangles=function(t,e,i,r,n,s,a,o,h,l){o===void 0&&(o=1);return this._saveToCmd(Wt._context.drawTriangles,C.create.call(this,t,e,i,r,n,s,a,o,h,l))};e.fillTexture=function(t,e,i,r,n,s,a){r===void 0&&(r=0);n===void 0&&(n=0);s===void 0&&(s="repeat");if(t&&t.getIsReady())return this._saveToCmd(Wt._context._fillTexture,h.create.call(this,t,e,i,r,n,s,a||ie.EMPTY,{}));else return null};e._saveToCmd=function(t,e){if(this._sp){this._sp._renderType|=512;this._sp._setRenderType(this._sp._renderType)}if(this._one==null){this._one=e;this._render=this._renderOne}else{this._render=this._renderAll;(this._cmds||(this._cmds=[])).length===0&&this._cmds.push(this._one);this._cmds.push(e)}this._repaint();return e};e.clipRect=function(t,e,i,r){return this._saveToCmd(Wt._context.clipRect,W.create.call(this,t,e,i,r))};e.fillText=function(t,e,i,r,n,s){return this._saveToCmd(Wt._context.fillText,Ee.create.call(this,t,e,i,r||Ri.defaultFontStr(),n,s))};e.fillBorderText=function(t,e,i,r,n,s,a,o){return this._saveToCmd(Wt._context.fillBorderText,jt.create.call(this,t,e,i,r||Ri.defaultFontStr(),n,s,a,o))};e.fillWords=function(t,e,i,r,n){return this._saveToCmd(Wt._context.fillWords,dt.create.call(this,t,e,i,r||Ri.defaultFontStr(),n))};e.fillBorderWords=function(t,e,i,r,n,s,a){return this._saveToCmd(Wt._context.fillBorderWords,ke.create.call(this,t,e,i,r||Ri.defaultFontStr(),n,s,a))};e.strokeText=function(t,e,i,r,n,s,a){return this._saveToCmd(Wt._context.fillBorderText,fe.create.call(this,t,e,i,r||Ri.defaultFontStr(),null,n,s,a))};e.alpha=function(t){return this._saveToCmd(Wt._context.alpha,ae.create.call(this,t))};e.transform=function(t,e,i){e===void 0&&(e=0);i===void 0&&(i=0);return this._saveToCmd(Wt._context._transform,mt.create.call(this,t,e,i))};e.rotate=function(t,e,i){e===void 0&&(e=0);i===void 0&&(i=0);return this._saveToCmd(Wt._context._rotate,Be.create.call(this,t,e,i))};e.scale=function(t,e,i,r){i===void 0&&(i=0);r===void 0&&(r=0);return this._saveToCmd(Wt._context._scale,se.create.call(this,t,e,i,r))};e.translate=function(t,e){return this._saveToCmd(Wt._context.translate,ee.create.call(this,t,e))};e.save=function(){return this._saveToCmd(Wt._context._save,Dt.create.call(this))};e.restore=function(){return this._saveToCmd(Wt._context.restore,N.create.call(this))};e.replaceText=function(t){this._repaint();var e=this._cmds;if(!e){if(this._one&&this._isTextCmd(this._one)){this._one.text=t;return true}}else{for(var i=e.length-1;i>-1;i--){if(this._isTextCmd(e[i])){e[i].text=t;return true}}}return false};e._isTextCmd=function(t){var e=t.cmdID;return e=="FillText"||e=="StrokeText"||e=="FillBorderText"};e.replaceTextColor=function(t){this._repaint();var e=this._cmds;if(!e){if(this._one&&this._isTextCmd(this._one)){this._setTextCmdColor(this._one,t)}}else{for(var i=e.length-1;i>-1;i--){if(this._isTextCmd(e[i])){this._setTextCmdColor(e[i],t)}}}};e._setTextCmdColor=function(t,e){var i=t.cmdID;switch(i){case"FillText":case"StrokeText":t.color=e;break;case"FillBorderText":case"FillBorderWords":case"FillBorderText":t.fillColor=e;break}};e.loadImage=function(t,e,i,r,n,s){e===void 0&&(e=0);i===void 0&&(i=0);r===void 0&&(r=0);n===void 0&&(n=0);var a=ii.getRes(t);if(!a){a=new ti;a.load(t);ii.cacheRes(t,a);a.once("ready",this,this.drawImage,[a,e,i,r,n])}else{if(!a.getIsReady()){a.once("ready",this,this.drawImage,[a,e,i,r,n])}else this.drawImage(a,e,i,r,n)}if(s!=null){a.getIsReady()?s.call(this._sp):a.on("ready",this._sp,s)}};e._renderEmpty=function(t,e,i,r){};e._renderAll=function(t,e,i,r){var n=this._cmds;for(var s=0,a=n.length;s<a;s++){n[s].run(e,i,r)}};e._renderOne=function(t,e,i,r){e.sprite=t;this._one.run(e,i,r)};e._renderOneImg=function(t,e,i,r){e.sprite=t;this._one.run(e,i,r)};e.drawLine=function(t,e,i,r,n,s){s===void 0&&(s=1);var a=s<1||s%2===0?0:.5;return this._saveToCmd(Wt._context._drawLine,ct.create.call(this,t+a,e+a,i+a,r+a,n,s,0))};e.drawLines=function(t,e,i,r,n){n===void 0&&(n=1);if(!i||i.length<4)return null;var s=n<1||n%2===0?0:.5;return this._saveToCmd(Wt._context._drawLines,be.create.call(this,t+s,e+s,i,r,n,0))};e.drawCurves=function(t,e,i,r,n){n===void 0&&(n=1);return this._saveToCmd(Wt._context.drawCurves,Ae.create.call(this,t,e,i,r,n))};e.drawRect=function(t,e,i,r,n,s,a){a===void 0&&(a=1);var o=a>=1&&s?a/2:0;var h=s?a:0;return this._saveToCmd(Wt._context.drawRect,et.create.call(this,t+o,e+o,i-h,r-h,n,s,a))};e.drawCircle=function(t,e,i,r,n,s){s===void 0&&(s=1);var a=s>=1&&n?s/2:0;return this._saveToCmd(Wt._context._drawCircle,yt.create.call(this,t,e,i-a,r,n,s,0))};e.drawPie=function(t,e,i,r,n,s,a,o){o===void 0&&(o=1);var h=o>=1&&a?o/2:0;var l=a?o:0;return this._saveToCmd(Wt._context._drawPie,A.create.call(this,t+h,e+h,i-l,xe.toRadian(r),xe.toRadian(n),s,a,o,0))};e.drawPoly=function(t,e,i,r,n,s){s===void 0&&(s=1);var a=false;if(i.length>6){a=false}else{a=true}var o=s>=1&&n?s%2===0?0:.5:0;return this._saveToCmd(Wt._context._drawPoly,G.create.call(this,t+o,e+o,i,r,n,s,a,0))};e.drawPath=function(t,e,i,r,n){return this._saveToCmd(Wt._context._drawPath,It.create.call(this,t,e,i,r,n))};e.draw9Grid=function(t,e,i,r,n,s){e===void 0&&(e=0);i===void 0&&(i=0);r===void 0&&(r=0);n===void 0&&(n=0);this._saveToCmd(null,$t.create(t,e,i,r,n,s))};d(0,e,"cmds",function(){return this._cmds},function(t){if(this._sp){this._sp._renderType|=512;this._sp._setRenderType(this._sp._renderType)}this._cmds=t;this._render=this._renderAll;this._repaint()});return t}();var ue=function(){function n(){this.reset()}v(n,"laya.utils.HTMLChar");var t=n.prototype;t.setData=function(t,e,i,r){this.char=t;this.charNum=t.charCodeAt(0);this.x=this.y=0;this.width=e;this.height=i;this.style=r;this.isWord=!n._isWordRegExp.test(t);return this};t.reset=function(){this.x=this.y=this.width=this.height=0;this.isWord=false;this.char=null;this.charNum=0;this.style=null;return this};t.recover=function(){z.recover("HTMLChar",this.reset())};t._isChar=function(){return true};t._getCSSStyle=function(){return this.style};n.create=function(){return z.getItemByClass("HTMLChar",n)};n._isWordRegExp=new RegExp("[\\w.]","");return n}();var ce=function(){function t(t,e,i){this.atlasID=0;this._width=0;this._height=0;this._texCount=0;this._rowInfo=null;this._cells=null;this._used=0;t===void 0&&(t=0);e===void 0&&(e=0);i===void 0&&(i=0);this._cells=null;this._rowInfo=null;this.atlasID=i;this._init(t,e)}v(t,"laya.webgl.text.AtlasGrid");var e=t.prototype;e.addRect=function(t,e,i,r){if(!this._get(e,i,r))return false;this._fill(r.x,r.y,e,i,t);this._texCount++;return true};e._release=function(){this._cells=null;this._rowInfo=null};e._init=function(t,e){this._width=t;this._height=e;this._release();if(this._width==0)return false;this._cells=new Uint8Array(this._width*this._height*3);this._rowInfo=new Uint8Array(this._height);this._used=0;this._clear();return true};e._get=function(t,e,i){if(t>this._width||e>this._height){return false}var r=-1;var n=-1;var s=this._width;var a=this._height;var o=this._cells;for(var h=0;h<a;h++){if(this._rowInfo[h]<t)continue;for(var l=0;l<s;){var u=(h*s+l)*3;if(o[u]!=0||o[u+1]<t||o[u+2]<e){l+=o[u+1];continue}r=l;n=h;for(var c=0;c<t;c++){if(o[3*c+u+2]<e){r=-1;break}}if(r<0){l+=o[u+1];continue}i.x=r;i.y=n;return true}}return false};e._fill=function(t,e,i,r,n){var s=this._width;var a=this._height;this._check(t+i<=s&&e+r<=a);for(var o=e;o<r+e;++o){this._check(this._rowInfo[o]>=i);this._rowInfo[o]-=i;for(var h=0;h<i;h++){var l=(t+o*s+h)*3;this._check(this._cells[l]==0);this._cells[l]=n;this._cells[l+1]=i;this._cells[l+2]=r}}if(t>0){for(o=0;o<r;++o){var u=0;for(h=t-1;h>=0;--h,++u){if(this._cells[((e+o)*s+h)*3]!=0)break}for(h=u;h>0;--h){this._cells[((e+o)*s+t-h)*3+1]=h;this._check(h>0)}}}if(e>0){for(h=t;h<t+i;++h){u=0;for(o=e-1;o>=0;--o,u++){if(this._cells[(h+o*s)*3]!=0)break}for(o=u;o>0;--o){this._cells[(h+(e-o)*s)*3+2]=o;this._check(o>0)}}}this._used+=i*r/(this._width*this._height)};e._check=function(t){if(t==false){console.log("xtexMerger 错误啦")}};e._clear=function(){this._texCount=0;for(var t=0;t<this._height;t++){this._rowInfo[t]=this._width}for(var e=0;e<this._height;e++){for(var i=0;i<this._width;i++){var r=(e*this._width+i)*3;this._cells[r]=0;this._cells[r+1]=this._width-i;this._cells[r+2]=this._width-e}}};return t}();var fe=function(){function h(){}v(h,"laya.display.cmd.StrokeTextCmd");var t=h.prototype;t.recover=function(){z.recover("StrokeTextCmd",this)};t.run=function(t,e,i){t.strokeWord(this.text,this.x+e,this.y+i,this.font,this.color,this.lineWidth,this.textAlign)};d(0,t,"cmdID",function(){return"StrokeText"});h.create=function(t,e,i,r,n,s,a){var o=z.getItemByClass("StrokeTextCmd",h);o.text=t;o.x=e;o.y=i;o.font=r;o.color=n;o.lineWidth=s;o.textAlign=a;return o};h.ID="StrokeText";return h}();var _e=function(){function t(){}v(t,"laya.webgl.text.ICharRender");var e=t.prototype;e.getWidth=function(t,e){return 0};e.scale=function(t,e){};e.getCharBmp=function(t,e,i,r,n,s,a,o,h,l,u){return null};d(0,e,"canvasWidth",function(){return 0},function(t){});return t}();var de=function(){function o(){}v(o,"laya.utils.Ease");o.linearNone=function(t,e,i,r){return i*t/r+e};o.linearIn=function(t,e,i,r){return i*t/r+e};o.linearInOut=function(t,e,i,r){return i*t/r+e};o.linearOut=function(t,e,i,r){return i*t/r+e};o.bounceIn=function(t,e,i,r){return i-o.bounceOut(r-t,0,i,r)+e};o.bounceInOut=function(t,e,i,r){if(t<r*.5)return o.bounceIn(t*2,0,i,r)*.5+e;else return o.bounceOut(t*2-r,0,i,r)*.5+i*.5+e};o.bounceOut=function(t,e,i,r){if((t/=r)<1/2.75)return i*(7.5625*t*t)+e;else if(t<2/2.75)return i*(7.5625*(t-=1.5/2.75)*t+.75)+e;else if(t<2.5/2.75)return i*(7.5625*(t-=2.25/2.75)*t+.9375)+e;else return i*(7.5625*(t-=2.625/2.75)*t+.984375)+e};o.backIn=function(t,e,i,r,n){n===void 0&&(n=1.70158);return i*(t/=r)*t*((n+1)*t-n)+e};o.backInOut=function(t,e,i,r,n){n===void 0&&(n=1.70158);if((t/=r*.5)<1)return i*.5*(t*t*(((n*=1.525)+1)*t-n))+e;return i/2*((t-=2)*t*(((n*=1.525)+1)*t+n)+2)+e};o.backOut=function(t,e,i,r,n){n===void 0&&(n=1.70158);return i*((t=t/r-1)*t*((n+1)*t+n)+1)+e};o.elasticIn=function(t,e,i,r,n,s){n===void 0&&(n=0);s===void 0&&(s=0);var a;if(t==0)return e;if((t/=r)==1)return e+i;if(!s)s=r*.3;if(!n||i>0&&n<i||i<0&&n<-i){n=i;a=s/4}else a=s/o.PI2*Math.asin(i/n);return-(n*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*o.PI2/s))+e};o.elasticInOut=function(t,e,i,r,n,s){n===void 0&&(n=0);s===void 0&&(s=0);var a;if(t==0)return e;if((t/=r*.5)==2)return e+i;if(!s)s=r*(.3*1.5);if(!n||i>0&&n<i||i<0&&n<-i){n=i;a=s/4}else a=s/o.PI2*Math.asin(i/n);if(t<1)return-.5*(n*Math.pow(2,10*(t-=1))*Math.sin((t*r-a)*o.PI2/s))+e;return n*Math.pow(2,-10*(t-=1))*Math.sin((t*r-a)*o.PI2/s)*.5+i+e};o.elasticOut=function(t,e,i,r,n,s){n===void 0&&(n=0);s===void 0&&(s=0);var a;if(t==0)return e;if((t/=r)==1)return e+i;if(!s)s=r*.3;if(!n||i>0&&n<i||i<0&&n<-i){n=i;a=s/4}else a=s/o.PI2*Math.asin(i/n);return n*Math.pow(2,-10*t)*Math.sin((t*r-a)*o.PI2/s)+i+e};o.strongIn=function(t,e,i,r){return i*(t/=r)*t*t*t*t+e};o.strongInOut=function(t,e,i,r){if((t/=r*.5)<1)return i*.5*t*t*t*t*t+e;return i*.5*((t-=2)*t*t*t*t+2)+e};o.strongOut=function(t,e,i,r){return i*((t=t/r-1)*t*t*t*t+1)+e};o.sineInOut=function(t,e,i,r){return-i*.5*(Math.cos(Math.PI*t/r)-1)+e};o.sineIn=function(t,e,i,r){return-i*Math.cos(t/r*o.HALF_PI)+i+e};o.sineOut=function(t,e,i,r){return i*Math.sin(t/r*o.HALF_PI)+e};o.quintIn=function(t,e,i,r){return i*(t/=r)*t*t*t*t+e};o.quintInOut=function(t,e,i,r){if((t/=r*.5)<1)return i*.5*t*t*t*t*t+e;return i*.5*((t-=2)*t*t*t*t+2)+e};o.quintOut=function(t,e,i,r){return i*((t=t/r-1)*t*t*t*t+1)+e};o.quartIn=function(t,e,i,r){return i*(t/=r)*t*t*t+e};o.quartInOut=function(t,e,i,r){if((t/=r*.5)<1)return i*.5*t*t*t*t+e;return-i*.5*((t-=2)*t*t*t-2)+e};o.quartOut=function(t,e,i,r){return-i*((t=t/r-1)*t*t*t-1)+e};o.cubicIn=function(t,e,i,r){return i*(t/=r)*t*t+e};o.cubicInOut=function(t,e,i,r){if((t/=r*.5)<1)return i*.5*t*t*t+e;return i*.5*((t-=2)*t*t+2)+e};o.cubicOut=function(t,e,i,r){return i*((t=t/r-1)*t*t+1)+e};o.quadIn=function(t,e,i,r){return i*(t/=r)*t+e};o.quadInOut=function(t,e,i,r){if((t/=r*.5)<1)return i*.5*t*t+e;return-i*.5*(--t*(t-2)-1)+e};o.quadOut=function(t,e,i,r){return-i*(t/=r)*(t-2)+e};o.expoIn=function(t,e,i,r){return t==0?e:i*Math.pow(2,10*(t/r-1))+e-i*.001};o.expoInOut=function(t,e,i,r){if(t==0)return e;if(t==r)return e+i;if((t/=r*.5)<1)return i*.5*Math.pow(2,10*(t-1))+e;return i*.5*(-Math.pow(2,-10*--t)+2)+e};o.expoOut=function(t,e,i,r){return t==r?e+i:i*(-Math.pow(2,-10*t/r)+1)+e};o.circIn=function(t,e,i,r){return-i*(Math.sqrt(1-(t/=r)*t)-1)+e};o.circInOut=function(t,e,i,r){if((t/=r*.5)<1)return-i*.5*(Math.sqrt(1-t*t)-1)+e;return i*.5*(Math.sqrt(1-(t-=2)*t)+1)+e};o.circOut=function(t,e,i,r){return i*Math.sqrt(1-(t=t/r-1)*t)+e};o.HALF_PI=Math.PI*.5;o.PI2=Math.PI*2;return o}();var pe=function(){function r(){this.sign=null;this.maxCount=1e3}v(r,"laya.utils.PoolCache");var t=r.prototype;t.getCacheList=function(){return z.getPoolBySign(this.sign)};t.tryDispose=function(t){var e;e=z.getPoolBySign(this.sign);if(e.length>this.maxCount){e.splice(this.maxCount,e.length-this.maxCount)}};r.addPoolCacheManager=function(t,e){e===void 0&&(e=100);var i;i=new r;i.sign=t;i.maxCount=e;st.regCacheByFunction(xe.bind(i.tryDispose,i),xe.bind(i.getCacheList,i))};return r}();var ve=function(){function h(){}v(h,"laya.webgl.utils.MatirxArray");h.ArrayMul=function(t,e,i){if(!t){h.copyArray(e,i);return}if(!e){h.copyArray(t,i);return}var r=NaN,n=NaN,s=NaN,a=NaN;for(var o=0;o<4;o++){r=t[o];n=t[o+4];s=t[o+8];a=t[o+12];i[o]=r*e[0]+n*e[1]+s*e[2]+a*e[3];i[o+4]=r*e[4]+n*e[5]+s*e[6]+a*e[7];i[o+8]=r*e[8]+n*e[9]+s*e[10]+a*e[11];i[o+12]=r*e[12]+n*e[13]+s*e[14]+a*e[15]}};h.copyArray=function(t,e){if(!t)return;if(!e)return;for(var i=0;i<t.length;i++){e[i]=t[i]}};return h}();var me=function(){function e(){}v(e,"laya.utils.Mouse");d(1,e,"cursor",function(){return e._style.cursor},function(t){e._style.cursor=t});e.hide=function(){if(e.cursor!="none"){e._preCursor=e.cursor;e.cursor="none"}};e.show=function(){if(e.cursor=="none"){if(e._preCursor){e.cursor=e._preCursor}else{e.cursor="auto"}}};e._preCursor=null;a(e,["_style",function(){return this._style=Yt.document.body.style}]);return e}();var ge=function(){function t(){}v(t,"laya.webgl.VertexArrayObject");return t}()(function(){var r={};function i(t){if(g.console&&g.console.error){g.console.error(t)}}function e(t){if(g.console&&g.console.log){g.console.log(t)}}function f(t,e){r[t]=true;if(e!==undefined){i(e)}}function n(e){var i=e.getError;e.getError=function(){var t;do{t=i.apply(e);if(t!=e.NO_ERROR){r[t]=true}}while(t!=e.NO_ERROR);for(var t in r){if(r[t]){delete r[t];return parseInt(t)}}return e.NO_ERROR}}var s=function t(e){var i=e.gl;this.ext=e;this.isAlive=true;this.hasBeenBound=false;this.elementArrayBuffer=null;this.attribs=new Array(e.maxVertexAttribs);for(var r=0;r<this.attribs.length;r++){var n=new t.VertexAttrib(i);this.attribs[r]=n}this.maxAttrib=0};s.VertexAttrib=function t(e){this.enabled=false;this.buffer=null;this.size=4;this.type=e.FLOAT;this.normalized=false;this.stride=16;this.offset=0;this.cached="";this.recache()};s.VertexAttrib.prototype.recache=function t(){this.cached=[this.size,this.type,this.normalized,this.stride,this.offset].join(":")};var a=function t(s){var l=this;this.gl=s;n(s);var u=this.original={getParameter:s.getParameter,enableVertexAttribArray:s.enableVertexAttribArray,disableVertexAttribArray:s.disableVertexAttribArray,bindBuffer:s.bindBuffer,getVertexAttrib:s.getVertexAttrib,vertexAttribPointer:s.vertexAttribPointer};s.getParameter=function t(e){if(e==l.VERTEX_ARRAY_BINDING_OES){if(l.currentVertexArrayObject==l.defaultVertexArrayObject){return null}else{return l.currentVertexArrayObject}}return u.getParameter.apply(this,arguments)};s.enableVertexAttribArray=function t(e){var i=l.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,e);var r=i.attribs[e];r.enabled=true;return u.enableVertexAttribArray.apply(this,arguments)};s.disableVertexAttribArray=function t(e){var i=l.currentVertexArrayObject;i.maxAttrib=Math.max(i.maxAttrib,e);var r=i.attribs[e];r.enabled=false;return u.disableVertexAttribArray.apply(this,arguments)};s.bindBuffer=function t(e,i){switch(e){case s.ARRAY_BUFFER:l.currentArrayBuffer=i;break;case s.ELEMENT_ARRAY_BUFFER:l.currentVertexArrayObject.elementArrayBuffer=i;break}return u.bindBuffer.apply(this,arguments)};s.getVertexAttrib=function t(e,i){var r=l.currentVertexArrayObject;var n=r.attribs[e];switch(i){case s.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:return n.buffer;case s.VERTEX_ATTRIB_ARRAY_ENABLED:return n.enabled;case s.VERTEX_ATTRIB_ARRAY_SIZE:return n.size;case s.VERTEX_ATTRIB_ARRAY_STRIDE:return n.stride;case s.VERTEX_ATTRIB_ARRAY_TYPE:return n.type;case s.VERTEX_ATTRIB_ARRAY_NORMALIZED:return n.normalized;default:return u.getVertexAttrib.apply(this,arguments)}};s.vertexAttribPointer=function t(e,i,r,n,s,a){var o=l.currentVertexArrayObject;o.maxAttrib=Math.max(o.maxAttrib,e);var h=o.attribs[e];h.buffer=l.currentArrayBuffer;h.size=i;h.type=r;h.normalized=n;h.stride=s;h.offset=a;h.recache();return u.vertexAttribPointer.apply(this,arguments)};if(s.instrumentExtension){s.instrumentExtension(this,"OES_vertex_array_object")}if(s.canvas&&s.canvas.addEventListener)s.canvas.addEventListener("webglcontextrestored",function(){e("OESVertexArrayObject emulation library context restored");l.reset_()},true);this.reset_()};a.prototype.VERTEX_ARRAY_BINDING_OES=34229;a.prototype.reset_=function t(){var e=this.vertexArrayObjects!==undefined;if(e){for(var i=0;i<this.vertexArrayObjects.length;++i){this.vertexArrayObjects.isAlive=false}}var r=this.gl;this.maxVertexAttribs=r.getParameter(r.MAX_VERTEX_ATTRIBS);this.defaultVertexArrayObject=new s(this);this.currentVertexArrayObject=null;this.currentArrayBuffer=null;this.vertexArrayObjects=[this.defaultVertexArrayObject];this.bindVertexArrayOES(null)};a.prototype.createVertexArrayOES=function t(){var e=new s(this);this.vertexArrayObjects.push(e);return e};a.prototype.deleteVertexArrayOES=function t(e){e.isAlive=false;this.vertexArrayObjects.splice(this.vertexArrayObjects.indexOf(e),1);if(this.currentVertexArrayObject==e){this.bindVertexArrayOES(null)}};a.prototype.isVertexArrayOES=function t(e){if(e&&e instanceof s){if(e.hasBeenBound&&e.ext==this){return true}}return false};a.prototype.bindVertexArrayOES=function t(e){var i=this.gl;if(e&&!e.isAlive){f(i.INVALID_OPERATION,"bindVertexArrayOES: attempt to bind deleted arrayObject");return}var r=this.original;var n=this.currentVertexArrayObject;this.currentVertexArrayObject=e||this.defaultVertexArrayObject;this.currentVertexArrayObject.hasBeenBound=true;var s=this.currentVertexArrayObject;if(n==s){return}if(!n||s.elementArrayBuffer!=n.elementArrayBuffer){r.bindBuffer.call(i,i.ELEMENT_ARRAY_BUFFER,s.elementArrayBuffer)}var a=this.currentArrayBuffer;var o=Math.max(n?n.maxAttrib:0,s.maxAttrib);for(var h=0;h<=o;h++){var l=s.attribs[h];var u=n?n.attribs[h]:null;if(!n||l.enabled!=u.enabled){if(l.enabled){r.enableVertexAttribArray.call(i,h)}else{r.disableVertexAttribArray.call(i,h)}}if(l.enabled){var c=false;if(!n||l.buffer!=u.buffer){if(a!=l.buffer){r.bindBuffer.call(i,i.ARRAY_BUFFER,l.buffer);a=l.buffer}c=true}if(c||l.cached!=u.cached){r.vertexAttribPointer.call(i,h,l.size,l.type,l.normalized,l.stride,l.offset)}}}if(this.currentArrayBuffer!=a){r.bindBuffer.call(i,i.ARRAY_BUFFER,this.currentArrayBuffer)}};g._setupVertexArrayObject=function(t){var i=t.getSupportedExtensions;t.getSupportedExtensions=function t(){var e=i.call(this)||[];if(e.indexOf("OES_vertex_array_object")<0){e.push("OES_vertex_array_object")}return e};var r=t.getExtension;t.getExtension=function t(e){var i=r.call(this,e);if(i){return i}if(e!=="OES_vertex_array_object"){return null}if(!this.__OESVertexArrayObject){console.log("Setup OES_vertex_array_object polyfill");this.__OESVertexArrayObject=new a(this)}return this.__OESVertexArrayObject}};g._forceSetupVertexArrayObject=function(t){var i=t.getSupportedExtensions;t.getSupportedExtensions=function t(){var e=i.call(this)||[];if(e.indexOf("OES_vertex_array_object")<0){e.push("OES_vertex_array_object")}return e};var r=t.getExtension;t.getExtension=function t(e){if(e==="OES_vertex_array_object"){if(!this.__OESVertexArrayObject){console.log("Setup OES_vertex_array_object polyfill");this.__OESVertexArrayObject=new a(this)}return this.__OESVertexArrayObject}else{var i=r.call(this,e);if(i){return i}else{return null}}}}}());var ye=function(){function s(){}v(s,"laya.resource.WebGLRTMgr");s.getRT=function(t,e){t=t|0;e=e|0;if(t>=1e4){console.error("getRT error! w too big")}var i=e*1e4+t;var r=s.dict[i];var n;if(r){if(r.length>0){n=r.pop();n._mgrKey=i;return n}}n=new Yi(t,e,1,-1);n._mgrKey=i;return n};s.releaseRT=function(t){if(t._mgrKey<=0)return;var e=s.dict[t._mgrKey];!e&&(e=[],s.dict[t._mgrKey]=e);t._mgrKey=0;e.push(t)};s.dict={};return s}();var xe=function(){function o(){}v(o,"laya.utils.Utils");o.toRadian=function(t){return t*o._pi2};o.toAngle=function(t){return t*o._pi};o.toHexColor=function(t){if(t<0||isNaN(t))return null;var e=t.toString(16);while(e.length<6)e="0"+e;return"#"+e};o.getGID=function(){return o._gid++};o.concatArray=function(t,e){if(!e)return t;if(!t)return e;var i=0,r=e.length;for(i=0;i<r;i++){t.push(e[i])}return t};o.clearArray=function(t){if(!t)return t;t.length=0;return t};o.copyArray=function(t,e){t||(t=[]);if(!e)return t;t.length=e.length;var i=0,r=e.length;for(i=0;i<r;i++){t[i]=e[i]}return t};o.getGlobalRecByPoints=function(t,e,i,r,n){var s;s=ie.create().setTo(e,i);s=t.localToGlobal(s);var a;a=ie.create().setTo(r,n);a=t.localToGlobal(a);var o=St._getWrapRec([s.x,s.y,a.x,a.y]);s.recover();a.recover();return o};o.getGlobalPosAndScale=function(t){return o.getGlobalRecByPoints(t,0,0,1,1)};o.bind=function(t,e){var i=t;i=t.bind(e);return i};o.measureText=function(t,e){return Pe.measureText(t,e)};o.updateOrder=function(t){if(!t||t.length<2)return false;var e=1,i=0,r=t.length,n=NaN,s;while(e<r){i=e;s=t[i];n=t[i]._zOrder;while(--i>-1){if(t[i]._zOrder>n)t[i+1]=t[i];else break}t[i+1]=s;e++}return true};o.transPointList=function(t,e,i){var r=0,n=t.length;for(r=0;r<n;r+=2){t[r]+=e;t[r+1]+=i}};o.parseInt=function(t,e){e===void 0&&(e=0);var i=Yt.window.parseInt(t,e);if(isNaN(i))return 0;return i};o.getFileExtension=function(t){o._extReg.lastIndex=t.lastIndexOf(".");var e=o._extReg.exec(t);if(e&&e.length>1){return e[1].toLowerCase()}return null};o.getTransformRelativeToWindow=function(t,e,i){var r=y.stage;var n=laya.utils.Utils.getGlobalPosAndScale(t);var s=r._canvasTransform.clone();var a=s.tx;var o=s.ty;s.rotate(-Math.PI/180*y.stage.canvasDegree);s.scale(y.stage.clientScaleX,y.stage.clientScaleY);var h=y.stage.canvasDegree%180!=0;var l=NaN,u=NaN;if(h){l=i+n.y;u=e+n.x;l*=s.d;u*=s.a;if(y.stage.canvasDegree==90){l=a-l;u+=o}else{l+=a;u=o-u}}else{l=e+n.x;u=i+n.y;l*=s.a;u*=s.d;l+=a;u+=o}u+=y.stage["_safariOffsetY"];var c=NaN,f=NaN;if(h){c=s.d*n.height;f=s.a*n.width}else{c=s.a*n.width;f=s.d*n.height}return{x:l,y:u,scaleX:c,scaleY:f}};o.fitDOMElementInArea=function(t,e,i,r,n,s){if(!t._fitLayaAirInitialized){t._fitLayaAirInitialized=true;t.style.transformOrigin=t.style.webKittransformOrigin="left top";t.style.position="absolute"}var a=o.getTransformRelativeToWindow(e,i,r);t.style.transform=t.style.webkitTransform="scale("+a.scaleX+","+a.scaleY+") rotate("+y.stage.canvasDegree+"deg)";t.style.width=n+"px";t.style.height=s+"px";t.style.left=a.x+"px";t.style.top=a.y+"px"};o.isOkTextureList=function(t){if(!t)return false;var e=0,i=t.length;var r;for(e=0;e<i;e++){r=t[e];if(!r||!r._getSource())return false}return true};o.isOKCmdList=function(t){if(!t)return false;var e=0,i=t.length;var r;var n;for(e=0;e<i;e++){r=t[e]}return true};o.getQueryString=function(t){if(Yt.onMiniGame)return null;if(!g.location||!g.location.search)return null;var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)");var i=g.location.search.substr(1).match(e);if(i!=null)return unescape(i[2]);return null};o._gid=1;o._pi=180/Math.PI;o._pi2=Math.PI/180;o._extReg=/\.(\w+)\??/g;o.parseXMLFromString=function(t){var e;t=t.replace(/>\s+</g,"><");e=(new DOMParser).parseFromString(t,"text/xml");if(e.firstChild.textContent.indexOf("This page contains the following errors")>-1){throw new Error(e.firstChild.firstChild.textContent)}return e};return o}();var Te=function(){function r(){}v(r,"laya.webgl.text.ArabicReshaper");var t=r.prototype;t.characterMapContains=function(t){for(var e=0;e<r.charsMap.length;++e){if(r.charsMap[e][0]===t){return true}}return false};t.getCharRep=function(t){for(var e=0;e<r.charsMap.length;++e){if(r.charsMap[e][0]===t){return r.charsMap[e]}}return false};t.getCombCharRep=function(t,e){for(var i=0;i<r.combCharsMap.length;++i){if(r.combCharsMap[i][0][0]===t&&r.combCharsMap[i][0][1]===e){return r.combCharsMap[i]}}return false};t.isTransparent=function(t){for(var e=0;e<r.transChars.length;++e){if(r.transChars[e]===t){return true}}return false};t.getOriginalCharsFromCode=function(t){var e=0;for(e=0;e<r.charsMap.length;++e){if(r.charsMap[e].indexOf(t)>-1){return String.fromCharCode(r.charsMap[e][0])}}for(e=0;e<r.combCharsMap.length;++e){if(r.combCharsMap[e].indexOf(t)>-1){return String.fromCharCode(r.combCharsMap[e][0][0])+String.fromCharCode(r.combCharsMap[e][0][1])}}return String.fromCharCode(t)};t.convertArabic=function(t){var e,i,r="";for(var n=0;n<t.length;++n){var s=t.charCodeAt(n);if(this.characterMapContains(s)){var a=null,o=null,h=n-1,l=n+1;for(;h>=0;--h){if(!this.isTransparent(t.charCodeAt(h))){break}}a=h>=0?t.charCodeAt(h):null;e=a?this.getCharRep(a):false;if(!e||e[2]==null&&e[3]==null){a=null}for(;l<t.length;++l){if(!this.isTransparent(t.charCodeAt(l))){break}}o=l<t.length?t.charCodeAt(l):null;e=o?this.getCharRep(o):false;if(!e||e[3]==null&&e[4]==null){o=null}if(s===1604&&o!=null&&(o===1570||o===1571||o===1573||o===1575)){i=this.getCombCharRep(s,o);if(a!=null){r+=String.fromCharCode(i[4])}else{r+=String.fromCharCode(i[1])}++n;continue}e=this.getCharRep(s);if(a!=null&&o!=null&&e[3]!=null){r+=String.fromCharCode(e[3]);continue}else if(a!=null&&e[4]!=null){r+=String.fromCharCode(e[4]);continue}else if(o!=null&&e[2]!=null){r+=String.fromCharCode(e[2]);continue}else{r+=String.fromCharCode(e[1])}}else{r+=String.fromCharCode(s)}}return r};t.convertArabicBack=function(t){var e="",i=0;var r=0;for(r=0;r<t.length;++r){i=t.charCodeAt(r);e+=this.getOriginalCharsFromCode(i)}return e};a(r,["charsMap",function(){return this.charsMap=[[1569,65152,null,null,null],[1570,65153,null,null,65154],[1571,65155,null,null,65156],[1572,65157,null,null,65158],[1573,65159,null,null,65160],[1574,65161,65163,65164,65162],[1575,65165,null,null,65166],[1576,65167,65169,65170,65168],[1577,65171,null,null,65172],[1578,65173,65175,65176,65174],[1579,65177,65179,65180,65178],[1580,65181,65183,65184,65182],[1581,65185,65187,65188,65186],[1582,65189,65191,65192,65190],[1583,65193,null,null,65194],[1584,65195,null,null,65196],[1585,65197,null,null,65198],[1586,65199,null,null,65200],[1587,65201,65203,65204,65202],[1588,65205,65207,65208,65206],[1589,65209,65211,65212,65210],[1590,65213,65215,65216,65214],[1591,65217,65219,65220,65218],[1592,65221,65223,65224,65222],[1593,65225,65227,65228,65226],[1594,65229,65231,65232,65230],[1600,1600,1600,1600,1600],[1601,65233,65235,65236,65234],[1602,65237,65239,65240,65238],[1603,65241,65243,65244,65242],[1604,65245,65247,65248,65246],[1605,65249,65251,65252,65250],[1606,65253,65255,65256,65254],[1607,65257,65259,65260,65258],[1608,65261,null,null,65262],[1609,65263,null,null,65264],[1610,65265,65267,65268,65266],[1662,64342,64344,64345,64343],[1740,64508,64510,64511,64509],[1670,64378,64380,64381,64379],[1705,64398,64400,64401,64399],[1711,64402,64404,64405,64403],[1688,64394,null,null,64395]]},"combCharsMap",function(){return this.combCharsMap=[[[1604,1570],65269,null,null,65270],[[1604,1571],65271,null,null,65272],[[1604,1573],65273,null,null,65274],[[1604,1575],65275,null,null,65276]]},"transChars",function(){return this.transChars=[1552,1554,1555,1556,1557,1611,1612,1613,1614,1615,1616,1617,1618,1619,1620,1621,1622,1623,1624,1648,1750,1751,1752,1753,1754,1755,1756,1759,1760,1761,1762,1763,1764,1767,1768,1770,1771,1772,1773]}]);return r}();var be=function(){function o(){}v(o,"laya.display.cmd.DrawLinesCmd");var t=o.prototype;t.recover=function(){this.points=null;this.lineColor=null;z.recover("DrawLinesCmd",this)};t.run=function(t,e,i){t._drawLines(this.x+e,this.y+i,this.points,this.lineColor,this.lineWidth,this.vid)};d(0,t,"cmdID",function(){return"DrawLines"});o.create=function(t,e,i,r,n,s){var a=z.getItemByClass("DrawLinesCmd",o);a.x=t;a.y=e;a.points=i;a.lineColor=r;a.lineWidth=n;a.vid=s;return a};o.ID="DrawLines";return o}();var we=function(){function a(){this._data=[];this._ndata=0;this._tex=null;this._imgId=0;this._clipid=-1;this._enbale=false;this._colorFiler=null;this._clipMatrix=new pt}v(a,"laya.webgl.text.CharSubmitCache");var t=a.prototype;t.clear=function(){this._tex=null;this._imgId=-1;this._ndata=0;this._enbale=false;this._colorFiler=null};t.destroy=function(){this.clear();this._data.length=0;this._data=null};t.add=function(t,e,i,r,n,s){if(this._ndata>0&&(this._tex!=e||this._imgId!=i||this._clipid>=0&&this._clipid!=t._clipInfoID)){this.submit(t)}this._clipid=t._clipInfoID;t._globalClipMatrix.copyTo(this._clipMatrix);this._tex=e;this._imgId=i;this._colorFiler=t._colorFiler;this._data[this._ndata]=r;this._data[this._ndata+1]=n;this._data[this._ndata+2]=s;this._ndata+=3};t.getPos=function(){if(a.__nPosPool==0)return new Array(8);return a.__posPool[--a.__nPosPool]};t.enable=function(t,e){if(t===this._enbale)return;this._enbale=t;this._enbale||this.submit(e)};t.submit=function(t){var e=this._ndata;if(!e)return;var i=t._mesh;var r=t._colorFiler;t._colorFiler=this._colorFiler;var n=Ve.create(t,i,Q.create(1,0));t._submits[t._submits._length++]=t._curSubmit=n;n.shaderValue.textureHost=this._tex;n._key.other=this._imgId;t._colorFiler=r;t._copyClipInfo(n,this._clipMatrix);n.clipInfoID=this._clipid;for(var s=0;s<e;s+=3){i.addQuad(this._data[s],this._data[s+1],this._data[s+2],true);a.__posPool[a.__nPosPool++]=this._data[s]}e/=3;n._numEle+=e*6;i.indexNum+=e*6;i.vertNum+=e*4;t._drawCount+=e;this._ndata=0;if(I.loopCount%100==0)this._data.length=0};a.__posPool=[];a.__nPosPool=0;return a}();var Ce=function(){function t(){}v(t,"Config");t.animationInterval=50;t.isAntialias=false;t.isAlpha=false;t.premultipliedAlpha=true;t.isStencil=true;t.preserveDrawingBuffer=false;t.webGL2D_MeshAllocMaxMem=true;t.is2DPixelArtGame=false;t.useWebGL2=false;t.useRetinalCanvas=false;return t}();var Ae=function(){function a(){}v(a,"laya.display.cmd.DrawCurvesCmd");var t=a.prototype;t.recover=function(){this.points=null;this.lineColor=null;z.recover("DrawCurvesCmd",this)};t.run=function(t,e,i){t.drawCurves(this.x+e,this.y+i,this.points,this.lineColor,this.lineWidth)};d(0,t,"cmdID",function(){return"DrawCurves"});a.create=function(t,e,i,r,n){var s=z.getItemByClass("DrawCurvesCmd",a);s.x=t;s.y=e;s.points=i;s.lineColor=r;s.lineWidth=n;return s};a.ID="DrawCurves";return a}();var Ee=function(){function o(){this._textIsWorldText=false;this._fontColor=4294967295;this._strokeColor=0;this._nTexAlign=0;this._fontObj=o._defFontObj}v(o,"laya.display.cmd.FillTextCmd");var t=o.prototype;t.recover=function(){z.recover("FillTextCmd",this)};t.run=function(t,e,i){if(y.stage.isGlobalRepaint()){this._textIsWorldText&&this._text.cleanCache()}if(this._textIsWorldText){t._fast_filltext(this._text,this.x+e,this.y+i,this._fontObj,this._color,null,0,this._nTexAlign,0)}else{t.drawText(this._text,this.x+e,this.y+i,this._font,this._color,this._textAlign)}};d(0,t,"text",function(){return this._text},function(t){this._text=t;this._textIsWorldText=t instanceof laya.utils.WordText;this._textIsWorldText&&this._text.cleanCache()});d(0,t,"cmdID",function(){return"FillText"});d(0,t,"color",function(){return this._color},function(t){this._color=t;this._fontColor=x.create(t).numColor;this._textIsWorldText&&this._text.cleanCache()});d(0,t,"font",function(){return this._font},function(t){this._font=t;this._fontObj=Fe.Parse(t);this._textIsWorldText&&this._text.cleanCache()});d(0,t,"textAlign",function(){return this._textAlign},function(t){this._textAlign=t;switch(t){case"center":this._nTexAlign=xt.ENUM_TEXTALIGN_CENTER;break;case"right":this._nTexAlign=xt.ENUM_TEXTALIGN_RIGHT;break;default:this._nTexAlign=xt.ENUM_TEXTALIGN_DEFAULT}this._textIsWorldText&&this._text.cleanCache()});o.create=function(t,e,i,r,n,s){var a=z.getItemByClass("FillTextCmd",o);a.text=t;a._textIsWorldText=t instanceof laya.utils.WordText;a.x=e;a.y=i;a.font=r;a.color=n;a.textAlign=s;return a};o.ID="FillText";a(o,["_defFontObj",function(){return this._defFontObj=new Fe(null)}]);return o}();var Se=function(){function t(){}v(t,"laya.webgl.shader.ShaderValue");return t}();var Me=function(){function t(){}v(t,"laya.events.KeyLocation");t.STANDARD=0;t.LEFT=1;t.RIGHT=2;t.NUM_PAD=3;return t}();var Re=function(){function n(){this._clipInfoID=-1;this.incache=false;this._globalClipMatrix=new pt;this._clipRect=new St}v(n,"laya.webgl.canvas.save.SaveClipRect");var t=n.prototype;y.imps(t,{"laya.webgl.canvas.save.ISaveData":true});t.isSaveMark=function(){return false};t.restore=function(t){this._globalClipMatrix.copyTo(t._globalClipMatrix);this._clipRect.clone(t._clipRect);t._clipInfoID=this._clipInfoID;n.POOL[n.POOL._length++]=this;t._clipInCache=this.incache};n.save=function(t){if((t._saveMark._saveuse&131072)==131072)return;t._saveMark._saveuse|=131072;var e=n.POOL;var i=e._length>0?e[--e._length]:new n;t._globalClipMatrix.copyTo(i._globalClipMatrix);t._clipRect.clone(i._clipRect);i._clipInfoID=t._clipInfoID;i.incache=t._clipInCache;var r=t._save;r[r._length++]=i};n.POOL=o._createArray();return n}();var Ie=function(){function t(){}v(t,"laya.filters.GlowFilterGLRender");var e=t.prototype;e.setShaderInfo=function(t,e,i,r){t.defines.add(r.type);var n=t;n.u_blurInfo1=r._sv_blurInfo1;var s=r._sv_blurInfo2;s[0]=e;s[1]=i;n.u_blurInfo2=s;n.u_color=r.getColor()};e.render=function(t,e,i,r,n){var s=i,a=r;var o=Q.create(1,0);this.setShaderInfo(o,s,a,n);var h=Q.create(1,0);var l=pt.TEMP.identity();e.drawTarget(t,0,0,s,a,l,o);e.drawTarget(t,0,0,s,a,l,h)};return t}();var Pe=function(){function s(){}v(s,"laya.utils.RunDriver");s.createShaderCondition=function(t){var e="(function() {return "+t+";})";return y._runScript(e)};s.fontMap=[];s.measureText=function(t,e){var i=s.hanzi.test(t);if(i&&s.fontMap[e]){return s.fontMap[e]}var r=Yt.context;r.font=e;var n=r.measureText(t);if(i)s.fontMap[e]=n;return n};s.drawToCanvas=function(t,e,i,r,n,s){n-=t.x;s-=t.y;n|=0;s|=0;i|=0;r|=0;var a=new xt;a.size(i,r);a.asBitmap=true;a._targets.start();F.renders[e]._fun(t,a,n,s);a.flush();a._targets.end();a._targets.restore();var o=a._targets.getData(0,0,i,r);a.destroy();var h=new ImageData(i,r);var l=i*4;var u=new Uint8Array(l);var c=h.data;var f=r-1;var _=f*l;var d=0;for(;f>=0;f--){c.set(o.subarray(d,d+l),_);_-=l;d+=l}var p=new Bi(true);p.size(i,r);var v=p.getContext("2d");v.putImageData(h,0,0);return p};s.drawToTexture=function(t,e,i,r,n,s){n-=t.x;s-=t.y;n|=0;s|=0;i|=0;r|=0;var a=new xt;a.size(i,r);a.asBitmap=true;a._targets.start();F.renders[e]._fun(t,a,n,s);a.flush();a._targets.end();a._targets.restore();var o=new ti(a._targets,ti.INV_UV);a.destroy(true);return o};s.changeWebGLSize=function(t,e){Bt.onStageResize(t,e)};s.clear=function(t){xt.set2DRenderConfig();At.worldScissorTest&&Bt.mainContext.disable(3089);var e=Wt.context;var i=e._submits._length==0||Ce.preserveDrawingBuffer?x.create(t).arrColor:y.stage._wgColor;if(i)e.clearBG(i[0],i[1],i[2],i[3]);else e.clearBG(0,0,0,0);At.clear()};s.enableNative=null;a(s,["hanzi",function(){return this.hanzi=new RegExp("^[一-龥]$")}]);return s}();var De=function(){function o(){}v(o,"laya.net.AtlasInfoManager");o.enable=function(t,e){y.loader.load(t,b.create(null,o._onInfoLoaded,[e]),null,"json")};o._onInfoLoaded=function(t,e){var i;var r;var n;var s=0,a=0;for(i in e){n=e[i];r=n[0];n=n[1];a=n.length;for(s=0;s<a;s++){o._fileLoadDic[r+n[s]]=i}}t&&t.run()};o.getFileLoadPath=function(t){return o._fileLoadDic[t]||t};o._fileLoadDic={};return o}();var Le=function(){function e(){}v(e,"laya.webgl.canvas.BlendMode");e._init_=function(t){e.fns=[e.BlendNormal,e.BlendAdd,e.BlendMultiply,e.BlendScreen,e.BlendOverlay,e.BlendLight,e.BlendMask,e.BlendDestinationOut];e.targetFns=[e.BlendNormalTarget,e.BlendAddTarget,e.BlendMultiplyTarget,e.BlendScreenTarget,e.BlendOverlayTarget,e.BlendLightTarget,e.BlendMask,e.BlendDestinationOut]};e.BlendNormal=function(t){ft.setBlendFunc(t,1,771)};e.BlendAdd=function(t){ft.setBlendFunc(t,1,772)};e.BlendMultiply=function(t){ft.setBlendFunc(t,774,771)};e.BlendScreen=function(t){ft.setBlendFunc(t,1,1)};e.BlendOverlay=function(t){ft.setBlendFunc(t,1,769)};e.BlendLight=function(t){ft.setBlendFunc(t,1,1)};e.BlendNormalTarget=function(t){ft.setBlendFunc(t,1,771)};e.BlendAddTarget=function(t){ft.setBlendFunc(t,1,772)};e.BlendMultiplyTarget=function(t){ft.setBlendFunc(t,774,771)};e.BlendScreenTarget=function(t){ft.setBlendFunc(t,1,1)};e.BlendOverlayTarget=function(t){ft.setBlendFunc(t,1,769)};e.BlendLightTarget=function(t){ft.setBlendFunc(t,1,1)};e.BlendMask=function(t){ft.setBlendFunc(t,0,770)};e.BlendDestinationOut=function(t){ft.setBlendFunc(t,0,0)};e.activeBlendFunction=null;e.NAMES=["normal","add","multiply","screen","overlay","light","mask","destination-out"];e.TOINT={normal:0,add:1,multiply:2,screen:3,overlay:4,light:5,mask:6,"destination-out":7,lighter:1};e.NORMAL="normal";e.ADD="add";e.MULTIPLY="multiply";e.SCREEN="screen";e.OVERLAY="overlay";e.LIGHT="light";e.MASK="mask";e.DESTINATIONOUT="destination-out";e.LIGHTER="lighter";e.fns=[];e.targetFns=[];return e}();var Be=function(){function n(){}v(n,"laya.display.cmd.RotateCmd");var t=n.prototype;t.recover=function(){z.recover("RotateCmd",this)};t.run=function(t,e,i){t._rotate(this.angle,this.pivotX+e,this.pivotY+i)};d(0,t,"cmdID",function(){return"Rotate"});n.create=function(t,e,i){var r=z.getItemByClass("RotateCmd",n);r.angle=t;r.pivotX=e;r.pivotY=i;return r};n.ID="Rotate";return n}();var Fe=function(){function i(t){this._font="14px Arial";this._family="Arial";this._size=14;this._italic=false;this._bold=false;this._id=i._gfontID++;this.setFont(t||this._font)}v(i,"laya.utils.FontInfo");var t=i.prototype;t.setFont=function(t){this._font=t;var e=t.split(" ");var i=e.length;if(i<2){if(i==1){if(e[0].indexOf("px")>0){this._size=parseInt(e[0])}}return}var r=-1;for(var n=0;n<i;n++){if(e[n].indexOf("px")>0||e[n].indexOf("pt")>0){r=n;this._size=parseInt(e[n]);if(this._size<=0){console.error("font parse error:"+t);this._size=14}break}}var s=r+1;var a=e[s];s++;for(;s<i;s++){a+=" "+e[s]}this._family=a.split(",")[0];this._italic=e.indexOf("italic")>=0;this._bold=e.indexOf("bold")>=0};i.Parse=function(t){if(t===i._lastFont){return i._lastFontInfo}var e=i._cache[t];if(!e){e=i._cache[t]=new i(t)}i._lastFont=t;i._lastFontInfo=e;return e};i.EMPTY=new i(null);i._cache={};i._gfontID=0;i._lastFont="";i._lastFontInfo=null;return i}();var Oe=function(){function g(t,e,i,r){this._clearCR=new RegExp("\r","g");var n=this;function s(t){t=t.replace(n._clearCR,"");var e=[];var i=new te(e);n._compileToTree(i,t.split("\n"),0,e,r);return i}var a=Yt.now();this._VS=s(t);this._PS=s(e);this._nameMap=i;if(Yt.now()-a>2)console.log("ShaderCompile use time:"+(Yt.now()-a)+"  size:"+t.length+"/"+e.length)}v(g,"laya.webgl.utils.ShaderCompile");var t=g.prototype;t._compileToTree=function(t,e,i,r,n){var s,a;var o,h,l;var u=0,c,f;var _=0,d=0,p=0;for(_=i;_<e.length;_++){o=e[_];if(o.length<1)continue;u=o.indexOf("//");if(u===0)continue;if(u>=0)o=o.substr(0,u);s=f||new te(r);f=null;s.text=o;s.noCompile=true;if((u=o.indexOf("#"))>=0){h="#";for(p=u+1,d=o.length;p<d;p++){var v=o.charAt(p);if(v===" "||v==="\t"||v==="?")break;h+=v}s.name=h;switch(h){case"#ifdef":case"#ifndef":s.src=o;s.noCompile=o.match(/[!&|()=<>]/)!=null;if(!s.noCompile){c=o.replace(/^\s*/,"").split(/\s+/);s.setCondition(c[1],h==="#ifdef"?1:2);s.text="//"+s.text}else{console.log("function():Boolean{return "+o.substr(u+s.name.length)+"}")}s.setParent(t);t=s;if(n){c=o.substr(p).split(g._splitToWordExps3);for(p=0;p<c.length;p++){o=c[p];o.length&&(n[o]=true)}}continue;case"#if":s.src=o;s.noCompile=true;s.setParent(t);t=s;if(n){c=o.substr(p).split(g._splitToWordExps3);for(p=0;p<c.length;p++){o=c[p];o.length&&o!="defined"&&(n[o]=true)}}continue;case"#else":s.src=o;t=t.parent;a=t.childs[t.childs.length-1];s.noCompile=a.noCompile;if(!s.noCompile){s.condition=a.condition;s.conditionType=a.conditionType==1?2:1;s.text="//"+s.text+" "+a.text+" "+s.conditionType}s.setParent(t);t=s;continue;case"#endif":t=t.parent;a=t.childs[t.childs.length-1];s.noCompile=a.noCompile;if(!s.noCompile){s.text="//"+s.text}s.setParent(t);continue;case"#include":c=g.splitToWords(o,null);var m=g.includes[c[1]];if(!m){throw"ShaderCompile error no this include file:"+c[1]}if((u=c[0].indexOf("?"))<0){s.setParent(t);o=m.getWith(c[2]=="with"?c[3]:null);this._compileToTree(s,o.split("\n"),0,r,n);s.text="";continue}s.setCondition(c[0].substr(u+1),1);s.text=m.getWith(c[2]=="with"?c[3]:null);break;case"#import":c=g.splitToWords(o,null);l=c[1];r.push({node:s,file:g.includes[l],ofs:s.text.length});continue}}else{a=t.childs[t.childs.length-1];if(a&&!a.name){r.length>0&&g.splitToWords(o,a);f=s;a.text+="\n"+o;continue}r.length>0&&g.splitToWords(o,s)}s.setParent(t)}};t.createShader=function(t,e,i,r){var n={};var s="";if(t){for(var a in t){s+="#define "+a+"\n";n[a]=true}}var o=this._VS.toscript(n,[]);var h=this._PS.toscript(n,[]);return(i||Pi.create)(s+o.join("\n"),s+h.join("\n"),e,this._nameMap,r)};g._parseOne=function(t,e,i,r,n,s){var a={type:g.shaderParamsMap[i[r+1]],name:i[r+2],size:isNaN(parseInt(i[r+3]))?1:parseInt(i[r+3])};if(s){if(n=="attribute"){t.push(a)}else{e.push(a)}}if(i[r+3]==":"){a.type=i[r+4];r+=2}r+=2;return r};g.addInclude=function(t,e){if(!e||e.length===0)throw new Error("add shader include file err:"+t);if(g.includes[t])throw new Error("add shader include file err, has add:"+t);g.includes[t]=new j(e)};g.preGetParams=function(t,e){var i=[t,e];var r={};var n=[];var s=[];var a={};var o=[];r.attributes=n;r.uniforms=s;r.defines=a;var h=0,l=0,u;for(var c=0;c<2;c++){i[c]=i[c].replace(g._removeAnnotation,"");var f=i[c].match(g._reg);var _;for(h=0,l=f.length;h<l;h++){var d=f[h];if(d!="attribute"&&d!="uniform"){if(d=="#define"){d=f[++h];o[d]=1;continue}else if(d=="#ifdef"){_=f[++h];var p=a[_]=a[_]||[];for(h++;h<l;h++){d=f[h];if(d!="attribute"&&d!="uniform"){if(d=="#else"){for(h++;h<l;h++){d=f[h];if(d!="attribute"&&d!="uniform"){if(d=="#endif"){break}continue}h=g._parseOne(n,s,f,h,d,!o[_])}}continue}h=g._parseOne(n,s,f,h,d,o[_])}}continue}h=g._parseOne(n,s,f,h,d,true)}}return r};g.splitToWords=function(t,e){var i=[];var r;var n=-1;var s;for(var a=0,o=t.length;a<o;a++){r=t.charAt(a);if(" \t=+-*/&%!<>()'\",;".indexOf(r)>=0){if(n>=0&&a-n>1){s=t.substr(n,a-n);i.push(s)}if(r=='"'||r=="'"){var h=t.indexOf(r,a+1);if(h<0){throw"Sharder err:"+t}i.push(t.substr(a+1,h-a-1));a=h;n=-1;continue}if(r=="("&&e&&i.length>0){s=i[i.length-1]+";";if("vec4;main;".indexOf(s)<0)e.useFuns+=s}n=-1;continue}if(n<0)n=a}if(n<o&&o-n>1){s=t.substr(n,o-n);i.push(s)}return i};g.IFDEF_NO=0;g.IFDEF_YES=1;g.IFDEF_ELSE=2;g.IFDEF_PARENT=3;g._removeAnnotation=new RegExp("(/\\*([^*]|[\\r\\\n]|(\\*+([^*/]|[\\r\\n])))*\\*+/)|(//.*)","g");g._reg=new RegExp("(\".*\")|('.*')|([#\\w\\*-\\.+/()=<>{}\\\\]+)|([,;:\\\\])","g");g._splitToWordExps=new RegExp("[(\".*\")]+|[('.*')]+|([ \\t=\\+\\-*/&%!<>!%(),;])","g");g.includes={};a(g,["shaderParamsMap",function(){return this.shaderParamsMap={float:5126,int:5124,bool:35670,vec2:35664,vec3:35665,vec4:35666,ivec2:35667,ivec3:35668,ivec4:35669,bvec2:35671,bvec3:35672,bvec4:35673,mat2:35674,mat3:35675,mat4:35676,sampler2D:35678,samplerCube:35680}},"_splitToWordExps3",function(){return this._splitToWordExps3=new RegExp("[ \\t=\\+\\-*/&%!<>!%(),;\\|]","g")}]);return g}();var Ne=function(){function t(){this.json=null}v(t,"laya.components.Prefab");var e=t.prototype;e.create=function(){if(this.json)return Et.createByData(null,this.json);return null};return t}();var ke=function(){function h(){}v(h,"laya.display.cmd.FillBorderWordsCmd");var t=h.prototype;t.recover=function(){this.words=null;z.recover("FillBorderWordsCmd",this)};t.run=function(t,e,i){t.fillBorderWords(this.words,this.x+e,this.y+i,this.font,this.fillColor,this.borderColor,this.lineWidth)};d(0,t,"cmdID",function(){return"FillBorderWords"});h.create=function(t,e,i,r,n,s,a){var o=z.getItemByClass("FillBorderWordsCmd",h);o.words=t;o.x=e;o.y=i;o.font=r;o.fillColor=n;o.borderColor=s;o.lineWidth=a;return o};h.ID="FillBorderWords";return h}();var Ue=function(){function f(){this._hit=null;this._unHit=null}v(f,"laya.utils.HitArea");var t=f.prototype;t.contains=function(t,e){if(!f._isHitGraphic(t,e,this.hit))return false;return!f._isHitGraphic(t,e,this.unHit)};d(0,t,"hit",function(){if(!this._hit)this._hit=new le;return this._hit},function(t){this._hit=t});d(0,t,"unHit",function(){if(!this._unHit)this._unHit=new le;return this._unHit},function(t){this._unHit=t});f._isHitGraphic=function(t,e,i){if(!i)return false;var r=i.cmds;if(!r&&i._one){r=f._cmds;r.length=1;r[0]=i._one}if(!r)return false;var n=0,s=0;s=r.length;var a;for(n=0;n<s;n++){a=r[n];if(!a)continue;switch(a.cmdID){case"Translate":t-=a.tx;e-=a.ty}if(f._isHitCmd(t,e,a))return true}return false};f._isHitCmd=function(t,e,i){if(!i)return false;var r=false;switch(i.cmdID){case"DrawRect":f._rect.setTo(i.x,i.y,i.width,i.height);r=f._rect.contains(t,e);break;case"DrawCircle":;var n=NaN;t-=i.x;e-=i.y;n=t*t+e*e;r=n<i.radius*i.radius;break;case"DrawPoly":t-=i.x;e-=i.y;r=f._ptInPolygon(t,e,i.points);break}return r};f._ptInPolygon=function(t,e,i){var r=f._ptPoint;r.setTo(t,e);var n=0;var s=NaN,a=NaN,o=NaN,h=NaN;var l=0;l=i.length;for(var u=0;u<l;u+=2){s=i[u];a=i[u+1];o=i[(u+2)%l];h=i[(u+3)%l];if(a==h)continue;if(r.y<Math.min(a,h))continue;if(r.y>=Math.max(a,h))continue;var c=(r.y-a)*(o-s)/(h-a)+s;if(c>r.x)n++}return n%2==1};f._cmds=[];a(f,["_rect",function(){return this._rect=new St},"_ptPoint",function(){return this._ptPoint=new ie}]);return f}();var We=function(){function h(){}v(h,"laya.media.SoundManager");d(1,h,"useAudioMusic",function(){return h._useAudioMusic},function(t){h._useAudioMusic=t;if(t){h._musicClass=He}else{h._musicClass=null}});d(1,h,"autoStopMusic",function(){return h._autoStopMusic},function(t){y.stage.off("blur",null,h._stageOnBlur);y.stage.off("focus",null,h._stageOnFocus);y.stage.off("visibilitychange",null,h._visibilityChange);h._autoStopMusic=t;if(t){y.stage.on("blur",null,h._stageOnBlur);y.stage.on("focus",null,h._stageOnFocus);y.stage.on("visibilitychange",null,h._visibilityChange)}});d(1,h,"muted",function(){return h._muted},function(t){if(t==h._muted)return;if(t){h.stopAllSound()}h.musicMuted=t;h._muted=t});d(1,h,"musicMuted",function(){return h._musicMuted},function(t){if(t==h._musicMuted)return;if(t){if(h._bgMusic){if(h._musicChannel&&!h._musicChannel.isStopped){if(Wt.isConchApp){if(h._musicChannel._audio)h._musicChannel._audio.muted=true}else{h._musicChannel.pause()}}else{h._musicChannel=null}}else{h._musicChannel=null}h._musicMuted=t}else{h._musicMuted=t;if(h._bgMusic){if(h._musicChannel){if(Wt.isConchApp){if(h._musicChannel._audio)h._musicChannel._audio.muted=false}else{h._musicChannel.resume()}}}}});d(1,h,"soundMuted",function(){return h._soundMuted},function(t){h._soundMuted=t});h.__init__=function(){var t=Yt.window;var e=t["AudioContext"]||t["webkitAudioContext"]||t["mozAudioContext"]?true:false;if(e)oi.initWebAudio();h._soundClass=e?oi:He;He._initMusicAudio();h._musicClass=He;return e};h.addChannel=function(t){if(h._channels.indexOf(t)>=0)return;h._channels.push(t)};h.removeChannel=function(t){var e=0;for(e=h._channels.length-1;e>=0;e--){if(h._channels[e]==t){h._channels.splice(e,1)}}};h.disposeSoundLater=function(t){h._lastSoundUsedTimeDic[t]=Yt.now();if(!h._isCheckingDispose){h._isCheckingDispose=true;y.timer.loop(5e3,null,h._checkDisposeSound)}};h._checkDisposeSound=function(){var t;var e=Yt.now();var i=false;for(t in h._lastSoundUsedTimeDic){if(e-h._lastSoundUsedTimeDic[t]>3e4){delete h._lastSoundUsedTimeDic[t];h.disposeSoundIfNotUsed(t)}else{i=true}}if(!i){h._isCheckingDispose=false;y.timer.clear(null,h._checkDisposeSound)}};h.disposeSoundIfNotUsed=function(t){var e=0;for(e=h._channels.length-1;e>=0;e--){if(h._channels[e].url==t){return}}h.destroySound(t)};h._visibilityChange=function(){if(y.stage.isVisibility){h._stageOnFocus()}else{h._stageOnBlur()}};h._stageOnBlur=function(){h._isActive=false;if(h._musicChannel){if(!h._musicChannel.isStopped){h._blurPaused=true;h._musicChannel.pause()}}h.stopAllSound();y.stage.once("mousedown",null,h._stageOnFocus)};h._recoverWebAudio=function(){if(oi.ctx&&oi.ctx.state!="running"&&oi.ctx.resume)oi.ctx.resume()};h._stageOnFocus=function(){h._isActive=true;h._recoverWebAudio();y.stage.off("mousedown",null,h._stageOnFocus);if(h._blurPaused){if(h._musicChannel&&h._musicChannel.isStopped){h._blurPaused=false;h._musicChannel.resume()}}};h.playSound=function(t,e,i,r,n){e===void 0&&(e=1);n===void 0&&(n=0);if(!h._isActive||!t)return null;if(h._muted)return null;h._recoverWebAudio();t=nt.formatURL(t);if(t==h._bgMusic){if(h._musicMuted)return null}else{if(Wt.isConchApp){var s=xe.getFileExtension(t);if(s!="wav"&&s!="ogg"){alert("The sound only supports wav or ogg format,for optimal performance reason,please refer to the official website document.");return null}}if(h._soundMuted)return null}var a;if(!Yt.onMiniGame){a=y.loader.getRes(t)}if(!r)r=h._soundClass;if(!a){a=new r;a.load(t);if(!Yt.onMiniGame){ii.cacheRes(t,a)}}var o;o=a.play(n,e);if(!o)return null;o.url=t;o.volume=t==h._bgMusic?h.musicVolume:h.soundVolume;o.completeHandler=i;return o};h.destroySound=function(t){var e=y.loader.getRes(t);if(e){ii.clearRes(t);e.dispose()}};h.playMusic=function(t,e,i,r){e===void 0&&(e=0);r===void 0&&(r=0);t=nt.formatURL(t);h._bgMusic=t;if(h._musicChannel)h._musicChannel.stop();return h._musicChannel=h.playSound(t,e,i,h._musicClass,r)};h.stopSound=function(t){t=nt.formatURL(t);var e=0;var i;for(e=h._channels.length-1;e>=0;e--){i=h._channels[e];if(i.url==t){i.stop()}}};h.stopAll=function(){h._bgMusic=null;var t=0;var e;for(t=h._channels.length-1;t>=0;t--){e=h._channels[t];e.stop()}};h.stopAllSound=function(){var t=0;var e;for(t=h._channels.length-1;t>=0;t--){e=h._channels[t];if(e.url!=h._bgMusic){e.stop()}}};h.stopMusic=function(){if(h._musicChannel)h._musicChannel.stop();h._bgMusic=null};h.setSoundVolume=function(t,e){if(e){e=nt.formatURL(e);h._setVolume(e,t)}else{h.soundVolume=t;var i=0;var r;for(i=h._channels.length-1;i>=0;i--){r=h._channels[i];if(r.url!=h._bgMusic){r.volume=t}}}};h.setMusicVolume=function(t){h.musicVolume=t;h._setVolume(h._bgMusic,t)};h._setVolume=function(t,e){t=nt.formatURL(t);var i=0;var r;for(i=h._channels.length-1;i>=0;i--){r=h._channels[i];if(r.url==t){r.volume=e}}};h.musicVolume=1;h.soundVolume=1;h.playbackRate=1;h._useAudioMusic=true;h._muted=false;h._soundMuted=false;h._musicMuted=false;h._bgMusic=null;h._musicChannel=null;h._channels=[];h._autoStopMusic=false;h._blurPaused=false;h._isActive=true;h._soundClass=null;h._musicClass=null;h._lastSoundUsedTimeDic={};h._isCheckingDispose=false;h.autoReleaseSound=true;return h}();var Ve=function(t){function a(t){t===void 0&&(t=1e4);a.__super.call(this,t)}v(a,"laya.webgl.submit.SubmitTexture",t);var e=a.prototype;e.clone=function(t,e,i){var r=a._poolSize?a.POOL[--a._poolSize]:new a;this._cloneInit(r,t,e,i);return r};e.releaseRender=function(){if(--this._ref<1){a.POOL[a._poolSize++]=this;this.shaderValue.release();this._mesh=null;this._parent&&(this._parent.releaseRender(),this._parent=null)}};e.renderSubmit=function(){if(this._numEle===0)return 1;var t=this.shaderValue.textureHost;if(t){var e=t?t._getSource():null;if(!e)return 1}var i=Bt.mainContext;this._mesh.useMesh(i);var r=T.preRender;var n=T.preRender._key;if(this._key.blendShader===0&&(this._key.submitType===n.submitType&&this._key.blendShader===n.blendShader)&&bi.activeShader&&T.preRender.clipInfoID==this.clipInfoID&&r.shaderValue.defines._value===this.shaderValue.defines._value&&(this.shaderValue.defines._value&Je.NOOPTMASK)==0){bi.activeShader.uploadTexture2D(e)}else{if(Le.activeBlendFunction!==this._blendFn){ft.setBlend(i,true);this._blendFn(i);Le.activeBlendFunction=this._blendFn}this.shaderValue.texture=e;this.shaderValue.upload()}i.drawElements(4,this._numEle,5123,this._startIdx);I.renderBatches++;I.trianglesFaces+=this._numEle/3;return 1};a.create=function(t,e,i){var r=a._poolSize?a.POOL[--a._poolSize]:new a(10016);r._mesh=e;r._key.clear();r._key.submitType=2;r._ref=1;r._startIdx=e.indexNum*bt.BYTES_PIDX;r._numEle=0;var n=t._nBlendType;r._key.blendShader=n;r._blendFn=t._targets?Le.targetFns[n]:Le.fns[n];r.shaderValue=i;if(t._colorFiler){var s=t._colorFiler;i.defines.add(s.type);i.colorMat=s._mat;i.colorAlpha=s._alpha}return r};a._poolSize=0;a.POOL=[];return a}(T);var Ge=function(t){function n(t){n.__super.call(this);if(!t)t=this._copyMatrix(n.IDENTITY_MATRIX);this._mat=new Float32Array(16);this._alpha=new Float32Array(4);this.setByMatrix(t)}v(n,"laya.filters.ColorFilter",t);var e=n.prototype;y.imps(e,{"laya.filters.IFilter":true});e.gray=function(){return this.setByMatrix(n.GRAY_MATRIX)};e.color=function(t,e,i,r){t===void 0&&(t=0);e===void 0&&(e=0);i===void 0&&(i=0);r===void 0&&(r=1);return this.setByMatrix([1,0,0,0,t,0,1,0,0,e,0,0,1,0,i,0,0,0,1,r])};e.setColor=function(t){var e=x.create(t).arrColor;var i=[0,0,0,0,256*e[0],0,0,0,0,256*e[1],0,0,0,0,256*e[2],0,0,0,1,0];return this.setByMatrix(i)};e.setByMatrix=function(t){if(this._matrix!=t)this._copyMatrix(t);var e=0;var i=0;for(var r=0;r<20;r++){if(r%5!=4){this._mat[e++]=t[r]}else{this._alpha[i++]=t[r]}}return this};e.adjustColor=function(t,e,i,r){this.adjustHue(r);this.adjustContrast(e);this.adjustBrightness(t);this.adjustSaturation(i);return this};e.adjustBrightness=function(t){t=this._clampValue(t,100);if(t==0||isNaN(t))return this;return this._multiplyMatrix([1,0,0,0,t,0,1,0,0,t,0,0,1,0,t,0,0,0,1,0,0,0,0,0,1])};e.adjustContrast=function(t){t=this._clampValue(t,100);if(t==0||isNaN(t))return this;var e=NaN;if(t<0){e=127+t/100*127}else{e=t%1;if(e==0){e=n.DELTA_INDEX[t]}else{e=n.DELTA_INDEX[t<<0]*(1-e)+n.DELTA_INDEX[(t<<0)+1]*e}e=e*127+127}var i=e/127;var r=(127-e)*.5;return this._multiplyMatrix([i,0,0,0,r,0,i,0,0,r,0,0,i,0,r,0,0,0,1,0,0,0,0,0,1])};e.adjustSaturation=function(t){t=this._clampValue(t,100);if(t==0||isNaN(t))return this;var e=1+(t>0?3*t/100:t/100);var i=1-e;var r=.3086*i;var n=.6094*i;var s=.082*i;return this._multiplyMatrix([r+e,n,s,0,0,r,n+e,s,0,0,r,n,s+e,0,0,0,0,0,1,0,0,0,0,0,1])};e.adjustHue=function(t){t=this._clampValue(t,180)/180*Math.PI;if(t==0||isNaN(t))return this;var e=Math.cos(t);var i=Math.sin(t);var r=.213;var n=.715;var s=.072;return this._multiplyMatrix([r+e*(1-r)+i*-r,n+e*-n+i*-n,s+e*-s+i*(1-s),0,0,r+e*-r+i*.143,n+e*(1-n)+i*.14,s+e*-s+i*-.283,0,0,r+e*-r+i*-(1-r),n+e*-n+i*n,s+e*(1-s)+i*s,0,0,0,0,0,1,0,0,0,0,0,1])};e.reset=function(){return this.setByMatrix(this._copyMatrix(n.IDENTITY_MATRIX))};e._multiplyMatrix=function(t){var e=[];this._matrix=this._fixMatrix(this._matrix);for(var i=0;i<5;i++){for(var r=0;r<5;r++){e[r]=this._matrix[r+i*5]}for(r=0;r<5;r++){var n=0;for(var s=0;s<5;s++){n+=t[r+s*5]*e[s]}this._matrix[r+i*5]=n}}return this.setByMatrix(this._matrix)};e._clampValue=function(t,e){return Math.min(e,Math.max(-e,t))};e._fixMatrix=function(t){if(t==null)return n.IDENTITY_MATRIX;if(t.length<25)t=t.slice(0,t.length).concat(n.IDENTITY_MATRIX.slice(t.length,25));else if(t.length>25)t=t.slice(0,25);return t};e._copyMatrix=function(t){var e=25;if(!this._matrix)this._matrix=[];for(var i=0;i<e;i++){this._matrix[i]=t[i]}return this._matrix};d(0,e,"type",function(){return 32});n.LENGTH=25;a(n,["DELTA_INDEX",function(){return this.DELTA_INDEX=[0,.01,.02,.04,.05,.06,.07,.08,.1,.11,.12,.14,.15,.16,.17,.18,.2,.21,.22,.24,.25,.27,.28,.3,.32,.34,.36,.38,.4,.42,.44,.46,.48,.5,.53,.56,.59,.62,.65,.68,.71,.74,.77,.8,.83,.86,.89,.92,.95,.98,1,1.06,1.12,1.18,1.24,1.3,1.36,1.42,1.48,1.54,1.6,1.66,1.72,1.78,1.84,1.9,1.96,2,2.12,2.25,2.37,2.5,2.62,2.75,2.87,3,3.2,3.4,3.6,3.8,4,4.3,4.7,4.9,5,5.5,6,6.5,6.8,7,7.3,7.5,7.8,8,8.4,8.7,9,9.4,9.6,9.8,10]},"GRAY_MATRIX",function(){return this.GRAY_MATRIX=[.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,.3086,.6094,.082,0,0,0,0,0,1,0]},"IDENTITY_MATRIX",function(){return this.IDENTITY_MATRIX=[1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1]}]);return n}(l);var Xe=function(t){function s(){this._matrix=new pt;this._matrix4=bt.defaultMatrix4.concat();s.__super.call(this,1e4);this.shaderValue=new Q(0,0)}v(s,"laya.webgl.submit.SubmitCanvas",t);var e=s.prototype;e.renderSubmit=function(){var t=At.worldAlpha;var e=At.worldMatrix4;var i=At.worldMatrix;var r=At.worldFilters;var n=At.worldShaderDefines;var s=this.shaderValue;var a=this._matrix;var o=this._matrix4;var h=pt.TEMP;pt.mul(a,i,h);o[0]=h.a;o[1]=h.b;o[4]=h.c;o[5]=h.d;o[12]=h.tx;o[13]=h.ty;At.worldMatrix=h.clone();At.worldMatrix4=o;At.worldAlpha=At.worldAlpha*s.alpha;if(s.filters&&s.filters.length){At.worldFilters=s.filters;At.worldShaderDefines=s.defines}this.canv["flushsubmit"]();At.worldAlpha=t;At.worldMatrix4=e;At.worldMatrix.destroy();At.worldMatrix=i;At.worldFilters=r;At.worldShaderDefines=n;return 1};e.releaseRender=function(){if(--this._ref<1){var t=s.POOL;this._mesh=null;t[t._length++]=this}};e.clone=function(t,e,i){return null};e.getRenderType=function(){return 10003};s.create=function(t,e,i){var r=!s.POOL._length?new s:s.POOL[--s.POOL._length];r.canv=t;r._ref=1;r._numEle=0;var n=r.shaderValue;n.alpha=e;n.defines.setValue(0);i&&i.length&&n.setFilters(i);return r};s.POOL=[];s.__init$=function(){{s.POOL._length=0}};return s}(T);var Ye=function(t){function e(){e.__super.call(this)}v(e,"laya.components.Script",t);var i=e.prototype;i._onAwake=function(){this.onAwake();if(this.onStart!==laya.components.Script.prototype.onStart){y.startTimer.callLater(this,this.onStart)}};i._onEnable=function(){var t=laya.components.Script.prototype;if(this.onTriggerEnter!==t.onTriggerEnter){this.owner.on("triggerenter",this,this.onTriggerEnter)}if(this.onTriggerStay!==t.onTriggerStay){this.owner.on("triggerstay",this,this.onTriggerStay)}if(this.onTriggerExit!==t.onTriggerExit){this.owner.on("triggerexit",this,this.onTriggerExit)}if(this.onMouseDown!==t.onMouseDown){this.owner.on("mousedown",this,this.onMouseDown)}if(this.onMouseUp!==t.onMouseUp){this.owner.on("mouseup",this,this.onMouseUp)}if(this.onClick!==t.onClick){this.owner.on("click",this,this.onClick)}if(this.onStageMouseDown!==t.onStageMouseDown){y.stage.on("mousedown",this,this.onStageMouseDown)}if(this.onStageMouseUp!==t.onStageMouseUp){y.stage.on("mouseup",this,this.onStageMouseUp)}if(this.onStageClick!==t.onStageClick){y.stage.on("click",this,this.onStageClick)}if(this.onStageMouseMove!==t.onStageMouseMove){y.stage.on("mousemove",this,this.onStageMouseMove)}if(this.onDoubleClick!==t.onDoubleClick){this.owner.on("doubleclick",this,this.onDoubleClick)}if(this.onRightClick!==t.onRightClick){this.owner.on("rightclick",this,this.onRightClick)}if(this.onMouseMove!==t.onMouseMove){this.owner.on("mousemove",this,this.onMouseMove)}if(this.onMouseOver!==t.onMouseOver){this.owner.on("mouseover",this,this.onMouseOver)}if(this.onMouseOut!==t.onMouseOut){this.owner.on("mouseout",this,this.onMouseOut)}if(this.onKeyDown!==t.onKeyDown){y.stage.on("keydown",this,this.onKeyDown)}if(this.onKeyPress!==t.onKeyPress){y.stage.on("keypress",this,this.onKeyPress)}if(this.onKeyUp!==t.onKeyUp){y.stage.on("keyup",this,this.onKeyUp)}if(this.onUpdate!==t.onUpdate){y.updateTimer.frameLoop(1,this,this.onUpdate)}if(this.onLateUpdate!==t.onLateUpdate){y.lateTimer.frameLoop(1,this,this.onLateUpdate)}if(this.onPreRender!==t.onPreRender){y.lateTimer.frameLoop(1,this,this.onPreRender)}};i._onDisable=function(){this.owner.offAllCaller(this);y.stage.offAllCaller(this);y.startTimer.clearAll(this);y.updateTimer.clearAll(this);y.lateTimer.clearAll(this)};i._isScript=function(){return true};i._onDestroy=function(){this.onDestroy()};i.onAwake=function(){};i.onEnable=function(){};i.onStart=function(){};i.onTriggerEnter=function(t,e,i){};i.onTriggerStay=function(t,e,i){};i.onTriggerExit=function(t,e,i){};i.onMouseDown=function(t){};i.onMouseUp=function(t){};i.onClick=function(t){};i.onStageMouseDown=function(t){};i.onStageMouseUp=function(t){};i.onStageClick=function(t){};i.onStageMouseMove=function(t){};i.onDoubleClick=function(t){};i.onRightClick=function(t){};i.onMouseMove=function(t){};i.onMouseOver=function(t){};i.onMouseOut=function(t){};i.onKeyDown=function(t){};i.onKeyPress=function(t){};i.onKeyUp=function(t){};i.onUpdate=function(){};i.onLateUpdate=function(){};i.onPreRender=function(){};i.onPostRender=function(){};i.onDisable=function(){};i.onDestroy=function(){};d(0,i,"isSingleton",function(){return false});return e}(p);var He=function(t){function a(){this.url=null;this.audio=null;this.loaded=false;a.__super.call(this)}v(a,"laya.media.h5audio.AudioSound",t);var e=a.prototype;e.dispose=function(){var t=a._audioCache[this.url];z.clearBySign("audio:"+this.url);if(t){if(!Wt.isConchApp){t.src=""}delete a._audioCache[this.url]}};e.load=function(t){t=nt.formatURL(t);this.url=t;var e;if(t==We._bgMusic){a._initMusicAudio();e=a._musicAudio;if(e.src!=t){a._audioCache[e.src]=null;e=null}}else{e=a._audioCache[t]}if(e&&e.readyState>=2){this.event("complete");return}if(!e){if(t==We._bgMusic){a._initMusicAudio();e=a._musicAudio}else{e=Yt.createElement("audio")}a._audioCache[t]=e;e.src=t}e.addEventListener("canplaythrough",r);e.addEventListener("error",n);var i=this;function r(){s();i.loaded=true;i.event("complete")}function n(){e.load=null;s();i.event("error")}function s(){e.removeEventListener("canplaythrough",r);e.removeEventListener("error",n)}this.audio=e;if(e.load){e.load()}else{n()}};e.play=function(t,e){t===void 0&&(t=0);e===void 0&&(e=0);if(!this.url)return null;var i;if(this.url==We._bgMusic){i=a._musicAudio}else{i=a._audioCache[this.url]}if(!i)return null;var r;r=z.getItem("audio:"+this.url);if(Wt.isConchApp){if(!r){r=Yt.createElement("audio");r.src=this.url}}else{if(this.url==We._bgMusic){a._initMusicAudio();r=a._musicAudio;r.src=this.url}else{r=r?r:i.cloneNode(true)}}var n=new Si(r);n.url=this.url;n.loops=e;n.startTime=t;n.play();We.addChannel(n);return n};d(0,e,"duration",function(){var t;t=a._audioCache[this.url];if(!t)return 0;return t.duration});a._initMusicAudio=function(){if(a._musicAudio)return;if(!a._musicAudio)a._musicAudio=Yt.createElement("audio");if(!Wt.isConchApp){Yt.document.addEventListener("mousedown",a._makeMusicOK)}};a._makeMusicOK=function(){Yt.document.removeEventListener("mousedown",a._makeMusicOK);if(!a._musicAudio.src){a._musicAudio.src="";a._musicAudio.load()}else{a._musicAudio.play()}};a._audioCache={};a._musicAudio=null;return a}(m);var ze=function(t){function e(){e.__super.call(this)}v(e,"laya.media.Sound",t);var i=e.prototype;i.load=function(t){};i.play=function(t,e){t===void 0&&(t=0);e===void 0&&(e=0);return null};i.dispose=function(){};d(0,i,"duration",function(){return 0});return e}(m);var je=function(t){function i(t){i.__super.call(this,116,t*4*116,4);this.canReuse=true;this.setAttributes(laya.webgl.utils.MeshParticle2D._fixattriInfo);this.createQuadIB(t);this._quadNum=t}v(i,"laya.webgl.utils.MeshParticle2D",t);var e=i.prototype;e.setMaxParticleNum=function(t){this._vb._resizeBuffer(t*4*116,false);this.createQuadIB(t)};e.releaseMesh=function(){this._vb.setByteLength(0);this.vertNum=0;this.indexNum=0;laya.webgl.utils.MeshParticle2D._POOL.push(this)};e.destroy=function(){this._ib.destroy();this._vb.destroy();this._vb.deleteBuffer()};i.getAMesh=function(t){if(laya.webgl.utils.MeshParticle2D._POOL.length){var e=laya.webgl.utils.MeshParticle2D._POOL.pop();e.setMaxParticleNum(t);return e}return new i(t)};i.const_stride=116;i._POOL=[];a(i,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5126,3,16,5126,3,28,5126,4,40,5126,4,56,5126,3,72,5126,2,84,5126,4,92,5126,1,108,5126,1,112]}]);return i}(E);var Ke=function(t){function a(){this._bits=0;this._parent=null;this.name="";this.destroyed=false;this._conchData=null;this._components=null;this._activeChangeScripts=null;this._scene=null;a.__super.call(this);this._children=a.ARRAY_EMPTY;this._extUIChild=a.ARRAY_EMPTY;this.createGLBuffer()}v(a,"laya.display.Node",t);var e=a.prototype;e.createGLBuffer=function(){};e._setBit=function(t,e){if(t===16){var i=this._getBit(t);if(i!=e)this._updateDisplayedInstage()}if(e)this._bits|=t;else this._bits&=~t};e._getBit=function(t){return(this._bits&t)!=0};e._setUpNoticeChain=function(){if(this._getBit(16))this._setBitUp(16)};e._setBitUp=function(t){var e=this;e._setBit(t,true);e=e._parent;while(e){if(e._getBit(t))return;e._setBit(t,true);e=e._parent}};e.on=function(t,e,i,r){if(t==="display"||t==="undisplay"){if(!this._getBit(16))this._setBitUp(16)}return this._createListener(t,e,i,r,false)};e.once=function(t,e,i,r){if(t==="display"||t==="undisplay"){if(!this._getBit(16))this._setBitUp(16)}return this._createListener(t,e,i,r,true)};e.destroy=function(t){t===void 0&&(t=true);this.destroyed=true;this._destroyAllComponent();this._parent&&this._parent.removeChild(this);if(this._children){if(t)this.destroyChildren();else this.removeChildren()}this.onDestroy();this._children=null;this.offAll()};e.onDestroy=function(){};e.destroyChildren=function(){if(this._children){for(var t=0,e=this._children.length;t<e;t++){this._children[0].destroy(true)}}};e.addChild=function(t){if(!t||this.destroyed||t===this)return t;if(t._zOrder)this._setBit(32,true);if(t._parent===this){var e=this.getChildIndex(t);if(e!==this._children.length-1){this._children.splice(e,1);this._children.push(t);this._childChanged()}}else{t._parent&&t._parent.removeChild(t);this._children===a.ARRAY_EMPTY&&(this._children=[]);this._children.push(t);t._setParent(this);this._childChanged()}return t};e.addInputChild=function(t){if(this._extUIChild==a.ARRAY_EMPTY){this._extUIChild=[t]}else{if(this._extUIChild.indexOf(t)>=0){return null}this._extUIChild.push(t)}return null};e.removeInputChild=function(t){var e=this._extUIChild.indexOf(t);if(e>=0){this._extUIChild.splice(e,1)}};e.addChildren=function(t){var e=arguments;var i=0,r=e.length;while(i<r){this.addChild(e[i++])}};e.addChildAt=function(t,e){if(!t||this.destroyed||t===this)return t;if(t._zOrder)this._setBit(32,true);if(e>=0&&e<=this._children.length){if(t._parent===this){var i=this.getChildIndex(t);this._children.splice(i,1);this._children.splice(e,0,t);this._childChanged()}else{t._parent&&t._parent.removeChild(t);this._children===a.ARRAY_EMPTY&&(this._children=[]);this._children.splice(e,0,t);t._setParent(this)}return t}else{throw new Error("appendChildAt:The index is out of bounds")}};e.getChildIndex=function(t){return this._children.indexOf(t)};e.getChildByName=function(t){var e=this._children;if(e){for(var i=0,r=e.length;i<r;i++){var n=e[i];if(n.name===t)return n}}return null};e.getChildAt=function(t){return this._children[t]||null};e.setChildIndex=function(t,e){var i=this._children;if(e<0||e>=i.length){throw new Error("setChildIndex:The index is out of bounds.")}var r=this.getChildIndex(t);if(r<0)throw new Error("setChildIndex:node is must child of this object.");i.splice(r,1);i.splice(e,0,t);this._childChanged();return t};e._childChanged=function(t){};e.removeChild=function(t){if(!this._children)return t;var e=this._children.indexOf(t);return this.removeChildAt(e)};e.removeSelf=function(){this._parent&&this._parent.removeChild(this);return this};e.removeChildByName=function(t){var e=this.getChildByName(t);e&&this.removeChild(e);return e};e.removeChildAt=function(t){var e=this.getChildAt(t);if(e){this._children.splice(t,1);e._setParent(null)}return e};e.removeChildren=function(t,e){t===void 0&&(t=0);e===void 0&&(e=2147483647);if(this._children&&this._children.length>0){var i=this._children;if(t===0&&e>=i.length-1){var r=i;this._children=a.ARRAY_EMPTY}else{r=i.splice(t,e-t)}for(var n=0,s=r.length;n<s;n++){r[n]._setParent(null)}}return this};e.replaceChild=function(t,e){var i=this._children.indexOf(e);if(i>-1){this._children.splice(i,1,t);e._setParent(null);t._setParent(this);return t}return null};e._setParent=function(t){if(this._parent!==t){if(t){this._parent=t;this._onAdded();this.event("added");if(this._getBit(16)){this._setUpNoticeChain();t.displayedInStage&&this._displayChild(this,true)}t._childChanged(this)}else{this._onRemoved();this.event("removed");this._parent._childChanged();if(this._getBit(16))this._displayChild(this,false);this._parent=t}}};e._updateDisplayedInstage=function(){var t;t=this;var e=y.stage;var i=false;while(t){if(t._getBit(16)){i=t._getBit(128);break}if(t===e||t._getBit(128)){i=true;break}t=t._parent}this._setBit(128,i)};e._setDisplay=function(t){if(this._getBit(128)!==t){this._setBit(128,t);if(t)this.event("display");else this.event("undisplay")}};e._displayChild=function(t,e){var i=t._children;if(i){for(var r=0,n=i.length;r<n;r++){var s=i[r];if(!s._getBit(16))continue;if(s._children.length>0){this._displayChild(s,e)}else{s._setDisplay(e)}}}t._setDisplay(e)};e.contains=function(t){if(t===this)return true;while(t){if(t._parent===this)return true;t=t._parent}return false};e.timerLoop=function(t,e,i,r,n,s){n===void 0&&(n=true);s===void 0&&(s=false);var a=this.scene?this.scene.timer:y.timer;a.loop(t,e,i,r,n,s)};e.timerOnce=function(t,e,i,r,n){n===void 0&&(n=true);var s=this.scene?this.scene.timer:y.timer;s._create(false,false,t,e,i,r,n)};e.frameLoop=function(t,e,i,r,n){n===void 0&&(n=true);var s=this.scene?this.scene.timer:y.timer;s._create(true,true,t,e,i,r,n)};e.frameOnce=function(t,e,i,r,n){n===void 0&&(n=true);var s=this.scene?this.scene.timer:y.timer;s._create(true,false,t,e,i,r,n)};e.clearTimer=function(t,e){var i=this.scene?this.scene.timer:y.timer;i.clear(t,e)};e.callLater=function(t,e){var i=this.scene?this.scene.timer:y.timer;i.callLater(this,t,e)};e.runCallLater=function(t){var e=this.scene?this.scene.timer:y.timer;e.runCallLater(this,t)};e._onActive=function(){I.spriteCount++};e._onInActive=function(){I.spriteCount--};e._onActiveInScene=function(){};e._onInActiveInScene=function(){};e._parse=function(t,e){};e._setBelongScene=function(t){if(!this._scene){this._scene=t;if(this._components){for(var e=0,i=this._components.length;e<i;e++)this._components[e]._setActiveInScene(true)}this._onActiveInScene();for(e=0,i=this._children.length;e<i;e++)this._children[e]._setBelongScene(t)}};e._setUnBelongScene=function(){if(this._scene!==this){this._onInActiveInScene();if(this._components){for(var t=0,e=this._components.length;t<e;t++)this._components[t]._setActiveInScene(false)}this._scene=null;for(t=0,e=this._children.length;t<e;t++)this._children[t]._setUnBelongScene()}};e.onAwake=function(){};e.onEnable=function(){};e._processActive=function(){this._activeChangeScripts||(this._activeChangeScripts=[]);this._activeHierarchy(this._activeChangeScripts);this._activeScripts()};e._activeHierarchy=function(t){this._setBit(2,true);if(this._components){for(var e=0,i=this._components.length;e<i;e++){var r=this._components[e];r._setActive(true);r._isScript()&&r._enabled&&t.push(r)}}this._onActive();for(e=0,i=this._children.length;e<i;e++){var n=this._children[e];!n._getBit(1)&&n._activeHierarchy(t)}if(!this._getBit(4)){this._setBit(4,true);this.onAwake()}this.onEnable()};e._activeScripts=function(){for(var t=0,e=this._activeChangeScripts.length;t<e;t++)this._activeChangeScripts[t].onEnable();this._activeChangeScripts.length=0};e._processInActive=function(){this._activeChangeScripts||(this._activeChangeScripts=[]);this._inActiveHierarchy(this._activeChangeScripts);this._inActiveScripts()};e._inActiveHierarchy=function(t){this._onInActive();if(this._components){for(var e=0,i=this._components.length;e<i;e++){var r=this._components[e];r._setActive(false);r._isScript()&&r._enabled&&t.push(r)}}this._setBit(2,false);for(e=0,i=this._children.length;e<i;e++){var n=this._children[e];n&&!n._getBit(1)&&n._inActiveHierarchy(t)}this.onDisable()};e._inActiveScripts=function(){for(var t=0,e=this._activeChangeScripts.length;t<e;t++)this._activeChangeScripts[t].onDisable();this._activeChangeScripts.length=0};e.onDisable=function(){};e._onAdded=function(){if(this._activeChangeScripts&&this._activeChangeScripts.length!==0){throw"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event."}else{var t=this._parent.scene;t&&this._setBelongScene(t);this._parent.activeInHierarchy&&this.active&&this._processActive()}};e._onRemoved=function(){if(this._activeChangeScripts&&this._activeChangeScripts.length!==0){throw"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event."}else{this._parent.activeInHierarchy&&this.active&&this._processInActive();this._parent.scene&&this._setUnBelongScene()}};e._addComponentInstance=function(t){this._components=this._components||[];this._components.push(t);t.owner=this;t._onAdded();if(this.activeInHierarchy){t._setActive(true);t._isScript()&&t._enabled&&t.onEnable()}this._scene&&t._setActiveInScene(true)};e._destroyComponent=function(t){if(this._components){for(var e=0,i=this._components.length;e<i;e++){var r=this._components[e];if(r===t){r._destroy();this._components.splice(e,1);break}}}};e._destroyAllComponent=function(){if(this._components){for(var t=0,e=this._components.length;t<e;t++){var i=this._components[t];i._destroy()}this._components.length=0}};e._cloneTo=function(t,e,i){var r=t;if(this._components){for(var n=0,s=this._components.length;n<s;n++){var a=r.addComponent(this._components[n].constructor);this._components[n]._cloneTo(a)}}};e.addComponentIntance=function(t){if(t.owner)throw"Node:the component has belong to other node.";if(t.isSingleton&&this.getComponent(t.constructor))throw"Node:the component is singleton,can't add the second one.";this._addComponentInstance(t);return t};e.addComponent=function(t){var e=z.createByClass(t);e._destroyed=false;if(e.isSingleton&&this.getComponent(t))throw"无法实例"+t+"组件"+"，"+t+"组件已存在！";this._addComponentInstance(e);return e};e.getComponent=function(t){if(this._components){for(var e=0,i=this._components.length;e<i;e++){var r=this._components[e];if(y.__typeof(r,t))return r}}return null};e.getComponents=function(t){var e;if(this._components){for(var i=0,r=this._components.length;i<r;i++){var n=this._components[i];if(y.__typeof(n,t)){e=e||[];e.push(n)}}}return e};d(0,e,"numChildren",function(){return this._children.length});d(0,e,"parent",function(){return this._parent});d(0,e,"activeInHierarchy",function(){return this._getBit(2)});d(0,e,"active",function(){return!this._getBit(8)&&!this._getBit(1)},function(t){t=!!t;if(!this._getBit(1)!==t){if(this._activeChangeScripts&&this._activeChangeScripts.length!==0){if(t)throw"Node: can't set the main inActive node active in hierarchy,if the operate is in main inActive node or it's children script's onDisable Event.";else throw"Node: can't set the main active node inActive in hierarchy,if the operate is in main active node or it's children script's onEnable Event."}else{this._setBit(1,!t);if(this._parent){if(this._parent.activeInHierarchy){if(t)this._processActive();else this._processInActive()}}}}});d(0,e,"displayedInStage",function(){if(this._getBit(16))return this._getBit(128);this._setBitUp(16);return this._getBit(128)});d(0,e,"scene",function(){return this._scene});d(0,e,"timer",function(){return this.scene?this.scene.timer:y.timer});a.ARRAY_EMPTY=[];return a}(m);var $e=function(t){function e(){this.url=null;this.loops=0;this.startTime=NaN;this.isStopped=false;this.completeHandler=null;e.__super.call(this)}v(e,"laya.media.SoundChannel",t);var i=e.prototype;i.play=function(){};i.stop=function(){if(this.completeHandler)this.completeHandler.run()};i.pause=function(){};i.resume=function(){};i.__runComplete=function(t){if(t){t.run()}};d(0,i,"volume",function(){return 1},function(t){});d(0,i,"position",function(){return 0});d(0,i,"duration",function(){return 0});return e}(m);var qe=function(t){function i(){this._id=0;this._url=null;this._cpuMemory=0;this._gpuMemory=0;this._destroyed=false;this._referenceCount=0;this.lock=false;this.name=null;i.__super.call(this);this._id=++i._uniqueIDCounter;this._destroyed=false;this._referenceCount=0;i._idResourcesMap[this.id]=this;this.lock=false}v(i,"laya.resource.Resource",t);var e=i.prototype;y.imps(e,{"laya.resource.ICreateResource":true,"laya.resource.IDestroy":true});e._setCPUMemory=function(t){var e=t-this._cpuMemory;this._cpuMemory=t;i._addCPUMemory(e)};e._setGPUMemory=function(t){var e=t-this._gpuMemory;this._gpuMemory=t;i._addGPUMemory(e)};e._setCreateURL=function(t){t=nt.formatURL(t);if(this._url!==t){var e;if(this._url){e=i._urlResourcesMap[this._url];e.splice(e.indexOf(this),1);e.length===0&&delete i._urlResourcesMap[this._url]}if(t){e=i._urlResourcesMap[t];e||(i._urlResourcesMap[t]=e=[]);e.push(this)}this._url=t}};e._addReference=function(t){t===void 0&&(t=1);this._referenceCount+=t};e._removeReference=function(t){t===void 0&&(t=1);this._referenceCount-=t};e._clearReference=function(){this._referenceCount=0};e._recoverResource=function(){};e._disposeResource=function(){};e._activeResource=function(){};e.destroy=function(){if(this._destroyed)return;this._destroyed=true;this.lock=false;this._disposeResource();delete i._idResourcesMap[this.id];var t;if(this._url){t=i._urlResourcesMap[this._url];if(t){t.splice(t.indexOf(this),1);t.length===0&&delete i._urlResourcesMap[this._url]}var e=ii.getRes(this._url);e==this&&delete ii.loadedMap[this._url]}};d(0,e,"id",function(){return this._id});d(0,e,"gpuMemory",function(){return this._gpuMemory});d(0,e,"url",function(){return this._url});d(0,e,"cpuMemory",function(){return this._cpuMemory});d(0,e,"destroyed",function(){return this._destroyed});d(0,e,"referenceCount",function(){return this._referenceCount});d(1,i,"cpuMemory",function(){return this._cpuMemory},laya.events.EventDispatcher._$SET_cpuMemory);d(1,i,"gpuMemory",function(){return this._gpuMemory},laya.events.EventDispatcher._$SET_gpuMemory);i._addCPUMemory=function(t){this._cpuMemory+=t};i._addGPUMemory=function(t){this._gpuMemory+=t};i._addMemory=function(t,e){this._cpuMemory+=t;this._gpuMemory+=e};i.getResourceByID=function(t){return i._idResourcesMap[t]};i.getResourceByURL=function(t,e){e===void 0&&(e=0);return i._urlResourcesMap[t][e]};i.destroyUnusedResources=function(){for(var t in i._idResourcesMap){var e=i._idResourcesMap[t];if(!e.lock&&e._referenceCount===0)e.destroy()}};i._uniqueIDCounter=0;i._idResourcesMap={};i._urlResourcesMap={};i._cpuMemory=0;i._gpuMemory=0;return i}(m);var Qe=function(t){function i(){i.__super.call(this,12,4,4);this.canReuse=true;this.setAttributes(laya.webgl.utils.MeshVG._fixattriInfo)}v(i,"laya.webgl.utils.MeshVG",t);var e=i.prototype;e.addVertAndIBToMesh=function(t,e,i,r){var n=this._vb.needSize(e.length/2*12);var s=n>>2;var a=this._vb._floatArray32||this._vb.getFloat32Array();var o=this._vb._uint32Array;var h=0;var l=e.length/2;for(var u=0;u<l;u++){a[s++]=e[h];a[s++]=e[h+1];h+=2;o[s++]=i}this._vb.setNeedUpload();this._ib.append(new Uint16Array(r));this._ib.setNeedUpload();this.vertNum+=l;this.indexNum+=r.length};e.releaseMesh=function(){this._vb.setByteLength(0);this._ib.setByteLength(0);this.vertNum=0;this.indexNum=0;laya.webgl.utils.MeshVG._POOL.push(this)};e.destroy=function(){this._ib.destroy();this._vb.destroy();this._ib.disposeResource();this._vb.deleteBuffer()};i.getAMesh=function(t){var e;if(laya.webgl.utils.MeshVG._POOL.length){e=laya.webgl.utils.MeshVG._POOL.pop()}else e=new i;t&&e._vb._resizeBuffer(64*1024*12,false);return e};i.const_stride=12;i._POOL=[];a(i,["_fixattriInfo",function(){return this._fixattriInfo=[5126,2,0,5121,4,8]}]);return i}(E);var Ze=function(t){var o;function s(){this._labelDic=null;this._tweenDic={};this._tweenDataList=[];this._endTweenDataList=null;this._currTime=0;this._lastTime=0;this._startTime=0;this._index=0;this._gidIndex=0;this._firstTweenDic={};this._startTimeSort=false;this._endTimeSort=false;this._loopKey=false;this.scale=1;this._frameRate=60;this._frameIndex=0;this._total=0;s.__super.call(this)}v(s,"laya.utils.TimeLine",t);var e=s.prototype;e.to=function(t,e,i,r,n){n===void 0&&(n=0);return this._create(t,e,i,r,n,true)};e.from=function(t,e,i,r,n){n===void 0&&(n=0);return this._create(t,e,i,r,n,false)};e._create=function(t,e,i,r,n,s){var a=z.getItemByClass("tweenData",o);a.isTo=s;a.type=0;a.target=t;a.duration=i;a.data=e;a.startTime=this._startTime+n;a.endTime=a.startTime+a.duration;a.ease=r;this._startTime=Math.max(a.endTime,this._startTime);this._tweenDataList.push(a);this._startTimeSort=true;this._endTimeSort=true;return this};e.addLabel=function(t,e){var i=z.getItemByClass("tweenData",o);i.type=1;i.data=t;i.endTime=i.startTime=this._startTime+e;this._labelDic||(this._labelDic={});this._labelDic[t]=i;this._tweenDataList.push(i);return this};e.removeLabel=function(t){if(this._labelDic&&this._labelDic[t]){var e=this._labelDic[t];if(e){var i=this._tweenDataList.indexOf(e);if(i>-1){this._tweenDataList.splice(i,1)}}delete this._labelDic[t]}};e.gotoTime=function(t){if(this._tweenDataList==null||this._tweenDataList.length==0)return;var e;var i;for(var r in this._firstTweenDic){i=this._firstTweenDic[r];if(i){for(var n in i){if(i.diyTarget.hasOwnProperty(n)){i.diyTarget[n]=i[n]}}}}for(r in this._tweenDic){e=this._tweenDic[r];e.clear();delete this._tweenDic[r]}this._index=0;this._gidIndex=0;this._currTime=t;this._lastTime=Yt.now();var s;if(this._endTweenDataList==null||this._endTimeSort){this._endTimeSort=false;this._endTweenDataList=s=this._tweenDataList.concat();function a(t,e){if(t.endTime>e.endTime){return 1}else if(t.endTime<e.endTime){return-1}else{return 0}}s.sort(a)}else{s=this._endTweenDataList}var o;for(var h=0,l=s.length;h<l;h++){o=s[h];if(o.type==0){if(t>=o.endTime){this._index=Math.max(this._index,h+1);var u=o.data;if(o.isTo){for(var c in u){o.target[c]=u[c]}}}else{break}}}for(h=0,l=this._tweenDataList.length;h<l;h++){o=this._tweenDataList[h];if(o.type==0){if(t>=o.startTime&&t<o.endTime){this._index=Math.max(this._index,h+1);this._gidIndex++;e=z.getItemByClass("tween",tt);e._create(o.target,o.data,o.duration,o.ease,b.create(this,this._animComplete,[this._gidIndex]),0,false,o.isTo,true,false);e.setStartTime(this._currTime-(t-o.startTime));e._updateEase(this._currTime);e.gid=this._gidIndex;this._tweenDic[this._gidIndex]=e}}}};e.gotoLabel=function(t){if(this._labelDic==null)return;var e=this._labelDic[t];if(e)this.gotoTime(e.startTime)};e.pause=function(){y.timer.clear(this,this._update)};e.resume=function(){this.play(this._currTime,this._loopKey)};e.play=function(t,e){t===void 0&&(t=0);e===void 0&&(e=false);if(!this._tweenDataList)return;if(this._startTimeSort){this._startTimeSort=false;function i(t,e){if(t.startTime>e.startTime){return 1}else if(t.startTime<e.startTime){return-1}else{return 0}}this._tweenDataList.sort(i);for(var r=0,n=this._tweenDataList.length;r<n;r++){var s=this._tweenDataList[r];if(s!=null&&s.type==0){var a=s.target;var o=a.$_GID||(a.$_GID=xe.getGID());var h=null;if(this._firstTweenDic[o]==null){h={};h.diyTarget=a;this._firstTweenDic[o]=h}else{h=this._firstTweenDic[o]}for(var l in s.data){if(h[l]==null){h[l]=a[l]}}}}}if(typeof t=="string"){this.gotoLabel(t)}else{this.gotoTime(t)}this._loopKey=e;this._lastTime=Yt.now();y.timer.frameLoop(1,this,this._update)};e._update=function(){if(this._currTime>=this._startTime){if(this._loopKey){this._complete();if(!this._tweenDataList)return;this.gotoTime(0)}else{for(var t in this._tweenDic){n=this._tweenDic[t];n.complete()}this._complete();this.pause();return}}var e=Yt.now();var i=e-this._lastTime;var r=this._currTime+=i*this.scale;this._lastTime=e;for(t in this._tweenDic){n=this._tweenDic[t];n._updateEase(r)}var n;if(this._tweenDataList.length!=0&&this._index<this._tweenDataList.length){var s=this._tweenDataList[this._index];if(r>=s.startTime){this._index++;if(s.type==0){this._gidIndex++;n=z.getItemByClass("tween",tt);n._create(s.target,s.data,s.duration,s.ease,b.create(this,this._animComplete,[this._gidIndex]),0,false,s.isTo,true,false);n.setStartTime(r);n.gid=this._gidIndex;this._tweenDic[this._gidIndex]=n;n._updateEase(r)}else{this.event("label",s.data)}}}};e._animComplete=function(t){var e=this._tweenDic[t];if(e)delete this._tweenDic[t]};e._complete=function(){this.event("complete")};e.reset=function(){var t;if(this._labelDic){for(t in this._labelDic){delete this._labelDic[t]}}var e;for(t in this._tweenDic){e=this._tweenDic[t];e.clear();delete this._tweenDic[t]}for(t in this._firstTweenDic){delete this._firstTweenDic[t]}this._endTweenDataList=null;if(this._tweenDataList&&this._tweenDataList.length){var i=0,r=0;r=this._tweenDataList.length;for(i=0;i<r;i++){if(this._tweenDataList[i])this._tweenDataList[i].destroy()}}this._tweenDataList.length=0;this._currTime=0;this._lastTime=0;this._startTime=0;this._index=0;this._gidIndex=0;this.scale=1;y.timer.clear(this,this._update)};e.destroy=function(){this.reset();this._labelDic=null;this._tweenDic=null;this._tweenDataList=null;this._firstTweenDic=null};d(0,e,"index",function(){return this._frameIndex},function(t){this._frameIndex=t;this.gotoTime(this._frameIndex/this._frameRate*1e3)});d(0,e,"total",function(){this._total=Math.floor(this._startTime/1e3*this._frameRate);return this._total});s.to=function(t,e,i,r,n){n===void 0&&(n=0);return(new s).to(t,e,i,r,n)};s.from=function(t,e,i,r,n){n===void 0&&(n=0);return(new s).from(t,e,i,r,n)};s.__init$=function(){o=function(){function t(){this.type=0;this.isTo=true;this.startTime=NaN;this.endTime=NaN;this.target=null;this.duration=NaN;this.ease=null;this.data=null}v(t,"");var e=t.prototype;e.destroy=function(){this.target=null;this.ease=null;this.data=null;this.isTo=true;this.type=0;z.recover("tweenData",this)};return t}()};return s}(m);var Je=function(t){function i(){i.__super.call(this,i.__name2int,i.__int2name,i.__int2nameMap)}v(i,"laya.webgl.shader.d2.ShaderDefines2D",t);i.__init__=function(){i.reg("TEXTURE2D",1);i.reg("PRIMITIVE",4);i.reg("GLOW_FILTER",8);i.reg("BLUR_FILTER",16);i.reg("COLOR_FILTER",32);i.reg("COLOR_ADD",64);i.reg("WORLDMAT",128);i.reg("FILLTEXTURE",256);i.reg("FSHIGHPRECISION",1024);i.reg("MVP3D",2048)};i.reg=function(t,e){k._reg(t,e,i.__name2int,i.__int2name)};i.toText=function(t,e,i){return k._toText(t,e,i)};i.toInt=function(t){return k._toInt(t,i.__name2int)};i.TEXTURE2D=1;i.PRIMITIVE=4;i.FILTERGLOW=8;i.FILTERBLUR=16;i.FILTERCOLOR=32;i.COLORADD=64;i.WORLDMAT=128;i.FILLTEXTURE=256;i.SKINMESH=512;i.SHADERDEFINE_FSHIGHPRECISION=1024;i.MVP3D=2048;i.NOOPTMASK=8|16|32|256;i.__name2int={};i.__int2name=[];i.__int2nameMap=[];return i}(k);var ti=function(t){function C(t,e,i,r){this.uvrect=[0,0,1,1];this._destroyed=false;this._referenceCount=0;this.$_GID=0;this.offsetX=0;this.offsetY=0;this._w=0;this._h=0;this.sourceWidth=0;this.sourceHeight=0;this.url=null;this.scaleRate=1;C.__super.call(this);i===void 0&&(i=0);r===void 0&&(r=0);this.setTo(t,e,i,r)}v(C,"laya.resource.Texture",t);var e=C.prototype;e._addReference=function(){this._bitmap&&this._bitmap._addReference();this._referenceCount++};e._removeReference=function(){this._bitmap&&this._bitmap._removeReference();this._referenceCount--};e._getSource=function(t){if(this._destroyed||!this._bitmap)return null;this.recoverBitmap(t);return this._bitmap.destroyed?null:this.bitmap._getSource()};e._onLoaded=function(t,e){if(!e){}else if(e==this){}else if(e instanceof laya.resource.Texture){var i=e;C._create(e,0,0,i.width,i.height,0,0,i.sourceWidth,i.sourceHeight,this)}else{this.bitmap=e;this.sourceWidth=this._w=e.width;this.sourceHeight=this._h=e.height}t&&t.run();this.event("ready",this)};e.getIsReady=function(){return this._destroyed?false:this._bitmap?true:false};e.setTo=function(t,e,i,r){i===void 0&&(i=0);r===void 0&&(r=0);this.bitmap=t;this.sourceWidth=i;this.sourceHeight=r;if(t){this._w=t.width;this._h=t.height;this.sourceWidth=this.sourceWidth||t.width;this.sourceHeight=this.sourceHeight||t.height}this.uv=e||C.DEF_UV};e.load=function(t,e){if(!this._destroyed)y.loader.load(t,b.create(this,this._onLoaded,[e]),null,"htmlimage",1,false,null,true)};e.getTexturePixels=function(t,e,i,r){var n=0,s=0,a=0;var o=this.bitmap;var h=o.width;var l=o.height;if(t+i>h)i-=t+i-h;if(e+r>l)r-=e+r-l;if(i<=0||r<=0)return null;var u=i*4;var c=null;try{c=o.getPixels()}catch(t){}if(c){if(t==0&&e==0&&i==h&&r==l)return c;var f=new Uint8Array(i*r*4);u=h*4;n=t*4;s=(e+r-1)*u+t*4;for(a=r-1;a>=0;a--){f.set(T.slice(s,s+i*4),n);n+=u;s-=u}return f}var _=new xt;_.size(i,r);_.asBitmap=true;var d=null;if(t!=0||e!=0||i!=h||r!=l){d=d.concat();var p=d[0];var v=d[1];var m=d[2]-p;var g=d[7]-v;var y=m/h;var x=g/l;d=[p+t*y,v+e*x,p+(t+i)*y,v+e*x,p+(t+i)*y,v+(e+r)*x,p+t*y,v+(e+r)*x]}_._drawTextureM(this,0,0,i,r,null,1,d);_._targets.start();_.flush();_._targets.end();_._targets.restore();var T=_._targets.getData(0,0,i,r);_.destroy();f=new Uint8Array(i*r*4);n=0;s=(r-1)*u;for(a=r-1;a>=0;a--){f.set(T.slice(s,s+u),n);n+=u;s-=u}return f};e.getPixels=function(t,e,i,r){if(Wt.isConchApp){return this._nativeObj.getImageData(t,e,i,r)}else{return this.getTexturePixels(t,e,i,r)}};e.recoverBitmap=function(e){var i=this;var t=this._bitmap.url;if(!this._destroyed&&(!this._bitmap||this._bitmap.destroyed)&&t){y.loader.load(t,b.create(this,function(t){i.bitmap=t;e&&e()}),null,"htmlimage",1,false,null,true)}};e.disposeBitmap=function(){if(!this._destroyed&&this._bitmap){this._bitmap.destroy()}};e.destroy=function(t){t===void 0&&(t=false);if(!this._destroyed){this._destroyed=true;var e=this._bitmap;if(e){e._removeReference(this._referenceCount);if(e.referenceCount===0||t)e.destroy();e=null}if(this.url&&this===y.loader.getRes(this.url))y.loader.clearRes(this.url)}};d(0,e,"height",function(){if(this._h)return this._h;if(!this.bitmap)return 0;return this.uv&&this.uv!==C.DEF_UV?(this.uv[5]-this.uv[1])*this.bitmap.height:this.bitmap.height},function(t){this._h=t;this.sourceHeight||(this.sourceHeight=t)});d(0,e,"uv",function(){return this._uv},function(t){this.uvrect[0]=Math.min(t[0],t[2],t[4],t[6]);this.uvrect[1]=Math.min(t[1],t[3],t[5],t[7]);this.uvrect[2]=Math.max(t[0],t[2],t[4],t[6])-this.uvrect[0];this.uvrect[3]=Math.max(t[1],t[3],t[5],t[7])-this.uvrect[1];this._uv=t});d(0,e,"width",function(){if(this._w)return this._w;if(!this.bitmap)return 0;return this.uv&&this.uv!==C.DEF_UV?(this.uv[2]-this.uv[0])*this.bitmap.width:this.bitmap.width},function(t){this._w=t;this.sourceWidth||(this.sourceWidth=t)});d(0,e,"bitmap",function(){return this._bitmap},function(t){this._bitmap&&this._bitmap._removeReference(this._referenceCount);this._bitmap=t;t&&t._addReference(this._referenceCount)});d(0,e,"destroyed",function(){return this._destroyed});C.moveUV=function(t,e,i){for(var r=0;r<8;r+=2){i[r]+=t;i[r+1]+=e}return i};C.create=function(t,e,i,r,n,s,a,o,h){s===void 0&&(s=0);a===void 0&&(a=0);o===void 0&&(o=0);h===void 0&&(h=0);return C._create(t,e,i,r,n,s,a,o,h)};C._create=function(t,e,i,r,n,s,a,o,h,l){s===void 0&&(s=0);a===void 0&&(a=0);o===void 0&&(o=0);h===void 0&&(h=0);var u=t instanceof laya.resource.Texture;var c=u?t.uv:C.DEF_UV;var f=u?t.bitmap:t;if(f.width&&e+r>f.width)r=f.width-e;if(f.height&&i+n>f.height)n=f.height-i;var _;if(l){_=l;_.setTo(f,null,o||r,h||n)}else{_=new C(f,null,o||r,h||n)}_.width=r;_.height=n;_.offsetX=s;_.offsetY=a;var d=1/f.width;var p=1/f.height;e*=d;i*=p;r*=d;n*=p;var v=_.uv[0],m=_.uv[1],g=_.uv[4],y=_.uv[5];var x=g-v,T=y-m;var b=C.moveUV(c[0],c[1],[e,i,e+r,i,e+r,i+n,e,i+n]);_.uv=new Float32Array([v+b[0]*x,m+b[1]*T,g-(1-b[2])*x,m+b[3]*T,g-(1-b[4])*x,y-(1-b[5])*T,v+b[6]*x,y-(1-b[7])*T]);var w=f.scaleRate;if(w&&w!=1){_.sourceWidth/=w;_.sourceHeight/=w;_.width/=w;_.height/=w;_.scaleRate=w}else{_.scaleRate=1}return _};C.createFromTexture=function(t,e,i,r,n){var s=t.scaleRate;if(s!=1){e*=s;i*=s;r*=s;n*=s}var a=St.TEMP.setTo(e-t.offsetX,i-t.offsetY,r,n);var o=a.intersection(C._rect1.setTo(0,0,t.width,t.height),C._rect2);if(o)var h=C.create(t,o.x,o.y,o.width,o.height,o.x-a.x,o.y-a.y,r,n);else return null;return h};C.DEF_UV=new Float32Array([0,0,1,0,1,1,0,1]);C.NO_UV=new Float32Array([0,0,0,0,0,0,0,0]);C.INV_UV=new Float32Array([0,1,1,1,1,0,0,0]);C._rect1=new St;C._rect2=new St;return C}(m);var ei=function(t){function e(){this._responseType=null;this._data=null;this._url=null;e.__super.call(this);this._http=new Yt.window.XMLHttpRequest}v(e,"laya.net.HttpRequest",t);var i=e.prototype;i.send=function(t,e,i,r,n){i===void 0&&(i="get");r===void 0&&(r="text");this._responseType=r;this._data=null;this._url=t;var s=this;var a=this._http;t=nt.getAdptedFilePath(t);a.open(i,t,true);if(n){for(var o=0;o<n.length;o++){a.setRequestHeader(n[o++],n[o])}}else if(!Wt.isConchApp){if(!e||typeof e=="string")a.setRequestHeader("Content-Type","application/x-www-form-urlencoded");else a.setRequestHeader("Content-Type","application/json")}a.responseType=r!=="arraybuffer"?"text":"arraybuffer";a.onerror=function(t){s._onError(t)};a.onabort=function(t){s._onAbort(t)};a.onprogress=function(t){s._onProgress(t)};a.onload=function(t){s._onLoad(t)};a.send(e)};i._onProgress=function(t){if(t&&t.lengthComputable)this.event("progress",t.loaded/t.total)};i._onAbort=function(t){this.error("Request was aborted by user")};i._onError=function(t){this.error("Request failed Status:"+this._http.status+" text:"+this._http.statusText)};i._onLoad=function(t){var e=this._http;var i=e.status!==undefined?e.status:200;if(i===200||i===204||i===0){this.complete()}else{this.error("["+e.status+"]"+e.statusText+":"+e.responseURL)}};i.error=function(t){this.clear();console.warn(this.url,t);this.event("error",t)};i.complete=function(){this.clear();var e=true;try{if(this._responseType==="json"){this._data=JSON.parse(this._http.responseText)}else if(this._responseType==="xml"){this._data=xe.parseXMLFromString(this._http.responseText)}else{this._data=this._http.response||this._http.responseText}}catch(t){e=false;this.error(t.message)}e&&this.event("complete",this._data instanceof Array?[this._data]:this._data)};i.clear=function(){var t=this._http;t.onerror=t.onabort=t.onprogress=t.onload=null};d(0,i,"url",function(){return this._url});d(0,i,"http",function(){return this._http});d(0,i,"data",function(){return this._data});return e}(m);var ii=function(t){function E(){this._data=null;this._url=null;this._type=null;this._cache=false;this._http=null;this._useWorkerLoader=false;this._customParse=false;this._constructParams=null;this._propertyParams=null;this._createCache=false;E.__super.call(this)}v(E,"laya.net.Loader",t);var e=E.prototype;e.load=function(t,e,i,r,n,s){i===void 0&&(i=true);n===void 0&&(n=false);s===void 0&&(s=false);if(!t){this.onLoaded(null);return}E.setGroup(t,"666");this._url=t;if(t.indexOf("data:image")===0)e="image";else t=nt.formatURL(t);this._type=e||(e=E.getTypeFromUrl(this._url));this._cache=i;this._useWorkerLoader=s;this._data=null;if(s)pi.enableWorkerLoader();if(!n&&E.loadedMap[t]){this._data=E.loadedMap[t];this.event("progress",1);this.event("complete",this._data);return}if(r)E.setGroup(t,r);if(E.parserMap[e]!=null){this._customParse=true;if(E.parserMap[e]instanceof laya.utils.Handler)E.parserMap[e].runWith(this);else E.parserMap[e].call(null,this);return}if(e==="image"||e==="htmlimage"||e==="nativeimage")return this._loadImage(t);if(e==="sound")return this._loadSound(t);if(e==="ttf")return this._loadTTF(t);var a;switch(e){case"atlas":case"prefab":case"plf":a="json";break;case"font":a="xml";break;case"plfb":a="arraybuffer";break;default:a=e}if(E.preLoadedMap[t]){this.onLoaded(E.preLoadedMap[t])}else{if(!this._http){this._http=new ei;this._http.on("progress",this,this.onProgress);this._http.on("error",this,this.onError);this._http.on("complete",this,this.onLoaded)}this._http.send(t,null,"get",a)}};e._loadTTF=function(t){t=nt.formatURL(t);var e=new X;e.complete=b.create(this,this.onLoaded);e.load(t)};e._loadImage=function(i){i=nt.formatURL(i);var r=this;var n;function s(){var t=n;if(t){t.onload=null;t.onerror=null;delete E._imgCache[i]}}var t=function(){s();r.event("error","Load image failed")};if(this._type==="nativeimage"){var e=function(){s();r.onLoaded(n)};n=new Yt.window.Image;n.crossOrigin="";n.onload=e;n.onerror=t;n.src=i;E._imgCache[i]=n}else{var a=xe.getFileExtension(i);if(a==="ktx"||a==="pvr"){e=function(t){var e=0;switch(a){case"ktx":e=5;break;case"pvr":e=12;break}n=new Xi(0,0,e,false,false);n.wrapModeU=1;n.wrapModeV=1;n.setCompressData(t);n._setCreateURL(i);s();r.onLoaded(n)};var o;o=new ei;o.on("error",null,t);o.on("complete",null,e);o.send(i,null,"get","arraybuffer")}else{var h=new Yt.window.Image;e=function(){var t=new Xi(h.width,h.height,1,false,false);t.wrapModeU=1;t.wrapModeV=1;t.loadImageSource(h,true);t._setCreateURL(i);s();r.onLoaded(t)};h.crossOrigin="";h.onload=e;h.onerror=t;h.src=i;E._imgCache[i]=h}}};e._loadSound=function(t){var e=new We._soundClass;var i=this;e.on("complete",this,r);e.on("error",this,n);e.load(t);function r(){s();i.onLoaded(e)}function n(){s();e.dispose();i.event("error","Load sound failed")}function s(){e.offAll()}};e.onProgress=function(t){if(this._type==="atlas")this.event("progress",t*.3);else this.event("progress",t)};e.onError=function(t){this.event("error",t)};e.onLoaded=function(t){var e=this._type;if(e=="plfb"){this.parsePLFBData(t);this.complete(t)}else if(e=="plf"){this.parsePLFData(t);this.complete(t)}else if(e==="image"){var i=new ti(t);i.url=this._url;this.complete(i)}else if(e==="sound"||e==="htmlimage"||e==="nativeimage"){this.complete(t)}else if(e==="atlas"){if(!t.url&&!t._setContext){if(!this._data){this._data=t;if(t.meta&&t.meta.image){var r=t.meta.image.split(",");var n=this._url.indexOf("/")>=0?"/":"\\";var s=this._url.lastIndexOf(n);var a=s>=0?this._url.substr(0,s+1):"";var o;if(Yt.onAndroid&&t.meta.compressTextureAndroid){o=".ktx"}if(Yt.onIOS&&t.meta.compressTextureIOS){o=".pvr"}for(var h=0,l=r.length;h<l;h++){if(o){r[h]=a+r[h].replace(".png",o)}else{r[h]=a+r[h]}}}else{r=[this._url.replace(".json",".png")]}r.reverse();t.toLoads=r;t.pics=[]}this.event("progress",.3+1/r.length*.6);return this._loadImage(r.pop())}else{this._data.pics.push(t);if(this._data.toLoads.length>0){this.event("progress",.3+1/this._data.toLoads.length*.6);return this._loadImage(this._data.toLoads.pop())}var u=this._data.frames;var c=this._url.split("?")[0];var f=this._data.meta&&this._data.meta.prefix?this._data.meta.prefix:c.substring(0,c.lastIndexOf("."))+"/";var _=this._data.pics;var d=nt.formatURL(this._url);var p=E.atlasMap[d]||(E.atlasMap[d]=[]);p.dir=f;var v=1;if(this._data.meta&&this._data.meta.scale&&this._data.meta.scale!=1){v=parseFloat(this._data.meta.scale);for(var m in u){var g=u[m];var y=_[g.frame.idx?g.frame.idx:0];var x=nt.formatURL(f+m);y.scaleRate=v;var T;T=ti._create(y,g.frame.x,g.frame.y,g.frame.w,g.frame.h,g.spriteSourceSize.x,g.spriteSourceSize.y,g.sourceSize.w,g.sourceSize.h,laya.net.Loader.getRes(x));E.cacheRes(x,T);T.url=x;p.push(x)}}else{for(m in u){g=u[m];y=_[g.frame.idx?g.frame.idx:0];x=nt.formatURL(f+m);T=ti._create(y,g.frame.x,g.frame.y,g.frame.w,g.frame.h,g.spriteSourceSize.x,g.spriteSourceSize.y,g.sourceSize.w,g.sourceSize.h,laya.net.Loader.getRes(x));E.cacheRes(x,T);T.url=x;p.push(x)}}delete this._data.pics;this.complete(this._data)}}else if(e==="font"){if(!t._source){this._data=t;this.event("progress",.5);return this._loadImage(this._url.replace(".fnt",".png"))}else{var b=new U;b.parseFont(this._data,new ti(t));var w=this._url.split(".fnt")[0].split("/");var C=w[w.length-1];Ri.registerBitmapFont(C,b);this._data=b;this.complete(this._data)}}else if(e==="prefab"){var A=new Ne;A.json=t;this.complete(A)}else{this.complete(t)}};e.parsePLFData=function(t){var e;var i;var r;for(e in t){r=t[e];switch(e){case"json":case"text":for(i in r){E.preLoadedMap[nt.formatURL(i)]=r[i]}break;default:for(i in r){E.preLoadedMap[nt.formatURL(i)]=r[i]}}}};e.parsePLFBData=function(t){var e;e=new oe(t);var i=0,r=0;r=e.getInt32();for(i=0;i<r;i++){this.parseOnePLFBFile(e)}};e.parseOnePLFBFile=function(t){var e=0;var i;var r;i=t.getUTFString();e=t.getInt32();r=t.readArrayBuffer(e);E.preLoadedMap[nt.formatURL(i)]=r};e.complete=function(t){this._data=t;if(this._customParse){this.event("loaded",t instanceof Array?[t]:t)}else{E._loaders.push(this);if(!E._isWorking)E.checkNext()}};e.endLoad=function(t){t&&(this._data=t);if(this._cache)E.cacheRes(this._url,this._data);this.event("progress",1);this.event("complete",this.data instanceof Array?[this.data]:this.data)};d(0,e,"url",function(){return this._url});d(0,e,"data",function(){return this._data});d(0,e,"cache",function(){return this._cache});d(0,e,"type",function(){return this._type});E.getTypeFromUrl=function(t){var e=xe.getFileExtension(t);if(e)return E.typeMap[e];console.warn("Not recognize the resources suffix",t);return"text"};E.checkNext=function(){E._isWorking=true;var t=Yt.now();var e=t;while(E._startIndex<E._loaders.length){e=Yt.now();E._loaders[E._startIndex].endLoad();E._startIndex++;if(Yt.now()-t>E.maxTimeOut){console.warn("loader callback cost a long time:"+(Yt.now()-t)+" url="+E._loaders[E._startIndex-1].url);y.systemTimer.frameOnce(1,null,E.checkNext);return}}E._loaders.length=0;E._startIndex=0;E._isWorking=false};E.clearRes=function(t){t=nt.formatURL(t);var e=E.getAtlas(t);if(e){for(var i=0,r=e.length;i<r;i++){var n=e[i];var s=E.getRes(n);delete E.loadedMap[n];if(s)s.destroy()}e.length=0;delete E.atlasMap[t];delete E.loadedMap[t]}else{var a=E.loadedMap[t];if(a){delete E.loadedMap[t];if(a instanceof laya.resource.Texture&&a.bitmap)a.destroy()}}};E.clearTextureRes=function(t){t=nt.formatURL(t);var e=laya.net.Loader.getAtlas(t);var i=e&&e.length>0?laya.net.Loader.getRes(e[0]):laya.net.Loader.getRes(t);if(i instanceof laya.resource.Texture)i.disposeBitmap()};E.getRes=function(t){return E.loadedMap[nt.formatURL(t)]};E.getAtlas=function(t){return E.atlasMap[nt.formatURL(t)]};E.cacheRes=function(t,e){t=nt.formatURL(t);if(E.loadedMap[t]!=null){console.warn("Resources already exist,is repeated loading:",t)}else{E.loadedMap[t]=e}};E.setGroup=function(t,e){if(!E.groupMap[e])E.groupMap[e]=[];E.groupMap[e].push(t)};E.clearResByGroup=function(t){if(!E.groupMap[t])return;var e=E.groupMap[t],i=0,r=e.length;for(i=0;i<r;i++){E.clearRes(e[i])}e.length=0};E.TEXT="text";E.JSON="json";E.PREFAB="prefab";E.XML="xml";E.BUFFER="arraybuffer";E.IMAGE="image";E.SOUND="sound";E.ATLAS="atlas";E.FONT="font";E.TTF="ttf";E.PLF="plf";E.PLFB="plfb";E.HIERARCHY="HIERARCHY";E.MESH="MESH";E.MATERIAL="MATERIAL";E.TEXTURE2D="TEXTURE2D";E.TEXTURECUBE="TEXTURECUBE";E.ANIMATIONCLIP="ANIMATIONCLIP";E.AVATAR="AVATAR";E.TERRAINHEIGHTDATA="TERRAINHEIGHTDATA";E.TERRAINRES="TERRAIN";E.typeMap={ttf:"ttf",png:"image",jpg:"image",jpeg:"image",ktx:"image",pvr:"image",txt:"text",json:"json",prefab:"prefab",xml:"xml",als:"atlas",atlas:"atlas",mp3:"sound",ogg:"sound",wav:"sound",part:"json",fnt:"font",plf:"plf",plfb:"plfb",scene:"json",ani:"json",sk:"arraybuffer"};E.parserMap={};E.maxTimeOut=100;E.groupMap={};E.loadedMap={};E.atlasMap={};E.preLoadedMap={};E._imgCache={};E._loaders=[];E._isWorking=false;E._startIndex=0;return E}(m);var ri=function(t){function e(t){this.strength=NaN;this.strength_sig2_2sig2_gauss1=[];this.strength_sig2_native=null;this.renderFunc=null;e.__super.call(this);t===void 0&&(t=4);this.strength=t;this._glRender=new Tt}v(e,"laya.filters.BlurFilter",t);var i=e.prototype;i.getStrenth_sig2_2sig2_native=function(){if(!this.strength_sig2_native){this.strength_sig2_native=new Float32Array(4)}var t=this.strength/3;var e=t*t;this.strength_sig2_native[0]=this.strength;this.strength_sig2_native[1]=e;this.strength_sig2_native[2]=2*e;this.strength_sig2_native[3]=1/(2*Math.PI*e);return this.strength_sig2_native};d(0,i,"type",function(){return 16});return e}(l);var ni=function(t){function e(){this._maxsize=0;this._upload=true;this._uploadSize=0;this._bufferSize=0;this._u8Array=null;e.__super.call(this)}v(e,"laya.webgl.utils.Buffer2D",t);var i=e.prototype;i.setByteLength=function(t){if(this._byteLength!==t){t<=this._bufferSize||this._resizeBuffer(t*2+256,true);this._byteLength=t}};i.needSize=function(t){var e=this._byteLength;if(t){var i=this._byteLength+t;i<=this._bufferSize||this._resizeBuffer(i<<1,true);this._byteLength=i}return e};i._bufferData=function(){this._maxsize=Math.max(this._maxsize,this._byteLength);if(I.loopCount%30==0){if(this._buffer.byteLength>this._maxsize+64){this._buffer=this._buffer.slice(0,this._maxsize+64);this._bufferSize=this._buffer.byteLength;this._checkArrayUse()}this._maxsize=this._byteLength}if(this._uploadSize<this._buffer.byteLength){this._uploadSize=this._buffer.byteLength;Xt.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)}Xt.instance.bufferSubData(this._bufferType,0,new Uint8Array(this._buffer,0,this._byteLength))};i._bufferSubData=function(t,e,i){t===void 0&&(t=0);e===void 0&&(e=0);i===void 0&&(i=0);this._maxsize=Math.max(this._maxsize,this._byteLength);if(I.loopCount%30==0){if(this._buffer.byteLength>this._maxsize+64){this._buffer=this._buffer.slice(0,this._maxsize+64);this._bufferSize=this._buffer.byteLength;this._checkArrayUse()}this._maxsize=this._byteLength}if(this._uploadSize<this._buffer.byteLength){this._uploadSize=this._buffer.byteLength;Xt.instance.bufferData(this._bufferType,this._uploadSize,this._bufferUsage)}if(e||i){var r=this._buffer.slice(e,i);Xt.instance.bufferSubData(this._bufferType,t,r)}else{Xt.instance.bufferSubData(this._bufferType,t,this._buffer)}};i._checkArrayUse=function(){};i._bind_uploadForVAO=function(){if(!this._upload)return false;this._upload=false;this._bindForVAO();this._bufferData();return true};i._bind_upload=function(){if(!this._upload)return false;this._upload=false;this.bind();this._bufferData();return true};i._bind_subUpload=function(t,e,i){t===void 0&&(t=0);e===void 0&&(e=0);i===void 0&&(i=0);if(!this._upload)return false;this._upload=false;this.bind();this._bufferSubData(t,e,i);return true};i._resizeBuffer=function(t,e){var i=this._buffer;if(t<=i.byteLength)return this;var r=this._u8Array;if(e&&i&&i.byteLength>0){var n=new ArrayBuffer(t);var s=r&&r.buffer==i?r:new Uint8Array(i);r=this._u8Array=new Uint8Array(n);r.set(s,0);i=this._buffer=n}else{i=this._buffer=new ArrayBuffer(t);this._u8Array=null}this._checkArrayUse();this._upload=true;this._bufferSize=i.byteLength;return this};i.append=function(t){this._upload=true;var e=0,i;e=t.byteLength;if(t instanceof Uint8Array){this._resizeBuffer(this._byteLength+e,true);i=new Uint8Array(this._buffer,this._byteLength)}else if(t instanceof Uint16Array){this._resizeBuffer(this._byteLength+e,true);i=new Uint16Array(this._buffer,this._byteLength)}else if(t instanceof Float32Array){this._resizeBuffer(this._byteLength+e,true);i=new Float32Array(this._buffer,this._byteLength)}i.set(t,0);this._byteLength+=e;this._checkArrayUse()};i.appendU16Array=function(t,e){this._resizeBuffer(this._byteLength+e*2,true);var i=new Uint16Array(this._buffer,this._byteLength,e);if(e==6){i[0]=t[0];i[1]=t[1];i[2]=t[2];i[3]=t[3];i[4]=t[4];i[5]=t[5]}else if(e>=100){i.set(new Uint16Array(t.buffer,0,e))}else{for(var r=0;r<e;r++){i[r]=t[r]}}this._byteLength+=e*2;this._checkArrayUse()};i.appendEx=function(t,e){this._upload=true;var i=0,r;i=t.byteLength;this._resizeBuffer(this._byteLength+i,true);r=new e(this._buffer,this._byteLength);r.set(t,0);this._byteLength+=i;this._checkArrayUse()};i.appendEx2=function(t,e,i,r){r===void 0&&(r=1);this._upload=true;var n=0,s;n=i*r;this._resizeBuffer(this._byteLength+n,true);s=new e(this._buffer,this._byteLength);var a=0;for(a=0;a<i;a++){s[a]=t[a]}this._byteLength+=n;this._checkArrayUse()};i.getBuffer=function(){return this._buffer};i.setNeedUpload=function(){this._upload=true};i.getNeedUpload=function(){return this._upload};i.upload=function(){var t=this._bind_upload();Xt.instance.bindBuffer(this._bufferType,null);if(this._bufferType==34962)$._bindedVertexBuffer=null;if(this._bufferType==34963)$._bindedIndexBuffer=null;bi.activeShader=null;return t};i.subUpload=function(t,e,i){t===void 0&&(t=0);e===void 0&&(e=0);i===void 0&&(i=0);var r=this._bind_subUpload();Xt.instance.bindBuffer(this._bufferType,null);if(this._bufferType==34962)$._bindedVertexBuffer=null;if(this._bufferType==34963)$._bindedIndexBuffer=null;bi.activeShader=null;return r};i._disposeResource=function(){this._upload=true;this._uploadSize=0};i.clear=function(){this._byteLength=0;this._upload=true};d(0,i,"bufferLength",function(){return this._buffer.byteLength});d(0,i,"byteLength",null,function(t){this.setByteLength(t)});e.__int__=function(t){};e.FLOAT32=4;e.SHORT=2;return e}($);var si=function(t){function n(t,e,i,r){this._sv_blurInfo2=[0,0,1,0];this._color=null;this._color_native=null;this._blurInof1_native=null;this._blurInof2_native=null;n.__super.call(this);this._elements=new Float32Array(9);this._sv_blurInfo1=new Array(4);e===void 0&&(e=4);i===void 0&&(i=6);r===void 0&&(r=6);this._color=new x(t);this.blur=Math.min(e,20);this.offX=i;this.offY=r;this._sv_blurInfo1[0]=this._sv_blurInfo1[1]=this.blur;this._sv_blurInfo1[2]=i;this._sv_blurInfo1[3]=-r;this._glRender=new Ie}v(n,"laya.filters.GlowFilter",t);var e=n.prototype;e.getColor=function(){return this._color.arrColor};e.getColorNative=function(){if(!this._color_native){this._color_native=new Float32Array(4)}var t=this.getColor();this._color_native[0]=t[0];this._color_native[1]=t[1];this._color_native[2]=t[2];this._color_native[3]=t[3];return this._color_native};e.getBlurInfo1Native=function(){if(!this._blurInof1_native){this._blurInof1_native=new Float32Array(4)}this._blurInof1_native[0]=this._blurInof1_native[1]=this.blur;this._blurInof1_native[2]=this.offX;this._blurInof1_native[3]=this.offY;return this._blurInof1_native};e.getBlurInfo2Native=function(){if(!this._blurInof2_native){this._blurInof2_native=new Float32Array(4)}this._blurInof2_native[2]=1;return this._blurInof2_native};d(0,e,"type",function(){return 8});d(0,e,"offY",function(){return this._elements[6]},function(t){this._elements[6]=t;this._sv_blurInfo1[3]=-t});d(0,e,"offX",function(){return this._elements[5]},function(t){this._elements[5]=t;this._sv_blurInfo1[2]=t});d(0,e,"blur",function(){return this._elements[4]},function(t){this._elements[4]=t;this._sv_blurInfo1[0]=this._sv_blurInfo1[1]=t});return n}(l);var ai=function(t){function i(){i.__super.call(this,24,4,4);this.canReuse=true;this.setAttributes(laya.webgl.utils.MeshQuadTexture._fixattriInfo);if(!laya.webgl.utils.MeshQuadTexture._fixib){this.createQuadIB(i._maxIB);laya.webgl.utils.MeshQuadTexture._fixib=this._ib}else{this._ib=laya.webgl.utils.MeshQuadTexture._fixib;this._quadNum=i._maxIB}}v(i,"laya.webgl.utils.MeshQuadTexture",t);var e=i.prototype;e.releaseMesh=function(){this._vb.setByteLength(0);this.vertNum=0;this.indexNum=0;laya.webgl.utils.MeshQuadTexture._POOL.push(this)};e.destroy=function(){this._vb.destroy();this._vb.deleteBuffer()};e.addQuad=function(t,e,i,r){var n=this._vb;var s=n._byteLength>>2;n.setByteLength(s+24<<2);var a=n._floatArray32||n.getFloat32Array();var o=n._uint32Array;var h=s;var l=r?255:0;a[h++]=t[0];a[h++]=t[1];a[h++]=e[0];a[h++]=e[1];o[h++]=i;o[h++]=l;a[h++]=t[2];a[h++]=t[3];a[h++]=e[2];a[h++]=e[3];o[h++]=i;o[h++]=l;a[h++]=t[4];a[h++]=t[5];a[h++]=e[4];a[h++]=e[5];o[h++]=i;o[h++]=l;a[h++]=t[6];a[h++]=t[7];a[h++]=e[6];a[h++]=e[7];o[h++]=i;o[h++]=l;n._upload=true};i.getAMesh=function(t){var e=null;if(laya.webgl.utils.MeshQuadTexture._POOL.length){e=laya.webgl.utils.MeshQuadTexture._POOL.pop()}else e=new i;t&&e._vb._resizeBuffer(64*1024*24,false);return e};i.const_stride=24;i._fixib=null;i._maxIB=16*1024;i._POOL=[];a(i,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]);return i}(E);var oi=function(t){function r(){this.url=null;this.loaded=false;this.data=null;this.audioBuffer=null;this.__toPlays=null;this._disposed=false;r.__super.call(this)}v(r,"laya.media.webaudio.WebAudioSound",t);var e=r.prototype;e.load=function(t){var e=this;t=nt.formatURL(t);this.url=t;this.audioBuffer=r._dataCache[t];if(this.audioBuffer){this._loaded(this.audioBuffer);return}r.e.on("loaded:"+t,this,this._loaded);r.e.on("err:"+t,this,this._err);if(r.__loadingSound[t]){return}r.__loadingSound[t]=true;var i=new Yt.window.XMLHttpRequest;i.open("GET",t,true);i.responseType="arraybuffer";i.onload=function(){if(e._disposed){e._removeLoadEvents();return}e.data=i.response;r.buffs.push({buffer:e.data,url:e.url});r.decode()};i.onerror=function(t){e._err()};i.send()};e._err=function(){this._removeLoadEvents();r.__loadingSound[this.url]=false;this.event("error")};e._loaded=function(t){this._removeLoadEvents();if(this._disposed){return}this.audioBuffer=t;r._dataCache[this.url]=this.audioBuffer;this.loaded=true;this.event("complete")};e._removeLoadEvents=function(){r.e.off("loaded:"+this.url,this,this._loaded);r.e.off("err:"+this.url,this,this._err)};e.__playAfterLoaded=function(){if(!this.__toPlays)return;var t=0,e=0;var i;i=this.__toPlays;e=i.length;var r;for(t=0;t<e;t++){r=i[t];if(r[2]&&!r[2].isStopped){this.play(r[0],r[1],r[2])}}this.__toPlays.length=0};e.play=function(t,e,i){t===void 0&&(t=0);e===void 0&&(e=0);i=i?i:new Ei;if(!this.audioBuffer){if(this.url){if(!this.__toPlays)this.__toPlays=[];this.__toPlays.push([t,e,i]);this.once("complete",this,this.__playAfterLoaded);this.load(this.url)}}i.url=this.url;i.loops=e;i["audioBuffer"]=this.audioBuffer;i.startTime=t;i.play();We.addChannel(i);return i};e.dispose=function(){this._disposed=true;delete r._dataCache[this.url];delete r.__loadingSound[this.url];this.audioBuffer=null;this.data=null;this.__toPlays=[]};d(0,e,"duration",function(){if(this.audioBuffer){return this.audioBuffer.duration}return 0});r.decode=function(){if(r.buffs.length<=0||r.isDecoding){return}r.isDecoding=true;r.tInfo=r.buffs.shift();r.ctx.decodeAudioData(r.tInfo["buffer"],r._done,r._fail)};r._done=function(t){r.e.event("loaded:"+r.tInfo.url,t);r.isDecoding=false;r.decode()};r._fail=function(){r.e.event("err:"+r.tInfo.url,null);r.isDecoding=false;r.decode()};r._playEmptySound=function(){if(r.ctx==null){return}var t=r.ctx.createBufferSource();t.buffer=r._miniBuffer;t.connect(r.ctx.destination);t.start(0,0,0)};r._unlock=function(){if(r._unlocked){return}r._playEmptySound();if(r.ctx.state=="running"){Yt.document.removeEventListener("mousedown",r._unlock,true);Yt.document.removeEventListener("touchend",r._unlock,true);Yt.document.removeEventListener("touchstart",r._unlock,true);r._unlocked=true}};r.initWebAudio=function(){if(r.ctx.state!="running"){r._unlock();Yt.document.addEventListener("mousedown",r._unlock,true);Yt.document.addEventListener("touchend",r._unlock,true);Yt.document.addEventListener("touchstart",r._unlock,true)}};r._dataCache={};r.buffs=[];r.isDecoding=false;r._unlocked=false;r.tInfo=null;r.__loadingSound={};a(r,["window",function(){return this.window=Yt.window},"webAudioEnabled",function(){return this.webAudioEnabled=r.window["AudioContext"]||r.window["webkitAudioContext"]||r.window["mozAudioContext"]},"ctx",function(){return this.ctx=r.webAudioEnabled?new(r.window["AudioContext"]||r.window["webkitAudioContext"]||r.window["mozAudioContext"]):undefined},"_miniBuffer",function(){return this._miniBuffer=r.ctx.createBuffer(1,1,22050)},"e",function(){return this.e=new m}]);return r}(m);var hi=function(t){function n(t,e,i,r){this._endian=null;this._socket=null;this._connected=false;this._addInputPosition=0;this._input=null;this._output=null;this.disableInput=false;this._byteClass=null;this.protocols=[];n.__super.call(this);e===void 0&&(e=0);this._byteClass=i?i:oe;this.protocols=r;this.endian="bigEndian";if(t&&e>0&&e<65535)this.connect(t,e)}v(n,"laya.net.Socket",t);var e=n.prototype;e.connect=function(t,e){var i="ws://"+t+":"+e;this.connectByUrl(i)};e.connectByUrl=function(t){var e=this;if(this._socket!=null)this.close();this._socket&&this.cleanSocket();if(!this.protocols||this.protocols.length==0){this._socket=new Yt.window.WebSocket(t)}else{this._socket=new Yt.window.WebSocket(t,this.protocols)}this._socket.binaryType="arraybuffer";this._output=new this._byteClass;this._output.endian=this.endian;this._input=new this._byteClass;this._input.endian=this.endian;this._addInputPosition=0;this._socket.onopen=function(t){e._onOpen(t)};this._socket.onmessage=function(t){e._onMessage(t)};this._socket.onclose=function(t){e._onClose(t)};this._socket.onerror=function(t){e._onError(t)}};e.cleanSocket=function(){this.close();this._connected=false;this._socket.onopen=null;this._socket.onmessage=null;this._socket.onclose=null;this._socket.onerror=null;this._socket=null};e.close=function(){if(this._socket!=null){try{this._socket.close()}catch(t){}}};e._onOpen=function(t){this._connected=true;this.event("open",t)};e._onMessage=function(t){if(!t||!t.data)return;var e=t.data;if(this.disableInput&&e){this.event("message",e);return}if(this._input.length>0&&this._input.bytesAvailable<1){this._input.clear();this._addInputPosition=0}var i=this._input.pos;!this._addInputPosition&&(this._addInputPosition=0);this._input.pos=this._addInputPosition;if(e){if(typeof e=="string"){this._input.writeUTFBytes(e)}else{this._input.writeArrayBuffer(e)}this._addInputPosition=this._input.pos;this._input.pos=i}this.event("message",e)};e._onClose=function(t){this._connected=false;this.event("close",t)};e._onError=function(t){this.event("error",t)};e.send=function(t){this._socket.send(t)};e.flush=function(){if(this._output&&this._output.length>0){var e;try{this._socket&&this._socket.send(this._output.__getBuffer().slice(0,this._output.length))}catch(t){e=t}this._output.endian=this.endian;this._output.clear();if(e)this.event("error",e)}};d(0,e,"input",function(){return this._input});d(0,e,"output",function(){return this._output});d(0,e,"connected",function(){return this._connected});d(0,e,"endian",function(){return this._endian},function(t){this._endian=t;if(this._input!=null)this._input.endian=t;if(this._output!=null)this._output.endian=t});n.LITTLE_ENDIAN="littleEndian";n.BIG_ENDIAN="bigEndian";return n}(m);var li=function(t){function e(t){this.u_colorMatrix=null;this.strength=0;this.blurInfo=null;this.colorMat=null;this.colorAlpha=null;t===void 0&&(t=0);e.__super.call(this,1,t);this._attribLocation=["posuv",0,"attribColor",1,"attribFlags",2]}v(e,"laya.webgl.shader.d2.value.TextureSV",t);var i=e.prototype;i.clear=function(){this.texture=null;this.shader=null;this.defines._value=this.subID+(Bt.shaderHighPrecision?1024:0)};return e}(Q);var ui=function(t){function e(){e.__super.call(this)}v(e,"laya.components.CommonScript",t);var i=e.prototype;i.onAwake=function(){};i.onEnable=function(){};i.onStart=function(){};i.onUpdate=function(){};i.onLateUpdate=function(){};i.onDisable=function(){};i.onDestroy=function(){};d(0,i,"isSingleton",function(){return false});return e}(p);var ci=function(t){var _;function d(){this.retryNum=1;this.retryDelay=0;this.maxLoader=5;this._loaders=[];this._loaderCount=0;this._resInfos=[];this._infoPool=[];this._maxPriority=5;this._failRes={};this._statInfo={count:1,loaded:1};d.__super.call(this);for(var t=0;t<this._maxPriority;t++)this._resInfos[t]=[]}v(d,"laya.net.LoaderManager",t);var e=d.prototype;e.getProgress=function(){return this._statInfo.loaded/this._statInfo.count};e.resetProgress=function(){this._statInfo.count=this._statInfo.loaded=1};e.create=function(t,e,i,r,n,s,a,o){a===void 0&&(a=1);o===void 0&&(o=true);this._create(t,true,e,i,r,n,s,a,o)};e._create=function(t,e,i,r,n,s,a,o,h){o===void 0&&(o=1);h===void 0&&(h=true);if(t instanceof Array){var l=true;var u=t;var c=u.length;var f=0;if(r){var _=b.create(r.caller,r.method,r.args,false)}for(var d=0;d<c;d++){var p=u[d];if(typeof p=="string")p=u[d]={url:p};p.progress=0}for(d=0;d<c;d++){p=u[d];var v=r?b.create(null,y,[p],false):null;var m=r||i?b.create(null,g,[p]):null;this._createOne(p.url,e,m,v,p.type||n,p.constructParams||s,p.propertyParams||a,p.priority||o,h)}function g(t,e){f++;t.progress=1;e||(l=false);if(f===c&&i){i.runWith(l)}}function y(t,e){t.progress=e;var i=0;for(var r=0;r<c;r++){var n=u[r];i+=n.progress}var s=i/c;_.runWith(s)}}else{this._createOne(t,e,i,r,n,s,a,o,h)}};e._createOne=function(e,i,r,t,n,s,a,o,h){o===void 0&&(o=1);h===void 0&&(h=true);var l=this.getRes(e);if(!l){var u=xe.getFileExtension(e);n||(n=d.createMap[u]?d.createMap[u][0]:null);if(!n){this.load(e,r,t,n,o,h);return}var c=ii.parserMap;if(!c[n]){this.load(e,r,t,n,o,h);return}this._createLoad(e,b.create(null,f),t,n,s,a,o,h,true);function f(t){if(t){if(!i&&t instanceof laya.resource.Resource)t._addReference();t._setCreateURL(e)}r&&r.runWith(t);y.loader.event(e)}}else{if(!i&&l instanceof laya.resource.Resource)l._addReference();t&&t.runWith(1);r&&r.runWith(l)}};e.load=function(t,e,i,r,n,s,a,o,h){var l=this;n===void 0&&(n=1);s===void 0&&(s=true);o===void 0&&(o=false);h===void 0&&(h=false);if(t instanceof Array)return this._loadAssets(t,e,i,r,n,s,a);var u=ii.getRes(t);if(!o&&u!=null){y.systemTimer.frameOnce(1,null,function(){i&&i.runWith(1);e&&e.runWith(u instanceof Array?[u]:u);l._loaderCount||l.event("complete")})}else{var c;c=t;t=De.getFileLoadPath(t);if(t!=c&&r!=="nativeimage"){r="atlas"}else{c=null}var f=d._resMap[t];if(!f){f=this._infoPool.length?this._infoPool.pop():new _;f.url=t;f.type=r;f.cache=s;f.group=a;f.ignoreCache=o;f.useWorkerLoader=h;f.originalUrl=c;e&&f.on("complete",e.caller,e.method,e.args);i&&f.on("progress",i.caller,i.method,i.args);d._resMap[t]=f;n=n<this._maxPriority?n:this._maxPriority-1;this._resInfos[n].push(f);this._statInfo.count++;this.event("progress",this.getProgress());this._next()}else{if(e){if(c){e&&f._createListener("complete",this,this._resInfoLoaded,[c,e],false,false)}else{e&&f._createListener("complete",e.caller,e.method,e.args,false,false)}}i&&f._createListener("progress",i.caller,i.method,i.args,false,false)}}return this};e._resInfoLoaded=function(t,e){e.runWith(ii.getRes(t))};e._createLoad=function(t,e,i,r,n,s,a,o,h){var l=this;a===void 0&&(a=1);o===void 0&&(o=true);h===void 0&&(h=false);if(t instanceof Array)return this._loadAssets(t,e,i,r,a,o);var u=ii.getRes(t);if(u!=null){y.systemTimer.frameOnce(1,null,function(){i&&i.runWith(1);e&&e.runWith(u);l._loaderCount||l.event("complete")})}else{var c=d._resMap[t];if(!c){c=this._infoPool.length?this._infoPool.pop():new _;c.url=t;c.type=r;c.cache=false;c.ignoreCache=h;c.originalUrl=null;c.createCache=o;c.createConstructParams=n;c.createPropertyParams=s;e&&c.on("complete",e.caller,e.method,e.args);i&&c.on("progress",i.caller,i.method,i.args);d._resMap[t]=c;a=a<this._maxPriority?a:this._maxPriority-1;this._resInfos[a].push(c);this._statInfo.count++;this.event("progress",this.getProgress());this._next()}else{e&&c._createListener("complete",e.caller,e.method,e.args,false,false);i&&c._createListener("progress",i.caller,i.method,i.args,false,false)}}return this};e._next=function(){if(this._loaderCount>=this.maxLoader)return;for(var t=0;t<this._maxPriority;t++){var e=this._resInfos[t];while(e.length>0){var i=e.shift();if(i)return this._doLoad(i)}}this._loaderCount||this.event("complete")};e._doLoad=function(e){this._loaderCount++;var i=this._loaders.length?this._loaders.pop():new ii;i.on("complete",null,n);i.on("progress",null,function(t){e.event("progress",t)});i.on("error",null,function(t){n(null)});var r=this;function n(t){i.offAll();i._data=null;i._customParse=false;r._loaders.push(i);r._endLoad(e,t instanceof Array?[t]:t);r._loaderCount--;r._next()}i._constructParams=e.createConstructParams;i._propertyParams=e.createPropertyParams;i._createCache=e.createCache;i.load(e.url,e.type,e.cache,e.group,e.ignoreCache,e.useWorkerLoader)};e._endLoad=function(t,e){var i=t.url;if(e==null){var r=this._failRes[i]||0;if(r<this.retryNum){console.warn("[warn]Retry to load:",i);this._failRes[i]=r+1;y.systemTimer.once(this.retryDelay,this,this._addReTry,[t],false);return}else{ii.clearRes(i);console.warn("[error]Failed to load:",i);this.event("error",i)}}if(this._failRes[i])this._failRes[i]=0;delete d._resMap[i];if(t.originalUrl){e=ii.getRes(t.originalUrl)}t.event("complete",e);t.offAll();this._infoPool.push(t);this._statInfo.loaded++;this.event("progress",this.getProgress())};e._addReTry=function(t){this._resInfos[this._maxPriority-1].push(t);this._next()};e.clearRes=function(t){ii.clearRes(t)};e.clearTextureRes=function(t){ii.clearTextureRes(t)};e.getRes=function(t){return ii.getRes(t)};e.cacheRes=function(t,e){ii.cacheRes(t,e)};e.setGroup=function(t,e){ii.setGroup(t,e)};e.clearResByGroup=function(t){ii.clearResByGroup(t)};e.clearUnLoaded=function(){for(var t=0;t<this._maxPriority;t++){var e=this._resInfos[t];for(var i=e.length-1;i>-1;i--){var r=e[i];if(r){r.offAll();this._infoPool.push(r)}}e.length=0}this._loaderCount=0;d._resMap={}};e.cancelLoadByUrls=function(t){if(!t)return;for(var e=0,i=t.length;e<i;e++){this.cancelLoadByUrl(t[e])}};e.cancelLoadByUrl=function(t){for(var e=0;e<this._maxPriority;e++){var i=this._resInfos[e];for(var r=i.length-1;r>-1;r--){var n=i[r];if(n&&n.url===t){i[r]=null;n.offAll();this._infoPool.push(n)}}}if(d._resMap[t])delete d._resMap[t]};e._loadAssets=function(t,i,a,e,r,n,s){r===void 0&&(r=1);n===void 0&&(n=true);var o=t.length;var h=0;var l=0;var u=[];var c=true;for(var f=0;f<o;f++){var _=t[f];if(typeof _=="string")_={url:_,type:e,size:1,priority:r};if(!_.size)_.size=1;_.progress=0;l+=_.size;u.push(_);var d=a?b.create(null,m,[_],false):null;var p=i||a?b.create(null,v,[_]):null;this.load(_.url,p,d,_.type,_.priority||1,n,_.group||s,false,_.useWorkerLoader)}function v(t,e){h++;t.progress=1;if(!e)c=false;if(h===o&&i){i.runWith(c)}}function m(t,e){if(a!=null){t.progress=e;var i=0;for(var r=0;r<u.length;r++){var n=u[r];i+=n.size*n.progress}var s=i/l;a.runWith(s)}}return this};e.decodeBitmaps=function(t){var e=0,i=t.length;var r;r=Wt._context;for(e=0;e<i;e++){var n;n=ii.getAtlas(t[e]);if(n){this._decodeTexture(n[0],r)}else{var s;s=this.getRes(t[e]);if(s&&s instanceof laya.resource.Texture){this._decodeTexture(s,r)}}}};e._decodeTexture=function(t,e){var i=t.bitmap;if(!t||!i)return;var r=i.source||i.image;if(!r)return;if(y.__typeof(r,Yt.window.HTMLImageElement)){e.drawImage(r,0,0,1,1);var n=e.getImageData(0,0,1,1)}};d.cacheRes=function(t,e){ii.cacheRes(t,e)};d._resMap={};a(d,["createMap",function(){return this.createMap={atlas:[null,"atlas"]}}]);d.__init$=function(){_=function(t){function e(){this.url=null;this.type=null;this.cache=false;this.group=null;this.ignoreCache=false;this.useWorkerLoader=false;this.originalUrl=null;this.createCache=false;this.createConstructParams=null;this.createPropertyParams=null;e.__super.call(this)}v(e,"",t);return e}(m)};return d}(m);var fi=function(t){function i(){i.__super.call(this,24,4,4);this.canReuse=true;this.setAttributes(laya.webgl.utils.MeshTexture._fixattriInfo)}v(i,"laya.webgl.utils.MeshTexture",t);var e=i.prototype;e.addData=function(t,e,i,r,n){var s=this._vb;var a=this._ib;var o=t.length>>1;var h=s.needSize(o*24);var l=h>>2;var u=s._floatArray32||s.getFloat32Array();var c=s._uint32Array;var f=0;var _=r.a;var d=r.b;var p=r.c;var v=r.d;var m=r.tx;var g=r.ty;var y=0;for(y=0;y<o;y++){var x=t[f],T=t[f+1];u[l]=x*_+T*p+m;u[l+1]=x*d+T*v+g;u[l+2]=e[f];u[l+3]=e[f+1];c[l+4]=n;c[l+5]=255;l+=6;f+=2}s.setNeedUpload();var b=this.vertNum;var w=i.length;var C=a.needSize(i.byteLength);var A=a.getUint16Array();var E=C>>1;if(b>0){var S=E+w;var M=0;for(y=E;y<S;y++,M++){A[y]=i[M]+b}}else{A.set(i,E)}a.setNeedUpload();this.vertNum+=o;this.indexNum+=i.length};e.releaseMesh=function(){this._vb.setByteLength(0);this._ib.setByteLength(0);this.vertNum=0;this.indexNum=0;laya.webgl.utils.MeshTexture._POOL.push(this)};e.destroy=function(){this._ib.destroy();this._vb.destroy();this._ib.disposeResource();this._vb.deleteBuffer()};i.getAMesh=function(t){var e;if(laya.webgl.utils.MeshTexture._POOL.length){e=laya.webgl.utils.MeshTexture._POOL.pop()}else e=new i;t&&e._vb._resizeBuffer(64*1024*24,false);return e};i.const_stride=24;i._POOL=[];a(i,["_fixattriInfo",function(){return this._fixattriInfo=[5126,4,0,5121,4,16,5121,4,20]}]);return i}(E);var _i=function(t){function r(){this.totalCount=0;this._completeHandler=null;this._toLoadList=null;this._isLoading=false;this._curUrl=null;r.__super.call(this);this._completeHandler=new b(this,this.onOneLoadComplete);this.reset()}v(r,"laya.net.SceneLoader",t);var e=r.prototype;e.reset=function(){this._toLoadList=[];this._isLoading=false;this.totalCount=0};e.load=function(t,e,i){e===void 0&&(e=false);i===void 0&&(i=true);if(t instanceof Array){var r=0,n=0;n=t.length;for(r=0;r<n;r++){this._addToLoadList(t[r],e)}}else{this._addToLoadList(t,e)}if(i)this._checkNext()};e._addToLoadList=function(t,e){e===void 0&&(e=false);if(this._toLoadList.indexOf(t)>=0)return;if(ii.getRes(t))return;if(e){this._toLoadList.push({url:t})}else this._toLoadList.push(t);this.totalCount++};e._checkNext=function(){if(!this._isLoading){if(this._toLoadList.length==0){this.event("complete");return}var t;t=this._toLoadList.pop();if(typeof t=="string"){this.loadOne(t)}else{this.loadOne(t.url,true)}}};e.loadOne=function(t,e){e===void 0&&(e=false);this._curUrl=t;var i=xe.getFileExtension(this._curUrl);if(e){y.loader.create(t,this._completeHandler)}else if(r.LoadableExtensions[i]){y.loader.load(t,this._completeHandler,null,r.LoadableExtensions[i])}else if(t!=De.getFileLoadPath(t)||r.No3dLoadTypes[i]||!ci.createMap[i]){y.loader.load(t,this._completeHandler)}else{y.loader.create(t,this._completeHandler)}};e.onOneLoadComplete=function(){this._isLoading=false;if(!ii.getRes(this._curUrl)){console.log("Fail to load:",this._curUrl)}var t=xe.getFileExtension(this._curUrl);if(r.LoadableExtensions[t]){var e;e=ii.getRes(this._curUrl);if(e&&e instanceof laya.components.Prefab){e=e.json}if(e){if(e.loadList){this.load(e.loadList,false,false)}if(e.loadList3D){this.load(e.loadList3D,true,false)}}}if(t=="sk"){this.load(this._curUrl.replace(".sk",".png"),false,false)}this.event("progress",this.getProgress());this._checkNext()};e.getProgress=function(){return this.loadedCount/this.totalCount};d(0,e,"loadedCount",function(){return this.totalCount-this.leftCount});d(0,e,"leftCount",function(){if(this._isLoading)return this._toLoadList.length+1;return this._toLoadList.length});a(r,["LoadableExtensions",function(){return this.LoadableExtensions={scene:"json",scene3d:"json",ani:"json",ui:"json",prefab:"prefab"}},"No3dLoadTypes",function(){return this.No3dLoadTypes={png:true,jpg:true,txt:true}}]);return r}(m);var di=function(t){function e(){this.italic=false;e.__super.call(this)}v(e,"laya.display.css.TextStyle",t);var i=e.prototype;i.reset=function(){t.prototype.reset.call(this);this.italic=false;this.align="left";this.wordWrap=false;this.leading=0;this.padding=[0,0,0,0];this.bgColor=null;this.borderColor=null;this.asPassword=false;this.stroke=0;this.strokeColor="#000000";this.bold=false;this.underline=false;this.underlineColor=null;this.currBitmapFont=null;return this};i.recover=function(){if(this===e.EMPTY)return;z.recover("TextStyle",this.reset())};i.render=function(t,e,i,r){(this.bgColor||this.borderColor)&&e.drawRect(i,r,t.width,t.height,this.bgColor,this.borderColor,1)};e.create=function(){return z.getItemByClass("TextStyle",e)};e.EMPTY=new e;return e}(at);var pi=function(t){function n(){this.worker=null;this._useWorkerLoader=false;n.__super.call(this);var e=this;this.worker=new Worker(n.workerPath);this.worker.onmessage=function(t){e.workerMessage(t.data)}}v(n,"laya.net.WorkerLoader",t);var e=n.prototype;e.workerMessage=function(t){if(t){switch(t.type){case"Image":this.imageLoaded(t);break;case"Disable":n.enable=false;break}}};e.imageLoaded=function(t){if(!t.dataType||t.dataType!="imageBitmap"){this.event(t.url,null);return}var e=new Bi(true);var i=e.source.getContext("2d");switch(t.dataType){case"imageBitmap":;var r=t.imageBitmap;e.size(r.width,r.height);i.drawImage(r,0,0);break}console.log("load:",t.url);e._setGPUMemory(0);var n=new Xi;n.loadImageSource(e.source);this.event(t.url,n)};e.loadImage=function(t){this.worker.postMessage(t)};e._loadImage=function(e){var i=this;if(!this._useWorkerLoader||!n._enable){n._preLoadFun.call(i,e);return}e=nt.formatURL(e);function r(){laya.net.WorkerLoader.I.off(e,i,t)}var t=function(t){r();if(t){i["onLoaded"](t)}else{n._preLoadFun.call(i,e)}};laya.net.WorkerLoader.I.on(e,i,t);laya.net.WorkerLoader.I.loadImage(e)};d(1,n,"enable",function(){return n._enable},function(t){if(n._enable!=t){n._enable=t;if(t&&n._preLoadFun==null)n._enable=n.__init__()}});n.__init__=function(){if(n._preLoadFun!=null)return false;if(!Worker)return false;n._preLoadFun=ii["prototype"]["_loadImage"];ii["prototype"]["_loadImage"]=n["prototype"]["_loadImage"];if(!n.I)n.I=new n;return true};n.workerSupported=function(){return Worker?true:false};n.enableWorkerLoader=function(){if(!n._tryEnabled){n.enable=true;n._tryEnabled=true}};n.I=null;n.workerPath="libs/workerloader.js";n._preLoadFun=null;n._enable=false;n._tryEnabled=false;return n}(m);var vi=function(t){function e(){e.__super.call(this)}v(e,"laya.webgl.BufferState2D",t);return e}(Pt);var mi=function(t){function e(t){e.__super.call(this,4,0);this._attribLocation=["position",0,"attribColor",1]}v(e,"laya.webgl.shader.d2.value.PrimitiveSV",t);return e}(Q);var gi=function(t){function i(t){this.texcoord=null;this.position=null;this.offsetX=300;this.offsetY=0;i.__super.call(this,512,0);var e=8*bt.BYTES_PE;this.position=[2,5126,false,e,0];this.texcoord=[2,5126,false,e,2*bt.BYTES_PE];this.color=[4,5126,false,e,4*bt.BYTES_PE]}v(i,"laya.webgl.shader.d2.skinAnishader.SkinSV",t);return i}(Q);var yi=function(t){function _(t,e,i,r,n){this.ctx=null;this.lastScaleX=1;this.lastScaleY=1;this.needResetScale=false;this.maxTexW=0;this.maxTexH=0;this.scaleFontSize=true;this.showDbgInfo=false;this.supportImageData=true;_.__super.call(this);i===void 0&&(i=true);r===void 0&&(r=true);n===void 0&&(n=false);this.maxTexW=t;this.maxTexH=e;this.scaleFontSize=i;this.supportImageData=r;this.showDbgInfo=n;if(!_.canvas){_.canvas=g.document.createElement("canvas");_.canvas.width=1024;_.canvas.height=512;_.canvas.style.left="-10000px";_.canvas.style.position="absolute";s.body.appendChild(_.canvas);this.ctx=_.canvas.getContext("2d")}}v(_,"laya.webgl.text.CharRender_Canvas",t);var e=_.prototype;e.getWidth=function(t,e){if(!this.ctx)return 0;if(this.ctx._lastFont!=t){this.ctx.font=t;this.ctx._lastFont=t}return this.ctx.measureText(e).width};e.scale=function(t,e){if(!this.supportImageData){this.lastScaleX=t;this.lastScaleY=e;return}if(this.lastScaleX!=t||this.lastScaleY!=e){this.ctx.setTransform(t,0,0,e,0,0);this.lastScaleX=t;this.lastScaleY=e}};e.getCharBmp=function(t,e,i,r,n,s,a,o,h,l,u){if(!this.supportImageData)return this.getCharCanvas(t,e,i,r,n,s,a,o,h,l);var c=this.ctx;if(c.font!=e){c.font=e;c._lastFont=e}s.width=c.measureText(t).width;var f=s.width*this.lastScaleX;var _=s.height*this.lastScaleY;f+=(a+h)*this.lastScaleX;_+=(o+l)*this.lastScaleY;f=Math.ceil(f);_=Math.ceil(_);f=Math.min(f,laya.webgl.text.CharRender_Canvas.canvas.width);_=Math.min(_,laya.webgl.text.CharRender_Canvas.canvas.height);var d=f+i*2+1;var p=_+i*2+1;if(u){d=Math.max(d,u[0]+u[2]+1);p=Math.max(p,u[1]+u[3]+1)}c.clearRect(0,0,d,p);c.save();c.textBaseline="top";if(i>0){c.strokeStyle=n;c.lineWidth=i;c.strokeText(t,a,o)}c.fillStyle=r;c.fillText(t,a,o);if(this.showDbgInfo){c.strokeStyle="#ff0000";c.strokeRect(0,0,f,_);c.strokeStyle="#00ff00";c.strokeRect(a,o,s.width,s.height)}if(u){if(u[2]==-1)u[2]=Math.ceil((s.width+i*2)*this.lastScaleX)}var v=u?c.getImageData(u[0],u[1],u[2],u[3]):c.getImageData(0,0,f,_);c.restore();s.bmpWidth=v.width;s.bmpHeight=v.height;return v};e.getCharCanvas=function(t,e,i,r,n,s,a,o,h,l){var u=this.ctx;if(u.font!=e){u.font=e;u._lastFont=e}s.width=u.measureText(t).width;var c=s.width*this.lastScaleX;var f=s.height*this.lastScaleY;c+=(a+h)*this.lastScaleX;f+=(o+l)*this.lastScaleY+1;c=Math.min(c,this.maxTexW);f=Math.min(f,this.maxTexH);_.canvas.width=Math.min(c+1,this.maxTexW);_.canvas.height=Math.min(f+1,this.maxTexH);u.font=e;u.clearRect(0,0,c+1+i,f+1+i);u.setTransform(1,0,0,1,0,0);u.save();if(this.scaleFontSize){u.scale(this.lastScaleX,this.lastScaleY)}u.translate(a,o);u.textAlign="left";u.textBaseline="top";if(i>0){u.strokeStyle=n;u.fillStyle=r;u.lineWidth=i;if(u.fillAndStrokeText){u.fillAndStrokeText(t,0,0)}else{u.strokeText(t,0,0);u.fillText(t,0,0)}}else{u.fillStyle=r;u.fillText(t,0,0)}if(this.showDbgInfo){u.strokeStyle="#ff0000";u.strokeRect(0,0,c,f);u.strokeStyle="#00ff00";u.strokeRect(0,0,s.width,s.height)}u.restore();s.bmpWidth=_.canvas.width;s.bmpHeight=_.canvas.height;return _.canvas};d(0,e,"canvasWidth",function(){return _.canvas.width},function(t){if(_.canvas.width==t)return;_.canvas.width=t;if(t>2048){console.warn("画文字设置的宽度太大，超过2048了")}this.ctx.setTransform(1,0,0,1,0,0);this.ctx.scale(this.lastScaleX,this.lastScaleY)});_.canvas=null;return _}(_e);var xi=function(t){function e(){this.lastFont="";e.__super.call(this)}v(e,"laya.webgl.text.CharRender_Native",t);var i=e.prototype;i.getWidth=function(t,e){if(!g.conchTextCanvas)return 0;g.conchTextCanvas.font=t;this.lastFont=t;return g.conchTextCanvas.measureText(e).width};i.scale=function(t,e){};i.getCharBmp=function(t,e,i,r,n,s,a,o,h,l,u){if(!g.conchTextCanvas)return null;g.conchTextCanvas.font=e;this.lastFont=e;var c=s.width=g.conchTextCanvas.measureText(t).width;var f=s.height;c+=a+h;f+=o+l;var _=x.create(n);var d=_.numColor;var p=x.create(r);var v=p.numColor;var m=g.conchTextCanvas.getTextBitmapData(t,v,i>2?2:i,d);s.bmpWidth=m.width;s.bmpHeight=m.height;return m};return e}(_e);var Ti=function(n){function e(){this._x=0;this._y=0;this._width=0;this._height=0;this._visible=true;this._mouseState=0;this._zOrder=0;this._renderType=0;this._transform=null;this._tfChanged=false;this._texture=null;this._boundStyle=null;this._graphics=null;this.mouseThrough=false;this.autoSize=false;this.hitTestPrior=false;e.__super.call(this);this._repaint=0;this._style=at.EMPTY;this._cacheStyle=lt.EMPTY}v(e,"laya.display.Sprite",n);var t=e.prototype;t.destroy=function(t){t===void 0&&(t=true);n.prototype.destroy.call(this,t);this._style&&this._style.recover();this._cacheStyle&&this._cacheStyle.recover();this._boundStyle&&this._boundStyle.recover();this._style=null;this._cacheStyle=null;this._boundStyle=null;this._transform=null;if(this._graphics&&this._graphics.autoDestroy){this._graphics.destroy()}this._graphics=null;this.texture=null};t.updateZOrder=function(){xe.updateOrder(this._children)&&this.repaint()};t._getBoundsStyle=function(){if(!this._boundStyle)this._boundStyle=Ot.create();return this._boundStyle};t._setCustomRender=function(){};t._setCacheAs=function(t){};t._checkCanvasEnable=function(){var t=this._cacheStyle.needEnableCanvasRender();this._getCacheStyle().enableCanvasRender=t;if(t){if(this._cacheStyle.needBitmapCache()){this._cacheStyle.cacheAs="bitmap"}else{this._cacheStyle.cacheAs=this._cacheStyle.userSetCache}this._cacheStyle.reCache=true;this._renderType|=8}else{this._cacheStyle.cacheAs="none";this._cacheStyle.releaseContext();this._renderType&=~8}this._setCacheAs(this._cacheStyle.cacheAs);this._setRenderType(this._renderType)};t.reCache=function(){this._cacheStyle.reCache=true;this._repaint|=2};t.getRepaint=function(){return this._repaint};t._setX=function(t){this._x=t};t._setY=function(t){this._y=t};t._setWidth=function(t,e){};t._setHeight=function(t,e){};t.setSelfBounds=function(t){this._getBoundsStyle().userBounds=t};t.getBounds=function(){return this._getBoundsStyle().bounds=St._getWrapRec(this._boundPointsToParent())};t.getSelfBounds=function(){if(this._boundStyle&&this._boundStyle.userBounds)return this._boundStyle.userBounds;if(!this._graphics&&this._children.length===0&&!this._texture)return St.TEMP.setTo(0,0,0,0);return this._getBoundsStyle().bounds=St._getWrapRec(this._getBoundPointsM(false))};t._boundPointsToParent=function(t){t===void 0&&(t=false);var e=0,i=0;if(this._style){e=this.pivotX;i=this.pivotY;t=t||this._style.rotation!==0;if(this._style.scrollRect){e+=this._style.scrollRect.x;i+=this._style.scrollRect.y}}var r=this._getBoundPointsM(t);if(!r||r.length<1)return r;if(r.length!=8){r=t?Z.scanPList(r):St._getWrapRec(r,St.TEMP)._getBoundPoints()}if(!this.transform){xe.transPointList(r,this._x-e,this._y-i);return r}var n=ie.TEMP;var s=0,a=r.length;for(s=0;s<a;s+=2){n.x=r[s];n.y=r[s+1];this.toParentPoint(n);r[s]=n.x;r[s+1]=n.y}return r};t.getGraphicBounds=function(t){t===void 0&&(t=false);if(!this._graphics)return St.TEMP.setTo(0,0,0,0);return this._graphics.getBounds(t)};t._getBoundPointsM=function(t){t===void 0&&(t=false);if(this._boundStyle&&this._boundStyle.userBounds)return this._boundStyle.userBounds._getBoundPoints();if(!this._boundStyle)this._getBoundsStyle();if(!this._boundStyle.temBM)this._boundStyle.temBM=[];if(this._style.scrollRect){var e=xe.clearArray(this._boundStyle.temBM);var i=St.TEMP;i.copyFrom(this._style.scrollRect);xe.concatArray(e,i._getBoundPoints());return e}var r;if(this._graphics){r=this._graphics.getBoundPoints()}else{r=xe.clearArray(this._boundStyle.temBM);if(this._texture){i=St.TEMP;i.setTo(0,0,this.width||this._texture.width,this.height||this._texture.height);xe.concatArray(r,i._getBoundPoints())}}var n;var s;var a;a=this._children;for(var o=0,h=a.length;o<h;o++){n=a[o];if(n instanceof laya.display.Sprite&&n._visible===true){s=n._boundPointsToParent(t);if(s)r=r?xe.concatArray(r,s):s}}return r};t._getCacheStyle=function(){this._cacheStyle===lt.EMPTY&&(this._cacheStyle=lt.create());return this._cacheStyle};t.getStyle=function(){this._style===at.EMPTY&&(this._style=at.create());return this._style};t.setStyle=function(t){this._style=t};t._setScaleX=function(t){this._style.scaleX=t};t._setScaleY=function(t){this._style.scaleY=t};t._setRotation=function(t){this._style.rotation=t};t._setSkewX=function(t){this._style.skewX=t};t._setSkewY=function(t){this._style.skewY=t};t._createTransform=function(){return pt.create()};t._adjustTransform=function(){this._tfChanged=false;var t=this._style;var e=t.scaleX,i=t.scaleY;var r=t.skewX;var n=t.skewY;var s=t.rotation;var a=this._transform||(this._transform=this._createTransform());if(s||e!==1||i!==1||r!==0||n!==0){a._bTransform=true;var o=(s-r)*.0174532922222222;var h=(s+n)*.0174532922222222;var l=Math.cos(h);var u=Math.sin(h);var c=Math.sin(o);var f=Math.cos(o);a.a=e*l;a.b=e*u;a.c=-i*c;a.d=i*f;a.tx=a.ty=0}else{a.identity();this._renderType&=~2;this._setRenderType(this._renderType)}return a};t._setTransform=function(t){};t._setPivotX=function(t){var e=this.getStyle();e.pivotX=t};t._getPivotX=function(){return this._style.pivotX};t._setPivotY=function(t){var e=this.getStyle();e.pivotY=t};t._getPivotY=function(){return this._style.pivotY};t._setAlpha=function(t){if(this._style.alpha!==t){var e=this.getStyle();e.alpha=t;if(t!==1)this._renderType|=1;else this._renderType&=~1;this._setRenderType(this._renderType);this.parentRepaint()}};t._getAlpha=function(){return this._style.alpha};t._setBlendMode=function(t){};t._setGraphics=function(t){};t._setGraphicsCallBack=function(){};t._setScrollRect=function(t){};t.pos=function(t,e,i){i===void 0&&(i=false);if(this._x!==t||this._y!==e){if(this.destroyed)return this;if(i){this._setX(t);this._setY(e);this.parentRepaint(2);var r=this._cacheStyle.maskParent;if(r){r.repaint(2)}}else{this.x=t;this.y=e}}return this};t.pivot=function(t,e){this.pivotX=t;this.pivotY=e;return this};t.size=function(t,e){this.width=t;this.height=e;return this};t.scale=function(t,e,i){i===void 0&&(i=false);var r=this.getStyle();if(r.scaleX!=t||r.scaleY!=e){if(this.destroyed)return this;if(i){this._setScaleX(t);this._setScaleY(e);this._setTranformChange()}else{this.scaleX=t;this.scaleY=e}}return this};t.skew=function(t,e){this.skewX=t;this.skewY=e;return this};t.render=function(t,e,i){F.renders[this._renderType]._fun(this,t,e+this._x,i+this._y);this._repaint=0};t.drawToCanvas=function(t,e,i,r){return Pe.drawToCanvas(this,this._renderType,t,e,i,r)};t.drawToTexture=function(t,e,i,r){return Pe.drawToTexture(this,this._renderType,t,e,i,r)};t.customRender=function(t,e,i){this._repaint=3};t._applyFilters=function(){};t._setColorFilter=function(t){};t._isHaveGlowFilter=function(){var t=0,e=0;if(this.filters){for(t=0;t<this.filters.length;t++){if(this.filters[t].type==8){return true}}}for(t=0,e=this._children.length;t<e;t++){if(this._children[t]._isHaveGlowFilter()){return true}}return false};t.localToGlobal=function(t,e,i){e===void 0&&(e=false);if(e===true){t=new ie(t.x,t.y)}var r=this;i=i||y.stage;while(r&&!r.destroyed){if(r==i)break;t=r.toParentPoint(t);r=r.parent}return t};t.globalToLocal=function(t,e,i){e===void 0&&(e=false);if(e){t=new ie(t.x,t.y)}var r=this;var n=[];i=i||y.stage;while(r&&!r.destroyed){if(r==i)break;n.push(r);r=r.parent}var s=n.length-1;while(s>=0){r=n[s];t=r.fromParentPoint(t);s--}return t};t.toParentPoint=function(t){if(!t)return t;t.x-=this.pivotX;t.y-=this.pivotY;if(this.transform){this._transform.transformPoint(t)}t.x+=this._x;t.y+=this._y;var e=this._style.scrollRect;if(e){t.x-=e.x;t.y-=e.y}return t};t.fromParentPoint=function(t){if(!t)return t;t.x-=this._x;t.y-=this._y;var e=this._style.scrollRect;if(e){t.x+=e.x;t.y+=e.y}if(this.transform){this._transform.invertTransformPoint(t)}t.x+=this.pivotX;t.y+=this.pivotY;return t};t.fromStagePoint=function(t){return t};t.on=function(t,e,i,r){if(this._mouseState!==1&&this.isMouseEvent(t)){this.mouseEnabled=true;this._setBit(64,true);if(this._parent){this._$2__onDisplay()}return this._createListener(t,e,i,r,false)}return n.prototype.on.call(this,t,e,i,r)};t.once=function(t,e,i,r){if(this._mouseState!==1&&this.isMouseEvent(t)){this.mouseEnabled=true;this._setBit(64,true);if(this._parent){this._$2__onDisplay()}return this._createListener(t,e,i,r,true)}return n.prototype.once.call(this,t,e,i,r)};t._$2__onDisplay=function(){if(this._mouseState!==1){var t=this;t=t.parent;while(t&&t._mouseState!==1){if(t._getBit(64))break;t.mouseEnabled=true;t._setBit(64,true);t=t.parent}}};t._setParent=function(t){n.prototype._setParent.call(this,t);if(t&&this._getBit(64)){this._$2__onDisplay()}};t.loadImage=function(t,e){var i=this;if(t==null){this.texture=null;n()}else{var r=ii.getRes(t);if(!r){r=new ti;r.load(t);ii.cacheRes(t,r)}this.texture=r;if(!r.getIsReady())r.once("ready",null,n);else n()}function n(){i.repaint(3);e&&e.run()}return this};t.repaint=function(t){t===void 0&&(t=2);if(!(this._repaint&t)){this._repaint|=t;this.parentRepaint(t)}if(this._cacheStyle&&this._cacheStyle.maskParent){this._cacheStyle.maskParent.repaint(t)}};t._needRepaint=function(){return this._repaint&2&&this._cacheStyle.enableCanvasRender&&this._cacheStyle.reCache};t._childChanged=function(t){if(this._children.length)this._renderType|=8192;else this._renderType&=~8192;this._setRenderType(this._renderType);if(t&&this._getBit(32))y.systemTimer.callLater(this,this.updateZOrder);this.repaint(3)};t.parentRepaint=function(t){t===void 0&&(t=2);var e=this._parent;if(e&&!(e._repaint&t)){e._repaint|=t;e.parentRepaint(t)}};t._setMask=function(t){};t.startDrag=function(t,e,i,r,n,s,a){e===void 0&&(e=false);i===void 0&&(i=0);r===void 0&&(r=300);s===void 0&&(s=false);a===void 0&&(a=.92);this._style.dragging||(this.getStyle().dragging=new Zt);this._style.dragging.start(this,t,e,i,r,n,s,a)};t.stopDrag=function(){this._style.dragging&&this._style.dragging.stop()};t._setDisplay=function(t){if(!t){if(this._cacheStyle){this._cacheStyle.releaseContext();this._cacheStyle.releaseFilterCache();if(this._cacheStyle.hasGlowFilter){this._cacheStyle.hasGlowFilter=false}}}n.prototype._setDisplay.call(this,t)};t.hitTestPoint=function(t,e){var i=this.globalToLocal(ie.TEMP.setTo(t,e));t=i.x;e=i.y;var r=this._style.hitArea?this._style.hitArea:this._width>0&&this._height>0?St.TEMP.setTo(0,0,this._width,this._height):this.getSelfBounds();return r.contains(t,e)};t.getMousePoint=function(){return this.globalToLocal(ie.TEMP.setTo(y.stage.mouseX,y.stage.mouseY))};t._setTexture=function(t){};t._setRenderType=function(t){};t._setTranformChange=function(){this._tfChanged=true;this._renderType|=2;this.parentRepaint(2)};t._setBgStyleColor=function(t,e,i,r,n){};t._setBorderStyleColor=function(t,e,i,r,n,s){};t.captureMouseEvent=function(t){D.instance.setCapture(this,t)};t.releaseMouseEvent=function(){D.instance.releaseCapture()};d(0,t,"customRenderEnable",null,function(t){if(t){this._renderType|=2048;this._setRenderType(this._renderType);this._setCustomRender()}});d(0,t,"cacheAs",function(){return this._cacheStyle.cacheAs},function(t){if(t===this._cacheStyle.userSetCache)return;if(this.mask&&t==="normal")return;this._setCacheAs(t);this._getCacheStyle().userSetCache=t;this._checkCanvasEnable();this.repaint()});d(0,t,"globalScaleY",function(){var t=1;var e=this;while(e){if(e===y.stage)break;t*=e.scaleY;e=e.parent}return t});d(0,t,"hitArea",function(){return this._style.hitArea},function(t){this.getStyle().hitArea=t});d(0,t,"staticCache",function(){return this._cacheStyle.staticCache},function(t){this._getCacheStyle().staticCache=t;if(!t)this.reCache()});d(0,t,"displayWidth",function(){return this.width*this.scaleX});d(0,t,"zOrder",function(){return this._zOrder},function(t){if(this._zOrder!=t){this._zOrder=t;if(this._parent){t&&this._parent._setBit(32,true);y.systemTimer.callLater(this._parent,this.updateZOrder)}}});d(0,t,"rotation",function(){return this._style.rotation},function(t){var e=this.getStyle();if(e.rotation!==t){this._setRotation(t);this._setTranformChange()}});d(0,t,"width",function(){if(!this.autoSize)return this._width||(this.texture?this.texture.width:0);if(this.texture)return this.texture.width;if(!this._graphics&&this._children.length===0)return 0;return this.getSelfBounds().width},function(t){if(this._width!==t){this._width=t;this._setWidth(this.texture,t);this._setTranformChange()}});d(0,t,"x",function(){return this._x},function(t){if(this.destroyed)return;if(this._x!==t){this._setX(t);this.parentRepaint(2);var e=this._cacheStyle.maskParent;if(e){e.repaint(2)}}});d(0,t,"drawCallOptimize",function(){return this._getBit(256)},function(t){this._setBit(256,t)});d(0,t,"texture",function(){return this._texture},function(t){if(typeof t=="string"){this.loadImage(t)}else if(this._texture!=t){this._texture&&this._texture._removeReference();this._texture=t;t&&t._addReference();this._setTexture(t);this._setWidth(this._texture,this.width);this._setHeight(this._texture,this.height);if(t)this._renderType|=256;else this._renderType&=~256;this._setRenderType(this._renderType);this.repaint()}});d(0,t,"globalRotation",function(){var t=0;var e=this;while(e){if(e===y.stage)break;t+=e.rotation;e=e.parent}return t});d(0,t,"y",function(){return this._y},function(t){if(this.destroyed)return;if(this._y!==t){this._setY(t);this.parentRepaint(2);var e=this._cacheStyle.maskParent;if(e){e.repaint(2)}}});d(0,t,"displayHeight",function(){return this.height*this.scaleY});d(0,t,"height",function(){if(!this.autoSize)return this._height||(this.texture?this.texture.height:0);if(this.texture)return this.texture.height;if(!this._graphics&&this._children.length===0)return 0;return this.getSelfBounds().height},function(t){if(this._height!==t){this._height=t;this._setHeight(this.texture,t);this._setTranformChange()}});d(0,t,"blendMode",function(){return this._style.blendMode},function(t){this._setBlendMode(t);this.getStyle().blendMode=t;if(t&&t!="source-over")this._renderType|=4;else this._renderType&=~4;this._setRenderType(this._renderType);this.parentRepaint()});d(0,t,"scaleX",function(){return this._style.scaleX},function(t){var e=this.getStyle();if(e.scaleX!==t){this._setScaleX(t);this._setTranformChange()}});d(0,t,"scaleY",function(){return this._style.scaleY},function(t){var e=this.getStyle();if(e.scaleY!==t){this._setScaleY(t);this._setTranformChange()}});d(0,t,"stage",function(){return y.stage});d(0,t,"skewX",function(){return this._style.skewX},function(t){var e=this.getStyle();if(e.skewX!==t){this._setSkewX(t);this._setTranformChange()}});d(0,t,"scrollRect",function(){return this._style.scrollRect},function(t){this.getStyle().scrollRect=t;this._setScrollRect(t);this.repaint();if(t){this._renderType|=64}else{this._renderType&=~64}this._setRenderType(this._renderType)});d(0,t,"skewY",function(){return this._style.skewY},function(t){var e=this.getStyle();if(e.skewY!==t){this._setSkewY(t);this._setTranformChange()}});d(0,t,"transform",function(){return this._tfChanged?this._adjustTransform():this._transform},function(t){this._tfChanged=false;var e=this._transform||(this._transform=this._createTransform());t.copyTo(e);this._setTransform(e);if(t){this._x=e.tx;this._y=e.ty;e.tx=e.ty=0}if(t)this._renderType|=2;else{this._renderType&=~2}this._setRenderType(this._renderType);this.parentRepaint()});d(0,t,"pivotX",function(){return this._getPivotX()},function(t){this._setPivotX(t);this.repaint()});d(0,t,"pivotY",function(){return this._getPivotY()},function(t){this._setPivotY(t);this.repaint()});d(0,t,"alpha",function(){return this._getAlpha()},function(t){t=t<0?0:t>1?1:t;this._setAlpha(t)});d(0,t,"visible",function(){return this._visible},function(t){if(this._visible!==t){this._visible=t;this.parentRepaint(3)}});d(0,t,"graphics",function(){if(!this._graphics){this.graphics=new le;this._graphics.autoDestroy=true}return this._graphics},function(t){if(this._graphics)this._graphics._sp=null;this._graphics=t;if(t){this._setGraphics(t);this._renderType|=512;t._sp=this}else{this._renderType&=~512}this._setRenderType(this._renderType);this.repaint()});d(0,t,"filters",function(){return this._cacheStyle.filters},function(t){t&&t.length===0&&(t=null);if(this._cacheStyle.filters==t)return;this._getCacheStyle().filters=t?t.slice():null;if(t&&t.length){this._setColorFilter(t[0]);this._renderType|=16}else{this._setColorFilter(null);this._renderType&=~16}this._setRenderType(this._renderType);if(t&&t.length>0){if(!this._getBit(16))this._setBitUp(16);if(!(t.length==1&&t[0]instanceof laya.filters.ColorFilter)){this._getCacheStyle().cacheForFilters=true;this._checkCanvasEnable()}}else{if(this._cacheStyle.cacheForFilters){this._cacheStyle.cacheForFilters=false;this._checkCanvasEnable()}}this._getCacheStyle().hasGlowFilter=this._isHaveGlowFilter();this.repaint()});d(0,t,"mask",function(){return this._cacheStyle.mask},function(t){if(t&&this.mask&&this.mask._cacheStyle.maskParent)return;this._getCacheStyle().mask=t;this._setMask(t);this._checkCanvasEnable();if(t){t._getCacheStyle().maskParent=this}else{if(this.mask){this.mask._getCacheStyle().maskParent=null}}this._renderType|=32;this._setRenderType(this._renderType);this.parentRepaint(3)});d(0,t,"mouseEnabled",function(){return this._mouseState>1},function(t){this._mouseState=t?2:1});d(0,t,"globalScaleX",function(){var t=1;var e=this;while(e){if(e===y.stage)break;t*=e.scaleX;e=e.parent}return t});d(0,t,"mouseX",function(){return this.getMousePoint().x});d(0,t,"mouseY",function(){return this.getMousePoint().y});d(0,t,"viewport",function(){return this._style.viewport},function(t){if(typeof t=="string"){var e;e=t.split(",");if(e.length>3){t=new St(parseFloat(e[0]),parseFloat(e[1]),parseFloat(e[2]),parseFloat(e[3]))}}this.getStyle().viewport=t});e.fromImage=function(t){return(new e).loadImage(t)};return e}(Ke);var bi=function(t){function e(){e.__super.call(this)}v(e,"laya.webgl.shader.BaseShader",t);e.activeShader=null;e.bindShader=null;return e}(qe);var wi=function(t){function e(){e.__super.call(this);this._width=-1;this._height=-1}v(e,"laya.resource.Bitmap",t);var i=e.prototype;i._getSource=function(){throw"Bitmap: must override it."};d(0,i,"width",function(){return this._width});d(0,i,"height",function(){return this._height});return e}(qe);var Ci=function(t){function r(t,e){this._source=null;this._texW=0;this._texH=0;this.__destroyed=false;this._discardTm=0;this.genID=0;this.bitmap={id:0,_glTexture:null};this.curUsedCovRate=0;this.curUsedCovRateAtlas=0;this.lastTouchTm=0;this.ri=null;r.__super.call(this);this._texW=t||R.atlasWidth;this._texH=e||R.atlasWidth;this.bitmap.id=this.id;this.lock=true}v(r,"laya.webgl.text.TextTexture",t);var e=r.prototype;e.recreateResource=function(){if(this._source)return;var t=Wt.isConchApp?Xt.instance.getDefaultCommandEncoder():Bt.mainContext;var e=this._source=t.createTexture();this.bitmap._glTexture=e;ft.bindTexture(t,3553,e);t.texImage2D(3553,0,6408,this._texW,this._texH,0,6408,5121,null);t.texParameteri(3553,10241,9729);t.texParameteri(3553,10240,9729);t.texParameteri(3553,10242,33071);t.texParameteri(3553,10243,33071);if(R.debugUV){this.fillWhite()}};e.addChar=function(t,e,i,r){if(R.isWan1Wan){return this.addCharCanvas(t,e,i,r)}!this._source&&this.recreateResource();var n=Wt.isConchApp?Xt.instance.getDefaultCommandEncoder():Bt.mainContext;ft.bindTexture(n,3553,this._source);!Wt.isConchApp&&n.pixelStorei(37441,true);var s=t.data;if(t.data instanceof Uint8ClampedArray)s=new Uint8Array(s.buffer);n.texSubImage2D(3553,0,e,i,t.width,t.height,6408,5121,s);!Wt.isConchApp&&n.pixelStorei(37441,false);var a=NaN;var o=NaN;var h=NaN;var l=NaN;if(Wt.isConchApp){a=e/this._texW;o=i/this._texH;h=(e+t.width)/this._texW;l=(i+t.height)/this._texH}else{a=(e+1)/this._texW;o=i/this._texH;h=(e+t.width-1)/this._texW;l=(i+t.height-1)/this._texH}r=r||new Array(8);r[0]=a,r[1]=o;r[2]=h,r[3]=o;r[4]=h,r[5]=l;r[6]=a,r[7]=l;return r};e.addCharCanvas=function(t,e,i,r){!this._source&&this.recreateResource();var n=Wt.isConchApp?Xt.instance.getDefaultCommandEncoder():Bt.mainContext;ft.bindTexture(n,3553,this._source);!Wt.isConchApp&&n.pixelStorei(37441,true);n.texSubImage2D(3553,0,e,i,6408,5121,t);!Wt.isConchApp&&n.pixelStorei(37441,false);var s=NaN;var a=NaN;var o=NaN;var h=NaN;if(Wt.isConchApp){s=e/this._texW;a=i/this._texH;o=(e+t.width)/this._texW;h=(i+t.height)/this._texH}else{s=(e+1)/this._texW;a=(i+1)/this._texH;o=(e+t.width-1)/this._texW;h=(i+t.height-1)/this._texH}r=r||new Array(8);r[0]=s,r[1]=a;r[2]=o,r[3]=a;r[4]=o,r[5]=h;r[6]=s,r[7]=h;return r};e.fillWhite=function(){!this._source&&this.recreateResource();var t=Wt.isConchApp?Xt.instance.getDefaultCommandEncoder():Bt.mainContext;var e=new Uint8Array(this._texW*this._texH*4);e.fill(255);t.texSubImage2D(3553,0,0,0,this._texW,this._texH,6408,5121,e)};e.discard=function(){if(this._texW!=R.atlasWidth||this._texH!=R.atlasWidth){this.destroy();return}this.genID++;if(r.poolLen>=r.pool.length){r.pool=r.pool.concat(new Array(10))}this._discardTm=y.stage.getFrameTm();r.pool[r.poolLen++]=this};e.destroy=function(){this.__destroyed=true;var t=Wt.isConchApp?Xt.instance.getDefaultCommandEncoder():Bt.mainContext;this._source&&t.deleteTexture(this._source);this._source=null};e.touchRect=function(t,e){if(this.lastTouchTm!=e){this.curUsedCovRate=0;this.curUsedCovRateAtlas=0;this.lastTouchTm=e}var i=R.atlasWidth*R.atlasWidth;var r=qt.atlasGridW*qt.atlasGridW;this.curUsedCovRate+=t.bmpWidth*t.bmpHeight/i;this.curUsedCovRateAtlas+=Math.ceil(t.bmpWidth/qt.atlasGridW)*Math.ceil(t.bmpHeight/qt.atlasGridW)/(i/r)};e._getSource=function(){return this._source};e.drawOnScreen=function(t,e){};d(0,e,"texture",function(){return this});r.getTextTexture=function(t,e){if(t!=R.atlasWidth||t!=R.atlasWidth)return new r(t,e);if(r.poolLen>0){var i=r.pool[--r.poolLen];if(r.poolLen>0)r.clean();return i}return new r(t,e)};r.clean=function(){var t=y.stage.getFrameTm();if(r.cleanTm===0)r.cleanTm=t;if(t-r.cleanTm>=R.checkCleanTextureDt){for(var e=0;e<r.poolLen;e++){var i=r.pool[e];if(t-i._discardTm>=R.destroyUnusedTextureDt){i.destroy();r.pool[e]=r.pool[r.poolLen-1];r.poolLen--;e--}}r.cleanTm=t}};r.poolLen=0;r.cleanTm=0;a(r,["pool",function(){return this.pool=new Array(10)}]);return r}(qe);var Ai=function(t){function e(t){this._uint16Array=null;t===void 0&&(t=35044);e.__super.call(this);this._bufferUsage=t;this._bufferType=34963;this._buffer=new ArrayBuffer(8)}v(e,"laya.webgl.utils.IndexBuffer2D",t);var i=e.prototype;i._checkArrayUse=function(){this._uint16Array&&(this._uint16Array=new Uint16Array(this._buffer))};i.getUint16Array=function(){return this._uint16Array||(this._uint16Array=new Uint16Array(this._buffer))};i._bindForVAO=function(){Xt.instance.bindBuffer(34963,this._glBuffer)};i.bind=function(){if($._bindedIndexBuffer!==this._glBuffer){Xt.instance.bindBuffer(34963,this._glBuffer);$._bindedIndexBuffer=this._glBuffer;return true}return false};i.destory=function(){this._uint16Array=null;this._buffer=null};i.disposeResource=function(){this._disposeResource()};e.create=function(t){t===void 0&&(t=35044);return new e(t)};return e}(ni);var Ei=function(t){function e(){this.audioBuffer=null;this.gain=null;this.bufferSource=null;this._currentTime=0;this._volume=1;this._startTime=0;this._pauseTime=0;this._onPlayEnd=null;this.context=oi.ctx;e.__super.call(this);this._onPlayEnd=xe.bind(this.__onPlayEnd,this);if(this.context["createGain"]){this.gain=this.context["createGain"]()}else{this.gain=this.context["createGainNode"]()}}v(e,"laya.media.webaudio.WebAudioSoundChannel",t);var i=e.prototype;i.play=function(){We.addChannel(this);this.isStopped=false;this._clearBufferSource();if(!this.audioBuffer)return;var t=this.context;var e=this.gain;var i=t.createBufferSource();this.bufferSource=i;i.buffer=this.audioBuffer;i.connect(e);if(e)e.disconnect();e.connect(t.destination);i.onended=this._onPlayEnd;if(this.startTime>=this.duration)this.startTime=0;this._startTime=Yt.now();if(this.gain.gain.setTargetAtTime){this.gain.gain.setTargetAtTime(this._volume,this.context.currentTime,.001)}else this.gain.gain.value=this._volume;if(this.loops==0){i.loop=true}if(i.playbackRate.setTargetAtTime){i.playbackRate.setTargetAtTime(We.playbackRate,this.context.currentTime,.001)}else i.playbackRate.value=We.playbackRate;i.start(0,this.startTime);this._currentTime=0};i.__onPlayEnd=function(){if(this.loops==1){if(this.completeHandler){y.timer.once(10,this,this.__runComplete,[this.completeHandler],false);this.completeHandler=null}this.stop();this.event("complete");return}if(this.loops>0){this.loops--}this.startTime=0;this.play()};i._clearBufferSource=function(){if(this.bufferSource){var t=this.bufferSource;if(t.stop){t.stop(0)}else{t.noteOff(0)}t.disconnect(0);t.onended=null;if(!e._tryCleanFailed)this._tryClearBuffer(t);this.bufferSource=null}};i._tryClearBuffer=function(t){if(!Yt.onMac){try{t.buffer=null}catch(t){e._tryCleanFailed=true}return}try{t.buffer=oi._miniBuffer}catch(t){e._tryCleanFailed=true}};i.stop=function(){t.prototype.stop.call(this);this._clearBufferSource();this.audioBuffer=null;if(this.gain)this.gain.disconnect();this.isStopped=true;We.removeChannel(this);this.completeHandler=null;if(We.autoReleaseSound)We.disposeSoundLater(this.url)};i.pause=function(){if(!this.isStopped){this._pauseTime=this.position}this._clearBufferSource();if(this.gain)this.gain.disconnect();this.isStopped=true;We.removeChannel(this);if(We.autoReleaseSound)We.disposeSoundLater(this.url)};i.resume=function(){this.startTime=this._pauseTime;this.play()};d(0,i,"position",function(){if(this.bufferSource){return(Yt.now()-this._startTime)/1e3+this.startTime}return 0});d(0,i,"duration",function(){if(this.audioBuffer){return this.audioBuffer.duration}return 0});d(0,i,"volume",function(){return this._volume},function(t){this._volume=t;if(this.isStopped){return}if(this.gain.gain.setTargetAtTime){this.gain.gain.setTargetAtTime(t,this.context.currentTime,.001)}else this.gain.gain.value=t});e._tryCleanFailed=false;e.SetTargetDelay=.001;return e}($e);var Si=function(t){function e(t){this._audio=null;this._onEnd=null;this._resumePlay=null;e.__super.call(this);this._onEnd=xe.bind(this.__onEnd,this);this._resumePlay=xe.bind(this.__resumePlay,this);t.addEventListener("ended",this._onEnd);this._audio=t}v(e,"laya.media.h5audio.AudioSoundChannel",t);var i=e.prototype;i.__onEnd=function(){if(this.loops==1){if(this.completeHandler){y.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],false);this.completeHandler=null}this.stop();this.event("complete");return}if(this.loops>0){this.loops--}this.startTime=0;this.play()};i.__resumePlay=function(){if(this._audio)this._audio.removeEventListener("canplay",this._resumePlay);if(this.isStopped)return;try{this._audio.currentTime=this.startTime;Yt.container.appendChild(this._audio);this._audio.play()}catch(t){this.event("error")}};i.play=function(){this.isStopped=false;try{this._audio.playbackRate=We.playbackRate;this._audio.currentTime=this.startTime}catch(t){this._audio.addEventListener("canplay",this._resumePlay);return}We.addChannel(this);Yt.container.appendChild(this._audio);if("play"in this._audio)this._audio.play()};i.stop=function(){t.prototype.stop.call(this);this.isStopped=true;We.removeChannel(this);this.completeHandler=null;if(!this._audio)return;if("pause"in this._audio)if(Wt.isConchApp){this._audio.stop()}this._audio.pause();this._audio.removeEventListener("ended",this._onEnd);this._audio.removeEventListener("canplay",this._resumePlay);if(!Yt.onIE){if(this._audio!=He._musicAudio){z.recover("audio:"+this.url,this._audio)}}Yt.removeElement(this._audio);this._audio=null};i.pause=function(){this.isStopped=true;We.removeChannel(this);if("pause"in this._audio)this._audio.pause()};i.resume=function(){if(!this._audio)return;this.isStopped=false;We.addChannel(this);if("play"in this._audio)this._audio.play()};d(0,i,"position",function(){if(!this._audio)return 0;return this._audio.currentTime});d(0,i,"duration",function(){if(!this._audio)return 0;return this._audio.duration});d(0,i,"volume",function(){if(!this._audio)return 1;return this._audio.volume},function(t){if(!this._audio)return;this._audio.volume=t});return e}($e);var Mi=function(t){function i(t,e){this._floatArray32=null;this._uint32Array=null;this._vertexStride=0;i.__super.call(this);this._vertexStride=t;this._bufferUsage=e;this._bufferType=34962;this._buffer=new ArrayBuffer(8);this._floatArray32=new Float32Array(this._buffer);this._uint32Array=new Uint32Array(this._buffer)}v(i,"laya.webgl.utils.VertexBuffer2D",t);var e=i.prototype;e.getFloat32Array=function(){return this._floatArray32};e.appendArray=function(t){var e=this._byteLength>>2;this.setByteLength(this._byteLength+t.length*4);var i=this.getFloat32Array();i.set(t,e);this._upload=true};e._checkArrayUse=function(){this._floatArray32&&(this._floatArray32=new Float32Array(this._buffer));this._uint32Array&&(this._uint32Array=new Uint32Array(this._buffer))};e.deleteBuffer=function(){this._disposeResource()};e._bindForVAO=function(){Xt.instance.bindBuffer(34962,this._glBuffer)};e.bind=function(){if($._bindedVertexBuffer!==this._glBuffer){Xt.instance.bindBuffer(34962,this._glBuffer);$._bindedVertexBuffer=this._glBuffer;return true}return false};e.destroy=function(){laya.webgl.utils.Buffer.prototype.destroy.call(this);this._byteLength=0;this._upload=true;this._buffer=null;this._floatArray32=null};d(0,e,"vertexStride",function(){return this._vertexStride});i.create=function(t,e){e===void 0&&(e=35048);return new i(t,e)};return i}(ni);var Ri=function(e){function _(){this._clipPoint=null;this._text=null;this._isChanged=false;this._textWidth=0;this._textHeight=0;this._lines=[];this._lineWidths=[];this._startX=0;this._startY=0;this._words=null;this._charSize={};this._valign="top";this._color="#000000";this._singleCharRender=false;_.__super.call(this);this._fontSize=_.defaultFontSize;this._font=_.defaultFont;this.overflow="visible";this._style=di.EMPTY}v(_,"laya.display.Text",e);var t=_.prototype;t.getStyle=function(){this._style===di.EMPTY&&(this._style=di.create());return this._style};t._getTextStyle=function(){if(this._style===di.EMPTY){this._style=di.create()}return this._style};t.destroy=function(t){t===void 0&&(t=true);e.prototype.destroy.call(this,t);this._clipPoint=null;this._lines=null;this._lineWidths=null;this._words&&this._words.forEach(function(t){t.cleanCache()});this._words=null;this._charSize=null};t._getBoundPointsM=function(t){t===void 0&&(t=false);var e=St.TEMP;e.setTo(0,0,this.width,this.height);return e._getBoundPoints()};t.getGraphicBounds=function(t){t===void 0&&(t=false);var e=St.TEMP;e.setTo(0,0,this.width,this.height);return e};t._getCSSStyle=function(){return this._style};t.lang=function(t,e,i,r,n,s,a,o,h,l,u){t=_.langPacks&&_.langPacks[t]?_.langPacks[t]:t;if(arguments.length<2){this._text=t}else{for(var c=0,f=arguments.length;c<f;c++){t=t.replace("{"+c+"}",arguments[c+1])}this._text=t}};t._getContextFont=function(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(Yt.onIPhone?laya.display.Text.fontFamilyMap[this.font]||this.font:this.font)};t._isPassWordMode=function(){var t=this._style;var e=t.asPassword;if("prompt"in this&&this["prompt"]==this._text)e=false;return e};t._getPassWordTxt=function(t){var e=t.length;var i;i="";for(var r=e;r>0;r--){i+="●"}return i};t._renderText=function(){var t=this.padding;var e=this._lines.length;if(this.overflow!="visible"){e=Math.min(e,Math.floor((this.height-t[0]-t[2])/(this.leading+this._charSize.height))+1)}var i=this.scrollY/(this._charSize.height+this.leading)|0;var r=this.graphics;r.clear(true);var n=this._getContextFont();Yt.context.font=n;var s=t[3];var a="left";var o=this._lines;var h=this.leading+this._charSize.height;var l=this._style.currBitmapFont;if(l){h=this.leading+l.getMaxHeight()}var u=t[0];if(!l&&this._width>0&&this._textWidth<=this._width){if(this.align=="right"){a="right";s=this._width-t[1]}else if(this.align=="center"){a="center";s=this._width*.5+t[3]-t[1]}}if(this._height>0){var c=this._textHeight>this._height?"top":this.valign;if(c==="middle")u=(this._height-e*h)*.5+t[0]-t[2];else if(c==="bottom")u=this._height-e*h-t[2]}var f=this._style;if(l&&l.autoScaleSize){var _=l.fontSize/this.fontSize}if(this._clipPoint){r.save();if(l&&l.autoScaleSize){var d=0;var p=0;this._width?d=this._width-t[3]-t[1]:d=this._textWidth;this._height?p=this._height-t[0]-t[2]:p=this._textHeight;d*=_;p*=_;r.clipRect(t[3],t[0],d,p)}else{r.clipRect(t[3],t[0],this._width?this._width-t[3]-t[1]:this._textWidth,this._height?this._height-t[0]-t[2]:this._textHeight)}this.repaint()}var v=f.asPassword;if("prompt"in this&&this["prompt"]==this._text)v=false;var m=0,g=0;var y=Math.min(this._lines.length,e+i)||1;for(var x=i;x<y;x++){var T=o[x];var b;if(v){var w=T.length;T="";for(var C=w;C>0;C--){T+="●"}}if(T==null)T="";m=s-(this._clipPoint?this._clipPoint.x:0);g=u+h*x-(this._clipPoint?this._clipPoint.y:0);this.underline&&this._drawUnderline(a,m,g,x);if(l){var A=this.width;if(l.autoScaleSize){A=this.width*_}l._drawText(T,this,m,g,this.align,A)}else{this._words||(this._words=[]);if(this._words.length>x-i){b=this._words[x-i]}else{b=new S;this._words.push(b)}b.setText(T);b.splitRender=this._singleCharRender;f.stroke?r.fillBorderText(b,m,g,n,this.color,f.strokeColor,f.stroke,a):r.fillText(b,m,g,n,this.color,a)}}if(l&&l.autoScaleSize){var E=1/_;this.scale(E,E)}if(this._clipPoint)r.restore();this._startX=s;this._startY=u};t._drawUnderline=function(t,e,i,r){var n=this._lineWidths[r];switch(t){case"center":e-=n/2;break;case"right":e-=n;break;case"left":default:break}i+=this._charSize.height;this._graphics.drawLine(e,i,e+n,i,this.underlineColor||this.color,1)};t.typeset=function(){this._isChanged=false;if(!this._text){this._clipPoint=null;this._textWidth=this._textHeight=0;this.graphics.clear(true);return}if(Wt.isConchApp){g.conchTextCanvas.font=this._getContextFont()}else{Yt.context.font=this._getContextFont()}this._lines.length=0;this._lineWidths.length=0;if(this._isPassWordMode()){this._parseLines(this._getPassWordTxt(this._text))}else this._parseLines(this._text);this._evalTextSize();if(this._checkEnabledViewportOrNot())this._clipPoint||(this._clipPoint=new ie(0,0));else this._clipPoint=null;this._renderText()};t._evalTextSize=function(){var t=NaN,e=NaN;t=Math.max.apply(this,this._lineWidths);if(this._style.currBitmapFont)e=this._lines.length*(this._style.currBitmapFont.getMaxHeight()+this.leading)+this.padding[0]+this.padding[2];else e=this._lines.length*(this._charSize.height+this.leading)+this.padding[0]+this.padding[2];if(t!=this._textWidth||e!=this._textHeight){this._textWidth=t;this._textHeight=e}};t._checkEnabledViewportOrNot=function(){return this.overflow=="scroll"&&(this._width>0&&this._textWidth>this._width||this._height>0&&this._textHeight>this._height)};t.changeText=function(t){if(this._text!==t){this.lang(t+"");if(this._graphics&&this._graphics.replaceText(this._text)){}else{this.typeset()}}};t._parseLines=function(t){var e=this.wordWrap||this.overflow=="hidden";if(e){var i=this._getWordWrapWidth()}var r=this._style.currBitmapFont;if(r){this._charSize.width=r.getMaxWidth();this._charSize.height=r.getMaxHeight()}else{var n=null;if(Wt.isConchApp){n=g.conchTextCanvas.measureText(this._testWord)}else{n=Yt.context.measureText(_._testWord)}if(!n)n={width:100};this._charSize.width=n.width;this._charSize.height=n.height||this.fontSize}var s=t.replace(/\r\n/g,"\n").split("\n");for(var a=0,o=s.length;a<o;a++){var h=s[a];if(e)this._parseLine(h,i);else{this._lineWidths.push(this._getTextWidth(h));this._lines.push(h)}}};t._parseLine=function(t,e){var i=Yt.context;var r=this._lines;var n=0;var s;var a=NaN;var o=NaN;var h=0;a=this._getTextWidth(t);if(a<=e){r.push(t);this._lineWidths.push(a);return}a=this._charSize.width;n=Math.floor(e/a);n==0&&(n=1);a=this._getTextWidth(t.substring(0,n));o=a;for(var l=n,u=t.length;l<u;l++){a=this._getTextWidth(t.charAt(l));o+=a;if(o>e){if(this.wordWrap){var c=t.substring(h,l);if(c.charCodeAt(c.length-1)<255){s=/(?:\w|-)+$/.exec(c);if(s){l=s.index+h;if(s.index==0)l+=c.length;else c=t.substring(h,l)}}r.push(c);this._lineWidths.push(o-a);h=l;if(l+n<u){l+=n;a=this._getTextWidth(t.substring(h,l));o=a;l--}else{r.push(t.substring(h,u));this._lineWidths.push(this._getTextWidth(r[r.length-1]));h=-1;break}}else if(this.overflow=="hidden"){r.push(t.substring(0,l));this._lineWidths.push(this._getTextWidth(r[r.length-1]));return}}}if(this.wordWrap&&h!=-1){r.push(t.substring(h,u));this._lineWidths.push(this._getTextWidth(r[r.length-1]))}};t._getTextWidth=function(t){var e=this._style.currBitmapFont;if(e)return e.getTextWidth(t);else{if(Wt.isConchApp){return g.conchTextCanvas.measureText(t).width}else return Yt.context.measureText(t).width}};t._getWordWrapWidth=function(){var t=this.padding;var e=NaN;var i=this._style.currBitmapFont;if(i&&i.autoScaleSize)e=this._width*(i.fontSize/this.fontSize);else e=this._width;if(e<=0){e=this.wordWrap?100:Yt.width}e<=0&&(e=100);return e-t[3]-t[1]};t.getCharPoint=function(t,e){this._isChanged&&y.systemTimer.runCallLater(this,this.typeset);var i=0,r=this._lines,n=0;for(var s=0,a=r.length;s<a;s++){i+=r[s].length;if(t<i){var o=s;break}n=i}var h=(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+this.font;Yt.context.font=h;var l=this._getTextWidth(this._text.substring(n,t));var u=e||new ie;return u.setTo(this._startX+l-(this._clipPoint?this._clipPoint.x:0),this._startY+o*(this._charSize.height+this.leading)-(this._clipPoint?this._clipPoint.y:0))};d(0,t,"width",function(){if(this._width)return this._width;return this.textWidth+this.padding[1]+this.padding[3]},function(t){if(t!=this._width){y.superSet(Ti,this,"width",t);this.isChanged=true;if(this.borderColor){this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1)}}});d(0,t,"textWidth",function(){this._isChanged&&y.systemTimer.runCallLater(this,this.typeset);return this._textWidth});d(0,t,"height",function(){if(this._height)return this._height;return this.textHeight},function(t){if(t!=this._height){y.superSet(Ti,this,"height",t);this.isChanged=true;if(this.borderColor){this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1)}}});d(0,t,"textHeight",function(){this._isChanged&&y.systemTimer.runCallLater(this,this.typeset);return this._textHeight});d(0,t,"padding",function(){return this._style.padding},function(t){if(typeof t=="string"){var e;e=t.split(",");var i=0,r=0;r=e.length;while(e.length<4){e.push(0)}for(i=0;i<r;i++){e[i]=parseFloat(e[i])||0}t=e}this._getTextStyle().padding=t;this.isChanged=true});d(0,t,"bold",function(){return this._style.bold},function(t){this._getTextStyle().bold=t;this.isChanged=true});d(0,t,"text",function(){return this._text||""},function(t){if(this._text!==t){this.lang(t+"");this.isChanged=true;this.event("change");if(this.borderColor){this._setBorderStyleColor(0,0,this.width,this.height,this.borderColor,1)}}});d(0,t,"color",function(){return this._color},function(t){if(this._color!=t){this._color=t;if(!this._isChanged&&this._graphics){this._graphics.replaceTextColor(this.color)}else{this.isChanged=true}}});d(0,t,"font",function(){return this._font},function(t){if(this._style.currBitmapFont){this._getTextStyle().currBitmapFont=null;this.scale(1,1)}if(_._bitmapFonts&&_._bitmapFonts[t]){this._getTextStyle().currBitmapFont=_._bitmapFonts[t]}this._font=t;this.isChanged=true});d(0,t,"fontSize",function(){return this._fontSize},function(t){if(this._fontSize!=t){this._fontSize=t;this.isChanged=true}});d(0,t,"italic",function(){return this._style.italic},function(t){this._getTextStyle().italic=t;this.isChanged=true});d(0,t,"align",function(){return this._style.align},function(t){this._getTextStyle().align=t;this.isChanged=true});d(0,t,"valign",function(){return this._valign},function(t){this._valign=t;this.isChanged=true});d(0,t,"wordWrap",function(){return this._style.wordWrap},function(t){this._getTextStyle().wordWrap=t;this.isChanged=true});d(0,t,"singleCharRender",function(){return this._singleCharRender},function(t){this._singleCharRender=t});d(0,t,"leading",function(){return this._style.leading},function(t){this._getTextStyle().leading=t;this.isChanged=true});d(0,t,"bgColor",function(){return this._style.bgColor},function(t){this._getTextStyle().bgColor=t;this._renderType|=128;this._setBgStyleColor(0,0,this.width,this.height,t);this._setRenderType(this._renderType);this.isChanged=true});d(0,t,"borderColor",function(){return this._style.borderColor},function(t){this._getTextStyle().borderColor=t;this._renderType|=128;this._setBorderStyleColor(0,0,this.width,this.height,t,1);this._setRenderType(this._renderType);this.isChanged=true});d(0,t,"stroke",function(){return this._style.stroke},function(t){this._getTextStyle().stroke=t;this.isChanged=true});d(0,t,"strokeColor",function(){return this._style.strokeColor},function(t){this._getTextStyle().strokeColor=t;this.isChanged=true});d(0,t,"isChanged",null,function(t){if(this._isChanged!==t){this._isChanged=t;t&&y.systemTimer.callLater(this,this.typeset)}});d(0,t,"scrollX",function(){if(!this._clipPoint)return 0;return this._clipPoint.x},function(t){if(this.overflow!="scroll"||(this.textWidth<this._width||!this._clipPoint))return;t=t<this.padding[3]?this.padding[3]:t;var e=this._textWidth-this._width;t=t>e?e:t;this._clipPoint.x=t;this._renderText()});d(0,t,"scrollY",function(){if(!this._clipPoint)return 0;return this._clipPoint.y},function(t){if(this.overflow!="scroll"||(this.textHeight<this._height||!this._clipPoint))return;t=t<this.padding[0]?this.padding[0]:t;var e=this._textHeight-this._height;t=t>e?e:t;this._clipPoint.y=t;this._renderText()});d(0,t,"maxScrollX",function(){return this.textWidth<this._width?0:this._textWidth-this._width});d(0,t,"maxScrollY",function(){return this.textHeight<this._height?0:this._textHeight-this._height});d(0,t,"lines",function(){if(this._isChanged)this.typeset();return this._lines});d(0,t,"underlineColor",function(){return this._style.underlineColor},function(t){this._getTextStyle().underlineColor=t;if(!this._isChanged)this._renderText()});d(0,t,"underline",function(){return this._style.underline},function(t){this._getTextStyle().underline=t});_.defaultFontStr=function(){return _.defaultFontSize+"px "+_.defaultFont};_.registerBitmapFont=function(t,e){_._bitmapFonts||(_._bitmapFonts={});_._bitmapFonts[t]=e};_.unregisterBitmapFont=function(t,e){e===void 0&&(e=true);if(_._bitmapFonts&&_._bitmapFonts[t]){var i=_._bitmapFonts[t];if(e)i.destroy();delete _._bitmapFonts[t]}};_.VISIBLE="visible";_.SCROLL="scroll";_.HIDDEN="hidden";_.defaultFontSize=12;_.defaultFont="Arial";_.langPacks=null;_.isComplexText=false;_._testWord="游";_._bitmapFonts=null;_.CharacterCache=true;_.RightToLeft=false;a(_,["fontFamilyMap",function(){return this.fontFamilyMap={"报隶":"报隶-简","黑体":"黑体-简","楷体":"楷体-简","兰亭黑":"兰亭黑-简","隶变":"隶变-简","凌慧体":"凌慧体-简","翩翩体":"翩翩体-简","苹方":"苹方-简","手札体":"手札体-简","宋体":"宋体-简","娃娃体":"娃娃体-简","魏碑":"魏碑-简","行楷":"行楷-简","雅痞":"雅痞-简","圆体":"圆体-简"}}]);return _}(Ti);var Ii=function(e){function t(){this.loop=false;this.wrapMode=0;this._index=0;this._count=0;this._isPlaying=false;this._labels=null;this._isReverse=false;this._frameRateChanged=false;this._actionName=null;this._controlNode=null;t.__super.call(this);this._interval=Ce.animationInterval;this._setBitUp(16)}v(t,"laya.display.AnimationBase",e);var i=t.prototype;i.play=function(t,e,i){t===void 0&&(t=0);e===void 0&&(e=true);i===void 0&&(i="");this._isPlaying=true;this._actionName=i;this.index=typeof t=="string"?this._getFrameByLabel(t):t;this.loop=e;this._isReverse=this.wrapMode===1;if(this.index==0&&this._isReverse){this.index=this.count-1}if(this.interval>0)this.timerLoop(this.interval,this,this._frameLoop,null,true,true)};i._getFrameByLabel=function(t){for(var e=0;e<this._count;e++){var i=this._labels[e];if(i&&i.indexOf(t)>-1)return e}return 0};i._frameLoop=function(){if(this._isReverse){this._index--;if(this._index<0){if(this.loop){if(this.wrapMode==2){this._index=this._count>0?1:0;this._isReverse=false}else{this._index=this._count-1}this.event("complete")}else{this._index=0;this.stop();this.event("complete");return}}}else{this._index++;if(this._index>=this._count){if(this.loop){if(this.wrapMode==2){this._index=this._count-2>=0?this._count-2:0;this._isReverse=true}else{this._index=0}this.event("complete")}else{this._index--;this.stop();this.event("complete");return}}}this.index=this._index};i._setControlNode=function(t){if(this._controlNode){this._controlNode.off("display",this,this._resumePlay);this._controlNode.off("undisplay",this,this._resumePlay)}this._controlNode=t;if(t&&t!=this){t.on("display",this,this._resumePlay);t.on("undisplay",this,this._resumePlay)}};i._setDisplay=function(t){e.prototype._setDisplay.call(this,t);this._resumePlay()};i._resumePlay=function(){if(this._isPlaying){if(this._controlNode.displayedInStage)this.play(this._index,this.loop,this._actionName);else this.clearTimer(this,this._frameLoop)}};i.stop=function(){this._isPlaying=false;this.clearTimer(this,this._frameLoop)};i.addLabel=function(t,e){if(!this._labels)this._labels={};if(!this._labels[e])this._labels[e]=[];this._labels[e].push(t)};i.removeLabel=function(t){if(!t)this._labels=null;else if(this._labels){for(var e in this._labels){this._removeLabelFromList(this._labels[e],t)}}};i._removeLabelFromList=function(t,e){if(!t)return;for(var i=t.length-1;i>=0;i--){if(t[i]==e){t.splice(i,1)}}};i.gotoAndStop=function(t){this.index=typeof t=="string"?this._getFrameByLabel(t):t;this.stop()};i._displayToIndex=function(t){};i.clear=function(){this.stop();this._labels=null;return this};d(0,i,"interval",function(){return this._interval},function(t){if(this._interval!=t){this._frameRateChanged=true;this._interval=t;if(this._isPlaying&&t>0){this.timerLoop(t,this,this._frameLoop,null,true,true)}}});d(0,i,"isPlaying",function(){return this._isPlaying});d(0,i,"index",function(){return this._index},function(t){this._index=t;this._displayToIndex(t);if(this._labels&&this._labels[t]){var e=this._labels[t];for(var i=0,r=e.length;i<r;i++){this.event("label",e[i])}}});d(0,i,"count",function(){return this._count});t.WRAP_POSITIVE=0;t.WRAP_REVERSE=1;t.WRAP_PINGPONG=2;return t}(Ti);var Pi=function(t){function u(t,e,i,r,n){this._attribInfo=null;this.customCompile=false;this._curActTexIndex=0;this.tag={};this._program=null;this._params=null;this._paramsMap={};u.__super.call(this);if(!t||!e)throw"Shader Error";this._attribInfo=n;this._id=++u._count;this._vs=t;this._ps=e;this._nameMap=r?r:{};i!=null&&(u.sharders[i]=this);this.recreateResource();this.lock=true}v(u,"laya.webgl.shader.Shader",t);var e=u.prototype;e.recreateResource=function(){this._compile();this._setGPUMemory(0)};e._disposeResource=function(){Bt.mainContext.deleteShader(this._vshader);Bt.mainContext.deleteShader(this._pshader);Bt.mainContext.deleteProgram(this._program);this._vshader=this._pshader=this._program=null;this._params=null;this._paramsMap={};this._setGPUMemory(0);this._curActTexIndex=0};e._compile=function(){if(!this._vs||!this._ps||this._params)return;this._reCompile=true;this._params=[];var t;if(this.customCompile)t=Oe.preGetParams(this._vs,this._ps);var e=Bt.mainContext;this._program=e.createProgram();this._vshader=u._createShader(e,this._vs,35633);this._pshader=u._createShader(e,this._ps,35632);e.attachShader(this._program,this._vshader);e.attachShader(this._program,this._pshader);var i,r=0,n=0,s=0,a;var o=this._attribInfo?this._attribInfo.length:0;for(r=0;r<o;r+=2){e.bindAttribLocation(this._program,this._attribInfo[r+1],this._attribInfo[r])}e.linkProgram(this._program);if(!this.customCompile&&!e.getProgramParameter(this._program,35714)){throw e.getProgramInfoLog(this._program)}var h=this.customCompile?t.uniforms.length:e.getProgramParameter(this._program,35718);for(r=0;r<h;r++){var l=this.customCompile?t.uniforms[r]:e.getActiveUniform(this._program,r);a=e.getUniformLocation(this._program,l.name);i={vartype:"uniform",glfun:null,ivartype:1,location:a,name:l.name,type:l.type,isArray:false,isSame:false,preValue:null,indexOfParams:0};if(i.name.indexOf("[0]")>0){i.name=i.name.substr(0,i.name.length-3);i.isArray=true;i.location=e.getUniformLocation(this._program,i.name)}this._params.push(i)}for(r=0,s=this._params.length;r<s;r++){i=this._params[r];i.indexOfParams=r;i.index=1;i.value=[i.location,null];i.codename=i.name;i.name=this._nameMap[i.codename]?this._nameMap[i.codename]:i.codename;this._paramsMap[i.name]=i;i._this=this;i.uploadedValue=[];switch(i.type){case 5124:i.fun=i.isArray?this._uniform1iv:this._uniform1i;break;case 5126:i.fun=i.isArray?this._uniform1fv:this._uniform1f;break;case 35664:i.fun=i.isArray?this._uniform_vec2v:this._uniform_vec2;break;case 35665:i.fun=i.isArray?this._uniform_vec3v:this._uniform_vec3;break;case 35666:i.fun=i.isArray?this._uniform_vec4v:this._uniform_vec4;break;case 35678:i.fun=this._uniform_sampler2D;break;case 35680:i.fun=this._uniform_samplerCube;break;case 35676:i.glfun=e.uniformMatrix4fv;i.fun=this._uniformMatrix4fv;break;case 35670:i.fun=this._uniform1i;break;case 35674:case 35675:throw new Error("compile shader err!");default:throw new Error("compile shader err!")}}};e.getUniform=function(t){return this._paramsMap[t]};e._uniform1f=function(t,e){var i=t.uploadedValue;if(i[0]!==e){Bt.mainContext.uniform1f(t.location,i[0]=e);return 1}return 0};e._uniform1fv=function(t,e){if(e.length<4){var i=t.uploadedValue;if(i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]){Bt.mainContext.uniform1fv(t.location,e);i[0]=e[0];i[1]=e[1];i[2]=e[2];i[3]=e[3];return 1}return 0}else{Bt.mainContext.uniform1fv(t.location,e);return 1}};e._uniform_vec2=function(t,e){var i=t.uploadedValue;if(i[0]!==e[0]||i[1]!==e[1]){Bt.mainContext.uniform2f(t.location,i[0]=e[0],i[1]=e[1]);return 1}return 0};e._uniform_vec2v=function(t,e){if(e.length<2){var i=t.uploadedValue;if(i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]){Bt.mainContext.uniform2fv(t.location,e);i[0]=e[0];i[1]=e[1];i[2]=e[2];i[3]=e[3];return 1}return 0}else{Bt.mainContext.uniform2fv(t.location,e);return 1}};e._uniform_vec3=function(t,e){var i=t.uploadedValue;if(i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]){Bt.mainContext.uniform3f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]);return 1}return 0};e._uniform_vec3v=function(t,e){Bt.mainContext.uniform3fv(t.location,e);return 1};e._uniform_vec4=function(t,e){var i=t.uploadedValue;if(i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]){Bt.mainContext.uniform4f(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]);return 1}return 0};e._uniform_vec4v=function(t,e){Bt.mainContext.uniform4fv(t.location,e);return 1};e._uniformMatrix2fv=function(t,e){Bt.mainContext.uniformMatrix2fv(t.location,false,e);return 1};e._uniformMatrix3fv=function(t,e){Bt.mainContext.uniformMatrix3fv(t.location,false,e);return 1};e._uniformMatrix4fv=function(t,e){Bt.mainContext.uniformMatrix4fv(t.location,false,e);return 1};e._uniform1i=function(t,e){var i=t.uploadedValue;if(i[0]!==e){Bt.mainContext.uniform1i(t.location,i[0]=e);return 1}return 0};e._uniform1iv=function(t,e){Bt.mainContext.uniform1iv(t.location,e);return 1};e._uniform_ivec2=function(t,e){var i=t.uploadedValue;if(i[0]!==e[0]||i[1]!==e[1]){Bt.mainContext.uniform2i(t.location,i[0]=e[0],i[1]=e[1]);return 1}return 0};e._uniform_ivec2v=function(t,e){Bt.mainContext.uniform2iv(t.location,e);return 1};e._uniform_vec3i=function(t,e){var i=t.uploadedValue;if(i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]){Bt.mainContext.uniform3i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2]);return 1}return 0};e._uniform_vec3vi=function(t,e){Bt.mainContext.uniform3iv(t.location,e);return 1};e._uniform_vec4i=function(t,e){var i=t.uploadedValue;if(i[0]!==e[0]||i[1]!==e[1]||i[2]!==e[2]||i[3]!==e[3]){Bt.mainContext.uniform4i(t.location,i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[3]);return 1}return 0};e._uniform_vec4vi=function(t,e){Bt.mainContext.uniform4iv(t.location,e);return 1};e._uniform_sampler2D=function(t,e){var i=Bt.mainContext;var r=t.uploadedValue;if(r[0]==null){r[0]=this._curActTexIndex;i.uniform1i(t.location,this._curActTexIndex);ft.activeTexture(i,33984+this._curActTexIndex);ft.bindTexture(i,3553,e);this._curActTexIndex++;return 1}else{ft.activeTexture(i,33984+r[0]);ft.bindTexture(i,3553,e);return 0}};e._uniform_samplerCube=function(t,e){var i=Bt.mainContext;var r=t.uploadedValue;if(r[0]==null){r[0]=this._curActTexIndex;i.uniform1i(t.location,this._curActTexIndex);ft.activeTexture(i,33984+this._curActTexIndex);ft.bindTexture(i,34067,e);this._curActTexIndex++;return 1}else{ft.activeTexture(i,33984+r[0]);ft.bindTexture(i,34067,e);return 0}};e._noSetValue=function(t){console.log("no....:"+t.name)};e.uploadOne=function(t,e){ft.useProgram(Bt.mainContext,this._program);var i=this._paramsMap[t];i.fun.call(this,i,e)};e.uploadTexture2D=function(t){var e=ft;if(e._activeTextures[0]!==t){e.bindTexture(Bt.mainContext,e.TEXTURE_2D,t);e._activeTextures[0]=t}};e.upload=function(t,e){bi.activeShader=bi.bindShader=this;var i=Bt.mainContext;ft.useProgram(i,this._program);if(this._reCompile){e=this._params;this._reCompile=false}else{e=e||this._params}var r,n,s=e.length,a=0;for(var o=0;o<s;o++){r=e[o];if((n=t[r.name])!==null)a+=r.fun.call(this,r,n)}I.shaderCall+=a};e.uploadArray=function(t,e,i){bi.activeShader=this;bi.bindShader=this;ft.useProgram(Bt.mainContext,this._program);var r=this._params,n;var s,a=0;for(var o=e-2;o>=0;o-=2){s=this._paramsMap[t[o]];if(!s)continue;n=t[o+1];if(n!=null){i&&i[s.name]&&i[s.name].bind();a+=s.fun.call(this,s,n)}}I.shaderCall+=a};e.getParams=function(){return this._params};e.setAttributesLocation=function(t){this._attribInfo=t};u.getShader=function(t){return u.sharders[t]};u.create=function(t,e,i,r,n){return new u(t,e,i,r,n)};u.withCompile=function(t,e,i,r){if(i&&u.sharders[i])return u.sharders[i];var n=u._preCompileShader[2e-4*t];if(!n)throw new Error("withCompile shader err!"+t);return n.createShader(e,i,r,null)};u.withCompile2D=function(t,e,i,r,n,s){if(r&&u.sharders[r])return u.sharders[r];var a=u._preCompileShader[2e-4*t+e];if(!a)throw new Error("withCompile shader err!"+t+" "+e);return a.createShader(i,r,n,s)};u.addInclude=function(t,e){Oe.addInclude(t,e)};u.preCompile=function(t,e,i,r){var n=2e-4*t;u._preCompileShader[n]=new Oe(e,i,r)};u.preCompile2D=function(t,e,i,r,n){var s=2e-4*t+e;u._preCompileShader[s]=new Oe(i,r,n)};u._createShader=function(t,e,i){var r=t.createShader(i);t.shaderSource(r,e);t.compileShader(r);if(t.getShaderParameter(r,35713)){return r}else{console.log(t.getShaderInfoLog(r));return null}};u._count=0;u._preCompileShader={};u.SHADERNAME2ID=2e-4;u.sharders=new Array(32);a(u,["nameKey",function(){return this.nameKey=new Qt}]);return u}(bi);var Di=function(t){function e(){this.url=null;this._channel=null;this._tar=null;this._playEvents=null;this._stopEvents=null;e.__super.call(this);this.visible=false;this.on("added",this,this._onParentChange);this.on("removed",this,this._onParentChange)}v(e,"laya.media.SoundNode",t);var i=e.prototype;i._onParentChange=function(){this.target=this.parent};i.play=function(t,e){t===void 0&&(t=1);if(isNaN(t)){t=1}if(!this.url)return;this.stop();this._channel=We.playSound(this.url,t,e)};i.stop=function(){if(this._channel&&!this._channel.isStopped){this._channel.stop()}this._channel=null};i._setPlayAction=function(t,e,i,r){r===void 0&&(r=true);if(!this[i])return;if(!t)return;if(r){t.on(e,this,this[i])}else{t.off(e,this,this[i])}};i._setPlayActions=function(t,e,i,r){r===void 0&&(r=true);if(!t)return;if(!e)return;var n=e.split(",");var s=0,a=0;a=n.length;for(s=0;s<a;s++){this._setPlayAction(t,n[s],i,r)}};d(0,i,"playEvent",null,function(t){this._playEvents=t;if(!t)return;if(this._tar){this._setPlayActions(this._tar,t,"play")}});d(0,i,"target",null,function(t){if(this._tar){this._setPlayActions(this._tar,this._playEvents,"play",false);this._setPlayActions(this._tar,this._stopEvents,"stop",false)}this._tar=t;if(this._tar){this._setPlayActions(this._tar,this._playEvents,"play",true);this._setPlayActions(this._tar,this._stopEvents,"stop",true)}});d(0,i,"stopEvent",null,function(t){this._stopEvents=t;if(!t)return;if(this._tar){this._setPlayActions(this._tar,t,"stop")}});return e}(Ti);var Li=function(t){function i(t,e){i.__super.call(this);this._wrapModeU=0;this._wrapModeV=0;this._filterMode=1;this._readyed=false;this._width=-1;this._height=-1;this._format=t;this._mipmap=e;this._anisoLevel=1;this._glTexture=Xt.instance.createTexture()}v(i,"laya.resource.BaseTexture",t);var e=i.prototype;e._isPot=function(t){return(t&t-1)===0};e._getGLFormat=function(){var t=0;switch(this._format){case 0:t=6407;break;case 1:t=6408;break;case 2:t=6406;break;case 3:if(ft._compressedTextureS3tc)t=ft._compressedTextureS3tc.COMPRESSED_RGB_S3TC_DXT1_EXT;else throw"BaseTexture: not support DXT1 format.";break;case 4:if(ft._compressedTextureS3tc)t=ft._compressedTextureS3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;else throw"BaseTexture: not support DXT5 format.";break;case 5:if(ft._compressedTextureEtc1)t=ft._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL;else throw"BaseTexture: not support ETC1RGB format.";break;case 9:if(ft._compressedTexturePvrtc)t=ft._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGB_2BPPV format.";break;case 10:if(ft._compressedTexturePvrtc)t=ft._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGBA_2BPPV format.";break;case 11:if(ft._compressedTexturePvrtc)t=ft._compressedTexturePvrtc.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGB_4BPPV format.";break;case 12:if(ft._compressedTexturePvrtc)t=ft._compressedTexturePvrtc.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;else throw"BaseTexture: not support PVRTCRGBA_4BPPV format.";break;default:throw"BaseTexture: unknown texture format."}return t};e._setFilterMode=function(t){var e=Xt.instance;ft.bindTexture(e,this._glTextureType,this._glTexture);switch(t){case 0:if(this._mipmap)e.texParameteri(this._glTextureType,10241,9984);else e.texParameteri(this._glTextureType,10241,9728);e.texParameteri(this._glTextureType,10240,9728);break;case 1:if(this._mipmap)e.texParameteri(this._glTextureType,10241,9985);else e.texParameteri(this._glTextureType,10241,9729);e.texParameteri(this._glTextureType,10240,9729);break;case 2:if(this._mipmap)e.texParameteri(this._glTextureType,10241,9987);else e.texParameteri(this._glTextureType,10241,9729);e.texParameteri(this._glTextureType,10240,9729);break;default:throw new Error("BaseTexture:unknown filterMode value.")}};e._setWarpMode=function(t,e){var i=Xt.instance;ft.bindTexture(i,this._glTextureType,this._glTexture);if(this._isPot(this._width)&&this._isPot(this._height)){switch(e){case 0:i.texParameteri(this._glTextureType,t,10497);break;case 1:i.texParameteri(this._glTextureType,t,33071);break}}else{i.texParameteri(this._glTextureType,t,33071)}};e._setAnisotropy=function(t){var e=ft._extTextureFilterAnisotropic;if(e&&!Yt.onLimixiu){t=Math.max(t,1);var i=Xt.instance;ft.bindTexture(i,this._glTextureType,this._glTexture);t=Math.min(i.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT),t);i.texParameterf(this._glTextureType,e.TEXTURE_MAX_ANISOTROPY_EXT,t)}};e._disposeResource=function(){if(this._glTexture){Xt.instance.deleteTexture(this._glTexture);this._glTexture=null;this._setGPUMemory(0)}};e._getSource=function(){if(this._readyed)return this._glTexture;else return null};e.generateMipmap=function(){if(this._isPot(this.width)&&this._isPot(this.height))Xt.instance.generateMipmap(this._glTextureType)};d(0,e,"wrapModeU",function(){return this._wrapModeU},function(t){if(this._wrapModeU!==t){this._wrapModeU=t;this._width!==-1&&this._setWarpMode(10242,t)}});d(0,e,"mipmap",function(){return this._mipmap});d(0,e,"format",function(){return this._format});d(0,e,"wrapModeV",function(){return this._wrapModeV},function(t){if(this._wrapModeV!==t){this._wrapModeV=t;this._height!==-1&&this._setWarpMode(10243,t)}});d(0,e,"defaulteTexture",function(){throw"BaseTexture:must override it."});d(0,e,"filterMode",function(){return this._filterMode},function(t){if(t!==this._filterMode){this._filterMode=t;this._width!==-1&&this._height!==-1&&this._setFilterMode(t)}});d(0,e,"anisoLevel",function(){return this._anisoLevel},function(t){if(t!==this._anisoLevel){this._anisoLevel=Math.max(1,Math.min(16,t));this._width!==-1&&this._height!==-1&&this._setAnisotropy(t)}});i.WARPMODE_REPEAT=0;i.WARPMODE_CLAMP=1;i.FILTERMODE_POINT=0;i.FILTERMODE_BILINEAR=1;i.FILTERMODE_TRILINEAR=2;i.FORMAT_R8G8B8=0;i.FORMAT_R8G8B8A8=1;i.FORMAT_ALPHA8=2;i.FORMAT_DXT1=3;i.FORMAT_DXT5=4;i.FORMAT_ETC1RGB=5;i.FORMAT_PVRTCRGB_2BPPV=9;i.FORMAT_PVRTCRGBA_2BPPV=10;i.FORMAT_PVRTCRGB_4BPPV=11;i.FORMAT_PVRTCRGBA_4BPPV=12;i.FORMAT_DEPTH_16=0;i.FORMAT_STENCIL_8=1;i.FORMAT_DEPTHSTENCIL_16_8=2;i.FORMAT_DEPTHSTENCIL_NONE=3;return i}(wi);var Bi=function(t){function e(t){e.__super.call(this);t===void 0&&(t=false);if(t)this._source=Yt.createElement("canvas");else{this._source=this}this.lock=true}v(e,"laya.resource.HTMLCanvas",t);var i=e.prototype;i._getSource=function(){return this._source};i.clear=function(){this._ctx&&this._ctx.clear&&this._ctx.clear();if(this._texture){this._texture.destroy();this._texture=null}};i.destroy=function(){laya.resource.Resource.prototype.destroy.call(this);this._setCPUMemory(0);this._ctx&&this._ctx.destroy();this._ctx=null};i.release=function(){};i._setContext=function(t){this._ctx=t};i.getContext=function(t,e){return this.context};i.getMemSize=function(){return 0};i.size=function(t,e){if(this._width!=t||this._height!=e||this._source&&(this._source.width!=t||this._source.height!=e)){this._width=t;this._height=e;this._setCPUMemory(t*e*4);this._ctx&&this._ctx.size&&this._ctx.size(t,e);this._source&&(this._source.height=e,this._source.width=t);if(this._texture){this._texture.destroy();this._texture=null}}};i.getTexture=function(){if(!this._texture){var t=new Xi;t.loadImageSource(this.source);this._texture=new ti(t)}return this._texture};i.toBase64=function(t,e){if(this._source){if(Wt.isConchApp){if(conchConfig.threadMode==2){throw"native 2 thread mode use toBase64Async"}var i=this._ctx._targets.sourceWidth;var r=this._ctx._targets.sourceHeight;var n=this._ctx._targets.getData(0,0,i,r);return conchToBase64FlipY?conchToBase64FlipY(t,e,n.buffer,i,r):conchToBase64(t,e,n.buffer,i,r)}else{return this._source.toDataURL(t,e)}}return null};i.toBase64Async=function(i,r,n){var s=this._ctx._targets.sourceWidth;var a=this._ctx._targets.sourceHeight;this._ctx._targets.getDataAsync(0,0,s,a,function(t){var e=conchToBase64FlipY?conchToBase64FlipY(i,r,t.buffer,s,a):conchToBase64(i,r,t.buffer,s,a);n(e)})};d(0,i,"source",function(){return this._source});d(0,i,"context",function(){if(this._ctx)return this._ctx;if(this._source==this){this._ctx=new xt}else{this._ctx=this._source.getContext(Wt.isConchApp?"layagl":"2d")}this._ctx._canvas=this;return this._ctx});return e}(wi);var Fi=function(t){function e(){e.__super.call(this)}v(e,"laya.resource.HTMLImage",t);e.create=function(t,e,i){var r=new Xi(t,e,i,false,false);r.wrapModeU=1;r.wrapModeV=1;return r};return e}(wi);var Oi=function(l){function u(){this.focus=null;this._frameRate="fast";this.designWidth=0;this.designHeight=0;this.canvasRotation=false;this.canvasDegree=0;this.renderingEnabled=true;this.screenAdaptationEnabled=true;this._screenMode="none";this._scaleMode="noscale";this._alignV="top";this._alignH="left";this._bgColor="black";this._mouseMoveTime=0;this._renderCount=0;this._safariOffsetY=0;this._frameStartTime=0;this._isFocused=false;this._isVisibility=false;this._wgColor=[0,0,0,1];this._scene3Ds=[];this._globalRepaintSet=false;this._globalRepaintGet=false;this._curUIBase=null;this.useRetinalCanvas=false;u.__super.call(this);this.offset=new ie;this._canvasTransform=new pt;this._previousOrientation=Yt.window.orientation;this._3dUI=[];var e=this;this.transform=this._createTransform();this.mouseEnabled=true;this.hitTestPrior=true;this.autoSize=false;this._setBit(128,true);this._setBit(2,true);this._isFocused=true;this._isVisibility=true;this.useRetinalCanvas=Ce.useRetinalCanvas;var t=Yt.window;var i=this;t.addEventListener("focus",function(){e._isFocused=true;i.event("focus");i.event("focuschange")});t.addEventListener("blur",function(){e._isFocused=false;i.event("blur");i.event("focuschange");if(i._isInputting())Ui["inputElement"].target.focus=false});var r="hidden",n="visibilityState",s="visibilitychange";var a=t.document;if(typeof a.hidden!=="undefined"){s="visibilitychange";n="visibilityState"}else if(typeof a.mozHidden!=="undefined"){s="mozvisibilitychange";n="mozVisibilityState"}else if(typeof a.msHidden!=="undefined"){s="msvisibilitychange";n="msVisibilityState"}else if(typeof a.webkitHidden!=="undefined"){s="webkitvisibilitychange";n="webkitVisibilityState"}t.document.addEventListener(s,o);function o(){if(Yt.document[n]=="hidden"){e._isVisibility=false;if(i._isInputting())Ui["inputElement"].target.focus=false}else{e._isVisibility=true}e.renderingEnabled=e._isVisibility;i.event("visibilitychange")}t.addEventListener("resize",function(){var t=Yt.window.orientation;if(t!=null&&t!=e._previousOrientation&&i._isInputting()){Ui["inputElement"].target.focus=false}e._previousOrientation=t;if(i._isInputting())return;if(Yt.onSafari)i._safariOffsetY=(Yt.window.__innerHeight||Yt.document.body.clientHeight||Yt.document.documentElement.clientHeight)-Yt.window.innerHeight;i._resetCanvas()});t.addEventListener("orientationchange",function(t){i._resetCanvas()});this.on("mousemove",this,this._onmouseMove);if(Yt.onMobile)this.on("mousedown",this,this._onmouseMove)}v(u,"laya.display.Stage",l);var t=u.prototype;t._isInputting=function(){return Yt.onMobile&&Ui.isInputting};t._changeCanvasSize=function(){this.setScreenSize(Yt.clientWidth*Yt.pixelRatio,Yt.clientHeight*Yt.pixelRatio)};t._resetCanvas=function(){if(!this.screenAdaptationEnabled)return;this._changeCanvasSize()};t.setScreenSize=function(t,e){var i=false;if(this._screenMode!=="none"){var r=t/e<1?"vertical":"horizontal";i=r!==this._screenMode;if(i){var n=e;e=t;t=n}}this.canvasRotation=i;var s=Wt._mainCanvas;var a=s.source.style;var o=this._canvasTransform.identity();var h=this._scaleMode;var l=t/this.designWidth;var u=e/this.designHeight;var c=this.useRetinalCanvas?t:this.designWidth;var f=this.useRetinalCanvas?e:this.designHeight;var _=t;var d=e;var p=Yt.pixelRatio;this._width=this.designWidth;this._height=this.designHeight;switch(h){case"noscale":l=u=1;_=this.designWidth;d=this.designHeight;break;case"showall":l=u=Math.min(l,u);c=_=Math.round(this.designWidth*l);f=d=Math.round(this.designHeight*u);break;case"noborder":l=u=Math.max(l,u);_=Math.round(this.designWidth*l);d=Math.round(this.designHeight*u);break;case"full":l=u=1;this._width=c=t;this._height=f=e;break;case"fixedwidth":u=l;this._height=f=Math.round(e/l);break;case"fixedheight":l=u;this._width=c=Math.round(t/u);break;case"fixedauto":if(t/e<this.designWidth/this.designHeight){u=l;this._height=f=Math.round(e/l)}else{l=u;this._width=c=Math.round(t/u)}break}if(this.useRetinalCanvas){c=t;f=e}l*=this.scaleX;u*=this.scaleY;if(l===1&&u===1){this.transform.identity()}else{this.transform.a=this._formatData(l/(_/c));this.transform.d=this._formatData(u/(d/f))}s.size(c,f);Pe.changeWebGLSize(c,f);o.scale(_/c/p,d/f/p);if(this._alignH==="left")this.offset.x=0;else if(this._alignH==="right")this.offset.x=t-_;else this.offset.x=(t-_)*.5/p;if(this._alignV==="top")this.offset.y=0;else if(this._alignV==="bottom")this.offset.y=e-d;else this.offset.y=(e-d)*.5/p;this.offset.x=Math.round(this.offset.x);this.offset.y=Math.round(this.offset.y);o.translate(this.offset.x,this.offset.y);if(this._safariOffsetY)o.translate(0,this._safariOffsetY);this.canvasDegree=0;if(i){if(this._screenMode==="horizontal"){o.rotate(Math.PI/2);o.translate(e/p,0);this.canvasDegree=90}else{o.rotate(-Math.PI/2);o.translate(0,t/p);this.canvasDegree=-90}}o.a=this._formatData(o.a);o.d=this._formatData(o.d);o.tx=this._formatData(o.tx);o.ty=this._formatData(o.ty);this.transform=this.transform;a.transformOrigin=a.webkitTransformOrigin=a.msTransformOrigin=a.mozTransformOrigin=a.oTransformOrigin="0px 0px 0px";a.transform=a.webkitTransform=a.msTransform=a.mozTransform=a.oTransform="matrix("+o.toString()+")";if(this._safariOffsetY)o.translate(0,-this._safariOffsetY);o.translate(parseInt(a.left)||0,parseInt(a.top)||0);this.visible=true;this._repaint|=2;this.event("resize")};t._formatData=function(t){if(Math.abs(t)<1e-6)return 0;if(Math.abs(1-t)<.001)return t>0?1:-1;return t};t.getMousePoint=function(){return ie.TEMP.setTo(this.mouseX,this.mouseY)};t.repaint=function(t){t===void 0&&(t=2);this._repaint|=t};t.parentRepaint=function(t){t===void 0&&(t=2)};t._loop=function(){this._globalRepaintGet=this._globalRepaintSet;this._globalRepaintSet=false;this.render(Wt._context,0,0);return true};t.getFrameTm=function(){return this._frameStartTime};t._onmouseMove=function(t){this._mouseMoveTime=Yt.now()};t.getTimeFromFrameStart=function(){return Yt.now()-this._frameStartTime};t.render=function(t,e,i){u._dbgSprite.graphics.clear();if(this._frameRate==="sleep"){var r=Yt.now();if(r-this._frameStartTime>=1e3)this._frameStartTime=r;else return}else{if(!this._visible){this._renderCount++;if(this._renderCount%5===0){he.I._update();I.loopCount++;this._updateTimers()}return}this._frameStartTime=Yt.now()}this._renderCount++;var n=this._frameRate==="mouse"?this._frameStartTime-this._mouseMoveTime<2e3?"fast":"slow":this._frameRate;var s=n!=="slow";var a=this._renderCount%2===0;I.renderSlow=!s;if(s||a){he.I._update();I.loopCount++;if(this.renderingEnabled){for(var o=0,h=this._scene3Ds.length;o<h;o++)this._scene3Ds[o]._update();t.clear();l.prototype.render.call(this,t,e,i);I._show&&I._sp&&I._sp.render(t,e,i)}}u._dbgSprite.render(t,0,0);if(s||!a){if(this.renderingEnabled){Pe.clear(this._bgColor);t.flush();L.instance&&L.getInstance().endDispose()}this._updateTimers()}};t.renderToNative=function(t,e,i){this._renderCount++;if(!this._visible){if(this._renderCount%5===0){he.I._update();I.loopCount++;this._updateTimers()}return}he.I._update();I.loopCount++;if(this.renderingEnabled){for(var r=0,n=this._scene3Ds.length;r<n;r++)this._scene3Ds[r]._update();t.clear();l.prototype.render.call(this,t,e,i);I._show&&I._sp&&I._sp.render(t,e,i)}if(this.renderingEnabled){Pe.clear(this._bgColor);t.flush();L.instance&&L.getInstance().endDispose()}this._updateTimers()};t._updateTimers=function(){y.systemTimer._update();y.startTimer._update();y.physicsTimer._update();y.updateTimer._update();y.lateTimer._update();y.timer._update()};t._requestFullscreen=function(){var t=Yt.document.documentElement;if(t.requestFullscreen){t.requestFullscreen()}else if(t.mozRequestFullScreen){t.mozRequestFullScreen()}else if(t.webkitRequestFullscreen){t.webkitRequestFullscreen()}else if(t.msRequestFullscreen){t.msRequestFullscreen()}};t._fullScreenChanged=function(){y.stage.event("fullscreenchange")};t.exitFullscreen=function(){var t=Yt.document;if(t.exitFullscreen){t.exitFullscreen()}else if(t.mozCancelFullScreen){t.mozCancelFullScreen()}else if(t.webkitExitFullscreen){t.webkitExitFullscreen()}};t.isGlobalRepaint=function(){return this._globalRepaintGet};t.setGlobalRepaint=function(){this._globalRepaintSet=true};t.add3DUI=function(t){var e=t.rootView;if(this._3dUI.indexOf(e)>=0)return;this._3dUI.push(e)};t.remove3DUI=function(t){var e=t.rootView;var i=this._3dUI.indexOf(e);if(i>=0){this._3dUI.splice(i,1);return true}return false};d(0,t,"clientScaleY",function(){return this._transform?this._transform.getScaleY():1});d(0,t,"width",l.prototype._$get_width,function(t){this.designWidth=t;y.superSet(Ti,this,"width",t);y.systemTimer.callLater(this,this._changeCanvasSize)});d(0,t,"isFocused",function(){return this._isFocused});d(0,t,"alignH",function(){return this._alignH},function(t){this._alignH=t;y.systemTimer.callLater(this,this._changeCanvasSize)});d(0,t,"height",l.prototype._$get_height,function(t){this.designHeight=t;y.superSet(Ti,this,"height",t);y.systemTimer.callLater(this,this._changeCanvasSize)});d(0,t,"transform",function(){if(this._tfChanged)this._adjustTransform();return this._transform=this._transform||this._createTransform()},l.prototype._$set_transform);d(0,t,"isVisibility",function(){return this._isVisibility});d(0,t,"scaleMode",function(){return this._scaleMode},function(t){this._scaleMode=t;y.systemTimer.callLater(this,this._changeCanvasSize)});d(0,t,"alignV",function(){return this._alignV},function(t){this._alignV=t;y.systemTimer.callLater(this,this._changeCanvasSize)});d(0,t,"bgColor",function(){return this._bgColor},function(t){this._bgColor=t;if(t)this._wgColor=x.create(t).arrColor;else this._wgColor=null;if(Yt.onLimixiu){this._wgColor=x.create(t).arrColor}else if(t){Wt.canvas.style.background=t}else{Wt.canvas.style.background="none"}});d(0,t,"mouseX",function(){return Math.round(D.instance.mouseX/this.clientScaleX)});d(0,t,"mouseY",function(){return Math.round(D.instance.mouseY/this.clientScaleY)});d(0,t,"clientScaleX",function(){return this._transform?this._transform.getScaleX():1});d(0,t,"screenMode",function(){return this._screenMode},function(t){this._screenMode=t});d(0,t,"visible",l.prototype._$get_visible,function(t){if(this.visible!==t){y.superSet(Ti,this,"visible",t);var e=Wt._mainCanvas.source.style;e.visibility=t?"visible":"hidden"}});d(0,t,"fullScreenEnabled",null,function(t){var e=Yt.document;var i=Wt.canvas;if(t){i.addEventListener("mousedown",this._requestFullscreen);i.addEventListener("touchstart",this._requestFullscreen);e.addEventListener("fullscreenchange",this._fullScreenChanged);e.addEventListener("mozfullscreenchange",this._fullScreenChanged);e.addEventListener("webkitfullscreenchange",this._fullScreenChanged);e.addEventListener("msfullscreenchange",this._fullScreenChanged)}else{i.removeEventListener("mousedown",this._requestFullscreen);i.removeEventListener("touchstart",this._requestFullscreen);e.removeEventListener("fullscreenchange",this._fullScreenChanged);e.removeEventListener("mozfullscreenchange",this._fullScreenChanged);e.removeEventListener("webkitfullscreenchange",this._fullScreenChanged);e.removeEventListener("msfullscreenchange",this._fullScreenChanged)}});d(0,t,"frameRate",function(){if(!Wt.isConchApp){return this._frameRate}else{return this._frameRateNative}},function(t){if(!Wt.isConchApp){this._frameRate=t}else{switch(t){case"fast":g.conch.config.setLimitFPS(60);break;case"mouse":g.conch.config.setMouseFrame(2e3);break;case"slow":g.conch.config.setSlowFrame(true);break;case"sleep":g.conch.config.setLimitFPS(1);break}this._frameRateNative=t}});u.SCALE_NOSCALE="noscale";u.SCALE_EXACTFIT="exactfit";u.SCALE_SHOWALL="showall";u.SCALE_NOBORDER="noborder";u.SCALE_FULL="full";u.SCALE_FIXED_WIDTH="fixedwidth";u.SCALE_FIXED_HEIGHT="fixedheight";u.SCALE_FIXED_AUTO="fixedauto";u.ALIGN_LEFT="left";u.ALIGN_RIGHT="right";u.ALIGN_CENTER="center";u.ALIGN_TOP="top";u.ALIGN_MIDDLE="middle";u.ALIGN_BOTTOM="bottom";u.SCREEN_NONE="none";u.SCREEN_HORIZONTAL="horizontal";u.SCREEN_VERTICAL="vertical";u.FRAME_FAST="fast";u.FRAME_SLOW="slow";u.FRAME_MOUSE="mouse";u.FRAME_SLEEP="sleep";a(u,["_dbgSprite",function(){return this._dbgSprite=new Ti}]);return u}(Ti);var Ni=function(t){function _(){this.datas=[];this.hud_width=800;this.hud_height=200;this.gMinV=0;this.gMaxV=100;this.textSpace=40;this._now=null;this.sttm=0;_.__super.call(this);this.xdata=new Array(_.DATANUM);this.ydata=new Array(_.DATANUM);_.inst=this;this._renderType|=2048;this._setRenderType(this._renderType);this._setCustomRender();this.addDataDef(0,16777215,"frame",1);this.addDataDef(1,65280,"update",1);this.addDataDef(2,16711680,"flush",1);this._now=performance?performance.now.bind(performance):Date.now}v(_,"laya.utils.PerfHUD",t);var e=_.prototype;e.now=function(){return this._now()};e.start=function(){this.sttm=this._now()};e.end=function(t){var e=this._now()-this.sttm;this.updateValue(t,e)};e.config=function(t,e){this.hud_width=t;this.hud_height=e};e.addDataDef=function(t,e,i,r){this.datas[t]=new vt(t,e,i,r)};e.updateValue=function(t,e){this.datas[t].addData(e)};e.v2y=function(t){var e=this._y+this.hud_height*(1-(t-this.gMinV)/this.gMaxV);return this._y+this.hud_height*(1-(t-this.gMinV)/this.gMaxV)};e.drawHLine=function(t,e,i,r){var n=this._x;var s=this._x+this.hud_width;var a=this.v2y(e);t.fillText(r,n,a-6,null,"green",null);n+=this.textSpace;t.fillStyle=i;t.fillRect(n,a,this._x+this.hud_width,1,null)};e.customRender=function(t,e,i){var r=performance.now();if(_._lastTm<=0)_._lastTm=r;this.updateValue(0,r-_._lastTm);_._lastTm=r;t.save();t.fillRect(this._x,this._y,this.hud_width,this.hud_height+4,"#000000cc");t.globalAlpha=.9;this.drawHLine(t,0,"green","    0");this.drawHLine(t,10,"green","  10");this.drawHLine(t,16.667,"red"," ");this.drawHLine(t,20,"green","50|20");this.drawHLine(t,16.667*2,"yellow","");this.drawHLine(t,16.667*3,"yellow","");this.drawHLine(t,16.667*4,"yellow","");this.drawHLine(t,50,"green","20|50");this.drawHLine(t,100,"green","10|100");for(var n=0,s=this.datas.length;n<s;n++){var a=this.datas[n];if(!a)continue;var o=a.datas.length;var h=(this.hud_width-this.textSpace)/o;var l=a.datapos;var u=this._x+this.textSpace;t.fillStyle=a.color;for(var c=o;l<c;l++){var f=this.v2y(a.datas[l]*a.scale);t.fillRect(u,f,h,this.hud_height+this._y-f,null);u+=h}for(l=0;l<a.datapos;l++){f=this.v2y(a.datas[l]*a.scale);t.fillRect(u,f,h,this.hud_height+this._y-f,null);u+=h}}t.restore()};_._lastTm=0;_._now=0;_.DATANUM=300;_.inst=null;_.drawTexTm=0;return _}(Ti);var ki=function(r){function h(){this.autoDestroyAtClosed=false;this.url=null;this._timer=null;this._viewCreated=false;this._idMap=null;this._$componentType="Scene";h.__super.call(this);this._setBit(8,true);h.unDestroyedScenes.push(this);this._scene=this;this.createChildren()}v(h,"laya.display.Scene",r);var t=h.prototype;t.createChildren=function(){};t.loadScene=function(t){var e=t.indexOf(".")>-1?t:t+".scene";var i=y.loader.getRes(e);if(i){this.createView(i)}else{y.loader.resetProgress();var r=new _i;r.on("complete",this,this._onSceneLoaded,[e]);r.load(e)}};t._onSceneLoaded=function(t){this.createView(ii.getRes(t))};t.createView=function(t){if(t&&!this._viewCreated){this._viewCreated=true;Et.createByData(this,t)}};t.getNodeByID=function(t){if(this._idMap)return this._idMap[t];return null};t.open=function(t,e){t===void 0&&(t=true);if(t)h.closeAll();h.root.addChild(this);this.onOpened(e)};t.onOpened=function(t){};t.close=function(t){this.onClosed(t);if(this.autoDestroyAtClosed)this.destroy();else this.removeSelf()};t.onClosed=function(t){};t.destroy=function(t){t===void 0&&(t=true);this._idMap=null;r.prototype.destroy.call(this,t);var e=laya.display.Scene.unDestroyedScenes;for(var i=e.length-1;i>-1;i--){if(e[i]===this){e.splice(i,1);return}}};t._sizeChanged=function(){this.event("resize")};d(0,t,"scaleX",r.prototype._$get_scaleX,function(t){if(y.superGet(Ti,this,"scaleX")==t)return;y.superSet(Ti,this,"scaleX",t);this.event("resize")});d(0,t,"scaleY",r.prototype._$get_scaleY,function(t){if(y.superGet(Ti,this,"scaleY")==t)return;y.superSet(Ti,this,"scaleY",t);this.event("resize")});d(0,t,"width",function(){if(this._width)return this._width;var t=0;for(var e=this.numChildren-1;e>-1;e--){var i=this.getChildAt(e);if(i._visible){t=Math.max(i._x+i.width*i.scaleX,t)}}return t},function(t){if(y.superGet(Ti,this,"width")==t)return;y.superSet(Ti,this,"width",t);this.callLater(this._sizeChanged)});d(0,t,"timer",function(){return this._timer||y.timer},function(t){this._timer=t});d(0,t,"height",function(){if(this._height)return this._height;var t=0;for(var e=this.numChildren-1;e>-1;e--){var i=this.getChildAt(e);if(i._visible){t=Math.max(i._y+i.height*i.scaleY,t)}}return t},function(t){if(y.superGet(Ti,this,"height")==t)return;y.superSet(Ti,this,"height",t);this.callLater(this._sizeChanged)});d(1,h,"root",function(){if(!h._root){h._root=y.stage.addChild(new Ti);h._root.name="root";y.stage.on("resize",null,t);function t(){h._root.size(y.stage.width,y.stage.height);h._root.event("resize")}t()}return h._root},laya.display.Sprite._$SET_root);h.load=function(n,s,e){y.loader.resetProgress();var a=new _i;a.on("progress",null,o);a.once("complete",null,t);a.load(n);function o(t){if(h._loadPage)h._loadPage.event("progress",t);e&&e.runWith(t)}function t(){a.off("progress",null,o);var t=ii.getRes(n);if(!t)throw"Can not find scene:"+n;if(!t.props)throw"Scene data is error:"+n;var e=t.props.runtime?t.props.runtime:t.type;var i=Vt.getClass(e);if(t.props.renderType=="instance"){var r=i.instance||(i.instance=new i)}else{r=new i}if(r&&r instanceof laya.display.Node){r.url=n;if(!r._getBit(8)){s&&s.runWith(r)}else{r.on("onViewCreated",null,function(){s&&s.runWith(r)});r.createView(t)}h.hideLoadingPage()}else{throw"Can not find scene:"+e}}};h.open=function(t,e,i,r,n){e===void 0&&(e=true);if(i instanceof laya.utils.Handler){var s=r;r=i;i=s}h.showLoadingPage();h.load(t,b.create(null,this._onSceneLoaded,[e,r,i]),n)};h._onSceneLoaded=function(t,e,i,r){r.open(t,i);if(e)e.runWith(r)};h.close=function(t,e){e===void 0&&(e="");var i=false;var r=laya.display.Scene.unDestroyedScenes;for(var n=0,s=r.length;n<s;n++){var a=r[n];if(a&&a.parent&&a.url===t&&a.name==e){a.close();i=true}}return i};h.closeAll=function(){var t=laya.display.Scene.root;for(var e=0,i=t.numChildren;e<i;e++){var r=t.getChildAt(0);if(r instanceof laya.display.Scene)r.close();else r.removeSelf()}};h.destroy=function(t,e){e===void 0&&(e="");var i=false;var r=laya.display.Scene.unDestroyedScenes;for(var n=0,s=r.length;n<s;n++){var a=r[n];if(a.url===t&&a.name==e){a.destroy();i=true}}return i};h.gc=function(){qe.destroyUnusedResources()};h.setLoadingPage=function(t){if(h._loadPage!=t){h._loadPage=t}};h.showLoadingPage=function(t,e){e===void 0&&(e=500);if(h._loadPage){y.systemTimer.clear(null,h._showLoading);y.systemTimer.clear(null,h._hideLoading);y.systemTimer.once(e,null,h._showLoading,[t],false)}};h._showLoading=function(t){y.stage.addChild(h._loadPage);h._loadPage.onOpened(t)};h._hideLoading=function(){h._loadPage.close()};h.hideLoadingPage=function(t){t===void 0&&(t=500);if(h._loadPage){y.systemTimer.clear(null,h._showLoading);y.systemTimer.clear(null,h._hideLoading);y.systemTimer.once(t,null,h._hideLoading)}};h.unDestroyedScenes=[];h._root=null;h._loadPage=null;return h}(Ti);var Ui=function(e){function n(){this._focus=false;this._multiline=false;this._editable=true;this._restrictPattern=null;this._type="text";this._prompt="";this._promptColor="#A9A9A9";this._originColor="#000000";this._content="";n.__super.call(this);this._maxChars=1e5;this._width=100;this._height=20;this.multiline=false;this.overflow="scroll";this.on("mousedown",this,this._onMouseDown);this.on("undisplay",this,this._onUnDisplay)}v(n,"laya.display.Input",e);var t=n.prototype;t.setSelection=function(t,e){this.focus=true;laya.display.Input.inputElement.selectionStart=t;laya.display.Input.inputElement.selectionEnd=e};t._onUnDisplay=function(t){this.focus=false};t._onMouseDown=function(t){this.focus=true};t._syncInputTransform=function(){var t=this.nativeInput;var e=xe.getTransformRelativeToWindow(this,this.padding[3],this.padding[0]);var i=this._width-this.padding[1]-this.padding[3];var r=this._height-this.padding[0]-this.padding[2];if(Wt.isConchApp){t.setScale(e.scaleX,e.scaleY);t.setSize(i,r);t.setPos(e.x,e.y)}else{n.inputContainer.style.transform=n.inputContainer.style.webkitTransform="scale("+e.scaleX+","+e.scaleY+") rotate("+y.stage.canvasDegree+"deg)";t.style.width=i+"px";t.style.height=r+"px";n.inputContainer.style.left=e.x+"px";n.inputContainer.style.top=e.y+"px"}};t.select=function(){this.nativeInput.select()};t._setInputMethod=function(){n.input.parentElement&&n.inputContainer.removeChild(n.input);n.area.parentElement&&n.inputContainer.removeChild(n.area);n.inputElement=this._multiline?n.area:n.input;n.inputContainer.appendChild(n.inputElement);if(Ri.RightToLeft){n.inputElement.style.direction="rtl"}};t._focusIn=function(){laya.display.Input.isInputting=true;var t=this.nativeInput;this._focus=true;var e=t.style;e.whiteSpace=this.wordWrap?"pre-wrap":"nowrap";this._setPromptColor();t.readOnly=!this._editable;if(Wt.isConchApp){t.setType(this._type);t.setForbidEdit(!this._editable)}t.maxLength=this._maxChars;var i=this.padding;t.type=this._type;t.value=this._content;t.placeholder=this._prompt;y.stage.off("keydown",this,this._onKeyDown);y.stage.on("keydown",this,this._onKeyDown);y.stage.focus=this;this.event("focus");if(Yt.onPC)t.focus();if(!Yt.onMiniGame&&!Yt.onBDMiniGame&&!Yt.onQGMiniGame&&!Yt.onKGMiniGame){var r=this._text;this._text=null}this.typeset();t.setColor(this._originColor);t.setFontSize(this.fontSize);t.setFontFace(Yt.onIPhone?Ri.fontFamilyMap[this.font]||this.font:this.font);if(Wt.isConchApp){t.setMultiAble&&t.setMultiAble(this._multiline)}e.lineHeight=this.leading+this.fontSize+"px";e.fontStyle=this.italic?"italic":"normal";e.fontWeight=this.bold?"bold":"normal";e.textAlign=this.align;e.padding="0 0";this._syncInputTransform();if(!Wt.isConchApp&&Yt.onPC)y.systemTimer.frameLoop(1,this,this._syncInputTransform)};t._setPromptColor=function(){n.promptStyleDOM=Yt.getElementById("promptStyle");if(!n.promptStyleDOM){n.promptStyleDOM=Yt.createElement("style");n.promptStyleDOM.setAttribute("id","promptStyle");Yt.document.head.appendChild(n.promptStyleDOM)}n.promptStyleDOM.innerText="input::-webkit-input-placeholder, textarea::-webkit-input-placeholder {"+"color:"+this._promptColor+"}"+"input:-moz-placeholder, textarea:-moz-placeholder {"+"color:"+this._promptColor+"}"+"input::-moz-placeholder, textarea::-moz-placeholder {"+"color:"+this._promptColor+"}"+"input:-ms-input-placeholder, textarea:-ms-input-placeholder {"+"color:"+this._promptColor+"}"};t._focusOut=function(){laya.display.Input.isInputting=false;this._focus=false;this._text=null;this._content=this.nativeInput.value;if(!this._content){y.superSet(Ri,this,"text",this._prompt);y.superSet(Ri,this,"color",this._promptColor)}else{y.superSet(Ri,this,"text",this._content);y.superSet(Ri,this,"color",this._originColor)}y.stage.off("keydown",this,this._onKeyDown);y.stage.focus=null;this.event("blur");this.event("change");if(Wt.isConchApp)this.nativeInput.blur();Yt.onPC&&y.systemTimer.clear(this,this._syncInputTransform)};t._onKeyDown=function(t){if(t.keyCode===13){if(Yt.onMobile&&!this._multiline)this.focus=false;this.event("enter")}};t.changeText=function(t){this._content=t;if(this._focus){this.nativeInput.value=t||"";this.event("change")}else e.prototype.changeText.call(this,t)};d(0,t,"color",e.prototype._$get_color,function(t){if(this._focus)this.nativeInput.setColor(t);y.superSet(Ri,this,"color",this._content?t:this._promptColor);this._originColor=t});d(0,t,"multiline",function(){return this._multiline},function(t){this._multiline=t;this.valign=t?"top":"middle"});d(0,t,"maxChars",function(){return this._maxChars},function(t){if(t<=0)t=1e5;this._maxChars=t});d(0,t,"text",function(){if(this._focus)return this.nativeInput.value;else return this._content||""},function(t){y.superSet(Ri,this,"color",this._originColor);t+="";if(this._focus){this.nativeInput.value=t||"";this.event("change")}else{if(!this._multiline)t=t.replace(/\r?\n/g,"");this._content=t;if(t)y.superSet(Ri,this,"text",t);else{y.superSet(Ri,this,"text",this._prompt);y.superSet(Ri,this,"color",this.promptColor)}}});d(0,t,"nativeInput",function(){return this._multiline?n.area:n.input});d(0,t,"focus",function(){return this._focus},function(t){var e=this.nativeInput;if(this._focus!==t){if(t){if(e.target){e.target._focusOut()}else{this._setInputMethod()}e.target=this;this._focusIn()}else{e.target=null;this._focusOut();Yt.document.body.scrollTop=0;e.blur();if(Wt.isConchApp)e.setPos(-1e4,-1e4);else if(n.inputContainer.contains(e))n.inputContainer.removeChild(e)}}});d(0,t,"editable",function(){return this._editable},function(t){this._editable=t;if(Wt.isConchApp){n.input.setForbidEdit(!t)}});d(0,t,"bgColor",e.prototype._$get_bgColor,function(t){y.superSet(Ri,this,"bgColor",t);if(Wt.isConchApp)this.nativeInput.setBgColor(t)});d(0,t,"restrict",function(){if(this._restrictPattern){return this._restrictPattern.source}return""},function(t){if(t){t="[^"+t+"]";if(t.indexOf("^^")>-1)t=t.replace("^^","");this._restrictPattern=new RegExp(t,"g")}else this._restrictPattern=null});d(0,t,"prompt",function(){return this._prompt},function(t){if(!this._text&&t)y.superSet(Ri,this,"color",this._promptColor);this.promptColor=this._promptColor;if(this._text)y.superSet(Ri,this,"text",this._text==this._prompt?t:this._text);else y.superSet(Ri,this,"text",t);this._prompt=Ri.langPacks&&Ri.langPacks[t]?Ri.langPacks[t]:t});d(0,t,"promptColor",function(){return this._promptColor},function(t){this._promptColor=t;if(!this._content)y.superSet(Ri,this,"color",t)});d(0,t,"type",function(){return this._type},function(t){if(t==="password")this._getTextStyle().asPassword=true;else this._getTextStyle().asPassword=false;this._type=t});n.__init__=function(){n._createInputElement();if(Yt.onMobile){var t=false;if(Yt.onMiniGame||Yt.onBDMiniGame||Yt.onQGMiniGame||Yt.onKGMiniGame){t=true}Wt.canvas.addEventListener(n.IOS_IFRAME?t?"touchend":"click":"touchend",n._popupInputMethod)}};n._popupInputMethod=function(t){if(!laya.display.Input.isInputting)return;var e=laya.display.Input.inputElement;e.focus()};n._createInputElement=function(){n._initInput(n.area=Yt.createElement("textarea"));n._initInput(n.input=Yt.createElement("input"));n.inputContainer=Yt.createElement("div");n.inputContainer.style.position="absolute";n.inputContainer.style.zIndex=1e5;Yt.container.appendChild(n.inputContainer);n.inputContainer.setPos=function(t,e){n.inputContainer.style.left=t+"px";n.inputContainer.style.top=e+"px"}};n._initInput=function(e){var t=e.style;t.cssText="position:absolute;overflow:hidden;resize:none;transform-origin:0 0;-webkit-transform-origin:0 0;-moz-transform-origin:0 0;-o-transform-origin:0 0;";t.resize="none";t.backgroundColor="transparent";t.border="none";t.outline="none";t.zIndex=1;e.addEventListener("input",n._processInputting);e.addEventListener("mousemove",n._stopEvent);e.addEventListener("mousedown",n._stopEvent);e.addEventListener("touchmove",n._stopEvent);e.setFontFace=function(t){e.style.fontFamily=t};if(!Wt.isConchApp){e.setColor=function(t){e.style.color=t};e.setFontSize=function(t){e.style.fontSize=t+"px"}}};n._processInputting=function(t){var e=laya.display.Input.inputElement.target;if(!e)return;var i=laya.display.Input.inputElement.value;if(e._restrictPattern){i=i.replace(/\u2006|\x27/g,"");if(e._restrictPattern.test(i)){i=i.replace(e._restrictPattern,"");laya.display.Input.inputElement.value=i}}e._text=i;e.event("input")};n._stopEvent=function(t){if(t.type=="touchmove")t.preventDefault();t.stopPropagation&&t.stopPropagation()};n.TYPE_TEXT="text";n.TYPE_PASSWORD="password";n.TYPE_EMAIL="email";n.TYPE_URL="url";n.TYPE_NUMBER="number";n.TYPE_RANGE="range";n.TYPE_DATE="date";n.TYPE_MONTH="month";n.TYPE_WEEK="week";n.TYPE_TIME="time";n.TYPE_DATE_TIME="datetime";n.TYPE_DATE_TIME_LOCAL="datetime-local";n.TYPE_SEARCH="search";n.input=null;n.area=null;n.inputElement=null;n.inputContainer=null;n.confirmButton=null;n.promptStyleDOM=null;n.inputHeight=45;n.isInputting=false;n.stageMatrix=null;a(n,["IOS_IFRAME",function(){return this.IOS_IFRAME=Yt.onIOS&&Yt.window.top!=Yt.window.self}]);return n}(Ri);var Wi=function(r){function c(){this._frames=null;this._url=null;c.__super.call(this);this._setControlNode(this)}v(c,"laya.display.Animation",r);var t=c.prototype;t.destroy=function(t){t===void 0&&(t=true);this.stop();laya.display.Sprite.prototype.destroy.call(this,t);this._frames=null;this._labels=null};t.play=function(t,e,i){t===void 0&&(t=0);e===void 0&&(e=true);i===void 0&&(i="");if(i)this._setFramesFromCache(i,true);r.prototype.play.call(this,t,e,i)};t._setFramesFromCache=function(t,e){e===void 0&&(e=false);if(this._url)t=this._url+"#"+t;if(t&&c.framesMap[t]){var i=c.framesMap[t];if(i instanceof Array){this._frames=c.framesMap[t];this._count=this._frames.length}else{if(i.nodeRoot){c.framesMap[t]=Hi.parseAnimationByData(i);i=c.framesMap[t]}this._frames=i.frames;this._count=this._frames.length;if(!this._frameRateChanged)this._interval=i.interval;this._labels=this._copyLabels(i.labels)}return true}else{if(e)console.log("ani not found:",t)}return false};t._copyLabels=function(t){if(!t)return null;var e;e={};var i;for(i in t){e[i]=xe.copyArray([],t[i])}return e};t._frameLoop=function(){if(this._visible&&this._style.alpha>.01&&this._frames){r.prototype._frameLoop.call(this)}};t._displayToIndex=function(t){if(this._frames)this.graphics=this._frames[t]};t.clear=function(){r.prototype.clear.call(this);this.stop();this.graphics=null;this._frames=null;this._labels=null;return this};t.loadImages=function(t,e){e===void 0&&(e="");this._url="";if(!this._setFramesFromCache(e)){this.frames=c.framesMap[e]?c.framesMap[e]:c.createFrames(t,e)}return this};t.loadAtlas=function(e,i,r){r===void 0&&(r="");this._url="";var n=this;if(!n._setFramesFromCache(r)){function t(t){if(e===t){n.frames=c.framesMap[r]?c.framesMap[r]:c.createFrames(e,r);if(i)i.run()}}if(ii.getAtlas(e))t(e);else y.loader.load(e,b.create(null,t,[e]),null,"atlas")}return this};t.loadAnimation=function(t,e,i){this._url=t;var r=this;if(!this._actionName)this._actionName="";if(!r._setFramesFromCache(this._actionName)){if(!i||ii.getAtlas(i)){this._loadAnimationData(t,e,i)}else{y.loader.load(i,b.create(this,this._loadAnimationData,[t,e,i]),null,"atlas")}}else{r._setFramesFromCache(this._actionName,true);this.index=0;if(e)e.run()}return this};t._loadAnimationData=function(o,h,t){var l=this;if(t&&!ii.getAtlas(t)){console.warn("atlas load fail:"+t);return}var u=this;function e(t){if(!ii.getRes(t)){if(c.framesMap[o+"#"]){u._setFramesFromCache(l._actionName,true);l.index=0;l._resumePlay();if(h)h.run()}return}if(o===t){var e;if(!c.framesMap[o+"#"]){var i=Hi.parseAnimationData(ii.getRes(o));if(!i)return;var r=i.animationList;var n=0,s=r.length;var a;for(n=0;n<s;n++){e=r[n];c.framesMap[o+"#"+e.name]=e;if(!a)a=e}if(a){c.framesMap[o+"#"]=a;u._setFramesFromCache(l._actionName,true);l.index=0}l._resumePlay()}else{u._setFramesFromCache(l._actionName,true);l.index=0;l._resumePlay()}if(h)h.run()}ii.clearRes(o)}if(ii.getRes(o))e(o);else y.loader.load(o,b.create(null,e,[o]),null,"json")};d(0,t,"frames",function(){return this._frames},function(t){this._frames=t;if(t){this._count=t.length;if(this._actionName)this._setFramesFromCache(this._actionName,true);this.index=this._index}});d(0,t,"autoPlay",null,function(t){if(t)this.play();else this.stop()});d(0,t,"source",null,function(t){if(t.indexOf(".ani")>-1)this.loadAnimation(t);else if(t.indexOf(".json")>-1||t.indexOf("als")>-1||t.indexOf("atlas")>-1)this.loadAtlas(t);else this.loadImages(t.split(","))});d(0,t,"autoAnimation",null,function(t){this.play(0,true,t)});c.createFrames=function(t,e){var i;if(typeof t=="string"){var r=ii.getAtlas(t);if(r&&r.length){i=[];for(var n=0,s=r.length;n<s;n++){var a=new le;a.drawImage(ii.getRes(r[n]),0,0);i.push(a)}}}else if(t instanceof Array){i=[];for(n=0,s=t.length;n<s;n++){a=new le;a.loadImage(t[n],0,0);i.push(a)}}if(e)c.framesMap[e]=i;return i};c.clearCache=function(t){var e=c.framesMap;var i;var r=t+"#";for(i in e){if(i===t||i.indexOf(r)===0){delete c.framesMap[i]}}};c.framesMap={};return c}(Ii);var Vi=function(t){function s(t,e,i,r,n){this._params2dQuick2=null;this._shaderValueWidth=0;this._shaderValueHeight=0;s.__super.call(this,t,e,i,r,n)}v(s,"laya.webgl.shader.d2.Shader2X",t);var e=s.prototype;e._disposeResource=function(){t.prototype._disposeResource.call(this);this._params2dQuick2=null};e.upload2dQuick2=function(t){this.upload(t,this._params2dQuick2||this._make2dQuick2())};e._make2dQuick2=function(){if(!this._params2dQuick2){this._params2dQuick2=[];var t=this._params,e;for(var i=0,r=t.length;i<r;i++){e=t[i];if(e.name!=="size")this._params2dQuick2.push(e)}}return this._params2dQuick2};s.create=function(t,e,i,r,n){return new s(t,e,i,r,n)};return s}(Pi);var Gi=function(t){function l(){this._targetDic=null;this._animationData=null;this._usedFrames=null;l.__super.call(this);if(l._sortIndexFun===null){l._sortIndexFun=B.sortByKey("index",false,true)}}v(l,"laya.display.FrameAnimation",t);var e=l.prototype;e._setUp=function(t,e){this._targetDic=t;this._animationData=e;this.interval=1e3/e.frameRate;if(e.parsed){this._count=e.count;this._labels=e.labels;this._usedFrames=e.animationNewFrames}else{this._usedFrames=[];this._calculateDatas();e.parsed=true;e.labels=this._labels;e.count=this._count;e.animationNewFrames=this._usedFrames}};e.clear=function(){t.prototype.clear.call(this);this._targetDic=null;this._animationData=null;return this};e._displayToIndex=function(t){if(!this._animationData)return;if(t<0)t=0;if(t>this._count)t=this._count;var e=this._animationData.nodes,i=0,r=e.length;for(i=0;i<r;i++){this._displayNodeToFrame(e[i],t)}};e._displayNodeToFrame=function(t,e,i){if(!i)i=this._targetDic;var r=i[t.target];if(!r){return}var n=t.frames,s,a,o;var h=t.keys,l=0,u=h.length;for(l=0;l<u;l++){s=h[l];a=n[s];if(a.length>e){o=a[e]}else{o=a[a.length-1]}r[s]=o}var c=t.funkeys;u=c.length;var f;if(u==0)return;for(l=0;l<u;l++){s=c[l];f=n[s];if(f[e]!==undefined){r[s]&&r[s].apply(r,f[e])}}};e._calculateDatas=function(){if(!this._animationData)return;var t=this._animationData.nodes,e=0,i=t.length,r;this._count=0;for(e=0;e<i;e++){r=t[e];this._calculateKeyFrames(r)}this._count+=1};e._calculateKeyFrames=function(t){var e=t.keyframes,i,r,n=t.target;if(!t.frames)t.frames={};if(!t.keys)t.keys=[];else t.keys.length=0;if(!t.funkeys)t.funkeys=[];else t.funkeys.length=0;if(!t.initValues)t.initValues={};for(i in e){var s=i.indexOf("()")!=-1;r=e[i];if(s)i=i.substr(0,i.length-2);if(!t.frames[i]){t.frames[i]=[]}if(!s){if(this._targetDic&&this._targetDic[n]){t.initValues[i]=this._targetDic[n][i]}r.sort(l._sortIndexFun);t.keys.push(i);this._calculateNodePropFrames(r,t.frames[i],i,n)}else{t.funkeys.push(i);var a=t.frames[i];for(var o=0;o<r.length;o++){var h=r[o];a[h.index]=h.value;if(h.index>this._count)this._count=h.index}}}};e.resetNodes=function(){if(!this._targetDic)return;if(!this._animationData)return;var t=this._animationData.nodes,e=0,i=t.length;var r;var n;for(e=0;e<i;e++){r=t[e];n=r.initValues;if(!n)continue;var s=this._targetDic[r.target];if(!s)continue;var a;for(a in n){s[a]=n[a]}}};e._calculateNodePropFrames=function(t,e,i,r){var n=0,s=t.length-1;e.length=t[s].index+1;for(n=0;n<s;n++){this._dealKeyFrame(t[n]);this._calculateFrameValues(t[n],t[n+1],e)}if(s==0){e[0]=t[0].value;if(this._usedFrames)this._usedFrames[t[0].index]=true}this._dealKeyFrame(t[n])};e._dealKeyFrame=function(t){if(t.label&&t.label!="")this.addLabel(t.label,t.index)};e._calculateFrameValues=function(t,e,i){var r=0,n;var s=t.index,a=e.index;var o=t.value;var h=e.value-t.value;var l=a-s;var u=this._usedFrames;if(a>this._count)this._count=a;if(t.tween){n=de[t.tweenMethod];if(n==null)n=de.linearNone;for(r=s;r<a;r++){i[r]=n(r-s,o,h,l);if(u)u[r]=true}}else{for(r=s;r<a;r++){i[r]=o}}if(u){u[t.index]=true;u[e.index]=true}i[e.index]=e.value};l._sortIndexFun=null;return l}(Ii);var Xi=function(t){function a(t,e,i,r,n){t===void 0&&(t=0);e===void 0&&(e=0);i===void 0&&(i=1);r===void 0&&(r=true);n===void 0&&(n=false);a.__super.call(this,i,r);this._glTextureType=3553;this._width=t;this._height=e;this._canRead=n;this._setWarpMode(10242,this._wrapModeU);this._setWarpMode(10243,this._wrapModeV);this._setFilterMode(this._filterMode);this._setAnisotropy(this._anisoLevel);if(this._mipmap){this._mipmapCount=Math.max(Math.ceil(Math.log2(t))+1,Math.ceil(Math.log2(2))+1);for(var s=0;s<this._mipmapCount;s++)this._setPixels(null,s,Math.max(t>>s,1),Math.max(e>>s,1));this._setGPUMemory(t*e*4*(1+1/3))}else{this._mipmapCount=1;this._setGPUMemory(t*e*4)}}v(a,"laya.resource.Texture2D",t);var e=a.prototype;e._getFormatByteCount=function(){switch(this._format){case 0:return 3;case 1:return 4;case 2:return 1;default:throw"Texture2D: unknown format."}};e._setPixels=function(t,e,i,r){var n=Xt.instance;var s=this._glTextureType;var a=this._getGLFormat();ft.bindTexture(n,s,this._glTexture);if(this.format===0){n.pixelStorei(3317,1);n.texImage2D(s,e,a,i,r,0,a,5121,t);n.pixelStorei(3317,4)}else{n.texImage2D(s,e,a,i,r,0,a,5121,t)}};e._calcualatesCompressedDataSize=function(t,e,i){switch(t){case 3:case 5:return(e+3>>2)*(i+3>>2)*8;case 4:return(e+3>>2)*(i+3>>2)*16;case 11:case 12:return Math.floor((Math.max(e,8)*Math.max(i,8)*4+7)/8);case 9:case 10:return Math.floor((Math.max(e,16)*Math.max(i,8)*2+7)/8);default:return 0}};e._pharseDDS=function(t){var e=827611204;var i=894720068;var r=4;var n=131072;var s=542327876;var a=31;var o=0;var h=1;var l=2;var u=3;var c=4;var f=7;var _=20;var d=21;var p=new Int32Array(t,0,a);if(p[o]!=s)throw"Invalid magic number in DDS header";if(!(p[_]&r))throw"Unsupported format, must contain a FourCC code";var v=p[d];switch(this._format){case 3:if(v!==e)throw"the FourCC code is not same with texture format.";break;case 4:if(v!==i)throw"the FourCC code is not same with texture format.";break;default:throw"unknown texture format."}var m=1;if(p[l]&n){m=Math.max(1,p[f]);if(!this._mipmap)throw"the mipmap is not same with Texture2D."}else{if(this._mipmap)throw"the mipmap is not same with Texture2D."}var g=p[c];var y=p[u];this._width=g;this._height=y;var x=p[h]+4;this._upLoadCompressedTexImage2D(t,g,y,m,x,0)};e._pharseKTX=function(t){var e=13;var i=4;var r=7;var n=6;var s=11;var a=12;var o=new Uint8Array(t,0,12);if(o[0]!=171||o[1]!=75||o[2]!=84||o[3]!=88||o[4]!=32||o[5]!=49||o[6]!=49||o[7]!=187||o[8]!=13||o[9]!=10||o[10]!=26||o[11]!=10)throw"Invalid fileIdentifier in KTX header";var h=new Int32Array(o.buffer,o.length,e);var l=h[i];switch(l){case ft._compressedTextureEtc1.COMPRESSED_RGB_ETC1_WEBGL:this._format=5;break;default:throw"unknown texture format."}var u=h[s];var c=h[n];var f=h[r];this._width=c;this._height=f;var _=64+h[a];this._upLoadCompressedTexImage2D(t,c,f,u,_,4)};e._pharsePVR=function(t){var e=0;var i=1;var r=2;var n=3;var s=55727696;var a=13;var o=0;var h=2;var l=6;var u=7;var c=11;var f=12;var _=new Int32Array(t,0,a);if(_[o]!=s)throw"Invalid magic number in PVR header";var d=_[h];switch(d){case e:this._format=9;break;case r:this._format=11;break;case i:this._format=10;break;case n:this._format=12;break;default:throw"Texture2D:unknown PVR format."}var p=_[c];var v=_[u];var m=_[l];this._width=v;this._height=m;var g=_[f]+52;this._upLoadCompressedTexImage2D(t,v,m,p,g,0)};e._upLoadCompressedTexImage2D=function(t,e,i,r,n,s){var a=Xt.instance;var o=this._glTextureType;ft.bindTexture(a,o,this._glTexture);var h=this._getGLFormat();var l=n;for(var u=0;u<r;u++){l+=s;var c=this._calcualatesCompressedDataSize(this._format,e,i);var f=new Uint8Array(t,l,c);a.compressedTexImage2D(o,u,h,e,i,0,f);e=Math.max(e>>1,1);i=Math.max(i>>1,1);l+=c}var _=l;this._setGPUMemory(_);this._readyed=true;this._activeResource()};e.loadImageSource=function(t,e){e===void 0&&(e=false);var i=t.width;var r=t.height;this._width=i;this._height=r;if(!(this._isPot(i)&&this._isPot(r)))this._mipmap=false;this._setWarpMode(10242,this._wrapModeU);this._setWarpMode(10243,this._wrapModeV);this._setFilterMode(this._filterMode);var n=Xt.instance;ft.bindTexture(n,this._glTextureType,this._glTexture);var s=this._getGLFormat();if(Wt.isConchApp){if(t instanceof laya.resource.HTMLCanvas){n.texImage2D(this._glTextureType,0,6408,6408,5121,t)}else{t.setPremultiplyAlpha(e);n.texImage2D(this._glTextureType,0,6408,6408,5121,t)}}else{e&&n.pixelStorei(37441,true);n.texImage2D(this._glTextureType,0,s,s,5121,t);e&&n.pixelStorei(37441,false)}if(this._mipmap){n.generateMipmap(this._glTextureType);this._setGPUMemory(i*r*4*(1+1/3))}else{this._setGPUMemory(i*r*4)}if(this._canRead){if(Wt.isConchApp){this._pixels=new Uint8Array(t._nativeObj.getImageData(0,0,i,r))}else{Yt.canvas.size(i,r);Yt.canvas.clear();Yt.context.drawImage(t,0,0,i,r);this._pixels=new Uint8Array(Yt.context.getImageData(0,0,i,r).data.buffer)}}this._readyed=true;this._activeResource()};e.setPixels=function(t,e){e===void 0&&(e=0);if(!t)throw"Texture2D:pixels can't be null.";var i=Math.max(this._width>>e,1);var r=Math.max(this._height>>e,1);var n=i*r*this._getFormatByteCount();if(t.length<n)throw"Texture2D:pixels length should at least "+n+".";this._setPixels(t,e,i,r);if(this._canRead)this._pixels=t;this._readyed=true;this._activeResource()};e.setSubPixels=function(t,e,i,r,n,s){s===void 0&&(s=0);if(!n)throw"Texture2D:pixels can't be null.";var a=Xt.instance;var o=this._glTextureType;ft.bindTexture(a,o,this._glTexture);var h=this._getGLFormat();if(this._format===0){a.pixelStorei(3317,1);a.texSubImage2D(o,s,t,e,i,r,h,5121,n);a.pixelStorei(3317,4)}else{a.texSubImage2D(o,s,t,e,i,r,h,5121,n)}this._readyed=true;this._activeResource()};e.setCompressData=function(t){switch(this._format){case 3:case 4:this._pharseDDS(t);break;case 5:this._pharseKTX(t);break;case 9:case 10:case 11:case 12:this._pharsePVR(t);break;default:throw"Texture2D:unkonwn format."}};e._recoverResource=function(){};e.getPixels=function(){if(this._canRead)return this._pixels;else throw new Error("Texture2D: must set texture canRead is true.")};d(0,e,"mipmapCount",function(){return this._mipmapCount});d(0,e,"defaulteTexture",function(){return laya.resource.Texture2D.grayTexture});a.__init__=function(){var t=new Uint8Array(3);t[0]=128;t[1]=128;t[2]=128;a.grayTexture=new a(1,1,0,false,false);a.grayTexture.setPixels(t);a.grayTexture.lock=true;t[0]=255;t[1]=255;t[2]=255;a.whiteTexture=new a(1,1,0,false,false);a.whiteTexture.setPixels(t);a.whiteTexture.lock=true;t[0]=0;t[1]=0;t[2]=0;a.blackTexture=new a(1,1,0,false,false);a.blackTexture.setPixels(t);a.blackTexture.lock=true};a._parse=function(t,e,i){var r=i?new a(i[0],i[1],i[2],i[3],i[4]):new a(0,0);if(e){r.wrapModeU=e.wrapModeU;r.wrapModeV=e.wrapModeV;r.filterMode=e.filterMode;r.anisoLevel=e.anisoLevel}switch(r._format){case 0:case 1:r.loadImageSource(t);break;case 3:case 4:case 5:case 9:case 10:case 11:case 12:r.setCompressData(t);break;default:throw"Texture2D:unkonwn format."}return r};a.load=function(t,e){y.loader.create(t,e,null,"TEXTURE2D")};a.grayTexture=null;a.whiteTexture=null;a.blackTexture=null;return a}(Li);var Yi=function(t){function n(t,e,i,r){this._mgrKey=0;i===void 0&&(i=0);r===void 0&&(r=0);n.__super.call(this,i,false);this._glTextureType=3553;this._width=t;this._height=e;this._depthStencilFormat=r;this._create(t,e);this.lock=true}v(n,"laya.resource.RenderTexture2D",t);var e=n.prototype;e.getIsReady=function(){return true};e._create=function(t,e){var i=Xt.instance;this._frameBuffer=i.createFramebuffer();ft.bindTexture(i,this._glTextureType,this._glTexture);var r=this._getGLFormat();i.texImage2D(this._glTextureType,0,r,t,e,0,r,5121,null);this._setGPUMemory(t*e*4);i.bindFramebuffer(36160,this._frameBuffer);i.framebufferTexture2D(36160,36064,3553,this._glTexture,0);if(this._depthStencilFormat!==3){this._depthStencilBuffer=i.createRenderbuffer();i.bindRenderbuffer(36161,this._depthStencilBuffer);switch(this._depthStencilFormat){case 0:i.renderbufferStorage(36161,33189,t,e);i.framebufferRenderbuffer(36160,36096,36161,this._depthStencilBuffer);break;case 1:i.renderbufferStorage(36161,36168,t,e);i.framebufferRenderbuffer(36160,36128,36161,this._depthStencilBuffer);break;case 2:i.renderbufferStorage(36161,34041,t,e);i.framebufferRenderbuffer(36160,33306,36161,this._depthStencilBuffer);break;default:}}i.bindFramebuffer(36160,null);i.bindRenderbuffer(36161,null);this._setWarpMode(10242,this._wrapModeU);this._setWarpMode(10243,this._wrapModeV);this._setFilterMode(this._filterMode);this._setAnisotropy(this._anisoLevel);this._readyed=true;this._activeResource()};e.generateMipmap=function(){if(this._isPot(this.width)&&this._isPot(this.height)){this._mipmap=true;Xt.instance.generateMipmap(this._glTextureType);this._setFilterMode(this._filterMode);this._setGPUMemory(this.width*this.height*4*(1+1/3))}else{this._mipmap=false;this._setGPUMemory(this.width*this.height*4)}};e.start=function(){var t=Xt.instance;Xt.instance.bindFramebuffer(36160,this._frameBuffer);this._lastRT=n._currentActive;n._currentActive=this;this._readyed=true;t.viewport(0,0,this._width,this._height);this._lastWidth=At.width;this._lastHeight=At.height;At.width=this._width;At.height=this._height;bi.activeShader=null};e.end=function(){Xt.instance.bindFramebuffer(36160,null);n._currentActive=null;this._readyed=true};e.restore=function(){var t=Xt.instance;if(this._lastRT!=n._currentActive){Xt.instance.bindFramebuffer(36160,this._lastRT?this._lastRT._frameBuffer:null);n._currentActive=this._lastRT}this._readyed=true;t.viewport(0,0,this._lastWidth,this._lastHeight);At.width=this._lastWidth;At.height=this._lastHeight;bi.activeShader=null};e.clear=function(t,e,i,r){t===void 0&&(t=0);e===void 0&&(e=0);i===void 0&&(i=0);r===void 0&&(r=1);var n=Xt.instance;n.clearColor(t,e,i,r);var s=16384;switch(this._depthStencilFormat){case 33189:s|=256;break;case 36168:s|=1024;break;case 34041:s|=256;s|=1024;break}n.clear(s)};e.getData=function(t,e,i,r){if(Wt.isConchApp&&conchConfig.threadMode==2){throw"native 2 thread mode use getDataAsync"}var n=Xt.instance;n.bindFramebuffer(36160,this._frameBuffer);var s=n.checkFramebufferStatus(36160)===36053;if(!s){n.bindFramebuffer(36160,null);return null}var a=new Uint8Array(this._width*this._height*4);var o=this._getGLFormat();n.readPixels(t,e,i,r,o,5121,a);n.bindFramebuffer(36160,null);return a};e.getDataAsync=function(t,e,i,r,n){var s=Xt.instance;s.bindFramebuffer(36160,this._frameBuffer);s.readPixelsAsync(t,e,i,r,6408,5121,function(t){n(new Uint8Array(t))});s.bindFramebuffer(36160,null)};e.recycle=function(){};e._disposeResource=function(){if(this._frameBuffer){var t=Xt.instance;t.deleteTexture(this._glTexture);t.deleteFramebuffer(this._frameBuffer);t.deleteRenderbuffer(this._depthStencilBuffer);this._glTexture=null;this._frameBuffer=null;this._depthStencilBuffer=null;this._setGPUMemory(0)}};d(0,e,"depthStencilFormat",function(){return this._depthStencilFormat});d(0,e,"defaulteTexture",function(){return Xi.grayTexture});d(0,e,"sourceWidth",function(){return this._width});d(0,e,"sourceHeight",function(){return this._height});d(0,e,"offsetX",function(){return 0});d(0,e,"offsetY",function(){return 0});d(1,n,"currentActive",function(){return n._currentActive},laya.resource.BaseTexture._$SET_currentActive);n.pushRT=function(){n.rtStack.push({rt:n._currentActive,w:At.width,h:At.height})};n.popRT=function(){var t=Xt.instance;var e=n.rtStack.pop();if(e){if(n._currentActive!=e.rt){Xt.instance.bindFramebuffer(36160,e.rt?e.rt._frameBuffer:null);n._currentActive=e.rt}t.viewport(0,0,e.w,e.h);At.width=e.w;At.height=e.h}};n._currentActive=null;n.rtStack=[];a(n,["defuv",function(){return this.defuv=[0,0,1,0,1,1,0,1]},"flipyuv",function(){return this.flipyuv=[0,1,1,1,1,0,0,0]}]);return n}(Li);var Hi=function(e){var S;function M(){this.animationList=null;this.animationDic=null;this._nodeList=null;this._nodeDefaultProps=null;this._gList=null;this._nodeIDAniDic={};this._rootNode=null;this._nodeGDic=null;M.__super.call(this)}v(M,"laya.utils.GraphicAnimation",e);var t=M.prototype;t._parseNodeList=function(t){if(!this._nodeList)this._nodeList=[];this._nodeDefaultProps[t.compId]=t.props;if(t.compId)this._nodeList.push(t.compId);var e=t.child;if(e){var i=0,r=e.length;for(i=0;i<r;i++){this._parseNodeList(e[i])}}};t._calGraphicData=function(t){this._setUp(null,t);this._createGraphicData();if(this._nodeIDAniDic){var e;for(e in this._nodeIDAniDic){this._nodeIDAniDic[e]=null}}};t._createGraphicData=function(){var t=[];var e=0,i=this.count;var r=this._usedFrames;if(!r)r=[];var n;for(e=0;e<i;e++){if(r[e]||!n){n=this._createFrameGraphic(e)}t.push(n)}this._gList=t};t._createFrameGraphic=function(t){var e=new le;if(!M._rootMatrix)M._rootMatrix=new pt;this._updateNodeGraphic(this._rootNode,t,M._rootMatrix,e);return e};t._updateNodeGraphic=function(t,e,i,r,n){n===void 0&&(n=1);var s;s=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId]);if(!s.resultTransform)s.resultTransform=new pt;var a;a=s.resultTransform;pt.mul(s.transform,i,a);var o;var h=s.alpha*n;if(h<.01)return;if(s.skin){o=this._getTextureByUrl(s.skin);if(o){if(a._checkTransform()){r.drawTexture(o,0,0,s.width,s.height,a,h);s.resultTransform=null}else{r.drawTexture(o,a.tx,a.ty,s.width,s.height,null,h)}}}var l=t.child;if(!l)return;var u=0,c=0;c=l.length;for(u=0;u<c;u++){this._updateNodeGraphic(l[u],e,a,r,h)}};t._updateNoChilds=function(t,e){if(!t.skin)return;var i=this._getTextureByUrl(t.skin);if(!i)return;var r=t.transform;r._checkTransform();var n=false;n=!r._bTransform;if(!n){e.drawTexture(i,0,0,t.width,t.height,r.clone(),t.alpha)}else{e.drawTexture(i,r.tx,r.ty,t.width,t.height,null,t.alpha)}};t._updateNodeGraphic2=function(t,e,i){var r;r=this._nodeGDic[t.compId]=this._getNodeGraphicData(t.compId,e,this._nodeGDic[t.compId]);if(!t.child){this._updateNoChilds(r,i);return}var n=r.transform;n._checkTransform();var s=false;s=!n._bTransform;var a=false;a=s&&(n.tx!=0||n.ty!=0);var o=false;o=n._bTransform||r.alpha!=1;if(o)i.save();if(r.alpha!=1)i.alpha(r.alpha);if(!s)i.transform(n.clone());else if(a)i.translate(n.tx,n.ty);var h=t.child;var l;if(r.skin){l=this._getTextureByUrl(r.skin);if(l){i.drawImage(l,0,0,r.width,r.height)}}if(h){var u=0,c=0;c=h.length;for(u=0;u<c;u++){this._updateNodeGraphic2(h[u],e,i)}}if(o){i.restore()}else{if(!s){i.transform(n.clone().invert())}else if(a){i.translate(-n.tx,-n.ty)}}};t._calculateKeyFrames=function(t){e.prototype._calculateKeyFrames.call(this,t);this._nodeIDAniDic[t.target]=t};t.getNodeDataByID=function(t){return this._nodeIDAniDic[t]};t._getParams=function(t,e,i,r){var n=M._temParam;n.length=e.length;var s=0,a=e.length;for(s=0;s<a;s++){n[s]=this._getObjVar(t,e[s][0],i,e[s][1],r)}return n};t._getObjVar=function(t,e,i,r,n){if(t.hasOwnProperty(e)){var s=t[e];if(i>=s.length)i=s.length-1;return t[e][i]}if(n.hasOwnProperty(e)){return n[e]}return r};t._getNodeGraphicData=function(t,e,i){if(!i)i=new S;if(!i.transform){i.transform=new pt}else{i.transform.identity()}var r=this.getNodeDataByID(t);if(!r)return i;var n=r.frames;var s=this._getParams(n,M._drawTextureCmd,e,this._nodeDefaultProps[t]);var a=s[0];var o=NaN,h=NaN;var l=s[5],u=s[6];var c=s[13],f=s[14];var _=s[7],d=s[8];var p=s[9];var v=s[11],m=s[12];o=s[3];h=s[4];if(o==0||h==0)a=null;if(o==-1)o=0;if(h==-1)h=0;var g;i.skin=a;i.width=o;i.height=h;if(a){g=this._getTextureByUrl(a);if(g){if(!o)o=g.sourceWidth;if(!h)h=g.sourceHeight}else{console.warn("lost skin:",a,",you may load pics first")}}i.alpha=s[10];var y=i.transform;if(c!=0){l=c*o}if(f!=0){u=f*h}if(l!=0||u!=0){y.translate(-l,-u)}var x=null;if(p||_!==1||d!==1||v||m){x=M._tempMt;x.identity();x._bTransform=true;var T=(p-v)*.0174532922222222;var b=(p+m)*.0174532922222222;var w=Math.cos(b);var C=Math.sin(b);var A=Math.sin(T);var E=Math.cos(T);x.a=_*w;x.b=_*C;x.c=-d*A;x.d=d*E;x.tx=x.ty=0}if(x){y=pt.mul(y,x,y)}y.translate(s[1],s[2]);return i};t._getTextureByUrl=function(t){return ii.getRes(t)};t.setAniData=function(t,e){if(t.animations){this._nodeDefaultProps={};this._nodeGDic={};if(this._nodeList)this._nodeList.length=0;this._rootNode=t;this._parseNodeList(t);var i={};var r=[];var n=t.animations;var s=0,a=n.length;var o;for(s=0;s<a;s++){o=n[s];this._labels=null;if(e&&e!=o.name){continue}if(!o)continue;try{this._calGraphicData(o)}catch(t){console.warn("parse animation fail:"+o.name+",empty animation created");this._gList=[]}var h={};h.interval=1e3/o["frameRate"];h.frames=this._gList;h.labels=this._labels;h.name=o.name;r.push(h);i[o.name]=h}this.animationList=r;this.animationDic=i}M._temParam.length=0};t.parseByData=function(t){var e,i;e=t.nodeRoot;i=t.aniO;delete t.nodeRoot;delete t.aniO;this._nodeDefaultProps={};this._nodeGDic={};if(this._nodeList)this._nodeList.length=0;this._rootNode=e;this._parseNodeList(e);this._labels=null;try{this._calGraphicData(i)}catch(t){console.warn("parse animation fail:"+i.name+",empty animation created");this._gList=[]}var r=t;r.interval=1e3/i["frameRate"];r.frames=this._gList;r.labels=this._labels;r.name=i.name;return r};t.setUpAniData=function(t){if(t.animations){var e={};var i=[];var r=t.animations;var n=0,s=r.length;var a;for(n=0;n<s;n++){a=r[n];if(!a)continue;var o={};o.name=a.name;o.aniO=a;o.nodeRoot=t;i.push(o);e[a.name]=o}this.animationList=i;this.animationDic=e}};t._clear=function(){this.animationList=null;this.animationDic=null;this._gList=null;this._nodeGDic=null};M.parseAnimationByData=function(t){if(!M._I)M._I=new M;var e;e=M._I.parseByData(t);M._I._clear();return e};M.parseAnimationData=function(t){if(!M._I)M._I=new M;M._I.setUpAniData(t);var e;e={};e.animationList=M._I.animationList;e.animationDic=M._I.animationDic;M._I._clear();return e};M._temParam=[];M._I=null;M._rootMatrix=null;a(M,["_drawTextureCmd",function(){return this._drawTextureCmd=[["skin",null],["x",0],["y",0],["width",-1],["height",-1],["pivotX",0],["pivotY",0],["scaleX",1],["scaleY",1],["rotation",0],["alpha",1],["skewX",0],["skewY",0],["anchorX",0],["anchorY",0]]},"_tempMt",function(){return this._tempMt=new pt}]);M.__init$=function(){S=function(){function t(){this.skin=null;this.transform=null;this.resultTransform=null;this.width=NaN;this.height=NaN;this.alpha=1}v(t,"");return t}()};return M}(Gi);var zi=function(a){function t(){this._target=null;this._playEvent=null;this._initData={};this._aniKeys=null;this._effectClass=null;t.__super.call(this)}v(t,"laya.display.EffectAnimation",a);var e=t.prototype;e._onOtherBegin=function(t){if(t===this)return;this.stop()};e._addEvent=function(){if(!this._target||!this._playEvent)return;this._setControlNode(this._target);this._target.on(this._playEvent,this,this._onPlayAction)};e._onPlayAction=function(){this.play(0,false)};e.play=function(t,e,i){t===void 0&&(t=0);e===void 0&&(e=true);i===void 0&&(i="");if(!this._target)return;this._target.event("effectbegin",[this]);this._recordInitData();laya.display.AnimationBase.prototype.play.call(this,t,e,i)};e._recordInitData=function(){if(!this._aniKeys)return;var t=0,e=0;e=this._aniKeys.length;var i;for(t=0;t<e;t++){i=this._aniKeys[t];this._initData[i]=this._target[i]}};e._displayToIndex=function(t){if(!this._animationData)return;if(t<0)t=0;if(t>this._count)t=this._count;var e=this._animationData.nodes,i=0,r=e.length;r=r>1?1:r;for(i=0;i<r;i++){this._displayNodeToFrame(e[i],t)}};e._displayNodeToFrame=function(t,e,i){if(!this._target)return;var r=this._target;var n=t.frames,s,a,o;var h=t.keys,l=0,u=h.length;var c=t.secondFrames;var f=0;var _;var d;var p;var v;for(l=0;l<u;l++){s=h[l];a=n[s];f=c[s];if(f==-1){o=this._initData[s]}else{if(e<f){d=t.keyframes[s];p=d[0];if(p.tween){_=de[p.tweenMethod];if(_==null)_=de.linearNone;v=d[1];o=_(e,this._initData[s],v.value-this._initData[s],v.index)}else{o=this._initData[s]}}else{if(a.length>e)o=a[e];else o=a[a.length-1]}}r[s]=o}};e._calculateKeyFrames=function(t){a.prototype._calculateKeyFrames.call(this,t);var e=t.keyframes,i,r,n=t.target;var s={};t.secondFrames=s;for(i in e){r=e[i];if(r.length<=1)s[i]=-1;else s[i]=r[1].index}};d(0,e,"target",function(){return this._target},function(t){if(this._target)this._target.off("effectbegin",this,this._onOtherBegin);this._target=t;if(this._target)this._target.on("effectbegin",this,this._onOtherBegin);this._addEvent()});d(0,e,"playEvent",null,function(t){this._playEvent=t;if(!t)return;this._addEvent()});d(0,e,"effectData",null,function(t){if(t){var e=t["animations"];if(e&&e[0]){var i=e[0];this._setUp({},i);if(i.nodes&&i.nodes[0]){this._aniKeys=i.nodes[0].keys}}}});d(0,e,"effectClass",null,function(t){this._effectClass=Vt.getClass(t);if(this._effectClass){var e=this._effectClass["uiView"];if(e){var i=e["animations"];if(i&&i[0]){var r=i[0];this._setUp({},r);if(r.nodes&&r.nodes[0]){this._aniKeys=r.nodes[0].keys}}}}});t.EFFECT_BEGIN="effectbegin";return t}(Gi);y.__init([m,xt,ci,P,Hi,Et,Wt,rt,ht,he,Lt,Xe,f,Ze])})(window,document,Laya);(function(t,e,i){var r=i.un,n=i.uns,s=i.static,a=i.class,o=i.getset,h=i.__newvec;var l=function(){function t(){}a(t,"LayaMain");return t}();new l})(window,document,Laya);